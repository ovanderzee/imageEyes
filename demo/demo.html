<!DOCTYPE html>
<html>
    <head>
        <title>Image Eyes</title>
        <script src="../dist/imageEyes.js"></script>
        <link rel="stylesheet" type="text/css" href="demo.css" />
    </head>
    <body>
        <h2>Image Eyes</h2>
        <div class="read">this demo was designed to run on localhost:8</div>
        <div class="read">first image loads automatically, the others on hover</div>

        <figure>
            <img class="target" src="http://localhost:8/demo/gull-192909_640.jpg" />
            <figcaption>
                <strong class="name">Gull</strong>
                <em class="description">RGB-image</em>
                <span class="credit">pixabay.com/lizzyliz</span>
            </figcaption>
        </figure>

        <figure>
            <img class="target" src="http://localhost:8/demo/ink-texture-2823603_640.jpg" />
            <figcaption>
                <strong class="name">Ink Texture</strong>
                <em class="description">CMYK-image</em>
                <span class="credit">pixabay.com/DTech</span>
            </figcaption>
        </figure>

        <div id="readout" class="read">
            <span id="xy-coordinate"></span><span id="rgb-sample"></span><span id="rgb-value"></span>
        </div>

        <script>


// start server for localhost at port 8 with npm start
let eyeDropApi
let eyeDropDiameter = 11

const firstImage = document.querySelector('figure img')
const allImages = document.querySelectorAll('figure img')

const xyCoordinateNode = document.getElementById('xy-coordinate')
const rgbSampleNode = document.getElementById('rgb-sample')
const rgbValueNode = document.getElementById('rgb-value')

const mouseMoveHandler = function (event) {
    let domRect = this.getBoundingClientRect()
    let imgX = Math.round(event.x - domRect.x)
    let imgY = Math.round(event.y - domRect.y)
    xyCoordinateNode.innerHTML = `${imgX}, ${imgY}`
    // let color = eyeDropApi.getDropColor(imgX, imgY, eyeDropDiameter)
    let color = eyeDropApi.getPixelColor(imgX, imgY)
    rgbSampleNode.style.background = `rgba(${color.join()})`
    rgbValueNode.innerHTML = JSON.stringify( color )
}

const eyeDropLoader = async function () {
    xyCoordinateNode.textContent = ''
    rgbSampleNode.textContent = ''
    rgbValueNode.textContent = ''
    let t0 = new Date()
    eyeDropApi = await imageEyes(this.src)
    this.addEventListener('mousemove', mouseMoveHandler)
    let t1 = new Date()
    console.log(`loading ${this.src} took ${(t1 - t0) / 1000} seconds`)
}

allImages.forEach((img) => {
    if (img === firstImage) {
        eyeDropLoader.call(firstImage)
    }
    img.addEventListener('mouseover', eyeDropLoader.bind(img))
})

        </script>
    </body>
</html>
