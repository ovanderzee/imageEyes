var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var imageJs=createCommonjsModule((function(module,exports){
/**
 * image-js - Image processing and manipulation in JavaScript
 * @version v0.28.0
 * @link https://github.com/image-js/core
 * @license MIT
 */var factory;factory=function(exports){const bitMethods={getBit(t){return this.data[getSlot(t)]&1<<getShift(t)?1:0},setBit(t){this.data[getSlot(t)]|=1<<getShift(t)},clearBit(t){this.data[getSlot(t)]&=~(1<<getShift(t))},toggleBit(t){this.data[getSlot(t)]^=1<<getShift(t)},getBitXY(t,e){return t>=this.width||e>=this.height?0:this.getBit(e*this.width+t)},setBitXY(t,e){this.setBit(e*this.width+t)},clearBitXY(t,e){this.clearBit(e*this.width+t)},toggleBitXY(t,e){this.toggleBit(e*this.width+t)}};function getSlot(t){return t>>3}function getShift(t){return 7-(7&t)}function setBitMethods(t){for(const e in bitMethods)t.prototype[e]=bitMethods[e]}function checkProcessable(t,e={}){let{bitDepth:r,alpha:i,colorModel:n,components:s,channels:a}=e;if("string"!=typeof t||0===t.length)throw new TypeError("processName must be a string");if(r&&(Array.isArray(r)||(r=[r]),!r.includes(this.bitDepth)))throw new TypeError(`The process: ${t} can only be applied if bit depth is in: ${r}`);if(i&&(Array.isArray(i)||(i=[i]),!i.includes(this.alpha)))throw new TypeError(`The process: ${t} can only be applied if alpha is in: ${i}`);if(n&&(Array.isArray(n)||(n=[n]),!n.includes(this.colorModel)))throw new TypeError(`The process: ${t} can only be applied if color model is in: ${n}`);if(s&&(Array.isArray(s)||(s=[s]),!s.includes(this.components))){let e=`The process: ${t} can only be applied if the number of components is in: ${s}`;throw 1===s.length&&1===s[0]?new TypeError(e+'.\rYou should transform your image using "image.grey()" before applying the algorithm.'):new TypeError(e)}if(a&&(Array.isArray(a)||(a=[a]),!a.includes(this.channels)))throw new TypeError(`The process: ${t} can only be applied if the number of channels is in: ${a}`)}function createBlob(t,e){t=t||[],"string"==typeof(e=e||{})&&(e={type:e});try{return new Blob(t,e)}catch(n){if("TypeError"!==n.name)throw n;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(e.type)}}function dataURLToBlob(t){var e=t.match(/data:([^;]+)/)[1],r=t.replace(/^[^,]+,/,"");return createBlob([binaryStringToArrayBuffer(atob(r))],{type:e})}function canvasToBlob(t,e,r){return"function"==typeof t.toBlob?new Promise((function(i){t.toBlob(i,e,r)})):Promise.resolve(dataURLToBlob(t.toDataURL(e,r)))}function binaryStringToArrayBuffer(t){for(var e=t.length,r=new ArrayBuffer(e),i=new Uint8Array(r),n=-1;++n<e;)i[n]=t.charCodeAt(n);return r}var commonjsGlobal$1="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return commonjsRequire(t,null==e?r.path:e)}},r.exports),r.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var utf8=createCommonjsModule((function(t,e){!function(r){var i=e,n=t&&t.exports==i&&t,s="object"==typeof commonjsGlobal$1&&commonjsGlobal$1;s.global!==s&&s.window!==s||(r=s);var a,o,l,h=String.fromCharCode;function c(t){for(var e,r,i=[],n=0,s=t.length;n<s;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<s?56320==(64512&(r=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&r)+65536):(i.push(e),n--):i.push(e);return i}function u(t){if(t>=55296&&t<=57343)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value")}function f(t,e){return h(t>>e&63|128)}function d(t){if(0==(4294967168&t))return h(t);var e="";return 0==(4294965248&t)?e=h(t>>6&31|192):0==(4294901760&t)?(u(t),e=h(t>>12&15|224),e+=f(t,6)):0==(4292870144&t)&&(e=h(t>>18&7|240),e+=f(t,12),e+=f(t,6)),e+=h(63&t|128)}function m(){if(l>=o)throw Error("Invalid byte index");var t=255&a[l];if(l++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function g(){var t,e;if(l>o)throw Error("Invalid byte index");if(l==o)return!1;if(t=255&a[l],l++,0==(128&t))return t;if(192==(224&t)){if((e=(31&t)<<6|m())>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&t)){if((e=(15&t)<<12|m()<<6|m())>=2048)return u(e),e;throw Error("Invalid continuation byte")}if(240==(248&t)&&(e=(7&t)<<18|m()<<12|m()<<6|m())>=65536&&e<=1114111)return e;throw Error("Invalid UTF-8 detected")}var p={version:"2.1.2",encode:function(t){for(var e=c(t),r=e.length,i=-1,n="";++i<r;)n+=d(e[i]);return n},decode:function(t){a=c(t),o=a.length,l=0;for(var e,r=[];!1!==(e=g());)r.push(e);return function(t){for(var e,r=t.length,i=-1,n="";++i<r;)(e=t[i])>65535&&(n+=h((e-=65536)>>>10&1023|55296),e=56320|1023&e),n+=h(e);return n}(r)}};if(i&&!i.nodeType)if(n)n.exports=p;else{var w={}.hasOwnProperty;for(var b in p)w.call(p,b)&&(i[b]=p[b])}else r.utf8=p}(commonjsGlobal$1)}));const defaultByteLength=8192,charArray=[];class IOBuffer{constructor(t,e){e=e||{};var r=!1;void 0===t&&(t=defaultByteLength),"number"==typeof t?t=new ArrayBuffer(t):(r=!0,this._lastWrittenByte=t.byteLength);const i=e.offset?e.offset>>>0:0;let n=t.byteLength-i,s=i;t.buffer&&(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+i),t=t.buffer),this._lastWrittenByte=r?n:0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,n),this._mark=0,this._marks=[]}available(t){return void 0===t&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t){return void 0===t&&(t=1),this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t){if(void 0===t&&(t=1),!this.available(t)){const e=2*(this.offset+t),r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){void 0===t&&(t=1);for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){void 0===t&&(t=1),charArray.length=t;for(var e=0;e<t;e++)charArray[e]=this.readChar();return charArray.join("")}readUtf8(t){void 0===t&&(t=1);const e=this.readChars(t);return utf8.decode(e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){const e=utf8.encode(t);return this.writeChars(e)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}getBuffer(){return"undefined"!=typeof Buffer?Buffer.from(this.toArray()):this.toArray()}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}var IOBuffer_1=IOBuffer,constants={BITMAPV5HEADER:{LogicalColorSpace:{LCS_CALIBRATED_RGB:0,LCS_sRGB:1934772034,LCS_WINDOWS_COLOR_SPACE:1466527264},Compression:{BI_RGB:0,BI_RLE8:1,BI_RLE4:2,BI_BITFIELDS:3,BI_JPEG:4,BI_PNG:5,BI_CMYK:11,BI_CMYKRLE8:12,BI_CMYKRLE4:13},GamutMappingIntent:{LCS_GM_ABS_COLORIMETRIC:8,LCS_GM_BUSINESS:1,LCS_GM_GRAPHICS:2,LCS_GM_IMAGES:4}}};const tableLeft=[];for(var i=0;i<=8;i++)tableLeft.push(255<<i);var encode=function(t){if(1!==t.bitDepth)throw new Error("Only bitDepth of 1 is supported");if(!t.height||!t.width)throw new Error("ImageData width and height are required");if(1!==t.components)throw new Error("Only 1 component is supported");if(1!==t.channels)throw new Error("Only 1 channel is supported");var e=new IOBuffer_1;e.skip(14),writeBitmapV5Header(e,t),writeColorTable(e,t);const r=e.offset;return writePixelArray(e,t),e.rewind(),writeBitmapFileHeader(e,r),e.getBuffer()};function writePixelArray(t,e){const r=4*Math.floor((e.bitDepth*e.width+31)/32),i=Math.ceil(e.bitDepth*e.width/8),n=r-i,s=e.bitDepth*e.width%8,a=0===s?0:8-s,o=r*e.height;var l,h;const c=new IOBuffer_1(e.data);let u=0,f=0,d=8;t.mark(),h=c.readUint8();for(var m=e.height-1;m>=0;m--){const e=0===m;t.reset(),t.skip(m*r);for(var g=0;g<i;g++){const r=g===i-1;f<=a&&r?(t.writeByte(h<<f),0!==a&&a!==f||e||(l=h,h=c.readByte())):0===f?(l=h,h=c.readUint8(),t.writeByte(l)):(l=h,h=c.readUint8(),t.writeByte(l<<f&tableLeft[f]|h>>d)),r?(u+=s||8,t.skip(n),f=u%8,d=8-f):u+=8}}r>i&&(t.reset(),t.skip(o-1),t.writeUint8(0))}function writeColorTable(t,e){e.bitDepth>8||t.writeUint32(0).writeUint32(16777215)}function writeBitmapFileHeader(t,e){t.writeChars("BM"),t.writeInt32(t._lastWrittenByte),t.writeUint16(0),t.writeUint16(0),t.writeUint32(e)}function writeBitmapV5Header(t,e){t.writeUint32(124).writeInt32(e.width).writeInt32(e.height).writeUint16(1).writeUint16(e.bitDepth).writeUint32(constants.BITMAPV5HEADER.Compression.BI_RGB).writeUint32(e.width*e.height*e.bitDepth).writeInt32(0).writeInt32(0).writeUint32(Math.pow(2,e.bitDepth)).writeUint32(Math.pow(2,e.bitDepth)).writeUint32(4278190080).writeUint32(16711680).writeUint32(65280).writeUint32(255).writeUint32(constants.BITMAPV5HEADER.LogicalColorSpace.LCS_sRGB).skip(36).skip(12).writeUint32(constants.BITMAPV5HEADER.GamutMappingIntent.LCS_GM_IMAGES).skip(12)}var encode$1=encode;!function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${t}') is invalid.`)}function r(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${t}') is invalid.`);if(e.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const i=t.length;let n=0,s=Math.max(32,i+(i>>1)+7),a=new Uint8Array(s>>3<<3);for(;r<i;){let e=t.charCodeAt(r++);if(e>=55296&&e<=56319){if(r<i){const i=t.charCodeAt(r);56320==(64512&i)&&(++r,e=((1023&e)<<10)+(1023&i)+65536)}if(e>=55296&&e<=56319)continue}if(n+4>a.length){s+=8,s*=1+r/t.length*2,s=s>>3<<3;const e=new Uint8Array(s);e.set(a),a=e}if(0!=(4294967168&e)){if(0==(4294965248&e))a[n++]=e>>6&31|192;else if(0==(4294901760&e))a[n++]=e>>12&15|224,a[n++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;a[n++]=e>>18&7|240,a[n++]=e>>12&63|128,a[n++]=e>>6&63|128}a[n++]=63&e|128}else a[n++]=e}return a.slice(0,n)},Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const r=new Uint8Array(t);let i=0;const n=r.length,s=[];for(;i<n;){const t=r[i++];if(0===t)break;if(0==(128&t))s.push(t);else if(192==(224&t)){const e=63&r[i++];s.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&r[i++],n=63&r[i++];s.push((31&t)<<12|e<<6|n)}else if(240==(248&t)){let e=(7&t)<<18|(63&r[i++])<<12|(63&r[i++])<<6|63&r[i++];e>65535&&(e-=65536,s.push(e>>>10&1023|55296),e=56320|1023&e),s.push(e)}}return String.fromCharCode.apply(null,s)},t.TextEncoder=e,t.TextDecoder=r}("undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0);const decoder=new TextDecoder("utf-8");function decode(t){return decoder.decode(t)}const encoder=new TextEncoder;function encode$2(t){return encoder.encode(t)}const defaultByteLength$1=8192;class IOBuffer$1{constructor(t=defaultByteLength$1,e={}){let r=!1;"number"==typeof t?t=new ArrayBuffer(t):(r=!0,this.lastWrittenByte=t.byteLength);const i=e.offset?e.offset>>>0:0,n=t.byteLength-i;let s=i;(ArrayBuffer.isView(t)||t instanceof IOBuffer$1)&&(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+i),t=t.buffer),this.lastWrittenByte=r?n:0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,n),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){const e=new Uint8Array(t);for(let r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let r=0;r<t;r++)e+=this.readChar();return e}readUtf8(t=1){return decode(this.readBytes(t))}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(encode$2(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}var common=createCommonjsModule((function(t,e){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(t[n]=r[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,r,i,n){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+i),n);else for(var s=0;s<i;s++)t[n+s]=e[r+s]},flattenChunks:function(t){var e,r,i,n,s,a;for(i=0,e=0,r=t.length;e<r;e++)i+=t[e].length;for(a=new Uint8Array(i),n=0,e=0,r=t.length;e<r;e++)s=t[e],a.set(s,n),n+=s.length;return a}},s={arraySet:function(t,e,r,i,n){for(var s=0;s<i;s++)t[n+s]=e[r+s]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(r)})),Z_FIXED=4,Z_BINARY=0,Z_TEXT=1,Z_UNKNOWN=2;function zero(t){for(var e=t.length;--e>=0;)t[e]=0}var STORED_BLOCK=0,STATIC_TREES=1,DYN_TREES=2,MIN_MATCH=3,MAX_MATCH=258,LENGTH_CODES=29,LITERALS=256,L_CODES=LITERALS+1+LENGTH_CODES,D_CODES=30,BL_CODES=19,HEAP_SIZE=2*L_CODES+1,MAX_BITS=15,Buf_size=16,MAX_BL_BITS=7,END_BLOCK=256,REP_3_6=16,REPZ_3_10=17,REPZ_11_138=18,extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES+2));zero(static_ltree);var static_dtree=new Array(2*D_CODES);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES),static_l_desc,static_d_desc,static_bl_desc;function StaticTreeDesc(t,e,r,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}function TreeDesc(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function d_code(t){return t<256?_dist_code[t]:_dist_code[256+(t>>>7)]}function put_short(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function send_bits(t,e,r){t.bi_valid>Buf_size-r?(t.bi_buf|=e<<t.bi_valid&65535,put_short(t,t.bi_buf),t.bi_buf=e>>Buf_size-t.bi_valid,t.bi_valid+=r-Buf_size):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function send_code(t,e,r){send_bits(t,r[2*e],r[2*e+1])}function bi_reverse(t,e){var r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1}function bi_flush(t){16===t.bi_valid?(put_short(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function gen_bitlen(t,e){var r,i,n,s,a,o,l=e.dyn_tree,h=e.max_code,c=e.stat_desc.static_tree,u=e.stat_desc.has_stree,f=e.stat_desc.extra_bits,d=e.stat_desc.extra_base,m=e.stat_desc.max_length,g=0;for(s=0;s<=MAX_BITS;s++)t.bl_count[s]=0;for(l[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<HEAP_SIZE;r++)(s=l[2*l[2*(i=t.heap[r])+1]+1]+1)>m&&(s=m,g++),l[2*i+1]=s,i>h||(t.bl_count[s]++,a=0,i>=d&&(a=f[i-d]),o=l[2*i],t.opt_len+=o*(s+a),u&&(t.static_len+=o*(c[2*i+1]+a)));if(0!==g){do{for(s=m-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[m]--,g-=2}while(g>0);for(s=m;0!==s;s--)for(i=t.bl_count[s];0!==i;)(n=t.heap[--r])>h||(l[2*n+1]!==s&&(t.opt_len+=(s-l[2*n+1])*l[2*n],l[2*n+1]=s),i--)}}function gen_codes(t,e,r){var i,n,s=new Array(MAX_BITS+1),a=0;for(i=1;i<=MAX_BITS;i++)s[i]=a=a+r[i-1]<<1;for(n=0;n<=e;n++){var o=t[2*n+1];0!==o&&(t[2*n]=bi_reverse(s[o]++,o))}}function tr_static_init(){var t,e,r,i,n,s=new Array(MAX_BITS+1);for(r=0,i=0;i<LENGTH_CODES-1;i++)for(base_length[i]=r,t=0;t<1<<extra_lbits[i];t++)_length_code[r++]=i;for(_length_code[r-1]=i,n=0,i=0;i<16;i++)for(base_dist[i]=n,t=0;t<1<<extra_dbits[i];t++)_dist_code[n++]=i;for(n>>=7;i<D_CODES;i++)for(base_dist[i]=n<<7,t=0;t<1<<extra_dbits[i]-7;t++)_dist_code[256+n++]=i;for(e=0;e<=MAX_BITS;e++)s[e]=0;for(t=0;t<=143;)static_ltree[2*t+1]=8,t++,s[8]++;for(;t<=255;)static_ltree[2*t+1]=9,t++,s[9]++;for(;t<=279;)static_ltree[2*t+1]=7,t++,s[7]++;for(;t<=287;)static_ltree[2*t+1]=8,t++,s[8]++;for(gen_codes(static_ltree,L_CODES+1,s),t=0;t<D_CODES;t++)static_dtree[2*t+1]=5,static_dtree[2*t]=bi_reverse(t,5);static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS),static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS),static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(t){var e;for(e=0;e<L_CODES;e++)t.dyn_ltree[2*e]=0;for(e=0;e<D_CODES;e++)t.dyn_dtree[2*e]=0;for(e=0;e<BL_CODES;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*END_BLOCK]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function bi_windup(t){t.bi_valid>8?put_short(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function copy_block(t,e,r,i){bi_windup(t),i&&(put_short(t,r),put_short(t,~r)),common.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}function smaller(t,e,r,i){var n=2*e,s=2*r;return t[n]<t[s]||t[n]===t[s]&&i[e]<=i[r]}function pqdownheap(t,e,r){for(var i=t.heap[r],n=r<<1;n<=t.heap_len&&(n<t.heap_len&&smaller(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!smaller(e,i,t.heap[n],t.depth));)t.heap[r]=t.heap[n],r=n,n<<=1;t.heap[r]=i}function compress_block(t,e,r){var i,n,s,a,o=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],n=t.pending_buf[t.l_buf+o],o++,0===i?send_code(t,n,e):(send_code(t,(s=_length_code[n])+LITERALS+1,e),0!==(a=extra_lbits[s])&&send_bits(t,n-=base_length[s],a),send_code(t,s=d_code(--i),r),0!==(a=extra_dbits[s])&&send_bits(t,i-=base_dist[s],a))}while(o<t.last_lit);send_code(t,END_BLOCK,e)}function build_tree(t,e){var r,i,n,s=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=HEAP_SIZE,r=0;r<l;r++)0!==s[2*r]?(t.heap[++t.heap_len]=h=r,t.depth[r]=0):s[2*r+1]=0;for(;t.heap_len<2;)s[2*(n=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[n]=0,t.opt_len--,o&&(t.static_len-=a[2*n+1]);for(e.max_code=h,r=t.heap_len>>1;r>=1;r--)pqdownheap(t,s,r);n=l;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pqdownheap(t,s,1),i=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=i,s[2*n]=s[2*r]+s[2*i],t.depth[n]=(t.depth[r]>=t.depth[i]?t.depth[r]:t.depth[i])+1,s[2*r+1]=s[2*i+1]=n,t.heap[1]=n++,pqdownheap(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],gen_bitlen(t,e),gen_codes(s,h,t.bl_count)}function scan_tree(t,e,r){var i,n,s=-1,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),e[2*(r+1)+1]=65535,i=0;i<=r;i++)n=a,a=e[2*(i+1)+1],++o<l&&n===a||(o<h?t.bl_tree[2*n]+=o:0!==n?(n!==s&&t.bl_tree[2*n]++,t.bl_tree[2*REP_3_6]++):o<=10?t.bl_tree[2*REPZ_3_10]++:t.bl_tree[2*REPZ_11_138]++,o=0,s=n,0===a?(l=138,h=3):n===a?(l=6,h=3):(l=7,h=4))}function send_tree(t,e,r){var i,n,s=-1,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),i=0;i<=r;i++)if(n=a,a=e[2*(i+1)+1],!(++o<l&&n===a)){if(o<h)do{send_code(t,n,t.bl_tree)}while(0!=--o);else 0!==n?(n!==s&&(send_code(t,n,t.bl_tree),o--),send_code(t,REP_3_6,t.bl_tree),send_bits(t,o-3,2)):o<=10?(send_code(t,REPZ_3_10,t.bl_tree),send_bits(t,o-3,3)):(send_code(t,REPZ_11_138,t.bl_tree),send_bits(t,o-11,7));o=0,s=n,0===a?(l=138,h=3):n===a?(l=6,h=3):(l=7,h=4)}}function build_bl_tree(t){var e;for(scan_tree(t,t.dyn_ltree,t.l_desc.max_code),scan_tree(t,t.dyn_dtree,t.d_desc.max_code),build_tree(t,t.bl_desc),e=BL_CODES-1;e>=3&&0===t.bl_tree[2*bl_order[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function send_all_trees(t,e,r,i){var n;for(send_bits(t,e-257,5),send_bits(t,r-1,5),send_bits(t,i-4,4),n=0;n<i;n++)send_bits(t,t.bl_tree[2*bl_order[n]+1],3);send_tree(t,t.dyn_ltree,e-1),send_tree(t,t.dyn_dtree,r-1)}function detect_data_type(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return Z_BINARY;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return Z_TEXT;for(e=32;e<LITERALS;e++)if(0!==t.dyn_ltree[2*e])return Z_TEXT;return Z_BINARY}zero(base_dist);var static_init_done=!1;function _tr_init(t){static_init_done||(tr_static_init(),static_init_done=!0),t.l_desc=new TreeDesc(t.dyn_ltree,static_l_desc),t.d_desc=new TreeDesc(t.dyn_dtree,static_d_desc),t.bl_desc=new TreeDesc(t.bl_tree,static_bl_desc),t.bi_buf=0,t.bi_valid=0,init_block(t)}function _tr_stored_block(t,e,r,i){send_bits(t,(STORED_BLOCK<<1)+(i?1:0),3),copy_block(t,e,r,!0)}function _tr_align(t){send_bits(t,STATIC_TREES<<1,3),send_code(t,END_BLOCK,static_ltree),bi_flush(t)}function _tr_flush_block(t,e,r,i){var n,s,a=0;t.level>0?(t.strm.data_type===Z_UNKNOWN&&(t.strm.data_type=detect_data_type(t)),build_tree(t,t.l_desc),build_tree(t,t.d_desc),a=build_bl_tree(t),n=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=n&&(n=s)):n=s=r+5,r+4<=n&&-1!==e?_tr_stored_block(t,e,r,i):t.strategy===Z_FIXED||s===n?(send_bits(t,(STATIC_TREES<<1)+(i?1:0),3),compress_block(t,static_ltree,static_dtree)):(send_bits(t,(DYN_TREES<<1)+(i?1:0),3),send_all_trees(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),compress_block(t,t.dyn_ltree,t.dyn_dtree)),init_block(t),i&&bi_windup(t)}function _tr_tally(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(_length_code[r]+LITERALS+1)]++,t.dyn_dtree[2*d_code(e)]++),t.last_lit===t.lit_bufsize-1}var _tr_init_1=_tr_init,_tr_stored_block_1=_tr_stored_block,_tr_flush_block_1=_tr_flush_block,_tr_tally_1=_tr_tally,_tr_align_1=_tr_align,trees={_tr_init:_tr_init_1,_tr_stored_block:_tr_stored_block_1,_tr_flush_block:_tr_flush_block_1,_tr_tally:_tr_tally_1,_tr_align:_tr_align_1};function adler32(t,e,r,i){for(var n=65535&t|0,s=t>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{s=s+(n=n+e[i++]|0)|0}while(--a);n%=65521,s%=65521}return n|s<<16|0}var adler32_1=adler32;function makeTable(){for(var t,e=[],r=0;r<256;r++){t=r;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}var crcTable=makeTable();function crc32(t,e,r,i){var n=crcTable,s=i+r;t^=-1;for(var a=i;a<s;a++)t=t>>>8^n[255&(t^e[a])];return-1^t}var crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_FULL_FLUSH=3,Z_FINISH=4,Z_BLOCK=5,Z_OK=0,Z_STREAM_END=1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_BUF_ERROR=-5,Z_DEFAULT_COMPRESSION=-1,Z_FILTERED=1,Z_HUFFMAN_ONLY=2,Z_RLE=3,Z_FIXED$1=4,Z_DEFAULT_STRATEGY=0,Z_UNKNOWN$1=2,Z_DEFLATED=8,MAX_MEM_LEVEL=9,MAX_WBITS=15,DEF_MEM_LEVEL=8,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,BL_CODES$1=19,HEAP_SIZE$1=2*L_CODES$1+1,MAX_BITS$1=15,MIN_MATCH$1=3,MAX_MATCH$1=258,MIN_LOOKAHEAD=MAX_MATCH$1+MIN_MATCH$1+1,PRESET_DICT=32,INIT_STATE=42,EXTRA_STATE=69,NAME_STATE=73,COMMENT_STATE=91,HCRC_STATE=103,BUSY_STATE=113,FINISH_STATE=666,BS_NEED_MORE=1,BS_BLOCK_DONE=2,BS_FINISH_STARTED=3,BS_FINISH_DONE=4,OS_CODE=3,configuration_table;function err(t,e){return t.msg=messages[e],e}function rank(t){return(t<<1)-(t>4?9:0)}function zero$1(t){for(var e=t.length;--e>=0;)t[e]=0}function flush_pending(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(common.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function flush_block_only(t,e){trees._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,flush_pending(t.strm)}function put_byte(t,e){t.pending_buf[t.pending++]=e}function putShortMSB(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function read_buf(t,e,r,i){var n=t.avail_in;return n>i&&(n=i),0===n?0:(t.avail_in-=n,common.arraySet(e,t.input,t.next_in,n,r),1===t.state.wrap?t.adler=adler32_1(t.adler,e,n,r):2===t.state.wrap&&(t.adler=crc32_1(t.adler,e,n,r)),t.next_in+=n,t.total_in+=n,n)}function longest_match(t,e){var r,i,n=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-MIN_LOOKAHEAD?t.strstart-(t.w_size-MIN_LOOKAHEAD):0,h=t.window,c=t.w_mask,u=t.prev,f=t.strstart+MAX_MATCH$1,d=h[s+a-1],m=h[s+a];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(r=e)+a]===m&&h[r+a-1]===d&&h[r]===h[s]&&h[++r]===h[s+1]){s+=2,r++;do{}while(h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&h[++s]===h[++r]&&s<f);if(i=MAX_MATCH$1-(f-s),s=f-MAX_MATCH$1,i>a){if(t.match_start=e,a=i,i>=o)break;d=h[s+a-1],m=h[s+a]}}}while((e=u[e&c])>l&&0!=--n);return a<=t.lookahead?a:t.lookahead}function fill_window(t){var e,r,i,n,s,a=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=a+(a-MIN_LOOKAHEAD)){common.arraySet(t.window,t.window,a,a,0),t.match_start-=a,t.strstart-=a,t.block_start-=a,e=r=t.hash_size;do{i=t.head[--e],t.head[e]=i>=a?i-a:0}while(--r);e=r=a;do{i=t.prev[--e],t.prev[e]=i>=a?i-a:0}while(--r);n+=a}if(0===t.strm.avail_in)break;if(r=read_buf(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=r,t.lookahead+t.insert>=MIN_MATCH$1)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+MIN_MATCH$1-1])&t.hash_mask,t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<MIN_MATCH$1)););}while(t.lookahead<MIN_LOOKAHEAD&&0!==t.strm.avail_in)}function deflate_stored(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(fill_window(t),0===t.lookahead&&e===Z_NO_FLUSH)return BS_NEED_MORE;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+r;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE;if(t.strstart-t.block_start>=t.w_size-MIN_LOOKAHEAD&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):(t.strstart>t.block_start&&(flush_block_only(t,!1),t.strm.avail_out),BS_NEED_MORE)}function deflate_fast(t,e){for(var r,i;;){if(t.lookahead<MIN_LOOKAHEAD){if(fill_window(t),t.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH)return BS_NEED_MORE;if(0===t.lookahead)break}if(r=0,t.lookahead>=MIN_MATCH$1&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+MIN_MATCH$1-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-MIN_LOOKAHEAD&&(t.match_length=longest_match(t,r)),t.match_length>=MIN_MATCH$1)if(i=trees._tr_tally(t,t.strstart-t.match_start,t.match_length-MIN_MATCH$1),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=MIN_MATCH$1){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+MIN_MATCH$1-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=trees._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}return t.insert=t.strstart<MIN_MATCH$1-1?t.strstart:MIN_MATCH$1-1,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_slow(t,e){for(var r,i,n;;){if(t.lookahead<MIN_LOOKAHEAD){if(fill_window(t),t.lookahead<MIN_LOOKAHEAD&&e===Z_NO_FLUSH)return BS_NEED_MORE;if(0===t.lookahead)break}if(r=0,t.lookahead>=MIN_MATCH$1&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+MIN_MATCH$1-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=MIN_MATCH$1-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-MIN_LOOKAHEAD&&(t.match_length=longest_match(t,r),t.match_length<=5&&(t.strategy===Z_FILTERED||t.match_length===MIN_MATCH$1&&t.strstart-t.match_start>4096)&&(t.match_length=MIN_MATCH$1-1)),t.prev_length>=MIN_MATCH$1&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-MIN_MATCH$1,i=trees._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-MIN_MATCH$1),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+MIN_MATCH$1-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=MIN_MATCH$1-1,t.strstart++,i&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}else if(t.match_available){if((i=trees._tr_tally(t,0,t.window[t.strstart-1]))&&flush_block_only(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return BS_NEED_MORE}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=trees._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<MIN_MATCH$1-1?t.strstart:MIN_MATCH$1-1,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_rle(t,e){for(var r,i,n,s,a=t.window;;){if(t.lookahead<=MAX_MATCH$1){if(fill_window(t),t.lookahead<=MAX_MATCH$1&&e===Z_NO_FLUSH)return BS_NEED_MORE;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=MIN_MATCH$1&&t.strstart>0&&(i=a[n=t.strstart-1])===a[++n]&&i===a[++n]&&i===a[++n]){s=t.strstart+MAX_MATCH$1;do{}while(i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&i===a[++n]&&n<s);t.match_length=MAX_MATCH$1-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=MIN_MATCH$1?(r=trees._tr_tally(t,1,t.match_length-MIN_MATCH$1),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=trees._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function deflate_huff(t,e){for(var r;;){if(0===t.lookahead&&(fill_window(t),0===t.lookahead)){if(e===Z_NO_FLUSH)return BS_NEED_MORE;break}if(t.match_length=0,r=trees._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(flush_block_only(t,!1),0===t.strm.avail_out))return BS_NEED_MORE}return t.insert=0,e===Z_FINISH?(flush_block_only(t,!0),0===t.strm.avail_out?BS_FINISH_STARTED:BS_FINISH_DONE):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?BS_NEED_MORE:BS_BLOCK_DONE}function Config(t,e,r,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=i,this.func=n}function lm_init(t){t.window_size=2*t.w_size,zero$1(t.head),t.max_lazy_match=configuration_table[t.level].max_lazy,t.good_match=configuration_table[t.level].good_length,t.nice_match=configuration_table[t.level].nice_length,t.max_chain_length=configuration_table[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=MIN_MATCH$1-1,t.match_available=0,t.ins_h=0}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z_DEFLATED,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new common.Buf16(2*HEAP_SIZE$1),this.dyn_dtree=new common.Buf16(2*(2*D_CODES$1+1)),this.bl_tree=new common.Buf16(2*(2*BL_CODES$1+1)),zero$1(this.dyn_ltree),zero$1(this.dyn_dtree),zero$1(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new common.Buf16(MAX_BITS$1+1),this.heap=new common.Buf16(2*L_CODES$1+1),zero$1(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new common.Buf16(2*L_CODES$1+1),zero$1(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=Z_UNKNOWN$1,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?INIT_STATE:BUSY_STATE,t.adler=2===e.wrap?0:1,e.last_flush=Z_NO_FLUSH,trees._tr_init(e),Z_OK):err(t,Z_STREAM_ERROR)}function deflateReset(t){var e=deflateResetKeep(t);return e===Z_OK&&lm_init(t.state),e}function deflateSetHeader(t,e){return t&&t.state?2!==t.state.wrap?Z_STREAM_ERROR:(t.state.gzhead=e,Z_OK):Z_STREAM_ERROR}function deflateInit2(t,e,r,i,n,s){if(!t)return Z_STREAM_ERROR;var a=1;if(e===Z_DEFAULT_COMPRESSION&&(e=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),n<1||n>MAX_MEM_LEVEL||r!==Z_DEFLATED||i<8||i>15||e<0||e>9||s<0||s>Z_FIXED$1)return err(t,Z_STREAM_ERROR);8===i&&(i=9);var o=new DeflateState;return t.state=o,o.strm=t,o.wrap=a,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+MIN_MATCH$1-1)/MIN_MATCH$1),o.window=new common.Buf8(2*o.w_size),o.head=new common.Buf16(o.hash_size),o.prev=new common.Buf16(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new common.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=s,o.method=r,deflateReset(t)}function deflateInit(t,e){return deflateInit2(t,e,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(t,e){var r,i,n,s;if(!t||!t.state||e>Z_BLOCK||e<0)return t?err(t,Z_STREAM_ERROR):Z_STREAM_ERROR;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===FINISH_STATE&&e!==Z_FINISH)return err(t,0===t.avail_out?Z_BUF_ERROR:Z_STREAM_ERROR);if(i.strm=t,r=i.last_flush,i.last_flush=e,i.status===INIT_STATE)if(2===i.wrap)t.adler=0,put_byte(i,31),put_byte(i,139),put_byte(i,8),i.gzhead?(put_byte(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),put_byte(i,255&i.gzhead.time),put_byte(i,i.gzhead.time>>8&255),put_byte(i,i.gzhead.time>>16&255),put_byte(i,i.gzhead.time>>24&255),put_byte(i,9===i.level?2:i.strategy>=Z_HUFFMAN_ONLY||i.level<2?4:0),put_byte(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(put_byte(i,255&i.gzhead.extra.length),put_byte(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=EXTRA_STATE):(put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,9===i.level?2:i.strategy>=Z_HUFFMAN_ONLY||i.level<2?4:0),put_byte(i,OS_CODE),i.status=BUSY_STATE);else{var a=Z_DEFLATED+(i.w_bits-8<<4)<<8;a|=(i.strategy>=Z_HUFFMAN_ONLY||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(a|=PRESET_DICT),a+=31-a%31,i.status=BUSY_STATE,putShortMSB(i,a),0!==i.strstart&&(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),t.adler=1}if(i.status===EXTRA_STATE)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),flush_pending(t),n=i.pending,i.pending!==i.pending_buf_size));)put_byte(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=NAME_STATE)}else i.status=NAME_STATE;if(i.status===NAME_STATE)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),flush_pending(t),n=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,put_byte(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),0===s&&(i.gzindex=0,i.status=COMMENT_STATE)}else i.status=COMMENT_STATE;if(i.status===COMMENT_STATE)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),flush_pending(t),n=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,put_byte(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>n&&(t.adler=crc32_1(t.adler,i.pending_buf,i.pending-n,n)),0===s&&(i.status=HCRC_STATE)}else i.status=HCRC_STATE;if(i.status===HCRC_STATE&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&flush_pending(t),i.pending+2<=i.pending_buf_size&&(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),t.adler=0,i.status=BUSY_STATE)):i.status=BUSY_STATE),0!==i.pending){if(flush_pending(t),0===t.avail_out)return i.last_flush=-1,Z_OK}else if(0===t.avail_in&&rank(e)<=rank(r)&&e!==Z_FINISH)return err(t,Z_BUF_ERROR);if(i.status===FINISH_STATE&&0!==t.avail_in)return err(t,Z_BUF_ERROR);if(0!==t.avail_in||0!==i.lookahead||e!==Z_NO_FLUSH&&i.status!==FINISH_STATE){var o=i.strategy===Z_HUFFMAN_ONLY?deflate_huff(i,e):i.strategy===Z_RLE?deflate_rle(i,e):configuration_table[i.level].func(i,e);if(o!==BS_FINISH_STARTED&&o!==BS_FINISH_DONE||(i.status=FINISH_STATE),o===BS_NEED_MORE||o===BS_FINISH_STARTED)return 0===t.avail_out&&(i.last_flush=-1),Z_OK;if(o===BS_BLOCK_DONE&&(e===Z_PARTIAL_FLUSH?trees._tr_align(i):e!==Z_BLOCK&&(trees._tr_stored_block(i,0,0,!1),e===Z_FULL_FLUSH&&(zero$1(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),flush_pending(t),0===t.avail_out))return i.last_flush=-1,Z_OK}return e!==Z_FINISH?Z_OK:i.wrap<=0?Z_STREAM_END:(2===i.wrap?(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),put_byte(i,t.adler>>16&255),put_byte(i,t.adler>>24&255),put_byte(i,255&t.total_in),put_byte(i,t.total_in>>8&255),put_byte(i,t.total_in>>16&255),put_byte(i,t.total_in>>24&255)):(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),flush_pending(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Z_OK:Z_STREAM_END)}function deflateEnd(t){var e;return t&&t.state?(e=t.state.status)!==INIT_STATE&&e!==EXTRA_STATE&&e!==NAME_STATE&&e!==COMMENT_STATE&&e!==HCRC_STATE&&e!==BUSY_STATE&&e!==FINISH_STATE?err(t,Z_STREAM_ERROR):(t.state=null,e===BUSY_STATE?err(t,Z_DATA_ERROR):Z_OK):Z_STREAM_ERROR}function deflateSetDictionary(t,e){var r,i,n,s,a,o,l,h,c=e.length;if(!t||!t.state)return Z_STREAM_ERROR;if(2===(s=(r=t.state).wrap)||1===s&&r.status!==INIT_STATE||r.lookahead)return Z_STREAM_ERROR;for(1===s&&(t.adler=adler32_1(t.adler,e,c,0)),r.wrap=0,c>=r.w_size&&(0===s&&(zero$1(r.head),r.strstart=0,r.block_start=0,r.insert=0),h=new common.Buf8(r.w_size),common.arraySet(h,e,c-r.w_size,r.w_size,0),e=h,c=r.w_size),a=t.avail_in,o=t.next_in,l=t.input,t.avail_in=c,t.next_in=0,t.input=e,fill_window(r);r.lookahead>=MIN_MATCH$1;){i=r.strstart,n=r.lookahead-(MIN_MATCH$1-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+MIN_MATCH$1-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++}while(--n);r.strstart=i,r.lookahead=MIN_MATCH$1-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=MIN_MATCH$1-1,r.match_available=0,t.next_in=o,t.input=l,t.avail_in=a,r.wrap=s,Z_OK}configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];var deflateInit_1=deflateInit,deflateInit2_1=deflateInit2,deflateReset_1=deflateReset,deflateResetKeep_1=deflateResetKeep,deflateSetHeader_1=deflateSetHeader,deflate_2=deflate,deflateEnd_1=deflateEnd,deflateSetDictionary_1=deflateSetDictionary,deflateInfo="pako deflate (from Nodeca project)",deflate_1={deflateInit:deflateInit_1,deflateInit2:deflateInit2_1,deflateReset:deflateReset_1,deflateResetKeep:deflateResetKeep_1,deflateSetHeader:deflateSetHeader_1,deflate:deflate_2,deflateEnd:deflateEnd_1,deflateSetDictionary:deflateSetDictionary_1,deflateInfo:deflateInfo},STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(t){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){STR_APPLY_UIA_OK=!1}for(var _utf8len=new common.Buf8(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=function(t){var e,r,i,n,s,a=t.length,o=0;for(n=0;n<a;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),o+=r<128?1:r<2048?2:r<65536?3:4;for(e=new common.Buf8(o),s=0,n=0;s<o;n++)55296==(64512&(r=t.charCodeAt(n)))&&n+1<a&&56320==(64512&(i=t.charCodeAt(n+1)))&&(r=65536+(r-55296<<10)+(i-56320),n++),r<128?e[s++]=r:r<2048?(e[s++]=192|r>>>6,e[s++]=128|63&r):r<65536?(e[s++]=224|r>>>12,e[s++]=128|r>>>6&63,e[s++]=128|63&r):(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63,e[s++]=128|r>>>6&63,e[s++]=128|63&r);return e};function buf2binstring(t,e){if(e<65534&&(t.subarray&&STR_APPLY_UIA_OK||!t.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,common.shrinkBuf(t,e));for(var r="",i=0;i<e;i++)r+=String.fromCharCode(t[i]);return r}var buf2binstring_1=function(t){return buf2binstring(t,t.length)},binstring2buf=function(t){for(var e=new common.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},buf2string=function(t,e){var r,i,n,s,a=e||t.length,o=new Array(2*a);for(i=0,r=0;r<a;)if((n=t[r++])<128)o[i++]=n;else if((s=_utf8len[n])>4)o[i++]=65533,r+=s-1;else{for(n&=2===s?31:3===s?15:7;s>1&&r<a;)n=n<<6|63&t[r++],s--;s>1?o[i++]=65533:n<65536?o[i++]=n:(n-=65536,o[i++]=55296|n>>10&1023,o[i++]=56320|1023&n)}return buf2binstring(o,i)},utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?e:r+_utf8len[t[r]]>e?r:e},strings={string2buf:string2buf,buf2binstring:buf2binstring_1,binstring2buf:binstring2buf,buf2string:buf2string,utf8border:utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream,toString=Object.prototype.toString,Z_NO_FLUSH$1=0,Z_FINISH$1=4,Z_OK$1=0,Z_STREAM_END$1=1,Z_SYNC_FLUSH=2,Z_DEFAULT_COMPRESSION$1=-1,Z_DEFAULT_STRATEGY$1=0,Z_DEFLATED$1=8;function Deflate(t){if(!(this instanceof Deflate))return new Deflate(t);this.options=common.assign({level:Z_DEFAULT_COMPRESSION$1,method:Z_DEFLATED$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY$1,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=deflate_1.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Z_OK$1)throw new Error(messages[r]);if(e.header&&deflate_1.deflateSetHeader(this.strm,e.header),e.dictionary){var i;if(i="string"==typeof e.dictionary?strings.string2buf(e.dictionary):"[object ArrayBuffer]"===toString.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(r=deflate_1.deflateSetDictionary(this.strm,i))!==Z_OK$1)throw new Error(messages[r]);this._dict_set=!0}}function deflate$1(t,e){var r=new Deflate(e);if(r.push(t,!0),r.err)throw r.msg||messages[r.err];return r.result}function deflateRaw(t,e){return(e=e||{}).raw=!0,deflate$1(t,e)}function gzip(t,e){return(e=e||{}).gzip=!0,deflate$1(t,e)}Deflate.prototype.push=function(t,e){var r,i,n=this.strm,s=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:!0===e?Z_FINISH$1:Z_NO_FLUSH$1,"string"==typeof t?n.input=strings.string2buf(t):"[object ArrayBuffer]"===toString.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new common.Buf8(s),n.next_out=0,n.avail_out=s),(r=deflate_1.deflate(n,i))!==Z_STREAM_END$1&&r!==Z_OK$1)return this.onEnd(r),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||i!==Z_FINISH$1&&i!==Z_SYNC_FLUSH)||("string"===this.options.to?this.onData(strings.buf2binstring(common.shrinkBuf(n.output,n.next_out))):this.onData(common.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&r!==Z_STREAM_END$1);return i===Z_FINISH$1?(r=deflate_1.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Z_OK$1):i!==Z_SYNC_FLUSH||(this.onEnd(Z_OK$1),n.avail_out=0,!0)},Deflate.prototype.onData=function(t){this.chunks.push(t)},Deflate.prototype.onEnd=function(t){t===Z_OK$1&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Deflate_1=Deflate,deflate_2$1=deflate$1,deflateRaw_1=deflateRaw,gzip_1=gzip,deflate_1$1={Deflate:Deflate_1,deflate:deflate_2$1,deflateRaw:deflateRaw_1,gzip:gzip_1},BAD=30,TYPE=12,inffast=function(t,e){var r,i,n,s,a,o,l,h,c,u,f,d,m,g,p,w,b,y,_,M,x,v,S,k,A;r=t.state,i=t.next_in,k=t.input,n=i+(t.avail_in-5),s=t.next_out,A=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),l=r.dmax,h=r.wsize,c=r.whave,u=r.wnext,f=r.window,d=r.hold,m=r.bits,g=r.lencode,p=r.distcode,w=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;t:do{m<15&&(d+=k[i++]<<m,m+=8,d+=k[i++]<<m,m+=8),y=g[d&w];e:for(;;){if(d>>>=_=y>>>24,m-=_,0==(_=y>>>16&255))A[s++]=65535&y;else{if(!(16&_)){if(0==(64&_)){y=g[(65535&y)+(d&(1<<_)-1)];continue e}if(32&_){r.mode=TYPE;break t}t.msg="invalid literal/length code",r.mode=BAD;break t}M=65535&y,(_&=15)&&(m<_&&(d+=k[i++]<<m,m+=8),M+=d&(1<<_)-1,d>>>=_,m-=_),m<15&&(d+=k[i++]<<m,m+=8,d+=k[i++]<<m,m+=8),y=p[d&b];r:for(;;){if(d>>>=_=y>>>24,m-=_,!(16&(_=y>>>16&255))){if(0==(64&_)){y=p[(65535&y)+(d&(1<<_)-1)];continue r}t.msg="invalid distance code",r.mode=BAD;break t}if(x=65535&y,m<(_&=15)&&(d+=k[i++]<<m,(m+=8)<_&&(d+=k[i++]<<m,m+=8)),(x+=d&(1<<_)-1)>l){t.msg="invalid distance too far back",r.mode=BAD;break t}if(d>>>=_,m-=_,x>(_=s-a)){if((_=x-_)>c&&r.sane){t.msg="invalid distance too far back",r.mode=BAD;break t}if(v=0,S=f,0===u){if(v+=h-_,_<M){M-=_;do{A[s++]=f[v++]}while(--_);v=s-x,S=A}}else if(u<_){if(v+=h+u-_,(_-=u)<M){M-=_;do{A[s++]=f[v++]}while(--_);if(v=0,u<M){M-=_=u;do{A[s++]=f[v++]}while(--_);v=s-x,S=A}}}else if(v+=u-_,_<M){M-=_;do{A[s++]=f[v++]}while(--_);v=s-x,S=A}for(;M>2;)A[s++]=S[v++],A[s++]=S[v++],A[s++]=S[v++],M-=3;M&&(A[s++]=S[v++],M>1&&(A[s++]=S[v++]))}else{v=s-x;do{A[s++]=A[v++],A[s++]=A[v++],A[s++]=A[v++],M-=3}while(M>2);M&&(A[s++]=A[v++],M>1&&(A[s++]=A[v++]))}break}}break}}while(i<n&&s<o);i-=M=m>>3,d&=(1<<(m-=M<<3))-1,t.next_in=i,t.next_out=s,t.avail_in=i<n?n-i+5:5-(i-n),t.avail_out=s<o?o-s+257:257-(s-o),r.hold=d,r.bits=m},MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],inftrees=function(t,e,r,i,n,s,a,o){var l,h,c,u,f,d,m,g,p,w=o.bits,b=0,y=0,_=0,M=0,x=0,v=0,S=0,k=0,A=0,E=0,I=null,C=0,D=new common.Buf16(MAXBITS+1),T=new common.Buf16(MAXBITS+1),R=null,P=0;for(b=0;b<=MAXBITS;b++)D[b]=0;for(y=0;y<i;y++)D[e[r+y]]++;for(x=w,M=MAXBITS;M>=1&&0===D[M];M--);if(x>M&&(x=M),0===M)return n[s++]=20971520,n[s++]=20971520,o.bits=1,0;for(_=1;_<M&&0===D[_];_++);for(x<_&&(x=_),k=1,b=1;b<=MAXBITS;b++)if(k<<=1,(k-=D[b])<0)return-1;if(k>0&&(t===CODES||1!==M))return-1;for(T[1]=0,b=1;b<MAXBITS;b++)T[b+1]=T[b]+D[b];for(y=0;y<i;y++)0!==e[r+y]&&(a[T[e[r+y]]++]=y);if(t===CODES?(I=R=a,d=19):t===LENS?(I=lbase,C-=257,R=lext,P-=257,d=256):(I=dbase,R=dext,d=-1),E=0,y=0,b=_,f=s,v=x,S=0,c=-1,u=(A=1<<x)-1,t===LENS&&A>ENOUGH_LENS||t===DISTS&&A>ENOUGH_DISTS)return 1;for(;;){m=b-S,a[y]<d?(g=0,p=a[y]):a[y]>d?(g=R[P+a[y]],p=I[C+a[y]]):(g=96,p=0),l=1<<b-S,_=h=1<<v;do{n[f+(E>>S)+(h-=l)]=m<<24|g<<16|p|0}while(0!==h);for(l=1<<b-1;E&l;)l>>=1;if(0!==l?(E&=l-1,E+=l):E=0,y++,0==--D[b]){if(b===M)break;b=e[r+a[y]]}if(b>x&&(E&u)!==c){for(0===S&&(S=x),f+=_,k=1<<(v=b-S);v+S<M&&!((k-=D[v+S])<=0);)v++,k<<=1;if(A+=1<<v,t===LENS&&A>ENOUGH_LENS||t===DISTS&&A>ENOUGH_DISTS)return 1;n[c=E&u]=x<<24|v<<16|f-s|0}}return 0!==E&&(n[f+E]=b-S<<24|64<<16|0),o.bits=x,0},CODES$1=0,LENS$1=1,DISTS$1=2,Z_FINISH$2=4,Z_BLOCK$1=5,Z_TREES=6,Z_OK$2=0,Z_STREAM_END$2=1,Z_NEED_DICT=2,Z_STREAM_ERROR$1=-2,Z_DATA_ERROR$1=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR$1=-5,Z_DEFLATED$2=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE$1=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD$1=30,MEM=31,SYNC=32,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,MAX_WBITS$1=15,DEF_WBITS=MAX_WBITS$1;function zswap32(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new common.Buf16(320),this.work=new common.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=HEAD,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new common.Buf32(ENOUGH_LENS$1),e.distcode=e.distdyn=new common.Buf32(ENOUGH_DISTS$1),e.sane=1,e.back=-1,Z_OK$2):Z_STREAM_ERROR$1}function inflateReset(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,inflateResetKeep(t)):Z_STREAM_ERROR$1}function inflateReset2(t,e){var r,i;return t&&t.state?(i=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Z_STREAM_ERROR$1:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=r,i.wbits=e,inflateReset(t))):Z_STREAM_ERROR$1}function inflateInit2(t,e){var r,i;return t?(i=new InflateState,t.state=i,i.window=null,(r=inflateReset2(t,e))!==Z_OK$2&&(t.state=null),r):Z_STREAM_ERROR$1}function inflateInit(t){return inflateInit2(t,DEF_WBITS)}var virgin=!0,lenfix,distfix;function fixedtables(t){if(virgin){var e;for(lenfix=new common.Buf32(512),distfix=new common.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(inftrees(LENS$1,t.lens,0,288,lenfix,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;inftrees(DISTS$1,t.lens,0,32,distfix,0,t.work,{bits:5}),virgin=!1}t.lencode=lenfix,t.lenbits=9,t.distcode=distfix,t.distbits=5}function updatewindow(t,e,r,i){var n,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new common.Buf8(s.wsize)),i>=s.wsize?(common.arraySet(s.window,e,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((n=s.wsize-s.wnext)>i&&(n=i),common.arraySet(s.window,e,r-i,n,s.wnext),(i-=n)?(common.arraySet(s.window,e,r-i,i,0),s.wnext=i,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0}function inflate(t,e){var r,i,n,s,a,o,l,h,c,u,f,d,m,g,p,w,b,y,_,M,x,v,S,k,A=0,E=new common.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return Z_STREAM_ERROR$1;(r=t.state).mode===TYPE$1&&(r.mode=TYPEDO),a=t.next_out,n=t.output,l=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,h=r.hold,c=r.bits,u=o,f=l,v=Z_OK$2;t:for(;;)switch(r.mode){case HEAD:if(0===r.wrap){r.mode=TYPEDO;break}for(;c<16;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(2&r.wrap&&35615===h){r.check=0,E[0]=255&h,E[1]=h>>>8&255,r.check=crc32_1(r.check,E,2,0),h=0,c=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",r.mode=BAD$1;break}if((15&h)!==Z_DEFLATED$2){t.msg="unknown compression method",r.mode=BAD$1;break}if(c-=4,x=8+(15&(h>>>=4)),0===r.wbits)r.wbits=x;else if(x>r.wbits){t.msg="invalid window size",r.mode=BAD$1;break}r.dmax=1<<x,t.adler=r.check=1,r.mode=512&h?DICTID:TYPE$1,h=0,c=0;break;case FLAGS:for(;c<16;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(r.flags=h,(255&r.flags)!==Z_DEFLATED$2){t.msg="unknown compression method",r.mode=BAD$1;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=BAD$1;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(E[0]=255&h,E[1]=h>>>8&255,r.check=crc32_1(r.check,E,2,0)),h=0,c=0,r.mode=TIME;case TIME:for(;c<32;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}r.head&&(r.head.time=h),512&r.flags&&(E[0]=255&h,E[1]=h>>>8&255,E[2]=h>>>16&255,E[3]=h>>>24&255,r.check=crc32_1(r.check,E,4,0)),h=0,c=0,r.mode=OS;case OS:for(;c<16;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(E[0]=255&h,E[1]=h>>>8&255,r.check=crc32_1(r.check,E,2,0)),h=0,c=0,r.mode=EXLEN;case EXLEN:if(1024&r.flags){for(;c<16;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(E[0]=255&h,E[1]=h>>>8&255,r.check=crc32_1(r.check,E,2,0)),h=0,c=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(1024&r.flags&&((d=r.length)>o&&(d=o),d&&(r.head&&(x=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),common.arraySet(r.head.extra,i,s,d,x)),512&r.flags&&(r.check=crc32_1(r.check,i,d,s)),o-=d,s+=d,r.length-=d),r.length))break t;r.length=0,r.mode=NAME;case NAME:if(2048&r.flags){if(0===o)break t;d=0;do{x=i[s+d++],r.head&&x&&r.length<65536&&(r.head.name+=String.fromCharCode(x))}while(x&&d<o);if(512&r.flags&&(r.check=crc32_1(r.check,i,d,s)),o-=d,s+=d,x)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(4096&r.flags){if(0===o)break t;d=0;do{x=i[s+d++],r.head&&x&&r.length<65536&&(r.head.comment+=String.fromCharCode(x))}while(x&&d<o);if(512&r.flags&&(r.check=crc32_1(r.check,i,d,s)),o-=d,s+=d,x)break t}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(512&r.flags){for(;c<16;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(h!==(65535&r.check)){t.msg="header crc mismatch",r.mode=BAD$1;break}h=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=TYPE$1;break;case DICTID:for(;c<32;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}t.adler=r.check=zswap32(h),h=0,c=0,r.mode=DICT;case DICT:if(0===r.havedict)return t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=c,Z_NEED_DICT;t.adler=r.check=1,r.mode=TYPE$1;case TYPE$1:if(e===Z_BLOCK$1||e===Z_TREES)break t;case TYPEDO:if(r.last){h>>>=7&c,c-=7&c,r.mode=CHECK;break}for(;c<3;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}switch(r.last=1&h,c-=1,3&(h>>>=1)){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,e===Z_TREES){h>>>=2,c-=2;break t}break;case 2:r.mode=TABLE;break;case 3:t.msg="invalid block type",r.mode=BAD$1}h>>>=2,c-=2;break;case STORED:for(h>>>=7&c,c-=7&c;c<32;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",r.mode=BAD$1;break}if(r.length=65535&h,h=0,c=0,r.mode=COPY_,e===Z_TREES)break t;case COPY_:r.mode=COPY;case COPY:if(d=r.length){if(d>o&&(d=o),d>l&&(d=l),0===d)break t;common.arraySet(n,i,s,d,a),o-=d,s+=d,l-=d,a+=d,r.length-=d;break}r.mode=TYPE$1;break;case TABLE:for(;c<14;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(r.nlen=257+(31&h),h>>>=5,c-=5,r.ndist=1+(31&h),h>>>=5,c-=5,r.ncode=4+(15&h),h>>>=4,c-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=BAD$1;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;c<3;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}r.lens[I[r.have++]]=7&h,h>>>=3,c-=3}for(;r.have<19;)r.lens[I[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,S={bits:r.lenbits},v=inftrees(CODES$1,r.lens,0,19,r.lencode,0,r.work,S),r.lenbits=S.bits,v){t.msg="invalid code lengths set",r.mode=BAD$1;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;w=(A=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,b=65535&A,!((p=A>>>24)<=c);){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(b<16)h>>>=p,c-=p,r.lens[r.have++]=b;else{if(16===b){for(k=p+2;c<k;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(h>>>=p,c-=p,0===r.have){t.msg="invalid bit length repeat",r.mode=BAD$1;break}x=r.lens[r.have-1],d=3+(3&h),h>>>=2,c-=2}else if(17===b){for(k=p+3;c<k;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}c-=p,x=0,d=3+(7&(h>>>=p)),h>>>=3,c-=3}else{for(k=p+7;c<k;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}c-=p,x=0,d=11+(127&(h>>>=p)),h>>>=7,c-=7}if(r.have+d>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=BAD$1;break}for(;d--;)r.lens[r.have++]=x}}if(r.mode===BAD$1)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=BAD$1;break}if(r.lenbits=9,S={bits:r.lenbits},v=inftrees(LENS$1,r.lens,0,r.nlen,r.lencode,0,r.work,S),r.lenbits=S.bits,v){t.msg="invalid literal/lengths set",r.mode=BAD$1;break}if(r.distbits=6,r.distcode=r.distdyn,S={bits:r.distbits},v=inftrees(DISTS$1,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,S),r.distbits=S.bits,v){t.msg="invalid distances set",r.mode=BAD$1;break}if(r.mode=LEN_,e===Z_TREES)break t;case LEN_:r.mode=LEN;case LEN:if(o>=6&&l>=258){t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=c,inffast(t,f),a=t.next_out,n=t.output,l=t.avail_out,s=t.next_in,i=t.input,o=t.avail_in,h=r.hold,c=r.bits,r.mode===TYPE$1&&(r.back=-1);break}for(r.back=0;w=(A=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,b=65535&A,!((p=A>>>24)<=c);){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(w&&0==(240&w)){for(y=p,_=w,M=b;w=(A=r.lencode[M+((h&(1<<y+_)-1)>>y)])>>>16&255,b=65535&A,!(y+(p=A>>>24)<=c);){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}h>>>=y,c-=y,r.back+=y}if(h>>>=p,c-=p,r.back+=p,r.length=b,0===w){r.mode=LIT;break}if(32&w){r.back=-1,r.mode=TYPE$1;break}if(64&w){t.msg="invalid literal/length code",r.mode=BAD$1;break}r.extra=15&w,r.mode=LENEXT;case LENEXT:if(r.extra){for(k=r.extra;c<k;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;w=(A=r.distcode[h&(1<<r.distbits)-1])>>>16&255,b=65535&A,!((p=A>>>24)<=c);){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(0==(240&w)){for(y=p,_=w,M=b;w=(A=r.distcode[M+((h&(1<<y+_)-1)>>y)])>>>16&255,b=65535&A,!(y+(p=A>>>24)<=c);){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}h>>>=y,c-=y,r.back+=y}if(h>>>=p,c-=p,r.back+=p,64&w){t.msg="invalid distance code",r.mode=BAD$1;break}r.offset=b,r.extra=15&w,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(k=r.extra;c<k;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=BAD$1;break}r.mode=MATCH;case MATCH:if(0===l)break t;if(d=f-l,r.offset>d){if((d=r.offset-d)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=BAD$1;break}d>r.wnext?(d-=r.wnext,m=r.wsize-d):m=r.wnext-d,d>r.length&&(d=r.length),g=r.window}else g=n,m=a-r.offset,d=r.length;d>l&&(d=l),l-=d,r.length-=d;do{n[a++]=g[m++]}while(--d);0===r.length&&(r.mode=LEN);break;case LIT:if(0===l)break t;n[a++]=r.length,l--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;c<32;){if(0===o)break t;o--,h|=i[s++]<<c,c+=8}if(f-=l,t.total_out+=f,r.total+=f,f&&(t.adler=r.check=r.flags?crc32_1(r.check,n,f,a-f):adler32_1(r.check,n,f,a-f)),f=l,(r.flags?h:zswap32(h))!==r.check){t.msg="incorrect data check",r.mode=BAD$1;break}h=0,c=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;c<32;){if(0===o)break t;o--,h+=i[s++]<<c,c+=8}if(h!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=BAD$1;break}h=0,c=0}r.mode=DONE;case DONE:v=Z_STREAM_END$2;break t;case BAD$1:v=Z_DATA_ERROR$1;break t;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR$1}return t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=c,(r.wsize||f!==t.avail_out&&r.mode<BAD$1&&(r.mode<CHECK||e!==Z_FINISH$2))&&updatewindow(t,t.output,t.next_out,f-t.avail_out),u-=t.avail_in,f-=t.avail_out,t.total_in+=u,t.total_out+=f,r.total+=f,r.wrap&&f&&(t.adler=r.check=r.flags?crc32_1(r.check,n,f,t.next_out-f):adler32_1(r.check,n,f,t.next_out-f)),t.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE$1?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(0===u&&0===f||e===Z_FINISH$2)&&v===Z_OK$2&&(v=Z_BUF_ERROR$1),v}function inflateEnd(t){if(!t||!t.state)return Z_STREAM_ERROR$1;var e=t.state;return e.window&&(e.window=null),t.state=null,Z_OK$2}function inflateGetHeader(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?Z_STREAM_ERROR$1:(r.head=e,e.done=!1,Z_OK$2):Z_STREAM_ERROR$1}function inflateSetDictionary(t,e){var r,i=e.length;return t&&t.state?0!==(r=t.state).wrap&&r.mode!==DICT?Z_STREAM_ERROR$1:r.mode===DICT&&adler32_1(1,e,i,0)!==r.check?Z_DATA_ERROR$1:updatewindow(t,e,i,i)?(r.mode=MEM,Z_MEM_ERROR):(r.havedict=1,Z_OK$2):Z_STREAM_ERROR$1}var inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2=inflate,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo:inflateInfo},constants$1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader,toString$1=Object.prototype.toString;function Inflate(t){if(!(this instanceof Inflate))return new Inflate(t);this.options=common.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=inflate_1.inflateInit2(this.strm,e.windowBits);if(r!==constants$1.Z_OK)throw new Error(messages[r]);if(this.header=new gzheader,inflate_1.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=strings.string2buf(e.dictionary):"[object ArrayBuffer]"===toString$1.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=inflate_1.inflateSetDictionary(this.strm,e.dictionary))!==constants$1.Z_OK))throw new Error(messages[r])}function inflate$1(t,e){var r=new Inflate(e);if(r.push(t,!0),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw(t,e){return(e=e||{}).raw=!0,inflate$1(t,e)}Inflate.prototype.push=function(t,e){var r,i,n,s,a,o=this.strm,l=this.options.chunkSize,h=this.options.dictionary,c=!1;if(this.ended)return!1;i=e===~~e?e:!0===e?constants$1.Z_FINISH:constants$1.Z_NO_FLUSH,"string"==typeof t?o.input=strings.binstring2buf(t):"[object ArrayBuffer]"===toString$1.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new common.Buf8(l),o.next_out=0,o.avail_out=l),(r=inflate_1.inflate(o,constants$1.Z_NO_FLUSH))===constants$1.Z_NEED_DICT&&h&&(r=inflate_1.inflateSetDictionary(this.strm,h)),r===constants$1.Z_BUF_ERROR&&!0===c&&(r=constants$1.Z_OK,c=!1),r!==constants$1.Z_STREAM_END&&r!==constants$1.Z_OK)return this.onEnd(r),this.ended=!0,!1;o.next_out&&(0!==o.avail_out&&r!==constants$1.Z_STREAM_END&&(0!==o.avail_in||i!==constants$1.Z_FINISH&&i!==constants$1.Z_SYNC_FLUSH)||("string"===this.options.to?(n=strings.utf8border(o.output,o.next_out),s=o.next_out-n,a=strings.buf2string(o.output,n),o.next_out=s,o.avail_out=l-s,s&&common.arraySet(o.output,o.output,n,s,0),this.onData(a)):this.onData(common.shrinkBuf(o.output,o.next_out)))),0===o.avail_in&&0===o.avail_out&&(c=!0)}while((o.avail_in>0||0===o.avail_out)&&r!==constants$1.Z_STREAM_END);return r===constants$1.Z_STREAM_END&&(i=constants$1.Z_FINISH),i===constants$1.Z_FINISH?(r=inflate_1.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===constants$1.Z_OK):i!==constants$1.Z_SYNC_FLUSH||(this.onEnd(constants$1.Z_OK),o.avail_out=0,!0)},Inflate.prototype.onData=function(t){this.chunks.push(t)},Inflate.prototype.onEnd=function(t){t===constants$1.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Inflate_1=Inflate,inflate_2$1=inflate$1,inflateRaw_1=inflateRaw,ungzip=inflate$1,inflate_1$1={Inflate:Inflate_1,inflate:inflate_2$1,inflateRaw:inflateRaw_1,ungzip:ungzip},assign=common.assign,pako={};assign(pako,deflate_1$1,inflate_1$1,constants$1);var pako_1=pako;const pngSignature=[137,80,78,71,13,10,26,10],crcTable$1=[];for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;crcTable$1[t]=e}const initialCrc=4294967295;function updateCrc(t,e,r){let i=t;for(let t=0;t<r;t++)i=crcTable$1[255&(i^e[t])]^i>>>8;return i}function crc(t,e){return(updateCrc(initialCrc,t,e)^initialCrc)>>>0}var ColorType,CompressionMethod,FilterMethod,InterlaceMethod;!function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.GREYSCALE=0]="GREYSCALE",t[t.TRUECOLOUR=2]="TRUECOLOUR",t[t.INDEXED_COLOUR=3]="INDEXED_COLOUR",t[t.GREYSCALE_ALPHA=4]="GREYSCALE_ALPHA",t[t.TRUECOLOUR_ALPHA=6]="TRUECOLOUR_ALPHA"}(ColorType||(ColorType={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.DEFLATE=0]="DEFLATE"}(CompressionMethod||(CompressionMethod={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.ADAPTIVE=0]="ADAPTIVE"}(FilterMethod||(FilterMethod={})),function(t){t[t.UNKNOWN=-1]="UNKNOWN",t[t.NO_INTERLACE=0]="NO_INTERLACE",t[t.ADAM7=1]="ADAM7"}(InterlaceMethod||(InterlaceMethod={}));const empty=new Uint8Array(0),NULL="\0",uint16=new Uint16Array([255]),uint8=new Uint8Array(uint16.buffer),osIsLittleEndian=255===uint8[0];class PNGDecoder extends IOBuffer$1{constructor(t,e={}){super(t);const{checkCrc:r=!1}=e;this._checkCrc=r,this._inflator=new pako_1.Inflate,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._end=!1,this._hasPalette=!1,this._palette=[],this._compressionMethod=CompressionMethod.UNKNOWN,this._filterMethod=FilterMethod.UNKNOWN,this._interlaceMethod=InterlaceMethod.UNKNOWN,this._colorType=-1,this.setBigEndian()}decode(){for(this.decodeSignature();!this._end;)this.decodeChunk();return this.decodeImage(),this._png}decodeSignature(){for(let t=0;t<pngSignature.length;t++)if(this.readUint8()!==pngSignature[t])throw new Error(`wrong PNG signature. Byte at ${t} should be ${pngSignature[t]}.`)}decodeChunk(){const t=this.readUint32(),e=this.readChars(4),r=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"tEXt":this.decodetEXt(t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-r!==t)throw new Error("Length mismatch while decoding chunk "+e);if(this._checkCrc){const r=this.readUint32(),i=t+4,n=crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-i-4,i),i);if(n!==r)throw new Error(`CRC mismatch for chunk ${e}. Expected ${r}, found ${n}`)}else this.skip(4)}decodeIHDR(){const t=this._png;t.width=this.readUint32(),t.height=this.readUint32(),t.depth=checkBitDepth(this.readUint8());const e=this.readUint8();let r;switch(this._colorType=e,e){case ColorType.GREYSCALE:r=1;break;case ColorType.TRUECOLOUR:r=3;break;case ColorType.INDEXED_COLOUR:r=1;break;case ColorType.GREYSCALE_ALPHA:r=2;break;case ColorType.TRUECOLOUR_ALPHA:r=4;break;default:throw new Error("Unknown color type: "+e)}if(this._png.channels=r,this._compressionMethod=this.readUint8(),this._compressionMethod!==CompressionMethod.DEFLATE)throw new Error("Unsupported compression method: "+this._compressionMethod);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodePLTE(t){if(t%3!=0)throw new RangeError("PLTE field length must be a multiple of 3. Got "+t);const e=t/3;this._hasPalette=!0;const r=[];this._palette=r;for(let t=0;t<e;t++)r.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._inflator.push(new Uint8Array(this.buffer,this.offset+this.byteOffset,t),!1),this.skip(t)}decodetRNS(t){if(3===this._colorType){if(t>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){const t=this.readByte();this._palette[e].push(t)}for(;e<this._palette.length;e++)this._palette[e].push(255)}}decodetEXt(t){let e,r="";for(;(e=this.readChar())!==NULL;)r+=e;this._png.text[r]=this.readChars(t-r.length-1)}decodepHYs(){const t=this.readUint32(),e=this.readUint32(),r=this.readByte();this._png.resolution={x:t,y:e,unit:r}}decodeImage(){if(this._inflator.push(empty,!0),this._inflator.err)throw new Error("Error while decompressing the data: "+this._inflator.err);const t=this._inflator.result;if(this._filterMethod!==FilterMethod.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod!==InterlaceMethod.NO_INTERLACE)throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this.decodeInterlaceNull(t)}decodeInterlaceNull(t){const e=this._png.height,r=this._png.channels*this._png.depth/8,i=this._png.width*r,n=new Uint8Array(this._png.height*i);let s,a,o=empty,l=0;for(let h=0;h<e;h++){switch(s=t.subarray(l+1,l+1+i),a=n.subarray(h*i,(h+1)*i),t[l]){case 0:unfilterNone(s,a,i);break;case 1:unfilterSub(s,a,i,r);break;case 2:unfilterUp(s,a,o,i);break;case 3:unfilterAverage(s,a,o,i,r);break;case 4:unfilterPaeth(s,a,o,i,r);break;default:throw new Error("Unsupported filter: "+t[l])}o=a,l+=i+1}if(this._hasPalette&&(this._png.palette=this._palette),16===this._png.depth){const t=new Uint16Array(n.buffer);if(osIsLittleEndian)for(let e=0;e<t.length;e++)t[e]=swap16(t[e]);this._png.data=t}else this._png.data=n}}function unfilterNone(t,e,r){for(let i=0;i<r;i++)e[i]=t[i]}function unfilterSub(t,e,r,i){let n=0;for(;n<i;n++)e[n]=t[n];for(;n<r;n++)e[n]=t[n]+e[n-i]&255}function unfilterUp(t,e,r,i){let n=0;if(0===r.length)for(;n<i;n++)e[n]=t[n];else for(;n<i;n++)e[n]=t[n]+r[n]&255}function unfilterAverage(t,e,r,i,n){let s=0;if(0===r.length){for(;s<n;s++)e[s]=t[s];for(;s<i;s++)e[s]=t[s]+(e[s-n]>>1)&255}else{for(;s<n;s++)e[s]=t[s]+(r[s]>>1)&255;for(;s<i;s++)e[s]=t[s]+(e[s-n]+r[s]>>1)&255}}function unfilterPaeth(t,e,r,i,n){let s=0;if(0===r.length){for(;s<n;s++)e[s]=t[s];for(;s<i;s++)e[s]=t[s]+e[s-n]&255}else{for(;s<n;s++)e[s]=t[s]+r[s]&255;for(;s<i;s++)e[s]=t[s]+paethPredictor(e[s-n],r[s],r[s-n])&255}}function paethPredictor(t,e,r){const i=t+e-r,n=Math.abs(i-t),s=Math.abs(i-e),a=Math.abs(i-r);return n<=s&&n<=a?t:s<=a?e:r}function swap16(t){return(255&t)<<8|t>>8&255}function checkBitDepth(t){if(1!==t&&2!==t&&4!==t&&8!==t&&16!==t)throw new Error("invalid bit depth: "+t);return t}const defaultZlibOptions={level:3};class PNGEncoder extends IOBuffer$1{constructor(t,e={}){super(),this._colorType=ColorType.UNKNOWN,this._zlibOptions=Object.assign({},defaultZlibOptions,e.zlib),this._png=this._checkData(t),this.setBigEndian()}encode(){return this.encodeSignature(),this.encodeIHDR(),this.encodeData(),this.encodeIEND(),this.toArray()}encodeSignature(){this.writeBytes(pngSignature)}encodeIHDR(){this.writeUint32(13),this.writeChars("IHDR"),this.writeUint32(this._png.width),this.writeUint32(this._png.height),this.writeByte(this._png.depth),this.writeByte(this._colorType),this.writeByte(CompressionMethod.DEFLATE),this.writeByte(FilterMethod.ADAPTIVE),this.writeByte(InterlaceMethod.NO_INTERLACE),this.writeCrc(17)}encodeIEND(){this.writeUint32(0),this.writeChars("IEND"),this.writeCrc(4)}encodeIDAT(t){this.writeUint32(t.length),this.writeChars("IDAT"),this.writeBytes(t),this.writeCrc(t.length+4)}encodeData(){const{width:t,height:e,channels:r,depth:i,data:n}=this._png,s=r*t,a=(new IOBuffer$1).setBigEndian();let o=0;for(let t=0;t<e;t++)if(a.writeByte(0),8===i)o=writeDataBytes(n,a,s,o);else{if(16!==i)throw new Error("unreachable");o=writeDataUint16(n,a,s,o)}const l=a.toArray(),h=pako_1.deflate(l,this._zlibOptions);this.encodeIDAT(h)}_checkData(t){const{colorType:e,channels:r,depth:i}=getColorType(t),n={width:checkInteger(t.width,"width"),height:checkInteger(t.height,"height"),channels:r,data:t.data,depth:i,text:{}};this._colorType=e;const s=n.width*n.height*r;if(n.data.length!==s)throw new RangeError(`wrong data size. Found ${n.data.length}, expected ${s}`);return n}writeCrc(t){this.writeUint32(crc(new Uint8Array(this.buffer,this.byteOffset+this.offset-t,t),t))}}function checkInteger(t,e){if(Number.isInteger(t)&&t>0)return t;throw new TypeError(e+" must be a positive integer")}function getColorType(t){const{channels:e=4,depth:r=8}=t;if(4!==e&&3!==e&&2!==e&&1!==e)throw new RangeError("unsupported number of channels: "+e);if(8!==r&&16!==r)throw new RangeError("unsupported bit depth: "+r);const i={channels:e,depth:r,colorType:ColorType.UNKNOWN};switch(e){case 4:i.colorType=ColorType.TRUECOLOUR_ALPHA;break;case 3:i.colorType=ColorType.TRUECOLOUR;break;case 1:i.colorType=ColorType.GREYSCALE;break;case 2:i.colorType=ColorType.GREYSCALE_ALPHA;break;default:throw new Error("unsupported number of channels: "+e)}return i}function writeDataBytes(t,e,r,i){for(let n=0;n<r;n++)e.writeByte(t[i++]);return i}function writeDataUint16(t,e,r,i){for(let n=0;n<r;n++)e.writeUint16(t[i++]);return i}var ResolutionUnitSpecifier;function decodePNG(t,e){return new PNGDecoder(t,e).decode()}function encodePNG(t,e){return new PNGEncoder(t,e).encode()}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"}(ResolutionUnitSpecifier||(ResolutionUnitSpecifier={}));var encoder$1=createCommonjsModule((function(t){function e(t){var e,r,i,n,s,a=Math.floor,o=new Array(64),l=new Array(64),h=new Array(64),c=new Array(64),u=new Array(65535),f=new Array(65535),d=new Array(64),m=new Array(64),g=[],p=0,w=7,b=new Array(64),y=new Array(64),_=new Array(64),M=new Array(256),x=new Array(2048),v=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],k=[0,1,2,3,4,5,6,7,8,9,10,11],A=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],E=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],I=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],C=[0,1,2,3,4,5,6,7,8,9,10,11],D=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],T=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function R(t,e){for(var r=0,i=0,n=new Array,s=1;s<=16;s++){for(var a=1;a<=t[s];a++)n[e[i]]=[],n[e[i]][0]=r,n[e[i]][1]=s,i++,r++;r*=2}return n}function P(t){for(var e=t[0],r=t[1]-1;r>=0;)e&1<<r&&(p|=1<<w),r--,--w<0&&(255==p?(B(255),B(0)):B(p),w=7,p=0)}function B(t){g.push(t)}function O(t){B(t>>8&255),B(255&t)}function L(t,e,r,i,n){for(var s,a=n[0],o=n[240],l=function(t,e){var r,i,n,s,a,o,l,h,c,u,f=0;for(c=0;c<8;++c){r=t[f],i=t[f+1],n=t[f+2],s=t[f+3],a=t[f+4],o=t[f+5],l=t[f+6];var m=r+(h=t[f+7]),g=r-h,p=i+l,w=i-l,b=n+o,y=n-o,_=s+a,M=s-a,x=m+_,v=m-_,S=p+b,k=p-b;t[f]=x+S,t[f+4]=x-S;var A=.707106781*(k+v);t[f+2]=v+A,t[f+6]=v-A;var E=.382683433*((x=M+y)-(k=w+g)),I=.5411961*x+E,C=1.306562965*k+E,D=.707106781*(S=y+w),T=g+D,R=g-D;t[f+5]=R+I,t[f+3]=R-I,t[f+1]=T+C,t[f+7]=T-C,f+=8}for(f=0,c=0;c<8;++c){r=t[f],i=t[f+8],n=t[f+16],s=t[f+24],a=t[f+32],o=t[f+40],l=t[f+48];var P=r+(h=t[f+56]),B=r-h,O=i+l,L=i-l,N=n+o,F=n-o,U=s+a,$=s-a,V=P+U,z=P-U,H=O+N,G=O-N;t[f]=V+H,t[f+32]=V-H;var Y=.707106781*(G+z);t[f+16]=z+Y,t[f+48]=z-Y;var X=.382683433*((V=$+F)-(G=L+B)),j=.5411961*V+X,K=1.306562965*G+X,Z=.707106781*(H=F+L),W=B+Z,q=B-Z;t[f+40]=q+j,t[f+24]=q-j,t[f+8]=W+K,t[f+56]=W-K,f++}for(c=0;c<64;++c)u=t[c]*e[c],d[c]=u>0?u+.5|0:u-.5|0;return d}(t,e),h=0;h<64;++h)m[v[h]]=l[h];var c=m[0]-r;r=m[0],0==c?P(i[0]):(P(i[f[s=32767+c]]),P(u[s]));for(var g=63;g>0&&0==m[g];g--);if(0==g)return P(a),r;for(var p,w=1;w<=g;){for(var b=w;0==m[w]&&w<=g;++w);var y=w-b;if(y>=16){p=y>>4;for(var _=1;_<=p;++_)P(o);y&=15}s=32767+m[w],P(n[(y<<4)+f[s]]),P(u[s]),w++}return 63!=g&&P(a),r}function N(t){t<=0&&(t=1),t>100&&(t=100),s!=t&&(function(t){for(var e=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;r<64;r++){var i=a((e[r]*t+50)/100);i<1?i=1:i>255&&(i=255),o[v[r]]=i}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],s=0;s<64;s++){var u=a((n[s]*t+50)/100);u<1?u=1:u>255&&(u=255),l[v[s]]=u}for(var f=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],d=0,m=0;m<8;m++)for(var g=0;g<8;g++)h[d]=1/(o[v[d]]*f[m]*f[g]*8),c[d]=1/(l[v[d]]*f[m]*f[g]*8),d++}(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),s=t)}this.encode=function(t,s){(new Date).getTime(),s&&N(s),g=new Array,p=0,w=7,O(65496),O(65504),O(16),B(74),B(70),B(73),B(70),B(0),B(1),B(1),B(0),O(1),O(1),B(0),B(0),function(t){if(t){O(65505),69===t[0]&&120===t[1]&&105===t[2]&&102===t[3]?O(t.length+2):(O(t.length+5+2),B(69),B(120),B(105),B(102),B(0));for(var e=0;e<t.length;e++)B(t[e])}}(t.exifBuffer),function(){O(65499),O(132),B(0);for(var t=0;t<64;t++)B(o[t]);B(1);for(var e=0;e<64;e++)B(l[e])}(),function(t,e){O(65472),O(17),B(8),O(e),O(t),B(3),B(1),B(17),B(0),B(2),B(17),B(1),B(3),B(17),B(1)}(t.width,t.height),function(){O(65476),O(418),B(0);for(var t=0;t<16;t++)B(S[t+1]);for(var e=0;e<=11;e++)B(k[e]);B(16);for(var r=0;r<16;r++)B(A[r+1]);for(var i=0;i<=161;i++)B(E[i]);B(1);for(var n=0;n<16;n++)B(I[n+1]);for(var s=0;s<=11;s++)B(C[s]);B(17);for(var a=0;a<16;a++)B(D[a+1]);for(var o=0;o<=161;o++)B(T[o])}(),O(65498),O(12),B(3),B(1),B(0),B(2),B(17),B(3),B(17),B(0),B(63),B(0);var a=0,u=0,f=0;p=0,w=7,this.encode.displayName="_encode_";for(var d,m,M,v,R,F,U,$,V,z=t.data,H=t.width,G=t.height,Y=4*H,X=0;X<G;){for(d=0;d<Y;){for(F=R=Y*X+d,U=-1,$=0,V=0;V<64;V++)F=R+($=V>>3)*Y+(U=4*(7&V)),X+$>=G&&(F-=Y*(X+1+$-G)),d+U>=Y&&(F-=d+U-Y+4),m=z[F++],M=z[F++],v=z[F++],b[V]=(x[m]+x[M+256>>0]+x[v+512>>0]>>16)-128,y[V]=(x[m+768>>0]+x[M+1024>>0]+x[v+1280>>0]>>16)-128,_[V]=(x[m+1280>>0]+x[M+1536>>0]+x[v+1792>>0]>>16)-128;a=L(b,h,a,e,i),u=L(y,c,u,r,n),f=L(_,c,f,r,n),d+=32}X+=8}if(w>=0){var j=[];j[1]=w+1,j[0]=(1<<w+1)-1,P(j)}return O(65497),Buffer.from(g)},(new Date).getTime(),t||(t=50),function(){for(var t=String.fromCharCode,e=0;e<256;e++)M[e]=t(e)}(),e=R(S,k),r=R(I,C),i=R(A,E),n=R(D,T),function(){for(var t=1,e=2,r=1;r<=15;r++){for(var i=t;i<e;i++)f[32767+i]=r,u[32767+i]=[],u[32767+i][1]=r,u[32767+i][0]=i;for(var n=-(e-1);n<=-t;n++)f[32767+n]=r,u[32767+n]=[],u[32767+n][1]=r,u[32767+n][0]=e-1+n;t<<=1,e<<=1}}(),function(){for(var t=0;t<256;t++)x[t]=19595*t,x[t+256>>0]=38470*t,x[t+512>>0]=7471*t+32768,x[t+768>>0]=-11059*t,x[t+1024>>0]=-21709*t,x[t+1280>>0]=32768*t+8421375,x[t+1536>>0]=-27439*t,x[t+1792>>0]=-5329*t}(),N(t),(new Date).getTime()}t.exports=function(t,r){return void 0===r&&(r=50),{data:new e(r).encode(t,r),width:t.width,height:t.height}}})),decoder$1=createCommonjsModule((function(t){var e=function(){var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);function e(){}function r(t,e){for(var r,i,n=0,s=[],a=16;a>0&&!t[a-1];)a--;s.push({children:[],index:0});var o,l=s[0];for(r=0;r<a;r++){for(i=0;i<t[r];i++){for((l=s.pop()).children[l.index]=e[n];l.index>0;){if(0===s.length)throw new Error("Could not recreate Huffman Table");l=s.pop()}for(l.index++,s.push(l);s.length<=r;)s.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o;n++}r+1<a&&(s.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o)}return s[0].children}function i(e,r,i,n,s,a,o,l,h,c){i.precision,i.samplesPerLine,i.scanLines;var u=i.mcusPerLine,f=i.progressive,d=(i.maxH,i.maxV,r),m=0,g=0;function p(){if(g>0)return g--,m>>g&1;if(255==(m=e[r++])){var t=e[r++];if(t)throw new Error("unexpected marker: "+(m<<8|t).toString(16))}return g=7,m>>>7}function w(t){for(var e,r=t;null!==(e=p());){if("number"==typeof(r=r[e]))return r;if("object"!=typeof r)throw new Error("invalid huffman sequence")}return null}function b(t){for(var e=0;t>0;){var r=p();if(null===r)return;e=e<<1|r,t--}return e}function y(t){var e=b(t);return e>=1<<t-1?e:e+(-1<<t)+1}var _,M=0,x=0;function v(t,e,r,i,n){var s=r%u,a=(r/u|0)*t.v+i,o=s*t.h+n;void 0===t.blocks[a]&&c.tolerantDecoding||e(t,t.blocks[a][o])}function S(t,e,r){var i=r/t.blocksPerLine|0,n=r%t.blocksPerLine;void 0===t.blocks[i]&&c.tolerantDecoding||e(t,t.blocks[i][n])}var k,A,E,I,C,D,T=n.length;D=f?0===a?0===l?function(t,e){var r=w(t.huffmanTableDC),i=0===r?0:y(r)<<h;e[0]=t.pred+=i}:function(t,e){e[0]|=p()<<h}:0===l?function(e,r){if(M>0)M--;else for(var i=a,n=o;i<=n;){var s=w(e.huffmanTableAC),l=15&s,c=s>>4;if(0!==l)r[t[i+=c]]=y(l)*(1<<h),i++;else{if(c<15){M=b(c)+(1<<c)-1;break}i+=16}}}:function(e,r){for(var i=a,n=o,s=0;i<=n;){var l=t[i],c=r[l]<0?-1:1;switch(x){case 0:var u=w(e.huffmanTableAC),f=15&u;if(s=u>>4,0===f)s<15?(M=b(s)+(1<<s),x=4):(s=16,x=1);else{if(1!==f)throw new Error("invalid ACn encoding");_=y(f),x=s?2:3}continue;case 1:case 2:r[l]?r[l]+=(p()<<h)*c:0==--s&&(x=2==x?3:0);break;case 3:r[l]?r[l]+=(p()<<h)*c:(r[l]=_<<h,x=0);break;case 4:r[l]&&(r[l]+=(p()<<h)*c)}i++}4===x&&0==--M&&(x=0)}:function(e,r){var i=w(e.huffmanTableDC),n=0===i?0:y(i);r[0]=e.pred+=n;for(var s=1;s<64;){var a=w(e.huffmanTableAC),o=15&a,l=a>>4;if(0!==o)r[t[s+=l]]=y(o),s++;else{if(l<15)break;s+=16}}};var R,P,B,O,L=0;for(P=1==T?n[0].blocksPerLine*n[0].blocksPerColumn:u*i.mcusPerColumn,s||(s=P);L<P;){for(A=0;A<T;A++)n[A].pred=0;if(M=0,1==T)for(k=n[0],C=0;C<s;C++)S(k,D,L),L++;else for(C=0;C<s;C++){for(A=0;A<T;A++)for(B=(k=n[A]).h,O=k.v,E=0;E<O;E++)for(I=0;I<B;I++)v(k,D,L,E,I);if(++L===P)break}if(L===P)do{if(255===e[r]&&0!==e[r+1])break;r+=1}while(r<e.length-2);if(g=0,(R=e[r]<<8|e[r+1])<65280)throw new Error("marker was not found");if(!(R>=65488&&R<=65495))break;r+=2}return r-d}function n(t,e){var r,i,n=[],s=e.blocksPerLine,a=e.blocksPerColumn,o=s<<3,h=new Int32Array(64),c=new Uint8Array(64);function u(t,r,i){var n,s,a,o,l,h,c,u,f,d,m=e.quantizationTable,g=i;for(d=0;d<64;d++)g[d]=t[d]*m[d];for(d=0;d<8;++d){var p=8*d;0!=g[1+p]||0!=g[2+p]||0!=g[3+p]||0!=g[4+p]||0!=g[5+p]||0!=g[6+p]||0!=g[7+p]?(n=5793*g[0+p]+128>>8,s=5793*g[4+p]+128>>8,a=g[2+p],o=g[6+p],l=2896*(g[1+p]-g[7+p])+128>>8,u=2896*(g[1+p]+g[7+p])+128>>8,h=g[3+p]<<4,f=n-s+1>>1,n=n+s+1>>1,s=f,f=3784*a+1567*o+128>>8,a=1567*a-3784*o+128>>8,o=f,f=l-(c=g[5+p]<<4)+1>>1,l=l+c+1>>1,c=f,f=u+h+1>>1,h=u-h+1>>1,u=f,f=n-o+1>>1,n=n+o+1>>1,o=f,f=s-a+1>>1,s=s+a+1>>1,a=f,f=2276*l+3406*u+2048>>12,l=3406*l-2276*u+2048>>12,u=f,f=799*h+4017*c+2048>>12,h=4017*h-799*c+2048>>12,c=f,g[0+p]=n+u,g[7+p]=n-u,g[1+p]=s+c,g[6+p]=s-c,g[2+p]=a+h,g[5+p]=a-h,g[3+p]=o+l,g[4+p]=o-l):(f=5793*g[0+p]+512>>10,g[0+p]=f,g[1+p]=f,g[2+p]=f,g[3+p]=f,g[4+p]=f,g[5+p]=f,g[6+p]=f,g[7+p]=f)}for(d=0;d<8;++d){var w=d;0!=g[8+w]||0!=g[16+w]||0!=g[24+w]||0!=g[32+w]||0!=g[40+w]||0!=g[48+w]||0!=g[56+w]?(n=5793*g[0+w]+2048>>12,s=5793*g[32+w]+2048>>12,a=g[16+w],o=g[48+w],l=2896*(g[8+w]-g[56+w])+2048>>12,u=2896*(g[8+w]+g[56+w])+2048>>12,h=g[24+w],f=n-s+1>>1,n=n+s+1>>1,s=f,f=3784*a+1567*o+2048>>12,a=1567*a-3784*o+2048>>12,o=f,f=l-(c=g[40+w])+1>>1,l=l+c+1>>1,c=f,f=u+h+1>>1,h=u-h+1>>1,u=f,f=n-o+1>>1,n=n+o+1>>1,o=f,f=s-a+1>>1,s=s+a+1>>1,a=f,f=2276*l+3406*u+2048>>12,l=3406*l-2276*u+2048>>12,u=f,f=799*h+4017*c+2048>>12,h=4017*h-799*c+2048>>12,c=f,g[0+w]=n+u,g[56+w]=n-u,g[8+w]=s+c,g[48+w]=s-c,g[16+w]=a+h,g[40+w]=a-h,g[24+w]=o+l,g[32+w]=o-l):(f=5793*i[d+0]+8192>>14,g[0+w]=f,g[8+w]=f,g[16+w]=f,g[24+w]=f,g[32+w]=f,g[40+w]=f,g[48+w]=f,g[56+w]=f)}for(d=0;d<64;++d){var b=128+(g[d]+8>>4);r[d]=b<0?0:b>255?255:b}}l(o*a*8);for(var f=0;f<a;f++){var d=f<<3;for(r=0;r<8;r++)n.push(new Uint8Array(o));for(var m=0;m<s;m++){u(e.blocks[f][m],c,h);var g=0,p=m<<3;for(i=0;i<8;i++){var w=n[d+i];for(r=0;r<8;r++)w[p+r]=c[g++]}}}return n}function s(t){return t<0?0:t>255?255:t}e.prototype={load:function(t){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){var t=new Uint8Array(e.response||e.mozResponseArrayBuffer);this.parse(t),this.onload&&this.onload()}.bind(this),e.send(null)},parse:function(e){var s=1e3*this.opts.maxResolutionInMP*1e3,a=0;function o(){var t=e[a]<<8|e[a+1];return a+=2,t}function h(){var t=o(),r=e.subarray(a,a+t-2);return a+=r.length,r}function c(t){var e,r,i=0,n=0;for(r in t.components)t.components.hasOwnProperty(r)&&(i<(e=t.components[r]).h&&(i=e.h),n<e.v&&(n=e.v));var s=Math.ceil(t.samplesPerLine/8/i),a=Math.ceil(t.scanLines/8/n);for(r in t.components)if(t.components.hasOwnProperty(r)){e=t.components[r];var o=Math.ceil(Math.ceil(t.samplesPerLine/8)*e.h/i),h=Math.ceil(Math.ceil(t.scanLines/8)*e.v/n),c=s*e.h,u=a*e.v,f=[];l(u*c*256);for(var d=0;d<u;d++){for(var m=[],g=0;g<c;g++)m.push(new Int32Array(64));f.push(m)}e.blocksPerLine=o,e.blocksPerColumn=h,e.blocks=f}t.maxH=i,t.maxV=n,t.mcusPerLine=s,t.mcusPerColumn=a}e.length;var u,f,d=null,m=null,g=[],p=[],w=[],b=[],y=o();if(this.comments=[],65496!=y)throw new Error("SOI not found");for(y=o();65497!=y;){switch(y){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var _=h();if(65534===y){var M=String.fromCharCode.apply(null,_);this.comments.push(M)}65504===y&&74===_[0]&&70===_[1]&&73===_[2]&&70===_[3]&&0===_[4]&&(d={version:{major:_[5],minor:_[6]},densityUnits:_[7],xDensity:_[8]<<8|_[9],yDensity:_[10]<<8|_[11],thumbWidth:_[12],thumbHeight:_[13],thumbData:_.subarray(14,14+3*_[12]*_[13])}),65505===y&&69===_[0]&&120===_[1]&&105===_[2]&&102===_[3]&&0===_[4]&&(this.exifBuffer=_.subarray(5,_.length)),65518===y&&65===_[0]&&100===_[1]&&111===_[2]&&98===_[3]&&101===_[4]&&0===_[5]&&(m={version:_[6],flags0:_[7]<<8|_[8],flags1:_[9]<<8|_[10],transformCode:_[11]});break;case 65499:for(var x=o()+a-2;a<x;){var v=e[a++];l(256);var S=new Int32Array(64);if(v>>4==0)for(X=0;X<64;X++)S[t[X]]=e[a++];else{if(v>>4!=1)throw new Error("DQT: invalid table spec");for(X=0;X<64;X++)S[t[X]]=o()}g[15&v]=S}break;case 65472:case 65473:case 65474:o(),(u={}).extended=65473===y,u.progressive=65474===y,u.precision=e[a++],u.scanLines=o(),u.samplesPerLine=o(),u.components={},u.componentsOrder=[];var k=u.scanLines*u.samplesPerLine;if(k>s){var A=Math.ceil((k-s)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${A}MP`)}var E,I=e[a++];for(G=0;G<I;G++){E=e[a];var C=e[a+1]>>4,D=15&e[a+1],T=e[a+2];u.componentsOrder.push(E),u.components[E]={h:C,v:D,quantizationIdx:T},a+=3}c(u),p.push(u);break;case 65476:var R=o();for(G=2;G<R;){var P=e[a++],B=new Uint8Array(16),O=0;for(X=0;X<16;X++,a++)O+=B[X]=e[a];l(16+O);var L=new Uint8Array(O);for(X=0;X<O;X++,a++)L[X]=e[a];G+=17+O,(P>>4==0?b:w)[15&P]=r(B,L)}break;case 65501:o(),f=o();break;case 65500:o(),o();break;case 65498:o();var N=e[a++],F=[];for(G=0;G<N;G++){j=u.components[e[a++]];var U=e[a++];j.huffmanTableDC=b[U>>4],j.huffmanTableAC=w[15&U],F.push(j)}var $=e[a++],V=e[a++],z=e[a++],H=i(e,a,u,F,f,$,V,z>>4,15&z,this.opts);a+=H;break;case 65535:255!==e[a]&&a--;break;default:if(255==e[a-3]&&e[a-2]>=192&&e[a-2]<=254){a-=3;break}throw new Error("unknown JPEG marker "+y.toString(16))}y=o()}if(1!=p.length)throw new Error("only single frame JPEGs supported");for(var G=0;G<p.length;G++){var Y=p[G].components;for(var X in Y)Y[X].quantizationTable=g[Y[X].quantizationIdx],delete Y[X].quantizationIdx}for(this.width=u.samplesPerLine,this.height=u.scanLines,this.jfif=d,this.adobe=m,this.components=[],G=0;G<u.componentsOrder.length;G++){var j=u.components[u.componentsOrder[G]];this.components.push({lines:n(0,j),scaleX:j.h/u.maxH,scaleY:j.v/u.maxV})}},getData:function(t,e){var r,i,n,a,o,h,c,u,f,d,m,g,p,w,b,y,_,M,x,v,S,k=this.width/t,A=this.height/e,E=0,I=t*e*this.components.length;l(I);var C=new Uint8Array(I);switch(this.components.length){case 1:for(r=this.components[0],d=0;d<e;d++)for(o=r.lines[0|d*r.scaleY*A],f=0;f<t;f++)m=o[0|f*r.scaleX*k],C[E++]=m;break;case 2:for(r=this.components[0],i=this.components[1],d=0;d<e;d++)for(o=r.lines[0|d*r.scaleY*A],h=i.lines[0|d*i.scaleY*A],f=0;f<t;f++)m=o[0|f*r.scaleX*k],C[E++]=m,m=h[0|f*i.scaleX*k],C[E++]=m;break;case 3:for(S=!0,this.adobe&&this.adobe.transformCode?S=!0:void 0!==this.opts.colorTransform&&(S=!!this.opts.colorTransform),r=this.components[0],i=this.components[1],n=this.components[2],d=0;d<e;d++)for(o=r.lines[0|d*r.scaleY*A],h=i.lines[0|d*i.scaleY*A],c=n.lines[0|d*n.scaleY*A],f=0;f<t;f++)S?(m=o[0|f*r.scaleX*k],g=h[0|f*i.scaleX*k],M=s(m+1.402*((p=c[0|f*n.scaleX*k])-128)),x=s(m-.3441363*(g-128)-.71413636*(p-128)),v=s(m+1.772*(g-128))):(M=o[0|f*r.scaleX*k],x=h[0|f*i.scaleX*k],v=c[0|f*n.scaleX*k]),C[E++]=M,C[E++]=x,C[E++]=v;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(S=!1,this.adobe&&this.adobe.transformCode?S=!0:void 0!==this.opts.colorTransform&&(S=!!this.opts.colorTransform),r=this.components[0],i=this.components[1],n=this.components[2],a=this.components[3],d=0;d<e;d++)for(o=r.lines[0|d*r.scaleY*A],h=i.lines[0|d*i.scaleY*A],c=n.lines[0|d*n.scaleY*A],u=a.lines[0|d*a.scaleY*A],f=0;f<t;f++)S?(m=o[0|f*r.scaleX*k],g=h[0|f*i.scaleX*k],p=c[0|f*n.scaleX*k],w=u[0|f*a.scaleX*k],b=255-s(m+1.402*(p-128)),y=255-s(m-.3441363*(g-128)-.71413636*(p-128)),_=255-s(m+1.772*(g-128))):(b=o[0|f*r.scaleX*k],y=h[0|f*i.scaleX*k],_=c[0|f*n.scaleX*k],w=u[0|f*a.scaleX*k]),C[E++]=255-b,C[E++]=255-y,C[E++]=255-_,C[E++]=255-w;break;default:throw new Error("Unsupported color mode")}return C},copyToImageData:function(t,e){var r,i,n,a,o,l,h,c,u,f=t.width,d=t.height,m=t.data,g=this.getData(f,d),p=0,w=0;switch(this.components.length){case 1:for(i=0;i<d;i++)for(r=0;r<f;r++)n=g[p++],m[w++]=n,m[w++]=n,m[w++]=n,e&&(m[w++]=255);break;case 3:for(i=0;i<d;i++)for(r=0;r<f;r++)h=g[p++],c=g[p++],u=g[p++],m[w++]=h,m[w++]=c,m[w++]=u,e&&(m[w++]=255);break;case 4:for(i=0;i<d;i++)for(r=0;r<f;r++)o=g[p++],l=g[p++],n=g[p++],h=255-s(o*(1-(a=g[p++])/255)+a),c=255-s(l*(1-a/255)+a),u=255-s(n*(1-a/255)+a),m[w++]=h,m[w++]=c,m[w++]=u,e&&(m[w++]=255);break;default:throw new Error("Unsupported color mode")}}};var a=0,o=0;function l(t=0){var e=a+t;if(e>o){var r=Math.ceil((e-o)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${r}MB`)}a=e}return e.resetMaxMemoryUsage=function(t){a=0,o=t},e.getBytesAllocated=function(){return a},e.requestMemoryAllocation=l,e}();t.exports=function(t,r={}){var i={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...r},n=new Uint8Array(t),s=new e;s.opts=i,e.resetMaxMemoryUsage(1024*i.maxMemoryUsageInMB*1024),s.parse(n);var a=i.formatAsRGBA?4:3,o=s.width*s.height*a;try{e.requestMemoryAllocation(o);var l={width:s.width,height:s.height,exifBuffer:s.exifBuffer,data:i.useTArray?new Uint8Array(o):Buffer.alloc(o)};s.comments.length>0&&(l.comments=s.comments)}catch(t){throw t instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+o):t}return s.copyToImageData(l,i.formatAsRGBA),l}})),jpegJs={encode:encoder$1,decode:decoder$1};let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=new Uint8Array(256);for(let t=0;t<chars.length;t++)lookup[chars.charCodeAt(t)]=t;function encode$3(t){let e,r=t.length,i="";for(e=0;e<r;e+=3)i+=chars[t[e]>>2],i+=chars[(3&t[e])<<4|t[e+1]>>4],i+=chars[(15&t[e+1])<<2|t[e+2]>>6],i+=chars[63&t[e+2]];return r%3==2?i=i.substring(0,i.length-1)+"=":r%3==1&&(i=i.substring(0,i.length-2)+"=="),i}function decode$1(t){let e,r,i,n,s=.75*t.length,a=t.length,o=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);const l=new Uint8Array(s);for(let s=0;s<a;s+=4)e=lookup[t.charCodeAt(s)],r=lookup[t.charCodeAt(s+1)],i=lookup[t.charCodeAt(s+2)],n=lookup[t.charCodeAt(s+3)],l[o++]=e<<2|r>>4,l[o++]=(15&r)<<4|i>>2,l[o++]=(3&i)<<6|63&n;return l}function toBase64URL(t,e){return`data:${e};base64,${encode$3(t)}`}const ImageData=self.ImageData,DOMImage=self.Image;function createCanvas(t,e){let r=self.document.createElement("canvas");return r.width=t,r.height=e,r}function fetchBinary(t,{withCredentials:e=!1}={}){return new Promise((function(r,i){let n=new self.XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.withCredentials=e,n.onload=function(t){200!==this.status?i(t):r(this.response)},n.onerror=i,n.send()}))}function createWriteStream(){throw new Error("createWriteStream does not exist in the browser")}function writeFile(){throw new Error("writeFile does not exist in the browser")}function getType(t){return t.includes("/")||(t="image/"+t),t}function encodeJpeg(t,e={}){const r={width:t.width,height:t.height,data:t.getRGBAData()};return jpegJs.encode(r,e.quality).data}function encodePng(t,e){const r={width:t.width,height:t.height,channels:t.channels,depth:t.bitDepth,data:t.data};return 1!==r.depth&&32!==r.depth||(r.depth=8,r.channels=4,r.data=t.getRGBAData()),encodePNG(r,e)}const exportMethods={save(t,e={}){const{useCanvas:r=!1,encoder:i}=e;let{format:n}=e;if(!n){const e=/\.([a-zA-Z]+)$/.exec(t);e&&(n=e[1].toLowerCase())}if(!n)throw new Error("file format not provided");return new Promise((t,e)=>{let s,a;switch(n.toLowerCase()){case"png":r?s=this.getCanvas().pngStream():a=encodePng(this,i);break;case"jpg":case"jpeg":r?s=this.getCanvas().jpegStream():a=encodeJpeg(this,i);break;case"bmp":a=encode$1(this);break;default:throw new RangeError("invalid output format: "+n)}if(s){let r=createWriteStream();r.on("finish",t),r.on("error",e),s.pipe(r)}else a&&writeFile()})},toDataURL(t="image/png",e={}){"object"==typeof t&&(e=t,t="image/png");const{useCanvas:r=!1,encoder:i}=e;function n(e,r){return toBase64URL(e(r,i),t)}return"image/bmp"===(t=getType(t))?n(encode$1,this):"image/png"!==t||r?"image/jpeg"!==t||r?this.getCanvas().toDataURL(t):n(encodeJpeg,this):n(encodePng,this)},toBuffer(t={}){const{format:e="png",encoder:r}=t;switch(e.toLowerCase()){case"png":return encodePng(this,r);case"jpeg":case"jpg":return encodeJpeg(this,r);case"bmp":return encode$1(this);default:throw new RangeError("invalid output format: "+e)}},toBase64(t="image/png",e={}){if(e.async)return this.toDataURL(t,e).then((function(t){return t.substring(t.indexOf(",")+1)}));{const r=this.toDataURL(t,e);return r.substring(r.indexOf(",")+1)}},toBlob(t="image/png",e=.8){return canvasToBlob(this.getCanvas(),t,e)},getCanvas(){const t=new ImageData(this.getRGBAData({clamped:!0}),this.width,this.height);let e=createCanvas(this.width,this.height);return e.getContext("2d").putImageData(t,0,0),e}};function setExportMethods(t){for(const e in exportMethods)t.prototype[e]=exportMethods[e]}var _from="has-own@^1.0.1",_id="has-own@1.0.1",_inBundle=!1,_integrity="sha512-RDKhzgQTQfMaLvIFhjahU+2gGnRBK6dYOd5Gd9BzkmnBneOCRYjRC003RIMrdAbH52+l+CnMS4bBCXGer8tEhg==",_location="/has-own",_phantomChildren={},_requested={type:"range",registry:!0,raw:"has-own@^1.0.1",name:"has-own",escapedName:"has-own",rawSpec:"^1.0.1",saveSpec:null,fetchSpec:"^1.0.1"},_requiredBy=["/"],_resolved="https://registry.npmjs.org/has-own/-/has-own-1.0.1.tgz",_shasum="7cc78a63e5ffde330fa8d0a6ddaca4a70c495579",_spec="has-own@^1.0.1",_where="/usr/local/www/sites/www.lactame.com/node/grm-data/git/image-js/image-js",author={name:"Aaron Heckmann",email:"aaron.heckmann+github@gmail.com"},bugs={url:"https://github.com/aheckmann/has-own/issues"},bundleDependencies=!1,deprecated=!1,description="A safer .hasOwnProperty() - hasOwn(name, obj)",devDependencies={mocha:"^6.2.2"},homepage="https://github.com/aheckmann/has-own/",license="MIT",main="index.js",name="has-own",repository={type:"git",url:"git://github.com/aheckmann/has-own.git"},scripts={test:"make test"},version="1.0.1",require$$0={_from:_from,_id:_id,_inBundle:_inBundle,_integrity:_integrity,_location:_location,_phantomChildren:_phantomChildren,_requested:_requested,_requiredBy:_requiredBy,_resolved:_resolved,_shasum:_shasum,_spec:_spec,_where:_where,author:author,bugs:bugs,bundleDependencies:bundleDependencies,deprecated:deprecated,description:description,devDependencies:devDependencies,homepage:homepage,license:license,main:main,name:name,repository:repository,scripts:scripts,version:version},hasOwn=createCommonjsModule((function(t,e){var r=Object.prototype.hasOwnProperty;t.exports=e=function(t,e){return r.call(e,t)},e.version=require$$0.version}));let computedPropertyDescriptor={configurable:!0,enumerable:!1,get:void 0};function extendMethod(t,e,r={}){let{inPlace:i=!1,returnThis:n=!0,partialArgs:s=[]}=r;return Image.prototype[t]=i?function(...t){this.computed=null;let r=e.apply(this,[...s,...t]);return n?this:r}:function(...t){return e.apply(this,[...s,...t])},Image}function extendProperty(t,e,r={}){let{partialArgs:i=[]}=r;return computedPropertyDescriptor.get=function(){if(null===this.computed)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let r=e.apply(this,i);return this.computed[t]=r,r},Object.defineProperty(Image.prototype,t,computedPropertyDescriptor),Image}const GREY="GREY",RGB="RGB",HSL="HSL",HSV="HSV",CMYK="CMYK";var ColorModel=Object.freeze({__proto__:null,GREY:GREY,RGB:RGB,HSL:HSL,HSV:HSV,CMYK:CMYK});function getRGBAData(t={}){const{clamped:e}=t;this.checkProcessable("getRGBAData",{components:[1,3],bitDepth:[1,8,16,32]});const r=this.width*this.height*4;let i=e?new Uint8ClampedArray(r):new Uint8Array(r);return 1===this.bitDepth?fillDataFromBinary(this,i):32===this.bitDepth?(this.checkProcessable("getRGBAData",{alpha:0}),1===this.components?fillDataFromGrey32(this,i):3===this.components&&(this.checkProcessable("getRGBAData",{colorModel:[RGB]}),fillDataFromRGB32(this,i))):1===this.components?fillDataFromGrey(this,i):3===this.components&&(this.checkProcessable("getRGBAData",{colorModel:[RGB]}),fillDataFromRGB(this,i)),1===this.alpha?(this.checkProcessable("getRGBAData",{bitDepth:[8,16]}),copyAlpha(this,i)):fillAlpha(this,i),i}function fillDataFromBinary(t,e){for(let r=0;r<t.size;r++){const i=t.getBit(r);e[4*r]=255*i,e[4*r+1]=255*i,e[4*r+2]=255*i}}function fillDataFromGrey32(t,e){const r=t.min[0],i=t.max[0]-r;for(let n=0;n<t.size;n++){const s=Math.floor(255*(t.data[n]-r)/i);e[4*n]=s,e[4*n+1]=s,e[4*n+2]=s}}function fillDataFromRGB32(t,e){const r=Math.min(...t.min),i=Math.max(...t.max)-r;for(let n=0;n<t.size;n++){const s=Math.floor(255*(t.data[3*n]-r)/i),a=Math.floor(255*(t.data[3*n+1]-r)/i),o=Math.floor(255*(t.data[3*n+2]-r)/i);e[4*n]=s,e[4*n+1]=a,e[4*n+2]=o}}function fillDataFromGrey(t,e){for(let r=0;r<t.size;r++)e[4*r]=t.data[r*t.channels]>>>t.bitDepth-8,e[4*r+1]=t.data[r*t.channels]>>>t.bitDepth-8,e[4*r+2]=t.data[r*t.channels]>>>t.bitDepth-8}function fillDataFromRGB(t,e){for(let r=0;r<t.size;r++)e[4*r]=t.data[r*t.channels]>>>t.bitDepth-8,e[4*r+1]=t.data[r*t.channels+1]>>>t.bitDepth-8,e[4*r+2]=t.data[r*t.channels+2]>>>t.bitDepth-8}function copyAlpha(t,e){for(let r=0;r<t.size;r++)e[4*r+3]=t.data[r*t.channels+t.components]>>t.bitDepth-8}function fillAlpha(t,e){for(let r=0;r<t.size;r++)e[4*r+3]=255}const BINARY="BINARY",GREY$1="GREY",GREYA="GREYA",RGB$1="RGB",RGBA="RGBA",CMYK$1="CMYK",CMYKA="CMYKA",kinds={};function getKind(t){const e=kinds[t];if(!e)throw new RangeError("invalid image kind: "+t);return e}kinds[BINARY]={components:1,alpha:0,bitDepth:1,colorModel:GREY},kinds[GREYA]={components:1,alpha:1,bitDepth:8,colorModel:GREY},kinds[GREY$1]={components:1,alpha:0,bitDepth:8,colorModel:GREY},kinds[RGBA]={components:3,alpha:1,bitDepth:8,colorModel:RGB},kinds[RGB$1]={components:3,alpha:0,bitDepth:8,colorModel:RGB},kinds[CMYK$1]={components:4,alpha:0,bitDepth:8,colorModel:CMYK},kinds[CMYKA]={components:4,alpha:1,bitDepth:8,colorModel:CMYK};const validBitDepth=[1,8,16,32];function verifyKindDefinition(t){const{components:e,alpha:r,bitDepth:i,colorModel:n}=t;if(!Number.isInteger(e)||e<=0)throw new RangeError(`invalid components: ${e}. Must be a positive integer`);if(0!==r&&1!==r&&"boolean"!=typeof r)throw new TypeError(`invalid alpha: ${r}: must be a boolean, 0 or 1`);if(!validBitDepth.includes(i))throw new RangeError(`invalid bitDepth: ${i}. Must be one of ${validBitDepth.join(", ")}`);if(!ColorModel[n])throw new RangeError(`invalid colorModel: ${n}. Must be one of ${Object.keys(ColorModel).join(", ")}`)}function getTheoreticalPixelArraySize(t,e,r){let i=e*t;return 1===r&&(i=Math.ceil(i/8)),i}function createPixelArray(t,e,r,i,n,s){const a=i*t;let o;switch(n){case 1:o=new Uint8Array(Math.ceil(a/8));break;case 8:o=new Uint8Array(a);break;case 16:o=new Uint16Array(a);break;case 32:o=new Float32Array(a);break;default:throw new Error("Cannot create pixel array for bit depth "+n)}if(r)for(let t=e;t<o.length;t+=i)o[t]=s;return o}const defaultByteLength$2=8192,charArray$1=[];class IOBuffer$2{constructor(t,e){e=e||{},void 0===t&&(t=defaultByteLength$2),"number"==typeof t&&(t=new ArrayBuffer(t));let r=t.byteLength;const i=e.offset?e.offset>>>0:0;t.buffer&&(r=t.byteLength-i,t=t.byteLength!==t.buffer.byteLength?t.buffer.slice(t.byteOffset+i,t.byteOffset+t.byteLength):i?t.buffer.slice(i):t.buffer),this.buffer=t,this.length=r,this.byteLength=r,this.byteOffset=0,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer),this._increment=r||defaultByteLength$2,this._mark=0}available(t){return void 0===t&&(t=1),this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){this.littleEndian=!0}isBigEndian(){return!this.littleEndian}setBigEndian(){this.littleEndian=!1}skip(t){void 0===t&&(t=1),this.offset+=t}seek(t){this.offset=t}mark(){this._mark=this.offset}reset(){this.offset=this._mark}rewind(){this.offset=0}ensureAvailable(t){if(void 0===t&&(t=1),!this.available(t)){const t=this._increment+this._increment;this._increment=t;const e=this.length+t,r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=e,this._data=new DataView(this.buffer)}}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){void 0===t&&(t=1);for(var e=new Uint8Array(t),r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){var t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){var t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){var t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){var t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){var t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){var t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t){void 0===t&&(t=1),charArray$1.length=t;for(var e=0;e<t;e++)charArray$1[e]=this.readChar();return charArray$1.join("")}writeBoolean(t){this.writeUint8(t?255:0)}writeInt8(t){this.ensureAvailable(1),this._data.setInt8(this.offset++,t)}writeUint8(t){this.ensureAvailable(1),this._data.setUint8(this.offset++,t)}writeByte(t){this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(var e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e])}writeInt16(t){this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2}writeUint16(t){this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2}writeInt32(t){this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4}writeUint32(t){this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat32(t){this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4}writeFloat64(t){this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8}writeChar(t){this.writeUint8(t.charCodeAt(0))}writeChars(t){for(var e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e))}toArray(){return new Uint8Array(this.buffer,0,this.offset)}}var IOBuffer_1$1=IOBuffer$2;const tagsById={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName={};for(var i$1 in tagsById)tagsByName[tagsById[i$1]]=i$1;var standard={tagsById:tagsById,tagsByName:tagsByName};const tagsById$1={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$1={};for(var i$2 in tagsById$1)tagsByName$1[tagsById$1[i$2]]=i$2;var exif={tagsById:tagsById$1,tagsByName:tagsByName$1};const tagsById$2={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$2={};for(var i$3 in tagsById$2)tagsByName$2[tagsById$2[i$3]]=i$3;var gps={tagsById:tagsById$2,tagsByName:tagsByName$2};const tags={standard:standard,exif:exif,gps:gps};class IFD{constructor(t){if(!t)throw new Error("missing kind");this.data=null,this.fields=new Map,this.kind=t,this._map=null}get(t){if("number"==typeof t)return this.fields.get(t);if("string"==typeof t)return this.fields.get(tags[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._map){this._map={};const e=tags[this.kind].tagsById;for(var t of this.fields.keys())e[t]&&(this._map[e[t]]=this.fields.get(t))}return this._map}}var ifd=IFD;const dateTimeRegex=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd extends ifd{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){var t=new Date,e=dateTimeRegex.exec(this.dateTime);return t.setFullYear(e[1],e[2]-1,e[3]),t.setHours(e[4],e[5],e[6]),t}get newSubfileType(){return this.get(254)}get imageWidth(){return this.get(256)}get imageLength(){return this.get(257)}get bitsPerSample(){return this.get(258)}get compression(){return this.get(259)||1}get type(){return this.get(262)}get fillOrder(){return this.get(266)||1}get documentName(){return this.get(269)}get imageDescription(){return this.get(270)}get stripOffsets(){return alwaysArray(this.get(273))}get orientation(){return this.get(274)}get samplesPerPixel(){return this.get(277)}get rowsPerStrip(){return this.get(278)}get stripByteCounts(){return alwaysArray(this.get(279))}get minSampleValue(){return this.get(280)||0}get maxSampleValue(){return this.get(281)||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get(282)}get yResolution(){return this.get(283)}get planarConfiguration(){return this.get(284)||1}get resolutionUnit(){return this.get(296)||2}get dateTime(){return this.get(306)}get predictor(){return this.get(317)||1}get sampleFormat(){return this.get(339)||1}get sMinSampleValue(){return this.get(340)||this.minSampleValue}get sMaxSampleValue(){return this.get(341)||this.maxSampleValue}}function alwaysArray(t){return"number"==typeof t?[t]:t}var tiffIfd=TiffIfd,types=new Map([[1,[1,readByte]],[2,[1,readASCII]],[3,[2,readShort]],[4,[4,readLong]],[5,[8,readRational]],[6,[1,readSByte]],[7,[1,readByte]],[8,[2,readSShort]],[9,[4,readSLong]],[10,[8,readSRational]],[11,[4,readFloat]],[12,[8,readDouble]]]),getByteLength=function(t,e){return types.get(t)[0]*e},readData=function(t,e,r){return types.get(e)[1](t,r)};function readByte(t,e){if(1===e)return t.readUint8();for(var r=new Uint8Array(e),i=0;i<e;i++)r[i]=t.readUint8();return r}function readASCII(t,e){for(var r=[],i="",n=0;n<e;n++){var s=String.fromCharCode(t.readUint8());"\0"===s?(r.push(i),i=""):i+=s}return 1===r.length?r[0]:r}function readShort(t,e){if(1===e)return t.readUint16();for(var r=new Uint16Array(e),i=0;i<e;i++)r[i]=t.readUint16();return r}function readLong(t,e){if(1===e)return t.readUint32();for(var r=new Uint32Array(e),i=0;i<e;i++)r[i]=t.readUint32();return r}function readRational(t,e){if(1===e)return t.readUint32()/t.readUint32();for(var r=new Array(e),i=0;i<e;i++)r[i]=t.readUint32()/t.readUint32();return r}function readSByte(t,e){if(1===e)return t.readInt8();for(var r=new Int8Array(e),i=0;i<e;i++)r[i]=t.readInt8();return r}function readSShort(t,e){if(1===e)return t.readInt16();for(var r=new Int16Array(e),i=0;i<e;i++)r[i]=t.readInt16();return r}function readSLong(t,e){if(1===e)return t.readInt32();for(var r=new Int32Array(e),i=0;i<e;i++)r[i]=t.readInt32();return r}function readSRational(t,e){if(1===e)return t.readInt32()/t.readInt32();for(var r=new Array(e),i=0;i<e;i++)r[i]=t.readInt32()/t.readInt32();return r}function readFloat(t,e){if(1===e)return t.readFloat32();for(var r=new Float32Array(e),i=0;i<e;i++)r[i]=t.readFloat32();return r}function readDouble(t,e){if(1===e)return t.readFloat64();for(var r=new Float64Array(e),i=0;i<e;i++)r[i]=t.readFloat64();return r}var ifdValue={getByteLength:getByteLength,readData:readData};const defaultOptions={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder extends IOBuffer_1$1{constructor(t,e){super(t,e),this._nextIFD=0}decode(t){t=Object.assign({},defaultOptions,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t)),t.onlyFirst)return e[0];return e}decodeHeader(){let t=this.readUint16();if(18761===t)this.setLittleEndian();else{if(19789!==t)throw new Error("invalid byte order: 0x"+t.toString(16));this.setBigEndian()}if(t=this.readUint16(),42!==t)throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t){var e;this.seek(this._nextIFD),e=t.kind?new ifd(t.kind):new tiffIfd;const r=this.readUint16();for(var i=0;i<r;i++)this.decodeIFDEntry(e);return t.ignoreImageData||this.decodeImageData(e),this._nextIFD=this.readUint32(),e}decodeIFDEntry(t){const e=this.offset,r=this.readUint16(),i=this.readUint16(),n=this.readUint32();if(i<1||i>12)return void this.skip(4);ifdValue.getByteLength(i,n)>4&&this.seek(this.readUint32());const s=ifdValue.readData(this,i,n);if(t.fields.set(r,s),34665===r||34853===r){let e,i=this.offset;34665===r?e="exif":34853===r&&(e="gps"),this._nextIFD=s,t[e]=this.decodeIFD({kind:e,ignoreImageData:!0}),this.offset=i}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;switch(e&&1!==e&&unsupported("orientation",e),t.type){case 1:case 2:this.readStripData(t);break;default:unsupported("image type",t.type)}}readStripData(t){const e=t.width,r=t.height,i=validateBitDepth(t.bitsPerSample),n=t.sampleFormat;let s=e*r;const a=getDataArray(s,1,i,n),o=t.compression,l=t.rowsPerStrip*e,h=t.stripOffsets,c=t.stripByteCounts;for(var u=0,f=0;f<h.length;f++){var d=this.getStripData(o,h[f],c[f]),m=s>l?l:s;s-=m,8===i?u=fill8bit(a,d,u,m):16===i?u=fill16bit(a,d,u,m,this.isLittleEndian()):32===i&&3===n?u=fillFloat32(a,d,u,m,this.isLittleEndian()):unsupported("bitDepth",i)}t.data=a}getStripData(t,e,r){switch(t){case 1:return new DataView(this.buffer,e,r);case 2:case 32773:return unsupported("Compression",t);default:throw new Error("invalid compression: "+t)}}}var tiffDecoder=TIFFDecoder;function getDataArray(t,e,r,i){return 8===r?new Uint8Array(t*e):16===r?new Uint16Array(t*e):32===r&&3===i?new Float32Array(t*e):unsupported("bit depth / sample format",r+" / "+i)}function fill8bit(t,e,r,i){for(var n=0;n<i;n++)t[r++]=e.getUint8(n);return r}function fill16bit(t,e,r,i,n){for(var s=0;s<2*i;s+=2)t[r++]=e.getUint16(s,n);return r}function fillFloat32(t,e,r,i,n){for(var s=0;s<4*i;s+=4)t[r++]=e.getFloat32(s,n);return r}function unsupported(t,e){throw new Error("Unsupported "+t+": "+e)}function validateBitDepth(t){if(t.length){const r=t;t=r[0];for(var e=0;e<r.length;e++)r[e]!==t&&unsupported("bit depth",r)}return t}var decode$2=function(t,e){return new tiffDecoder(t,e).decode(e)},decode$3=decode$2,src={decode:decode$3};function decode$4(t){const e=new IOBuffer_1$1(t),r={};if(e.setBigEndian(),65496!==e.readUint16())throw new Error("SOI marker not found. Not a valid JPEG file");if(65505===e.readUint16()){e.readUint16();const t=e.readBytes(6);if(69===t[0]&&120===t[1]&&105===t[2]&&102===t[3]&&0===t[4]&&0===t[5]){const t=src.decode(e,{onlyFirst:!0,ignoreImageData:!0,offset:e.offset});r.exif=t}}return r}var decode_1=decode$4,decode$5=decode_1,fileType_1=createCommonjsModule((function(module){const toBytes=t=>[...t].map(t=>t.charCodeAt(0)),xpiZipFilename=toBytes("META-INF/mozilla.rsa"),oxmlContentTypes=toBytes("[Content_Types].xml"),oxmlRels=toBytes("_rels/.rels");function readUInt64LE(t,e=0){let r=t[e],i=1,n=0;for(;++n<8;)i*=256,r+=t[e+n]*i;return r}const fileType=t=>{if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof t}\``);const e=t instanceof Uint8Array?t:new Uint8Array(t);if(!(e&&e.length>1))return null;const r=(t,r)=>{r=Object.assign({offset:0},r);for(let i=0;i<t.length;i++)if(r.mask){if(t[i]!==(r.mask[i]&e[i+r.offset]))return!1}else if(t[i]!==e[i+r.offset])return!1;return!0},i=(t,e)=>r(toBytes(t),e);if(r([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(r([137,80,78,71,13,10,26,10]))return{ext:"png",mime:"image/png"};if(r([71,73,70]))return{ext:"gif",mime:"image/gif"};if(r([87,69,66,80],{offset:8}))return{ext:"webp",mime:"image/webp"};if(r([70,76,73,70]))return{ext:"flif",mime:"image/flif"};if((r([73,73,42,0])||r([77,77,0,42]))&&r([67,82],{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(r([73,73,42,0])||r([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(r([66,77]))return{ext:"bmp",mime:"image/bmp"};if(r([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(r([56,66,80,83]))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(r([80,75,3,4])){if(r([109,105,109,101,116,121,112,101,97,112,112,108,105,99,97,116,105,111,110,47,101,112,117,98,43,122,105,112],{offset:30}))return{ext:"epub",mime:"application/epub+zip"};if(r(xpiZipFilename,{offset:30}))return{ext:"xpi",mime:"application/x-xpinstall"};if(i("mimetypeapplication/vnd.oasis.opendocument.text",{offset:30}))return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};if(i("mimetypeapplication/vnd.oasis.opendocument.spreadsheet",{offset:30}))return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};if(i("mimetypeapplication/vnd.oasis.opendocument.presentation",{offset:30}))return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};const t=(t,e=0)=>t.findIndex((t,r,i)=>r>=e&&80===i[r]&&75===i[r+1]&&3===i[r+2]&&4===i[r+3]);let n=0,s=!1,a=null;do{const o=n+30;if(s||(s=r(oxmlContentTypes,{offset:o})||r(oxmlRels,{offset:o})),a||(i("word/",{offset:o})?a={ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}:i("ppt/",{offset:o})?a={ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}:i("xl/",{offset:o})&&(a={ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),s&&a)return a;n=t(e,o)}while(n>=0);if(a)return a}if(r([80,75])&&(3===e[2]||5===e[2]||7===e[2])&&(4===e[3]||6===e[3]||8===e[3]))return{ext:"zip",mime:"application/zip"};if(r([117,115,116,97,114],{offset:257}))return{ext:"tar",mime:"application/x-tar"};if(r([82,97,114,33,26,7])&&(0===e[6]||1===e[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(r([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(r([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(r([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(r([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(r([51,103,112,53])||r([0,0,0])&&r([102,116,121,112],{offset:4})&&(r([109,112,52,49],{offset:8})||r([109,112,52,50],{offset:8})||r([105,115,111,109],{offset:8})||r([105,115,111,50],{offset:8})||r([109,109,112,52],{offset:8})||r([77,52,86],{offset:8})||r([100,97,115,104],{offset:8})))return{ext:"mp4",mime:"video/mp4"};if(r([77,84,104,100]))return{ext:"mid",mime:"audio/midi"};if(r([26,69,223,163])){const t=e.subarray(4,4100),r=t.findIndex((t,e,r)=>66===r[e]&&130===r[e+1]);if(-1!==r){const e=r+3,i=r=>[...r].every((r,i)=>t[e+i]===r.charCodeAt(0));if(i("matroska"))return{ext:"mkv",mime:"video/x-matroska"};if(i("webm"))return{ext:"webm",mime:"video/webm"}}}if(r([0,0,0,20,102,116,121,112,113,116,32,32])||r([102,114,101,101],{offset:4})||r([102,116,121,112,113,116,32,32],{offset:4})||r([109,100,97,116],{offset:4})||r([109,111,111,118],{offset:4})||r([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(r([82,73,70,70])){if(r([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(r([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(r([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(r([48,38,178,117,142,102,207,17,166,217])){let t=30;do{const i=readUInt64LE(e,t+16);if(r([145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101],{offset:t})){if(r([64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43],{offset:t+24}))return{ext:"wma",mime:"audio/x-ms-wma"};if(r([192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43],{offset:t+24}))return{ext:"wmv",mime:"video/x-ms-asf"};break}t+=i}while(t+24<=e.length);return{ext:"asf",mime:"application/vnd.ms-asf"}}if(r([0,0,1,186])||r([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(r([102,116,121,112,51,103],{offset:4}))return{ext:"3gp",mime:"video/3gpp"};for(let t=0;t<2&&t<e.length-16;t++){if(r([73,68,51],{offset:t})||r([255,226],{offset:t,mask:[255,226]}))return{ext:"mp3",mime:"audio/mpeg"};if(r([255,228],{offset:t,mask:[255,228]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,248],{offset:t,mask:[255,252]}))return{ext:"mp2",mime:"audio/mpeg"};if(r([255,240],{offset:t,mask:[255,252]}))return{ext:"mp4",mime:"audio/mpeg"}}if(r([102,116,121,112,77,52,65],{offset:4}))return{ext:"m4a",mime:"audio/mp4"};if(r([79,112,117,115,72,101,97,100],{offset:28}))return{ext:"opus",mime:"audio/opus"};if(r([79,103,103,83]))return r([128,116,104,101,111,114,97],{offset:28})?{ext:"ogv",mime:"video/ogg"}:r([1,118,105,100,101,111,0],{offset:28})?{ext:"ogm",mime:"video/ogg"}:r([127,70,76,65,67],{offset:28})?{ext:"oga",mime:"audio/ogg"}:r([83,112,101,101,120,32,32],{offset:28})?{ext:"spx",mime:"audio/ogg"}:r([1,118,111,114,98,105,115],{offset:28})?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(r([102,76,97,67]))return{ext:"flac",mime:"audio/x-flac"};if(r([77,65,67,32]))return{ext:"ape",mime:"audio/ape"};if(r([119,118,112,107]))return{ext:"wv",mime:"audio/wavpack"};if(r([35,33,65,77,82,10]))return{ext:"amr",mime:"audio/amr"};if(r([37,80,68,70]))return{ext:"pdf",mime:"application/pdf"};if(r([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if((67===e[0]||70===e[0])&&r([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(r([123,92,114,116,102]))return{ext:"rtf",mime:"application/rtf"};if(r([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(r([119,79,70,70])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff",mime:"font/woff"};if(r([119,79,70,50])&&(r([0,1,0,0],{offset:4})||r([79,84,84,79],{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(r([76,80],{offset:34})&&(r([0,0,1],{offset:8})||r([1,0,2],{offset:8})||r([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(r([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(r([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(r([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(r([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(r([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(r([37,33]))return{ext:"ps",mime:"application/postscript"};if(r([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(r([83,81,76,105]))return{ext:"sqlite",mime:"application/x-sqlite3"};if(r([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(r([67,114,50,52]))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(r([77,83,67,70])||r([73,83,99,40]))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(r([33,60,97,114,99,104,62,10,100,101,98,105,97,110,45,98,105,110,97,114,121]))return{ext:"deb",mime:"application/x-deb"};if(r([33,60,97,114,99,104,62]))return{ext:"ar",mime:"application/x-unix-archive"};if(r([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(r([31,160])||r([31,157]))return{ext:"Z",mime:"application/x-compress"};if(r([76,90,73,80]))return{ext:"lz",mime:"application/x-lzip"};if(r([208,207,17,224,161,177,26,225]))return{ext:"msi",mime:"application/x-msi"};if(r([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(r([71],{offset:4})&&(r([71],{offset:192})||r([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(r([66,76,69,78,68,69,82]))return{ext:"blend",mime:"application/x-blender"};if(r([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(r([0,0,0,12,106,80,32,32,13,10,135,10])){if(r([106,112,50,32],{offset:20}))return{ext:"jp2",mime:"image/jp2"};if(r([106,112,120,32],{offset:20}))return{ext:"jpx",mime:"image/jpx"};if(r([106,112,109,32],{offset:20}))return{ext:"jpm",mime:"image/jpm"};if(r([109,106,112,50],{offset:20}))return{ext:"mj2",mime:"image/mj2"}}if(r([70,79,82,77]))return{ext:"aif",mime:"audio/aiff"};if(i("<?xml "))return{ext:"xml",mime:"application/xml"};if(r([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(r([102,116,121,112],{offset:4})){if(r([109,105,102,49],{offset:8}))return{ext:"heic",mime:"image/heif"};if(r([109,115,102,49],{offset:8}))return{ext:"heic",mime:"image/heif-sequence"};if(r([104,101,105,99],{offset:8})||r([104,101,105,120],{offset:8}))return{ext:"heic",mime:"image/heic"};if(r([104,101,118,99],{offset:8})||r([104,101,118,120],{offset:8}))return{ext:"heic",mime:"image/heic-sequence"}}return r([171,75,84,88,32,49,49,187,13,10,26,10])?{ext:"ktx",mime:"image/ktx"}:r([68,73,67,77],{offset:128})?{ext:"dcm",mime:"application/dicom"}:r([77,80,43])||r([77,80,67,75])?{ext:"mpc",mime:"audio/x-musepack"}:r([66,69,71,73,78,58])?{ext:"ics",mime:"text/calendar"}:r([103,108,84,70,2,0,0,0])?{ext:"glb",mime:"model/gltf-binary"}:r([212,195,178,161])||r([161,178,195,212])?{ext:"pcap",mime:"application/vnd.tcpdump.pcap"}:null};module.exports=fileType,module.exports.default=fileType,Object.defineProperty(fileType,"minimumBytes",{value:4100}),module.exports.stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.once("readable",()=>{const t=new stream.PassThrough,e=readableStream.read(module.exports.minimumBytes)||readableStream.read();try{t.fileType=fileType(e)}catch(t){reject(t)}readableStream.unshift(e),stream.pipeline?resolve(stream.pipeline(readableStream,t,()=>{})):resolve(readableStream.pipe(t))})})}));const imageExts=new Set(["jpg","png","gif","webp","flif","cr2","tif","bmp","jxr","psd","ico","bpg","jp2","jpm","jpx","heic","cur","dcm"]),imageType=t=>{const e=fileType_1(t);return imageExts.has(e&&e.ext)?e:null};var imageType_1=imageType,_default=imageType;Object.defineProperty(imageType,"minimumBytes",{value:fileType_1.minimumBytes}),imageType_1.default=_default,function(t){if(t.TextEncoder&&t.TextDecoder)return!1;function e(t="utf-8"){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${t}') is invalid.`)}function r(t="utf-8",e={fatal:!1}){if("utf-8"!==t)throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${t}') is invalid.`);if(e.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let r=0;const i=t.length;let n=0,s=Math.max(32,i+(i>>1)+7),a=new Uint8Array(s>>3<<3);for(;r<i;){let e=t.charCodeAt(r++);if(e>=55296&&e<=56319){if(r<i){const i=t.charCodeAt(r);56320==(64512&i)&&(++r,e=((1023&e)<<10)+(1023&i)+65536)}if(e>=55296&&e<=56319)continue}if(n+4>a.length){s+=8,s*=1+r/t.length*2,s=s>>3<<3;const e=new Uint8Array(s);e.set(a),a=e}if(0!=(4294967168&e)){if(0==(4294965248&e))a[n++]=e>>6&31|192;else if(0==(4294901760&e))a[n++]=e>>12&15|224,a[n++]=e>>6&63|128;else{if(0!=(4292870144&e))continue;a[n++]=e>>18&7|240,a[n++]=e>>12&63|128,a[n++]=e>>6&63|128}a[n++]=63&e|128}else a[n++]=e}return a.slice(0,n)},Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(r.prototype,"fatal",{value:!1}),Object.defineProperty(r.prototype,"ignoreBOM",{value:!1}),r.prototype.decode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");const r=new Uint8Array(t);let i=0;const n=r.length,s=[];for(;i<n;){const t=r[i++];if(0===t)break;if(0==(128&t))s.push(t);else if(192==(224&t)){const e=63&r[i++];s.push((31&t)<<6|e)}else if(224==(240&t)){const e=63&r[i++],n=63&r[i++];s.push((31&t)<<12|e<<6|n)}else if(240==(248&t)){let e=(7&t)<<18|(63&r[i++])<<12|(63&r[i++])<<6|63&r[i++];e>65535&&(e-=65536,s.push(e>>>10&1023|55296),e=56320|1023&e),s.push(e)}}return String.fromCharCode.apply(null,s)},t.TextEncoder=e,t.TextDecoder=r}("undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0);const decoder$2=new TextDecoder("utf-8");function decode$6(t){return decoder$2.decode(t)}const encoder$2=new TextEncoder;function encode$4(t){return encoder$2.encode(t)}const defaultByteLength$3=8192;class IOBuffer$3{constructor(t=defaultByteLength$3,e={}){let r=!1;"number"==typeof t?t=new ArrayBuffer(t):(r=!0,this.lastWrittenByte=t.byteLength);const i=e.offset?e.offset>>>0:0,n=t.byteLength-i;let s=i;(ArrayBuffer.isView(t)||t instanceof IOBuffer$3)&&(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+i),t=t.buffer),this.lastWrittenByte=r?n:0,this.buffer=t,this.length=n,this.byteLength=n,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,n),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const e=2*(this.offset+t),r=new Uint8Array(e);r.set(new Uint8Array(this.buffer)),this.buffer=r.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){const e=new Uint8Array(t);for(let r=0;r<t;r++)e[r]=this.readByte();return e}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let r=0;r<t;r++)e+=this.readChar();return e}readUtf8(t=1){return decode$6(this.readBytes(t))}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(encode$4(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function applyHorizontalDifferencing8Bit(t,e,r){let i=0;for(;i<t.length;){for(let n=r;n<e*r;n+=r)for(let e=0;e<r;e++)t[i+n+e]=t[i+n+e]+t[i+n-(r-e)]&255;i+=e*r}}function applyHorizontalDifferencing16Bit(t,e,r){let i=0;for(;i<t.length;){for(let n=r;n<e*r;n+=r)for(let e=0;e<r;e++)t[i+n+e]=t[i+n+e]+t[i+n-(r-e)]&65535;i+=e*r}}const tagsById$3={33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37396:"SubjectArea",37500:"MakerNote",37510:"UserComment",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42240:"Gamma"},tagsByName$3={};for(let t in tagsById$3)tagsByName$3[tagsById$3[t]]=Number(t);var exif$1=Object.freeze({__proto__:null,tagsById:tagsById$3,tagsByName:tagsByName$3});const tagsById$4={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},tagsByName$4={};for(let t in tagsById$4)tagsByName$4[tagsById$4[t]]=Number(t);var gps$1=Object.freeze({__proto__:null,tagsById:tagsById$4,tagsByName:tagsByName$4});const tagsById$5={254:"NewSubfileType",255:"SubfileType",256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Threshholding",264:"CellWidth",265:"CellLength",266:"FillOrder",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",296:"ResolutionUnit",305:"Software",306:"DateTime",315:"Artist",316:"HostComputer",320:"ColorMap",338:"ExtraSamples",33432:"Copyright",269:"DocumentName",285:"PageName",286:"XPosition",287:"YPosition",292:"T4Options",293:"T6Options",297:"PageNumber",301:"TransferFunction",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFDs",332:"InkSet",333:"InkNames",334:"NumberOfInks",336:"DotRange",337:"TargetPrinter",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",512:"JPEGProc",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"XMP",32781:"ImageID",34732:"ImageLayer",32932:"WangAnnotatio",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"ModelPixelScaleTag",33723:"IPTC",33918:"INGRPacketDataTag",33919:"INGRFlagRegisters",33920:"IrasBTransformationMatrix",33922:"ModelTiepointTag",34264:"ModelTransformationTag",34377:"Photoshop",34665:"ExifIFD",34675:"ICCProfile",34735:"GeoKeyDirectoryTag",34736:"GeoDoubleParamsTag",34737:"GeoAsciiParamsTag",34853:"GPSIFD",34908:"HylaFAXFaxRecvParams",34909:"HylaFAXFaxSubAddress",34910:"HylaFAXFaxRecvTime",37724:"ImageSourceData",40965:"InteroperabilityIFD",42112:"GDAL_METADATA",42113:"GDAL_NODATA",50215:"OceScanjobDescription",50216:"OceApplicationSelector",50217:"OceIdentificationNumber",50218:"OceImageLogicCharacteristics",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"LensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50740:"DNGPrivateData",50741:"MakerNoteSafety",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50784:"AliasLayerMetadata"},tagsByName$5={};for(let t in tagsById$5)tagsByName$5[tagsById$5[t]]=Number(t);var standard$1=Object.freeze({__proto__:null,tagsById:tagsById$5,tagsByName:tagsByName$5});const tags$1={standard:standard$1,exif:exif$1,gps:gps$1};class IFD$1{constructor(t){if(!t)throw new Error("missing kind");this.data=new Uint8Array,this.fields=new Map,this.kind=t,this._hasMap=!1,this._map={}}get(t){if("number"==typeof t)return this.fields.get(t);if("string"==typeof t)return this.fields.get(tags$1[this.kind].tagsByName[t]);throw new Error("expected a number or string")}get map(){if(!this._hasMap){const t=tags$1[this.kind].tagsById;for(let e of this.fields.keys())t[e]&&(this._map[t[e]]=this.fields.get(e));this._hasMap=!0}return this._map}}let types$1=new Map([[1,[1,readByte$1]],[2,[1,readASCII$1]],[3,[2,readShort$1]],[4,[4,readLong$1]],[5,[8,readRational$1]],[6,[1,readSByte$1]],[7,[1,readByte$1]],[8,[2,readSShort$1]],[9,[4,readSLong$1]],[10,[8,readSRational$1]],[11,[4,readFloat$1]],[12,[8,readDouble$1]]]);function getByteLength$1(t,e){const r=types$1.get(t);if(!r)throw new Error("type not found: "+t);return r[0]*e}function readData$1(t,e,r){const i=types$1.get(e);if(!i)throw new Error("type not found: "+e);return i[1](t,r)}function readByte$1(t,e){if(1===e)return t.readUint8();let r=new Uint8Array(e);for(let i=0;i<e;i++)r[i]=t.readUint8();return r}function readASCII$1(t,e){let r=[],i="";for(let n=0;n<e;n++){let e=String.fromCharCode(t.readUint8());"\0"===e?(r.push(i),i=""):i+=e}return 1===r.length?r[0]:r}function readShort$1(t,e){if(1===e)return t.readUint16();let r=new Uint16Array(e);for(let i=0;i<e;i++)r[i]=t.readUint16();return r}function readLong$1(t,e){if(1===e)return t.readUint32();let r=new Uint32Array(e);for(let i=0;i<e;i++)r[i]=t.readUint32();return r}function readRational$1(t,e){if(1===e)return t.readUint32()/t.readUint32();let r=new Array(e);for(let i=0;i<e;i++)r[i]=t.readUint32()/t.readUint32();return r}function readSByte$1(t,e){if(1===e)return t.readInt8();let r=new Int8Array(e);for(let i=0;i<e;i++)r[i]=t.readInt8();return r}function readSShort$1(t,e){if(1===e)return t.readInt16();let r=new Int16Array(e);for(let i=0;i<e;i++)r[i]=t.readInt16();return r}function readSLong$1(t,e){if(1===e)return t.readInt32();let r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.readInt32();return r}function readSRational$1(t,e){if(1===e)return t.readInt32()/t.readInt32();let r=new Array(e);for(let i=0;i<e;i++)r[i]=t.readInt32()/t.readInt32();return r}function readFloat$1(t,e){if(1===e)return t.readFloat32();let r=new Float32Array(e);for(let i=0;i<e;i++)r[i]=t.readFloat32();return r}function readDouble$1(t,e){if(1===e)return t.readFloat64();let r=new Float64Array(e);for(let i=0;i<e;i++)r[i]=t.readFloat64();return r}const CLEAR_CODE=256,EOI_CODE=257,TABLE_START=258,MIN_BIT_LENGTH=9,stringTable=[];for(let t=0;t<256;t++)stringTable.push([t]);const dummyString=[0];for(let t=256;t<4096;t++)stringTable.push(dummyString);class LzwDecoder{constructor(t){this.stripArray=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);const e=new Map;for(let t=0;t<256;t++)e.set(t,[t]);this.currentBit=0,this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH,this.outData=new IOBuffer$3(t.byteLength)}decode(){let t=0,e=0;for(;(t=this.getNextCode())!==EOI_CODE;)if(t===CLEAR_CODE){if(this.initializeTable(),t=this.getNextCode(),t===EOI_CODE)break;this.writeString(this.stringFromCode(t)),e=t}else if(this.isInTable(t))this.writeString(this.stringFromCode(t)),this.addStringToTable(this.stringFromCode(e).concat(this.stringFromCode(t)[0])),e=t;else{const r=this.stringFromCode(e).concat(this.stringFromCode(e)[0]);this.writeString(r),this.addStringToTable(r),e=t}const r=this.outData.toArray();return new DataView(r.buffer,r.byteOffset,r.byteLength)}initializeTable(){this.tableLength=TABLE_START,this.currentBitLength=MIN_BIT_LENGTH}writeString(t){this.outData.writeBytes(t)}stringFromCode(t){return stringTable[t]}isInTable(t){return t<this.tableLength}addStringToTable(t){stringTable[this.tableLength++]=t,this.tableLength+1===2**this.currentBitLength&&this.currentBitLength++}getNextCode(){const t=this.currentBit%8,e=this.currentBit>>>3,r=8-t,i=this.currentBit+this.currentBitLength-8*(e+1);let n=8*(e+2)-(this.currentBit+this.currentBitLength);const s=8*(e+2)-this.currentBit;n=Math.max(0,n);let a=this.stripArray[e]&2**(8-t)-1;a<<=this.currentBitLength-r;let o=a;if(e+1<this.stripArray.length){let t=this.stripArray[e+1]>>>n;t<<=Math.max(0,this.currentBitLength-s),o+=t}if(i>8&&e+2<this.stripArray.length){const t=8*(e+3)-(this.currentBit+this.currentBitLength);o+=this.stripArray[e+2]>>>t}return this.currentBit+=this.currentBitLength,o}}function decompressLzw(t){return new LzwDecoder(t).decode()}const dateTimeRegex$1=/^(\d{4}):(\d{2}):(\d{2}) (\d{2}):(\d{2}):(\d{2})$/;class TiffIfd$1 extends IFD$1{constructor(){super("standard")}get size(){return this.width*this.height}get width(){return this.imageWidth}get height(){return this.imageLength}get components(){return this.samplesPerPixel}get date(){let t=new Date,e=dateTimeRegex$1.exec(this.dateTime);if(null===e)throw new Error("invalid dateTime: "+this.dateTime);return t.setFullYear(Number(e[1]),Number(e[2])-1,Number(e[3])),t.setHours(Number(e[4]),Number(e[5]),Number(e[6])),t}get newSubfileType(){return this.get("NewSubfileType")}get imageWidth(){return this.get("ImageWidth")}get imageLength(){return this.get("ImageLength")}get bitsPerSample(){const t=this.get("BitsPerSample");return t&&"number"!=typeof t?t[0]:t}get alpha(){const t=this.extraSamples;return!!t&&0!==t[0]}get associatedAlpha(){const t=this.extraSamples;return!!t&&1===t[0]}get extraSamples(){return alwaysArray$1(this.get("ExtraSamples"))}get compression(){return this.get("Compression")||1}get type(){return this.get("PhotometricInterpretation")}get fillOrder(){return this.get("FillOrder")||1}get documentName(){return this.get("DocumentName")}get imageDescription(){return this.get("ImageDescription")}get stripOffsets(){return alwaysArray$1(this.get("StripOffsets"))}get orientation(){return this.get("Orientation")}get samplesPerPixel(){return this.get("SamplesPerPixel")||1}get rowsPerStrip(){return this.get("RowsPerStrip")}get stripByteCounts(){return alwaysArray$1(this.get("StripByteCounts"))}get minSampleValue(){return this.get("MinSampleValue")||0}get maxSampleValue(){return this.get("MaxSampleValue")||Math.pow(2,this.bitsPerSample)-1}get xResolution(){return this.get("XResolution")}get yResolution(){return this.get("YResolution")}get planarConfiguration(){return this.get("PlanarConfiguration")||1}get resolutionUnit(){return this.get("ResolutionUnit")||2}get dateTime(){return this.get("DateTime")}get predictor(){return this.get("Predictor")||1}get sampleFormat(){return this.get("SampleFormat")||1}get sMinSampleValue(){return this.get("SMinSampleValue")||this.minSampleValue}get sMaxSampleValue(){return this.get("SMaxSampleValue")||this.maxSampleValue}get palette(){const t=2**this.bitsPerSample,e=this.get("ColorMap");if(!e)return;if(e.length!==3*t)throw new Error("ColorMap size must be "+t);const r=[];for(let i=0;i<t;i++)r.push([e[i],e[i+t],e[i+2*t]]);return r}}function alwaysArray$1(t){return"number"==typeof t?[t]:t}const defaultOptions$1={ignoreImageData:!1,onlyFirst:!1};class TIFFDecoder$1 extends IOBuffer$3{constructor(t){super(t),this._nextIFD=0}get isMultiPage(){let t=0;for(this.decodeHeader();this._nextIFD;)if(t++,this.decodeIFD({ignoreImageData:!0},!0),2===t)return!0;if(1===t)return!1;throw unsupported$1("ifdCount",t)}get pageCount(){let t=0;for(this.decodeHeader();this._nextIFD;)t++,this.decodeIFD({ignoreImageData:!0},!0);if(t>0)return t;throw unsupported$1("ifdCount",t)}decode(t={}){t=Object.assign({},defaultOptions$1,t);const e=[];for(this.decodeHeader();this._nextIFD;)if(e.push(this.decodeIFD(t,!0)),t.onlyFirst)return[e[0]];return e}decodeHeader(){const t=this.readUint16();if(18761===t)this.setLittleEndian();else{if(19789!==t)throw new Error("invalid byte order: 0x"+t.toString(16));this.setBigEndian()}if(42!==this.readUint16())throw new Error("not a TIFF file");this._nextIFD=this.readUint32()}decodeIFD(t,e){let r;if(this.seek(this._nextIFD),e)r=new TiffIfd$1;else{if(!t.kind)throw new Error("kind is missing");r=new IFD$1(t.kind)}const i=this.readUint16();for(let t=0;t<i;t++)this.decodeIFDEntry(r);if(!t.ignoreImageData){if(!(r instanceof TiffIfd$1))throw new Error("must be a tiff ifd");this.decodeImageData(r)}return this._nextIFD=this.readUint32(),r}decodeIFDEntry(t){const e=this.offset,r=this.readUint16(),i=this.readUint16(),n=this.readUint32();if(i<1||i>12)return void this.skip(4);getByteLength$1(i,n)>4&&this.seek(this.readUint32());const s=readData$1(this,i,n);if(t.fields.set(r,s),34665===r||34853===r){let e=this.offset,i="exif";34665===r?i="exif":34853===r&&(i="gps"),this._nextIFD=s,t[i]=this.decodeIFD({kind:i,ignoreImageData:!0},!1),this.offset=e}this.seek(e),this.skip(12)}decodeImageData(t){const e=t.orientation;if(e&&1!==e)throw unsupported$1("orientation",e);switch(t.type){case 0:case 1:case 2:case 3:this.readStripData(t);break;default:throw unsupported$1("image type",t.type)}if(this.applyPredictor(t),this.convertAlpha(t),0===t.type){const e=t.bitsPerSample,r=Math.pow(2,e)-1;for(let e=0;e<t.data.length;e++)t.data[e]=r-t.data[e]}}readStripData(t){const e=t.width,r=t.height,i=t.bitsPerSample,n=t.sampleFormat,s=e*r*t.samplesPerPixel,a=getDataArray$1(s,i,n),o=t.rowsPerStrip*e*t.samplesPerPixel,l=t.stripOffsets,h=t.stripByteCounts;let c=s,u=0;for(let e=0;e<l.length;e++){let r=new DataView(this.buffer,l[e],h[e]),s=c>o?o:c;c-=s;let f=r;switch(t.compression){case 1:break;case 5:f=decompressLzw(r);break;case 2:throw unsupported$1("Compression","CCITT Group 3");case 32773:throw unsupported$1("Compression","PackBits");default:throw new Error("invalid compression: "+t.compression)}u=this.fillUncompressed(i,n,a,f,u,s)}t.data=a}fillUncompressed(t,e,r,i,n,s){if(8===t)return fill8bit$1(r,i,n,s);if(16===t)return fill16bit$1(r,i,n,s,this.isLittleEndian());if(32===t&&3===e)return fillFloat32$1(r,i,n,s,this.isLittleEndian());throw unsupported$1("bitDepth",t)}applyPredictor(t){const e=t.bitsPerSample;switch(t.predictor){case 1:break;case 2:if(8===e)applyHorizontalDifferencing8Bit(t.data,t.width,t.components);else{if(16!==e)throw new Error("Horizontal differencing is only supported for images with a bit depth of "+e);applyHorizontalDifferencing16Bit(t.data,t.width,t.components)}break;default:throw new Error("invalid predictor: "+t.predictor)}}convertAlpha(t){if(t.alpha&&t.associatedAlpha){const{data:e,components:r,maxSampleValue:i}=t;for(let t=0;t<e.length;t+=r){const n=e[t+r-1];for(let s=0;s<r-1;s++)e[t+s]=Math.round(e[t+s]*i/n)}}}}function getDataArray$1(t,e,r){if(8===e)return new Uint8Array(t);if(16===e)return new Uint16Array(t);if(32===e&&3===r)return new Float32Array(t);throw unsupported$1("bit depth / sample format",`${e} / ${r}`)}function fill8bit$1(t,e,r,i){for(let n=0;n<i;n++)t[r++]=e.getUint8(n);return r}function fill16bit$1(t,e,r,i,n){for(let s=0;s<2*i;s+=2)t[r++]=e.getUint16(s,n);return r}function fillFloat32$1(t,e,r,i,n){for(let s=0;s<4*i;s+=4)t[r++]=e.getFloat32(s,n);return r}function unsupported$1(t,e){return new Error(`Unsupported ${t}: ${e}`)}function decodeTIFF(t,e){return new TIFFDecoder$1(t).decode(e)}function matchAndCrop(t={}){let{algorithm:e="matchToPrevious",ignoreBorder:r=[0,0]}=t;this.checkProcessable("matchAndCrop",{bitDepth:[8,16]});let i="matchToPrevious"===e,n=this[0],s=[];s[0]={position:[0,0],image:this[0]};let a=[0,0];for(let t=1;t<this.length;t++){let e=n.getBestMatch(this[t],{border:r});s[t]={position:[e[0]+a[0],e[1]+a[1]],image:this[t]},i&&(a[0]+=e[0],a[1]+=e[1],n=this[t])}let o=0,l=0,h=0,c=0;for(let t=0;t<s.length;t++){let e=s[t];e.position[0]>o&&(o=e.position[0]),e.position[0]<l&&(l=e.position[0]),e.position[1]>h&&(h=e.position[1]),e.position[1]<c&&(c=e.position[1])}l=0-l,c=0-c;for(let t=0;t<s.length;t++){let e=s[t];e.crop=e.image.crop({x:o-e.position[0],y:h-e.position[1],width:n.width-l-o,height:n.height-c-h})}let u=[];for(let t=0;t<s.length;t++)u[t]=s[t].crop;return new Stack(u)}function min(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].min;for(let e=1;e<this.length;e++)for(let r=0;r<t.length;r++)t[r]=Math.min(t[r],this[e].min[r]);return t}function max(){this.checkProcessable("min",{bitDepth:[8,16]});let t=this[0].max;for(let e=1;e<this.length;e++)for(let r=0;r<t.length;r++)t[r]=Math.max(t[r],this[e].max[r]);return t}function median(t){let e=t.reduce((t,e)=>t+e);if(0===e)throw new Error("unreachable");let r,i=0,n=0,s=e/2;for(;;){if(t[i]>0){if(void 0!==r)return(r+i)/2;if(n+=t[i],n>s)return i;n===s&&(r=i)}i++}}function mean(t){let e=0,r=0;for(let i=0;i<t.length;i++)e+=t[i],r+=t[i]*i;return 0===e?0:r/e}function median$1(){this.checkProcessable("median",{bitDepth:[8,16]});let t=this.getHistograms({maxSlots:this[0].maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let i=t[r];e[r]=median(i)}return e}function histogram(t){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistogram(t);for(let r=1;r<this.length;r++){let i=this[r].getHistogram(t);for(let t=0;t<e.length;t++)e[t]+=i[t]}return e}function histograms(t){this.checkProcessable("min",{bitDepth:[8,16]});let e=this[0].getHistograms(t),r=e[0].length;for(let i=1;i<this.length;i++){let n=this[i].getHistograms(t);for(let t=0;t<e.length;t++)for(let i=0;i<r;i++)e[t][i]+=n[t][i]}return e}function averageImage(){this.checkProcessable("averageImage",{bitDepth:[8,16]});let t=new Uint32Array(this[0].data.length);for(let e=0;e<this.length;e++){let r=this[e];for(let e=0;e<this[0].data.length;e++)t[e]+=r.data[e]}let e=Image.createFrom(this[0]),r=e.data;for(let e=0;e<this[0].data.length;e++)r[e]=t[e]/this.length;return e}function maxImage(){this.checkProcessable("max",{bitDepth:[8,16]});let t=Image.createFrom(this[0]);t.data.fill(0);for(const e of this)for(let r=0;r<t.data.length;r++)t.data[r]=Math.max(e.data[r],t.data[r]);return t}function minImage(){this.checkProcessable("max",{bitDepth:[8,16]});let t=Image.createFrom(this[0]);t.data.fill(t.maxValue);for(const e of this)for(let r=0;r<t.data.length;r++)t.data[r]=Math.min(e.data[r],t.data[r]);return t}function extend(t){t.extendMethod("matchAndCrop",matchAndCrop),t.extendMethod("getMin",min),t.extendMethod("getMax",max),t.extendMethod("getMedian",median$1),t.extendMethod("getHistogram",histogram),t.extendMethod("getHistograms",histograms),t.extendMethod("getAverage",averageImage),t.extendMethod("getAverageImage",averageImage),t.extendMethod("getMaxImage",maxImage),t.extendMethod("getMinImage",minImage)}let computedPropertyDescriptor$1={configurable:!0,enumerable:!1,get:void 0};class Stack extends Array{constructor(t){if(Array.isArray(t)){super(t.length);for(let e=0;e<t.length;e++)this[e]=t[e]}else"number"==typeof t?super(t):super();this.computed=null}static load(t){return Promise.all(t.map(Image.load)).then(t=>new Stack(t))}static extendMethod(t,e,r={}){let{inPlace:i=!1,returnThis:n=!0,partialArgs:s=[]}=r;return Stack.prototype[t]=i?function(...t){this.computed=null;let r=e.apply(this,[...s,...t]);return n?this:r}:function(...t){return e.apply(this,[...s,...t])},Stack}static extendProperty(t,e,r={}){let{partialArgs:i=[]}=r;return computedPropertyDescriptor$1.get=function(){if(null===this.computed)this.computed={};else if(hasOwn(t,this.computed))return this.computed[t];let r=e.apply(this,i);return this.computed[t]=r,r},Object.defineProperty(Stack.prototype,t,computedPropertyDescriptor$1),Stack}checkProcessable(t,e={}){if("string"!=typeof t)throw new TypeError("checkProcessable requires as first parameter the processName (a string)");if(0===this.size)throw new TypeError(`The process: ${t} can not be applied on an empty stack`);this[0].checkProcessable(t,e);for(let r=1;r<this.length;r++){if((void 0===e.sameSize||e.sameSize)&&this[0].width!==this[r].width)throw new TypeError(`The process: ${t} can not be applied if width is not identical in all images`);if((void 0===e.sameSize||e.sameSize)&&this[0].height!==this[r].height)throw new TypeError(`The process: ${t} can not be applied if height is not identical in all images`);if((void 0===e.sameAlpha||e.sameAlpha)&&this[0].alpha!==this[r].alpha)throw new TypeError(`The process: ${t} can not be applied if alpha is not identical in all images`);if((void 0===e.sameBitDepth||e.sameBitDepth)&&this[0].bitDepth!==this[r].bitDepth)throw new TypeError(`The process: ${t} can not be applied if bitDepth is not identical in all images`);if((void 0===e.sameColorModel||e.sameColorModel)&&this[0].colorModel!==this[r].colorModel)throw new TypeError(`The process: ${t} can not be applied if colorModel is not identical in all images`);if((void 0===e.sameNumberChannels||e.sameNumberChannels)&&this[0].channels!==this[r].channels)throw new TypeError(`The process: ${t} can not be applied if channels is not identical in all images`)}}}Array[Symbol.species]||(Stack.prototype.map=function(t,e){if("function"!=typeof t)throw new TypeError(t+" is not a function");let r=new Stack(this.length);for(let i=0;i<this.length;i++)r[i]=t.call(e,this[i],i,this);return r}),extend(Stack);const isDataURL=/^data:[a-z]+\/([a-z]+);base64,/;function load(t,e){if("string"==typeof t)return loadURL(t,e);if(t instanceof ArrayBuffer)return Promise.resolve(loadBinary(new Uint8Array(t)));if(t.buffer)return Promise.resolve(loadBinary(t));throw new Error('argument to "load" must be a string or buffer.')}function loadBinary(t,e){const r=imageType_1(t);if(r)switch(r.mime){case"image/png":return loadPNG(t);case"image/jpeg":return loadJPEG(t);case"image/tiff":return loadTIFF(t);default:return loadGeneric(i(r.mime))}return loadGeneric(i("application/octet-stream"));function i(r){return e||toBase64URL(t,r)}}function loadURL(t,e){const r=t.slice(0,64).match(isDataURL);let i;return i=null!==r?Promise.resolve(decode$1(t.slice(r[0].length))):fetchBinary(t,e),i.then(e=>loadBinary(new Uint8Array(e),r?t:void 0))}function loadPNG(t){const e=decodePNG(t);let r,i=e.channels,n=0;return 2===i||4===i?(r=i-1,n=1):r=i,e.palette?loadPNGFromPalette(e):new Image(e.width,e.height,e.data,{components:r,alpha:n,bitDepth:e.depth})}function loadPNGFromPalette(t){const e=t.width*t.height,r=t.palette[0].length,i=new Uint8Array(e*r),n=8/t.depth,s=t.depth<8?n:1,a=parseInt("1".repeat(t.depth),2),o=4===r;let l=0;for(let r=0;r<e;r++){const e=Math.floor(r/s);let h=t.data[e];t.depth<8&&(h=h>>>t.depth*(n-1-r%n)&a);const c=t.palette[h];i[l++]=c[0],i[l++]=c[1],i[l++]=c[2],o&&(i[l++]=c[3])}return new Image(t.width,t.height,i,{components:3,alpha:o,bitDepth:8})}function loadJPEG(t){const e=decode$5(t);let r;e.exif&&(r=getMetadata(e.exif));const i=jpegJs.decode(t,{useTArray:!0});return new Image(i.width,i.height,i.data,{meta:r})}function loadTIFF(t){let e=decodeTIFF(t);return 1===e.length?getImageFromIFD(e[0]):new Stack(e.map(getImageFromIFD))}function getMetadata(t){const e={tiff:{fields:t.fields,tags:t.map}};return t.exif&&(e.exif=t.exif),t.gps&&(e.gps=t.gps),e}function getImageFromIFD(t){if(3===t.type){const e=new Uint16Array(3*t.width*t.height),r=t.palette;let i=0;for(let n=0;n<t.data.length;n++){const s=r[t.data[n]];e[i++]=s[0],e[i++]=s[1],e[i++]=s[2]}return new Image(t.width,t.height,e,{components:3,alpha:t.alpha,colorModel:RGB,bitDepth:16,meta:getMetadata(t)})}return new Image(t.width,t.height,t.data,{components:2===t.type?3:1,alpha:t.alpha,colorModel:2===t.type?RGB:GREY,bitDepth:t.bitsPerSample.length?t.bitsPerSample[0]:t.bitsPerSample,meta:getMetadata(t)})}function loadGeneric(t,e){return e=e||{},new Promise((function(r,i){let n=new DOMImage;n.onload=function(){let t=n.width,i=n.height,s=createCanvas(t,i).getContext("2d");s.drawImage(n,0,0,t,i);let a=s.getImageData(0,0,t,i).data;r(new Image(t,i,a,e))},n.onerror=function(){i(new Error("Could not load "+t))},n.src=t}))}const valueMethods={getValueXY(t,e,r){return this.data[(e*this.width+t)*this.channels+r]},setValueXY(t,e,r,i){return this.data[(e*this.width+t)*this.channels+r]=i,this.computed=null,this},getValue(t,e){return this.data[t*this.channels+e]},setValue(t,e,r){return this.data[t*this.channels+e]=r,this.computed=null,this},getPixelXY(t,e){return this.getPixel(e*this.width+t)},setPixelXY(t,e,r){return this.setPixel(e*this.width+t,r)},getPixel(t){const e=new Array(this.channels),r=t*this.channels;for(let t=0;t<this.channels;t++)e[t]=this.data[r+t];return e},setPixel(t,e){const r=t*this.channels;for(let t=0;t<e.length;t++)this.data[r+t]=e[t];return this.computed=null,this}};function setValueMethods(t){for(const e in valueMethods)t.prototype[e]=valueMethods[e]}function getImageParameters(t){return{width:t.width,height:t.height,components:t.components,alpha:t.alpha,colorModel:t.colorModel,bitDepth:t.bitDepth}}function getOutputImage(t,e,r,i={}){const{out:n}=e;if(void 0===n)return i.copy?t.clone():Image.createFrom(t,r);{if(!Image.isImage(n))throw new TypeError("out must be an Image object");const e=Object.assign(getImageParameters(t),r);for(const t in e)if(n[t]!==e[t])throw new RangeError(`cannot use out. Its ${t} must be "${e[t]}" (found "${n[t]}")`);return n}}function getOutputImageOrInPlace(t,e,r){if(void 0!==e.inPlace&&"boolean"!=typeof e.inPlace)throw new TypeError("inPlace option must be a boolean");if(e.inPlace){if(void 0!==e.out)throw new TypeError("out option must not be set if inPlace option is true");return t}return getOutputImage(t,e,null,r)}function abs(t={}){this.checkProcessable("abs",{bitDepth:[32]});const e=getOutputImageOrInPlace(this,t);return absolute(this,e),e}function absolute(t,e){for(let r=0;r<t.data.length;r++)e.data[r]=Math.abs(t.data[r])}function copyAlphaChannel(t,e){if(1===t.alpha&&1===e.alpha)for(let r=0;r<t.size;r++)e.data[r*e.channels+e.components]=t.data[r*t.channels+t.components]}function invert(t={}){this.checkProcessable("invert",{bitDepth:[1,8,16]});const e=getOutputImageOrInPlace(this,t);return 1===this.bitDepth?invertBinary(this,e):(invertColor(this,e),this!==e&&copyAlphaChannel(this,e)),e}function invertBinary(t,e){for(let r=0;r<t.data.length;r++)e.data[r]=~t.data[r]}function invertColor(t,e){for(let r=0;r<t.data.length;r+=t.channels)for(let i=0;i<t.components;i++)e.data[r+i]=t.maxValue-t.data[r+i]}function flipX(){this.checkProcessable("flipX",{bitDepth:[8,16]});for(let t=0;t<this.height;t++){let e=t*this.width*this.channels;for(let t=0;t<Math.floor(this.width/2);t++){let r=t*this.channels+e,i=(this.width-t-1)*this.channels+e;for(let t=0;t<this.channels;t++){let e=this.data[r+t];this.data[r+t]=this.data[i+t],this.data[i+t]=e}}}return this}function flipY(){this.checkProcessable("flipY",{bitDepth:[8,16]});for(let t=0;t<Math.floor(this.height/2);t++)for(let e=0;e<this.width;e++){let r=e*this.channels+t*this.width*this.channels,i=e*this.channels+(this.height-1-t)*this.channels*this.width;for(let t=0;t<this.channels;t++){let e=this.data[r+t];this.data[r+t]=this.data[i+t],this.data[i+t]=e}}return this}function blurFilter(t={}){const{radius:e=1}=t;if(e<1)throw new Error("radius must be greater than 1");const r=2*e+1,i=new Array(r);for(let t=0;t<r;t++){i[t]=new Array(r);for(let e=0;e<r;e++)i[t][e]=1/(r*r)}return this.convolution(i)}function assertNumber(t){if("number"!=typeof t)throw new TypeError("Expected a number")}var ascending=(t,e)=>(assertNumber(t),assertNumber(e),Number.isNaN(t)?-1:Number.isNaN(e)?1:t-e);function validateArrayOfChannels(t,e={}){let{channels:r,allowAlpha:i,defaultAlpha:n}=e;return"boolean"!=typeof i&&(i=!0),void 0===r?allChannels(t,n):validateChannels(t,r,i)}function allChannels(t,e){let r=e?t.channels:t.components,i=new Array(r);for(let t=0;t<r;t++)i[t]=t;return i}function validateChannels(t,e,r){Array.isArray(e)||(e=[e]);for(let i=0;i<e.length;i++)e[i]=validateChannel(t,e[i],r);return e}function validateChannel(t,e,r=!0){if(void 0===e)throw new RangeError("validateChannel : the channel has to be >=0 and <"+t.channels);if("string"==typeof e){switch(t.colorModel){case GREY:break;case RGB:if("rgb".includes(e))switch(e){case"r":e=0;break;case"g":e=1;break;case"b":e=2}break;case HSL:if("hsl".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"l":e=2}break;case HSV:if("hsv".includes(e))switch(e){case"h":e=0;break;case"s":e=1;break;case"v":e=2}break;case CMYK:if("cmyk".includes(e))switch(e){case"c":e=0;break;case"m":e=1;break;case"y":e=2;break;case"k":e=3}break;default:throw new Error("Unexpected color model: "+t.colorModel)}if("a"===e){if(!t.alpha)throw new Error("validateChannel : the image does not contain alpha channel");e=t.components}if("string"==typeof e)throw new Error("validateChannel : undefined channel: "+e)}if(e>=t.channels)throw new RangeError("validateChannel : the channel has to be >=0 and <"+t.channels);if(!r&&e>=t.components)throw new RangeError("validateChannel : alpha channel may not be selected");return e}function medianFilter(t={}){let{radius:e=1,border:r="copy",channels:i}=t;if(this.checkProcessable("medianFilter",{bitDepth:[8,16]}),e<1)throw new Error("radius must be greater than 0");i=validateArrayOfChannels(this,i);let n=e,s=e,a=Image.createFrom(this),o=(2*n+1)*(2*s+1),l=Math.floor(o/2),h=new Array(o);for(let t=0;t<i.length;t++){let e=i[t];for(let t=s;t<this.height-s;t++)for(let r=n;r<this.width-n;r++){let i=0;for(let a=-s;a<=s;a++)for(let s=-n;s<=n;s++){let n=((t+a)*this.width+r+s)*this.channels+e;h[i++]=this.data[n]}let o=(t*this.width+r)*this.channels+e,c=h.sort(ascending)[l];a.data[o]=c}}if(this.alpha&&!i.includes(this.channels))for(let t=this.components;t<this.data.length;t+=this.channels)a.data[t]=this.data[t];return a.setBorder({size:[n,s],algorithm:r}),a}function gaussianFilter(t={}){let{radius:e=1,sigma:r,channels:i,border:n="copy"}=t;this.checkProcessable("gaussian",{bitDepth:[8,16]});const s=getKernel(e,r);return this.convolution([s,s],{border:n,channels:i,algorithm:"separable"})}function getKernel(t,e){const r=2*t+1,i=new Array(r),n=e||.3*(.5*(r-1)-1)+.8,s=-.5/(n*n);let a=0;for(let e=0;e<r;e++){const r=e-t,n=Math.exp(s*r*r);i[e]=n,a+=n}for(let t=0;t<r;t++)i[t]/=a;return i}const DISCRETE_LAPLACE_4=[[0,1,0],[1,-4,1],[0,1,0]],DISCRETE_LAPLACE_8=[[1,1,1],[1,-8,1],[1,1,1]],SOBEL_X=[[-1,0,1],[-2,0,2],[-1,0,1]],SOBEL_Y=[[-1,-2,-1],[0,0,0],[1,2,1]],SCHARR_X=[[3,0,-3],[10,0,-10],[3,0,-3]],SCHARR_Y=[[3,10,3],[0,0,0],[-3,-10,-3]],SECOND_DERIVATIVE=[[-1,-2,0,2,1],[-2,-4,0,4,2],[0,0,0,0,0],[1,2,0,-2,-1],[2,4,0,-4,-2]],SECOND_DERIVATIVE_INV=[[1,2,0,-2,-1],[2,4,0,-4,-2],[0,0,0,0,0],[-2,-4,0,4,2],[-1,-2,0,2,1]];var fftlib=createCommonjsModule((function(t,e){(function(){var t,r="0.3.0",i="2013-03";(t=e).toString=function(){return"version "+r+", released "+i};for(var n=0,s=null,a=null,o={init:function(t){if(0===t||0!=(t&t-1))throw new Error("init: radix-2 required");n=t,o._initArray(),o._makeBitReversalTable(),o._makeCosSinTable()},fft1d:function(t,e){o.fft(t,e,1)},ifft1d:function(t,e){var r=1/n;o.fft(t,e,-1);for(var i=0;i<n;i++)t[i]*=r,e[i]*=r},bt1d:function(t,e){o.fft(t,e,-1)},fft2d:function(t,e){for(var r=[],i=[],s=0,a=0;a<n;a++){s=a*n;for(var l=0;l<n;l++)r[l]=t[l+s],i[l]=e[l+s];o.fft1d(r,i);for(var h=0;h<n;h++)t[h+s]=r[h],e[h+s]=i[h]}for(var c=0;c<n;c++){for(var u=0;u<n;u++)s=c+u*n,r[u]=t[s],i[u]=e[s];o.fft1d(r,i);for(var f=0;f<n;f++)t[s=c+f*n]=r[f],e[s]=i[f]}},ifft2d:function(t,e){for(var r=[],i=[],s=0,a=0;a<n;a++){s=a*n;for(var l=0;l<n;l++)r[l]=t[l+s],i[l]=e[l+s];o.ifft1d(r,i);for(var h=0;h<n;h++)t[h+s]=r[h],e[h+s]=i[h]}for(var c=0;c<n;c++){for(var u=0;u<n;u++)s=c+u*n,r[u]=t[s],i[u]=e[s];o.ifft1d(r,i);for(var f=0;f<n;f++)t[s=c+f*n]=r[f],e[s]=i[f]}},fft:function(t,e,r){for(var i,o,l,h,c,u,f,d,m,g=n>>2,p=0;p<n;p++)p<(h=s[p])&&(c=t[p],t[p]=t[h],t[h]=c,c=e[p],e[p]=e[h],e[h]=c);for(var w=1;w<n;w<<=1){o=0,i=n/(w<<1);for(var b=0;b<w;b++){u=a[o+g],f=r*a[o];for(var y=b;y<n;y+=w<<1)d=u*t[l=y+w]+f*e[l],m=u*e[l]-f*t[l],t[l]=t[y]-d,t[y]+=d,e[l]=e[y]-m,e[y]+=m;o+=i}}},_initArray:function(){s="undefined"!=typeof Uint32Array?new Uint32Array(n):[],a="undefined"!=typeof Float64Array?new Float64Array(1.25*n):[]},_paddingZero:function(){},_makeBitReversalTable:function(){var t=0,e=0,r=0;for(s[0]=0;++t<n;){for(r=n>>1;r<=e;)e-=r,r>>=1;e+=r,s[t]=e}},_makeCosSinTable:function(){var t=n>>1,e=n>>2,r=n>>3,i=t+e,s=Math.sin(Math.PI/n),o=2*s*s,l=Math.sqrt(o*(2-o)),h=a[e]=1,c=a[0]=0;s=2*o;for(var u=1;u<r;u++)o+=s*(h-=o),l-=s*(c+=l),a[u]=c,a[e-u]=h;0!==r&&(a[r]=Math.sqrt(.5));for(var f=0;f<e;f++)a[t-f]=a[f];for(var d=0;d<i;d++)a[d+t]=-a[d]}},l=["init","fft1d","ifft1d","fft2d","ifft2d"],h=0;h<l.length;h++)t[l[h]]=o[l[h]];return t.bt=o.bt1d,t.fft=o.fft1d,t.ifft=o.ifft1d,t}).call(commonjsGlobal$1)})),FFTUtils={DEBUG:!1,ifft2DArray:function(t,e,r){var i=new Array(e*r),n=e/2,s=2*(r-1);fftlib.init(n);for(var a={re:new Array(n),im:new Array(n)},o=0;o<r;o++){for(var l=n-1;l>=0;l--)a.re[l]=t[2*l*r+o],a.im[l]=t[(2*l+1)*r+o];for(fftlib.bt(a.re,a.im),l=n-1;l>=0;l--)i[2*l*r+o]=a.re[l],i[(2*l+1)*r+o]=a.im[l]}var h=new Array(n*s);fftlib.init(s);var c={re:new Array(s),im:new Array(s)},u=s*n;for(l=0;l<e;l+=2){for(c.re[0]=i[l*r],c.im[0]=i[(l+1)*r],o=1;o<r;o++)c.re[o]=i[l*r+o],c.im[o]=i[(l+1)*r+o],c.re[s-o]=i[l*r+o],c.im[s-o]=-i[(l+1)*r+o];fftlib.bt(c.re,c.im);var f=l/2*s;for(o=s-1;o>=0;o--)h[f+o]=c.re[o]/u}return h},fft2DArray:function(t,e,r,i){Object.assign({},{inplace:!0});var n=r/2+1,s=2*e,a=new Array(s*n);fftlib.init(r);for(var o,l,h,c,u,f={re:new Array(r),im:new Array(r)},d={re:new Array(r),im:new Array(r)},m={re:new Array(r),im:new Array(r)},g=0;g<e/2;g++){o=2*g*r,f.re=t.slice(o,o+r),o=(2*g+1)*r,f.im=t.slice(o,o+r),fftlib.fft1d(f.re,f.im),this.reconstructTwoRealFFT(f,d,m),l=4*g*n,h=(4*g+1)*n,c=(4*g+2)*n,u=(4*g+3)*n;for(var p=n-1;p>=0;p--)a[l+p]=d.re[p],a[h+p]=d.im[p],a[c+p]=m.re[p],a[u+p]=m.im[p]}d=null,m=null;var w=new Array(s*n);fftlib.init(e);for(var b={re:new Array(e),im:new Array(e)},y=n-1;y>=0;y--){for(g=e-1;g>=0;g--)b.re[g]=a[2*g*n+y],b.im[g]=a[(2*g+1)*n+y],isNaN(b.re[g])&&(b.re[g]=0),isNaN(b.im[g])&&(b.im[g]=0);for(fftlib.fft1d(b.re,b.im),g=e-1;g>=0;g--)w[2*g*n+y]=b.re[g],w[(2*g+1)*n+y]=b.im[g]}return w},reconstructTwoRealFFT:function(t,e,r){var i,n,s,a,o,l=t.re.length;e.re[0]=t.re[0],e.im[0]=0,r.re[0]=t.im[0],r.im[0]=0;for(var h=l/2;h>0;h--)o=l-h,i=.5*(t.re[h]-t.re[o]),n=.5*(t.re[h]+t.re[o]),s=.5*(t.im[h]-t.im[o]),a=.5*(t.im[h]+t.im[o]),e.re[h]=n,e.im[h]=s,e.re[o]=n,e.im[o]=-s,r.re[h]=a,r.im[h]=-i,r.re[o]=a,r.im[o]=i},convolute2DI:function(t,e,r,i){for(var n,s,a=0;a<r/2;a++)for(var o=0;o<i;o++)n=t[2*a*i+o]*e[2*a*i+o]-t[(2*a+1)*i+o]*e[(2*a+1)*i+o],s=t[2*a*i+o]*e[(2*a+1)*i+o]+t[(2*a+1)*i+o]*e[2*a*i+o],t[2*a*i+o]=n,t[(2*a+1)*i+o]=s},convolute:function(t,e,r,i,n){for(var s=new Array(i*r),a=0;a<r*i;a++)s[a]=t[a];s=this.fft2DArray(s,r,i);var o,l=e.length,h=e[0].length,c=new Array(i*r);for(a=0;a<i*r;a++)c[a]=0;for(var u=Math.floor((l-1)/2),f=Math.floor((h-1)/2),d=0;d<l;d++){o=(d-u+r)%r;for(var m=0;m<h;m++)c[o*i+(m-f+i)%i]=e[d][m]}c=this.fft2DArray(c,r,i);var g=2*r,p=i/2+1;return this.convolute2DI(s,c,g,p),this.ifft2DArray(s,g,p)},toRadix2:function(t,e,r){var i,n,s,a,o=r,l=e;if(0===r||0!=(r&r-1)){for(o=0;r>>++o!=0;);o=1<<o}if(0===e||0!=(e&e-1)){for(l=0;e>>++l!=0;);l=1<<l}if(l==e&&o==r)return{data:t,rows:e,cols:r};var h=new Array(l*o),c=Math.floor((l-e)/2)-e,u=Math.floor((o-r)/2)-r;for(i=0;i<l;i++)for(s=i*o,a=(i-c)%e*r,n=0;n<o;n++)h[s+n]=t[a+(n-u)%r];return{data:h,rows:l,cols:o}},crop:function(t,e,r,i,n,s){if(e==i&&r==n)return t;Object.assign({},s);var a,o,l,h,c=new Array(n*i),u=Math.floor((e-i)/2),f=Math.floor((r-n)/2);for(l=0;l<i;l++)for(a=l*n,o=(l+u)*r,h=0;h<n;h++)c[a+h]=t[o+(h+f)];return c}},FFTUtils_1=FFTUtils,FFTUtils$1=FFTUtils_1,FFT=fftlib,src$1={FFTUtils:FFTUtils$1,FFT:FFT},FFTUtils$2=src$1.FFTUtils;function convolutionFFT(t,e,r){var i,n,s=matrix2Array(t),a=s.data,o=Object.assign({normalize:!1,divisor:1,rows:s.rows,cols:s.cols},r);if(!o.rows||!o.cols)throw new Error("Invalid number of rows or columns "+i+" "+n);i=o.rows,n=o.cols;var l,h,c=o.divisor,u=e.length,f=e[0].length;if(o.normalize)for(c=0,l=0;l<u;l++)for(h=0;h<f;h++)c+=e[l][h];if(0===c)throw new RangeError("convolution: The divisor is equal to zero");var d=FFTUtils$2.toRadix2(a,i,n),m=FFTUtils$2.convolute(d.data,e,d.rows,d.cols);if(m=FFTUtils$2.crop(m,d.rows,d.cols,i,n),0!=c&&1!=c)for(l=0;l<m.length;l++)m[l]/=c;return m}function convolutionDirect(t,e,r){var i,n,s=matrix2Array(t),a=s.data,o=Object.assign({normalize:!1,divisor:1,rows:s.rows,cols:s.cols},r);if(!o.rows||!o.cols)throw new Error("Invalid number of rows or columns "+i+" "+n);i=o.rows,n=o.cols;var l,h,c,u,f,d,m=o.divisor,g=e.length,p=e[0].length;if(o.normalize)for(m=0,l=0;l<g;l++)for(h=0;h<p;h++)m+=e[l][h];if(0===m)throw new RangeError("convolution: The divisor is equal to zero");var w=new Array(i*n),b=Math.floor(g/2),y=Math.floor(p/2);for(u=0;u<i;u++)for(c=0;c<n;c++){for(f=0,h=0;h<g;h++)for(l=0;l<p;l++)d=e[g-h-1][p-l-1],f+=a[(u+h-b+i)%i*n+(c+l-y+n)%n]*d;w[u*n+c]=f/m}return w}function LoG(t,e,r){var i=1e3;r&&r.factor&&(i=r.factor);var n,s,a,o,l=new Array(e);i*=-1;var h=(e-1)/2,c=2*t*t;for(n=0;n<e;n++)for(l[n]=new Array(e),o=(n-h)*(n-h),s=0;s<e;s++)a=-((s-h)*(s-h)+o)/c,l[n][s]=Math.round(i*(1+a)*Math.exp(a));return l}function matrix2Array(t){var e,r,i=t;if("number"!=typeof t[0]){e=t.length,r=t[0].length,i=new Array(e*r);for(var n=0;n<e;n++)for(var s=0;s<r;s++)i[n*r+s]=t[n][s]}else{var a=Math.sqrt(t.length);Number.isInteger(a)&&(e=a,r=a)}return{data:i,rows:e,cols:r}}var src$2={fft:convolutionFFT,direct:convolutionDirect,kernelFactory:{LoG:LoG},matrix2Array:matrix2Array},numberIsNan=Number.isNaN||function(t){return t!=t},_isFinite=Number.isFinite||function(t){return!("number"!=typeof t||numberIsNan(t)||t===1/0||t===-1/0)},isInteger=Number.isInteger||function(t){return"number"==typeof t&&_isFinite(t)&&Math.floor(t)===t};function validateKernel(t){let e,r;if(!Array.isArray(t))throw new Error("validateKernel: Invalid Kernel: "+t);if(Array.isArray(t[0])){if(0==(1&t.length)||0==(1&t[0].length))throw new RangeError("validateKernel: Kernel rows and columns should be odd numbers");e=Math.floor(t.length/2),r=Math.floor(t[0].length/2)}else{let i=Math.sqrt(t.length);if(!isInteger(i))throw new RangeError("validateKernel: Kernel array should be a square");r=e=Math.floor(Math.sqrt(t.length)/2);let n=new Array(i);for(let e=0;e<i;e++){n[e]=new Array(i);for(let r=0;r<i;r++)n[e][r]=t[e*i+r]}t=n}return{kernel:t,kWidth:r,kHeight:e}}function clamp(t,e){return Math.round(Math.min(Math.max(t,0),e.maxValue))}function directConvolution(t,e,r){if(void 0===r){const i=t.length+e.length-1;r=new Array(i)}fill(r);for(var i=0;i<t.length;i++)for(var n=0;n<e.length;n++)r[i+n]+=t[i]*e[n];return r}function fill(t){for(var e=0;e<t.length;e++)t[e]=0}function convolutionSeparable(t,e,r,i){const n=new Array(t.length);let s,a,o,l;l=e[1],o=(l.length-1)/2,a=new Array(r+l.length-1),s=new Array(r);for(let e=0;e<i;e++){for(let i=0;i<r;i++)s[i]=t[e*r+i];directConvolution(s,l,a);for(let t=0;t<r;t++)n[e*r+t]=a[o+t]}l=e[0],o=(l.length-1)/2,a=new Array(i+l.length-1),s=new Array(i);for(let t=0;t<r;t++){for(let e=0;e<i;e++)s[e]=n[e*r+t];directConvolution(s,l,a);for(let e=0;e<i;e++)n[e*r+t]=a[o+e]}return n}const toString$2=Object.prototype.toString;function isAnyArray(t){return toString$2.call(t).endsWith("Array]")}var src$3=isAnyArray;function max$1(t){if(!src$3(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]>e&&(e=t[r]);return e}function min$1(t){if(!src$3(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return e}function rescale(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!src$3(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!src$3(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var i=min$1(t),n=max$1(t);if(i===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=r.min,a=void 0===s?r.autoMinMax?i:0:s,o=r.max,l=void 0===o?r.autoMinMax?n:1:o;if(a>=l)throw new RangeError("min option must be smaller than max option");for(var h=(l-a)/(n-i),c=0;c<t.length;c++)e[c]=(t[c]-i)*h+a;return e}const indent=" ".repeat(2),indentData=" ".repeat(4);function inspectMatrix(){return inspectMatrixWithOptions(this)}function inspectMatrixWithOptions(t,e={}){const{maxRows:r=15,maxColumns:i=10,maxNumSize:n=8}=e;return`${t.constructor.name} {\n${indent}[\n${indentData}${inspectData(t,r,i,n)}\n${indent}]\n${indent}rows: ${t.rows}\n${indent}columns: ${t.columns}\n}`}function inspectData(t,e,r,i){const{rows:n,columns:s}=t,a=Math.min(n,e),o=Math.min(s,r),l=[];for(let e=0;e<a;e++){let r=[];for(let n=0;n<o;n++)r.push(formatNumber(t.get(e,n),i));l.push(""+r.join(" "))}return o!==s&&(l[l.length-1]+=` ... ${s-r} more columns`),a!==n&&l.push(`... ${n-e} more rows`),l.join("\n"+indentData)}function formatNumber(t,e){const r=String(t);if(r.length<=e)return r.padEnd(e," ");const i=t.toPrecision(e-2);if(i.length<=e)return i;const n=t.toExponential(e-2),s=n.indexOf("e"),a=n.slice(s);return n.slice(0,e-a.length)+a}function installMathOperations(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this}}function checkRowIndex(t,e,r){let i=r?t.rows:t.rows-1;if(e<0||e>i)throw new RangeError("Row index out of range")}function checkColumnIndex(t,e,r){let i=r?t.columns:t.columns-1;if(e<0||e>i)throw new RangeError("Column index out of range")}function checkRowVector(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function checkColumnVector(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function checkIndices(t,e,r){return{row:checkRowIndices(t,e),column:checkColumnIndices(t,r)}}function checkRowIndices(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some(e=>e<0||e>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function checkColumnIndices(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some(e=>e<0||e>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function checkRange(t,e,r,i,n){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(checkNumber("startRow",e),checkNumber("endRow",r),checkNumber("startColumn",i),checkNumber("endColumn",n),e>r||i>n||e<0||e>=t.rows||r<0||r>=t.rows||i<0||i>=t.columns||n<0||n>=t.columns)throw new RangeError("Submatrix indices are out of range")}function newArray(t,e=0){let r=[];for(let i=0;i<t;i++)r.push(e);return r}function checkNumber(t,e){if("number"!=typeof e)throw new TypeError(t+" must be a number")}function sumByRow(t){let e=newArray(t.rows);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[r]+=t.get(r,i);return e}function sumByColumn(t){let e=newArray(t.columns);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[i]+=t.get(r,i);return e}function sumAll(t){let e=0;for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)e+=t.get(r,i);return e}function productByRow(t){let e=newArray(t.rows,1);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[r]*=t.get(r,i);return e}function productByColumn(t){let e=newArray(t.columns,1);for(let r=0;r<t.rows;++r)for(let i=0;i<t.columns;++i)e[i]*=t.get(r,i);return e}function productAll(t){let e=1;for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)e*=t.get(r,i);return e}function varianceByRow(t,e,r){const i=t.rows,n=t.columns,s=[];for(let a=0;a<i;a++){let i=0,o=0,l=0;for(let e=0;e<n;e++)l=t.get(a,e)-r[a],i+=l,o+=l*l;e?s.push((o-i*i/n)/(n-1)):s.push((o-i*i/n)/n)}return s}function varianceByColumn(t,e,r){const i=t.rows,n=t.columns,s=[];for(let a=0;a<n;a++){let n=0,o=0,l=0;for(let e=0;e<i;e++)l=t.get(e,a)-r[a],n+=l,o+=l*l;e?s.push((o-n*n/i)/(i-1)):s.push((o-n*n/i)/i)}return s}function varianceAll(t,e,r){const i=t.rows,n=t.columns,s=i*n;let a=0,o=0,l=0;for(let e=0;e<i;e++)for(let i=0;i<n;i++)l=t.get(e,i)-r,a+=l,o+=l*l;return e?(o-a*a/s)/(s-1):(o-a*a/s)/s}function centerByRow(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e[r])}function centerByColumn(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e[i])}function centerAll(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)-e)}function getScaleByRow(t){const e=[];for(let r=0;r<t.rows;r++){let i=0;for(let e=0;e<t.columns;e++)i+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(i))}return e}function scaleByRow(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e[r])}function getScaleByColumn(t){const e=[];for(let r=0;r<t.columns;r++){let i=0;for(let e=0;e<t.rows;e++)i+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(i))}return e}function scaleByColumn(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e[i])}function getScaleAll(t){const e=t.size-1;let r=0;for(let i=0;i<t.columns;i++)for(let n=0;n<t.rows;n++)r+=Math.pow(t.get(n,i),2)/e;return Math.sqrt(r)}function scaleAll(t,e){for(let r=0;r<t.rows;r++)for(let i=0;i<t.columns;i++)t.set(r,i,t.get(r,i)/e)}class AbstractMatrix{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let i=new Matrix(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)i.set(n,t,r[n*e+t]);return i}static rowVector(t){let e=new Matrix(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new Matrix(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new Matrix(t,e)}static ones(t,e){return new Matrix(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:i=Math.random}=r;let n=new Matrix(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)n.set(r,t,i());return n}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:i=0,max:n=1e3,random:s=Math.random}=r;if(!Number.isInteger(i))throw new TypeError("min must be an integer");if(!Number.isInteger(n))throw new TypeError("max must be an integer");if(i>=n)throw new RangeError("min must be smaller than max");let a=n-i,o=new Matrix(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=i+Math.round(s()*a);o.set(r,t,e)}return o}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let i=Math.min(t,e),n=this.zeros(t,e);for(let t=0;t<i;t++)n.set(t,t,r);return n}static diag(t,e,r){let i=t.length;void 0===e&&(e=i),void 0===r&&(r=e);let n=Math.min(i,e,r),s=this.zeros(e,r);for(let e=0;e<n;e++)s.set(e,e,t[e]);return s}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,i=t.columns,n=new Matrix(r,i);for(let s=0;s<r;s++)for(let r=0;r<i;r++)n.set(s,r,Math.min(t.get(s,r),e.get(s,r)));return n}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,i=t.columns,n=new this(r,i);for(let s=0;s<r;s++)for(let r=0;r<i;r++)n.set(s,r,Math.max(t.get(s,r),e.get(s,r)));return n}static checkMatrix(t){return AbstractMatrix.isMatrix(t)?t:new Matrix(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,i=!0,n=!1;for(;t<this.rows&&i;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(i=!1,n=!0);t++}return i}isReducedEchelonForm(){let t=0,e=0,r=-1,i=!0,n=!1;for(;t<this.rows&&i;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(i=!1,n=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(i=!1);t++}return i}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let i=e;for(let n=e;n<t.rows;n++)t.get(n,r)>t.get(i,r)&&(i=n);if(0===t.get(i,r))r++;else{t.swapRows(e,i);let n=t.get(e,r);for(let i=r;i<t.columns;i++)t.set(e,i,t.get(e,i)/n);for(let i=e+1;i<t.rows;i++){let n=t.get(i,r)/t.get(e,r);t.set(i,r,0);for(let s=r+1;s<t.columns;s++)t.set(i,s,t.get(i,s)-t.get(e,s)*n)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,i=r-1;for(;i>=0;)if(0===t.maxRow(i))i--;else{let n=0,s=!1;for(;n<r&&!1===s;)1===t.get(i,n)?s=!0:n++;for(let r=0;r<i;r++){let s=t.get(r,n);for(let a=n;a<e;a++){let e=t.get(r,a)-s*t.get(i,a);t.set(r,a,e)}}i--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let i=new Matrix(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)i.setSubMatrix(this,this.rows*t,this.columns*e);return i}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){checkRowIndex(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return Matrix.rowVector(this.getRow(t))}setRow(t,e){checkRowIndex(this,t),e=checkRowVector(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){checkRowIndex(this,t),checkRowIndex(this,e);for(let r=0;r<this.columns;r++){let i=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,i)}return this}getColumn(t){checkColumnIndex(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return Matrix.columnVector(this.getColumn(t))}setColumn(t,e){checkColumnIndex(this,t),e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){checkColumnIndex(this,t),checkColumnIndex(this,e);for(let r=0;r<this.rows;r++){let i=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,i)}return this}addRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=checkRowVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=checkColumnVector(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){checkRowIndex(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){checkColumnIndex(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)>t&&(t=this.get(r,i),e[0]=r,e[1]=i);return e}min(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)<t&&(t=this.get(r,i),e[0]=r,e[1]=i);return e}maxRow(t){checkRowIndex(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){checkRowIndex(this,t);let e=this.get(t,0),r=[t,0];for(let i=1;i<this.columns;i++)this.get(t,i)>e&&(e=this.get(t,i),r[1]=i);return r}minRow(t){checkRowIndex(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){checkRowIndex(this,t);let e=this.get(t,0),r=[t,0];for(let i=1;i<this.columns;i++)this.get(t,i)<e&&(e=this.get(t,i),r[1]=i);return r}maxColumn(t){checkColumnIndex(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){checkColumnIndex(this,t);let e=this.get(0,t),r=[0,t];for(let i=1;i<this.rows;i++)this.get(i,t)>e&&(e=this.get(i,t),r[0]=i);return r}minColumn(t){checkColumnIndex(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){checkColumnIndex(this,t);let e=this.get(0,t),r=[0,t];for(let i=1;i<this.rows;i++)this.get(i,t)<e&&(e=this.get(i,t),r[0]=i);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError("unknown norm type: "+t)}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){AbstractMatrix.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i];return r}mmul(t){t=Matrix.checkMatrix(t);let e=this.rows,r=this.columns,i=t.columns,n=new Matrix(e,i),s=new Float64Array(r);for(let a=0;a<i;a++){for(let e=0;e<r;e++)s[e]=t.get(e,a);for(let t=0;t<e;t++){let e=0;for(let i=0;i<r;i++)e+=this.get(t,i)*s[i];n.set(t,a,e)}}return n}strassen2x2(t){t=Matrix.checkMatrix(t);let e=new Matrix(2,2);const r=this.get(0,0),i=t.get(0,0),n=this.get(0,1),s=t.get(0,1),a=this.get(1,0),o=t.get(1,0),l=this.get(1,1),h=t.get(1,1),c=(r+l)*(i+h),u=(a+l)*i,f=r*(s-h),d=l*(o-i),m=(r+n)*h,g=c+d-m+(n-l)*(o+h),p=f+m,w=u+d,b=c-u+f+(a-r)*(i+s);return e.set(0,0,g),e.set(0,1,p),e.set(1,0,w),e.set(1,1,b),e}strassen3x3(t){t=Matrix.checkMatrix(t);let e=new Matrix(3,3);const r=this.get(0,0),i=this.get(0,1),n=this.get(0,2),s=this.get(1,0),a=this.get(1,1),o=this.get(1,2),l=this.get(2,0),h=this.get(2,1),c=this.get(2,2),u=t.get(0,0),f=t.get(0,1),d=t.get(0,2),m=t.get(1,0),g=t.get(1,1),p=t.get(1,2),w=t.get(2,0),b=t.get(2,1),y=t.get(2,2),_=(r-s)*(-f+g),M=(-r+s+a)*(u-f+g),x=(s+a)*(-u+f),v=r*u,S=(-r+l+h)*(u-d+p),k=(-r+l)*(d-p),A=(l+h)*(-u+d),E=(-n+h+c)*(g+w-b),I=(n-c)*(g-b),C=n*w,D=(h+c)*(-w+b),T=(-n+a+o)*(p+w-y),R=(n-o)*(p-y),P=(a+o)*(-w+y),B=v+C+i*m,O=(r+i+n-s-a-h-c)*g+M+x+v+E+C+D,L=v+S+A+(r+i+n-a-o-l-h)*p+C+T+P,N=_+a*(-u+f+m-g-p-w+y)+M+v+C+T+R,F=_+M+x+v+o*b,U=C+T+R+P+s*d,$=v+S+k+h*(-u+d+m-g-p-w+b)+E+I+C,V=E+I+C+D+l*f,z=v+S+k+A+c*y;return e.set(0,0,B),e.set(0,1,O),e.set(0,2,L),e.set(1,0,N),e.set(1,1,F),e.set(1,2,U),e.set(2,0,$),e.set(2,1,V),e.set(2,2,z),e}mmulStrassen(t){t=Matrix.checkMatrix(t);let e=this.clone(),r=e.rows,i=e.columns,n=t.rows,s=t.columns;function a(t,e,r){let i=t.rows,n=t.columns;if(i===e&&n===r)return t;{let i=AbstractMatrix.zeros(e,r);return i=i.setSubMatrix(t,0,0),i}}i!==n&&console.warn(`Multiplying ${r} x ${i} and ${n} x ${s} matrix: dimensions do not match.`);let o=Math.max(r,n),l=Math.max(i,s);return e=a(e,o,l),function t(e,r,i,n){if(i<=512||n<=512)return e.mmul(r);i%2==1&&n%2==1?(e=a(e,i+1,n+1),r=a(r,i+1,n+1)):i%2==1?(e=a(e,i+1,n),r=a(r,i+1,n)):n%2==1&&(e=a(e,i,n+1),r=a(r,i,n+1));let s=parseInt(e.rows/2,10),o=parseInt(e.columns/2,10),l=e.subMatrix(0,s-1,0,o-1),h=r.subMatrix(0,s-1,0,o-1),c=e.subMatrix(0,s-1,o,e.columns-1),u=r.subMatrix(0,s-1,o,r.columns-1),f=e.subMatrix(s,e.rows-1,0,o-1),d=r.subMatrix(s,r.rows-1,0,o-1),m=e.subMatrix(s,e.rows-1,o,e.columns-1),g=r.subMatrix(s,r.rows-1,o,r.columns-1),p=t(AbstractMatrix.add(l,m),AbstractMatrix.add(h,g),s,o),w=t(AbstractMatrix.add(f,m),h,s,o),b=t(l,AbstractMatrix.sub(u,g),s,o),y=t(m,AbstractMatrix.sub(d,h),s,o),_=t(AbstractMatrix.add(l,c),g,s,o),M=t(AbstractMatrix.sub(f,l),AbstractMatrix.add(h,u),s,o),x=t(AbstractMatrix.sub(c,m),AbstractMatrix.add(d,g),s,o),v=AbstractMatrix.add(p,y);v.sub(_),v.add(x);let S=AbstractMatrix.add(b,_),k=AbstractMatrix.add(w,y),A=AbstractMatrix.sub(p,w);A.add(b),A.add(M);let E=AbstractMatrix.zeros(2*v.rows,2*v.columns);return E=E.setSubMatrix(v,0,0),E=E.setSubMatrix(S,v.rows,0),E=E.setSubMatrix(k,0,v.columns),E=E.setSubMatrix(A,v.rows,v.columns),E.subMatrix(0,i-1,0,n-1)}(e,t=a(t,o,l),o,l)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let i=new Matrix(this.rows,this.columns);for(let t=0;t<this.rows;t++){const n=this.getRow(t);rescale(n,{min:e,max:r,output:n}),i.setRow(t,n)}return i}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let i=new Matrix(this.rows,this.columns);for(let t=0;t<this.columns;t++){const n=this.getColumn(t);rescale(n,{min:e,max:r,output:n}),i.setColumn(t,n)}return i}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),i=this.get(e,this.columns-1-r);this.set(e,r,i),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),i=this.get(this.rows-1-r,e);this.set(r,e,i),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=Matrix.checkMatrix(t);let e=this.rows,r=this.columns,i=t.rows,n=t.columns,s=new Matrix(e*i,r*n);for(let a=0;a<e;a++)for(let e=0;e<r;e++)for(let r=0;r<i;r++)for(let o=0;o<n;o++)s.set(i*a+r,n*e+o,this.get(a,e)*t.get(r,o));return s}transpose(){let t=new Matrix(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=compareNumbers){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=compareNumbers){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,i){checkRange(this,t,e,r,i);let n=new Matrix(e-t+1,i-r+1);for(let s=t;s<=e;s++)for(let e=r;e<=i;e++)n.set(s-t,e-r,this.get(s,e));return n}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let i=new Matrix(t.length,r-e+1);for(let n=0;n<t.length;n++)for(let s=e;s<=r;s++){if(t[n]<0||t[n]>=this.rows)throw new RangeError("Row index out of range: "+t[n]);i.set(n,s-e,this.get(t[n],s))}return i}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let i=new Matrix(r-e+1,t.length);for(let n=0;n<t.length;n++)for(let s=e;s<=r;s++){if(t[n]<0||t[n]>=this.columns)throw new RangeError("Column index out of range: "+t[n]);i.set(s-e,n,this.get(s,t[n]))}return i}setSubMatrix(t,e,r){checkRange(this,e,e+(t=Matrix.checkMatrix(t)).rows-1,r,r+t.columns-1);for(let i=0;i<t.rows;i++)for(let n=0;n<t.columns;n++)this.set(e+i,r+n,t.get(i,n));return this}selection(t,e){let r=checkIndices(this,t,e),i=new Matrix(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let n=0;n<r.column.length;n++){let s=r.column[n];i.set(t,n,this.get(e,s))}}return i}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new Matrix(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return sumByRow(this);case"column":return sumByColumn(this);case void 0:return sumAll(this);default:throw new Error("invalid option: "+t)}}product(t){switch(t){case"row":return productByRow(this);case"column":return productByColumn(this);case void 0:return productAll(this);default:throw new Error("invalid option: "+t)}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error("invalid option: "+t)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:i=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(i))throw new TypeError("mean must be an array");return varianceByRow(this,r,i);case"column":if(!Array.isArray(i))throw new TypeError("mean must be an array");return varianceByColumn(this,r,i);case void 0:if("number"!=typeof i)throw new TypeError("mean must be a number");return varianceAll(this,r,i);default:throw new Error("invalid option: "+t)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return centerByRow(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return centerByColumn(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return centerAll(this,r),this;default:throw new Error("invalid option: "+t)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=getScaleByRow(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return scaleByRow(this,r),this;case"column":if(void 0===r)r=getScaleByColumn(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return scaleByColumn(this,r),this;case void 0:if(void 0===r)r=getScaleAll(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return scaleAll(this,r),this;default:throw new Error("invalid option: "+t)}}toString(t){return inspectMatrixWithOptions(this,t)}}function compareNumbers(t,e){return t-e}AbstractMatrix.prototype.klass="Matrix","undefined"!=typeof Symbol&&(AbstractMatrix.prototype[Symbol.for("nodejs.util.inspect.custom")]=inspectMatrix),AbstractMatrix.random=AbstractMatrix.rand,AbstractMatrix.randomInt=AbstractMatrix.randInt,AbstractMatrix.diagonal=AbstractMatrix.diag,AbstractMatrix.prototype.diagonal=AbstractMatrix.prototype.diag,AbstractMatrix.identity=AbstractMatrix.eye,AbstractMatrix.prototype.negate=AbstractMatrix.prototype.neg,AbstractMatrix.prototype.tensorProduct=AbstractMatrix.prototype.kroneckerProduct;class Matrix extends AbstractMatrix{constructor(t,e){if(super(),Matrix.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(this.data=[],!(Number.isInteger(e)&&e>0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if(t=r.length,"number"!=typeof(e=r[0].length)||0===e)throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let i=0;i<t;i++){if(r[i].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[i]))}}}return this.rows=t,this.columns=e,this}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){if(checkRowIndex(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),checkRowIndex(this,t,!0),e=Float64Array.from(checkRowVector(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){if(checkColumnIndex(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let i=0;i<t;i++)r[i]=this.data[e][i];for(let i=t+1;i<this.columns;i++)r[i-1]=this.data[e][i];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),checkColumnIndex(this,t,!0),e=checkColumnVector(this,e);for(let r=0;r<this.rows;r++){const i=new Float64Array(this.columns+1);let n=0;for(;n<t;n++)i[n]=this.data[r][n];for(i[n++]=e[r];n<this.columns+1;n++)i[n]=this.data[r][n-1];this.data[r]=i}return this.columns+=1,this}}installMathOperations(AbstractMatrix,Matrix);class BaseView extends AbstractMatrix{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class MatrixColumnView extends BaseView{constructor(t,e){checkColumnIndex(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}}class MatrixColumnSelectionView extends BaseView{constructor(t,e){e=checkColumnIndices(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}}class MatrixFlipColumnView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}}class MatrixFlipRowView extends BaseView{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}}class MatrixRowView extends BaseView{constructor(t,e){checkRowIndex(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}}class MatrixRowSelectionView extends BaseView{constructor(t,e){super(t,(e=checkRowIndices(t,e)).length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}}class MatrixSelectionView extends BaseView{constructor(t,e,r){let i=checkIndices(t,e,r);super(t,i.row.length,i.column.length),this.rowIndices=i.row,this.columnIndices=i.column}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class MatrixSubView extends BaseView{constructor(t,e,r,i,n){checkRange(t,e,r,i,n),super(t,r-e+1,n-i+1),this.startRow=e,this.startColumn=i}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}}class MatrixTransposeView extends BaseView{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}}class WrapperMatrix1D extends AbstractMatrix{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!=0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let i=this._calculateIndex(t,e);return this.data[i]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}class WrapperMatrix2D extends AbstractMatrix{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}function wrap(t,e){if(Array.isArray(t))return t[0]&&Array.isArray(t[0])?new WrapperMatrix2D(t):new WrapperMatrix1D(t,e);throw new Error("the argument is not an array")}class LuDecomposition{constructor(t){let e,r,i,n,s,a,o,l,h,c=(t=WrapperMatrix2D.checkMatrix(t)).clone(),u=c.rows,f=c.columns,d=new Float64Array(u),m=1;for(e=0;e<u;e++)d[e]=e;for(l=new Float64Array(u),r=0;r<f;r++){for(e=0;e<u;e++)l[e]=c.get(e,r);for(e=0;e<u;e++){for(h=Math.min(e,r),s=0,i=0;i<h;i++)s+=c.get(e,i)*l[i];l[e]-=s,c.set(e,r,l[e])}for(n=r,e=r+1;e<u;e++)Math.abs(l[e])>Math.abs(l[n])&&(n=e);if(n!==r){for(i=0;i<f;i++)a=c.get(n,i),c.set(n,i,c.get(r,i)),c.set(r,i,a);o=d[n],d[n]=d[r],d[r]=o,m=-m}if(r<u&&0!==c.get(r,r))for(e=r+1;e<u;e++)c.set(e,r,c.get(e,r)/c.get(r,r))}this.LU=c,this.pivotVector=d,this.pivotSign=m}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=Matrix.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,i,n,s=t.columns,a=t.subMatrixRow(this.pivotVector,0,s-1),o=e.columns;for(n=0;n<o;n++)for(r=n+1;r<o;r++)for(i=0;i<s;i++)a.set(r,i,a.get(r,i)-a.get(n,i)*e.get(r,n));for(n=o-1;n>=0;n--){for(i=0;i<s;i++)a.set(n,i,a.get(n,i)/e.get(n,n));for(r=0;r<n;r++)for(i=0;i<s;i++)a.set(r,i,a.get(r,i)-a.get(n,i)*e.get(r,n))}return a}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let i=0;i<r;i++)e*=t.get(i,i);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,i=new Matrix(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n>e?i.set(n,e,t.get(n,e)):n===e?i.set(n,e,1):i.set(n,e,0);return i}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,i=new Matrix(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n<=e?i.set(n,e,t.get(n,e)):i.set(n,e,0);return i}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hypotenuse(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class QrDecomposition{constructor(t){let e,r,i,n,s=(t=WrapperMatrix2D.checkMatrix(t)).clone(),a=t.rows,o=t.columns,l=new Float64Array(o);for(i=0;i<o;i++){let t=0;for(e=i;e<a;e++)t=hypotenuse(t,s.get(e,i));if(0!==t){for(s.get(i,i)<0&&(t=-t),e=i;e<a;e++)s.set(e,i,s.get(e,i)/t);for(s.set(i,i,s.get(i,i)+1),r=i+1;r<o;r++){for(n=0,e=i;e<a;e++)n+=s.get(e,i)*s.get(e,r);for(n=-n/s.get(i,i),e=i;e<a;e++)s.set(e,r,s.get(e,r)+n*s.get(e,i))}}l[i]=-t}this.QR=s,this.Rdiag=l}solve(t){t=Matrix.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let i,n,s,a,o=t.columns,l=t.clone(),h=e.columns;for(s=0;s<h;s++)for(n=0;n<o;n++){for(a=0,i=s;i<r;i++)a+=e.get(i,s)*l.get(i,n);for(a=-a/e.get(s,s),i=s;i<r;i++)l.set(i,n,l.get(i,n)+a*e.get(i,s))}for(s=h-1;s>=0;s--){for(n=0;n<o;n++)l.set(s,n,l.get(s,n)/this.Rdiag[s]);for(i=0;i<s;i++)for(n=0;n<o;n++)l.set(i,n,l.get(i,n)-l.get(s,n)*e.get(i,s))}return l.subMatrix(0,h-1,0,o-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,i=r.columns,n=new Matrix(i,i);for(t=0;t<i;t++)for(e=0;e<i;e++)t<e?n.set(t,e,r.get(t,e)):t===e?n.set(t,e,this.Rdiag[t]):n.set(t,e,0);return n}get orthogonalMatrix(){let t,e,r,i,n=this.QR,s=n.rows,a=n.columns,o=new Matrix(s,a);for(r=a-1;r>=0;r--){for(t=0;t<s;t++)o.set(t,r,0);for(o.set(r,r,1),e=r;e<a;e++)if(0!==n.get(r,r)){for(i=0,t=r;t<s;t++)i+=n.get(t,r)*o.get(t,e);for(i=-i/n.get(r,r),t=r;t<s;t++)o.set(t,e,o.get(t,e)+i*n.get(t,r))}}return o}}class SingularValueDecomposition{constructor(t,e={}){let r=(t=WrapperMatrix2D.checkMatrix(t)).rows,i=t.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:s=!0,autoTranspose:a=!1}=e;let o,l=Boolean(n),h=Boolean(s),c=!1;if(r<i)if(a){o=t.transpose(),r=o.rows,i=o.columns,c=!0;let e=l;l=h,h=e}else o=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else o=t.clone();let u=Math.min(r,i),f=Math.min(r+1,i),d=new Float64Array(f),m=new Matrix(r,u),g=new Matrix(i,i),p=new Float64Array(i),w=new Float64Array(r),b=new Float64Array(f);for(let t=0;t<f;t++)b[t]=t;let y=Math.min(r-1,i),_=Math.max(0,Math.min(i-2,r)),M=Math.max(y,_);for(let t=0;t<M;t++){if(t<y){d[t]=0;for(let e=t;e<r;e++)d[t]=hypotenuse(d[t],o.get(e,t));if(0!==d[t]){o.get(t,t)<0&&(d[t]=-d[t]);for(let e=t;e<r;e++)o.set(e,t,o.get(e,t)/d[t]);o.set(t,t,o.get(t,t)+1)}d[t]=-d[t]}for(let e=t+1;e<i;e++){if(t<y&&0!==d[t]){let i=0;for(let n=t;n<r;n++)i+=o.get(n,t)*o.get(n,e);i=-i/o.get(t,t);for(let n=t;n<r;n++)o.set(n,e,o.get(n,e)+i*o.get(n,t))}p[e]=o.get(t,e)}if(l&&t<y)for(let e=t;e<r;e++)m.set(e,t,o.get(e,t));if(t<_){p[t]=0;for(let e=t+1;e<i;e++)p[t]=hypotenuse(p[t],p[e]);if(0!==p[t]){p[t+1]<0&&(p[t]=0-p[t]);for(let e=t+1;e<i;e++)p[e]/=p[t];p[t+1]+=1}if(p[t]=-p[t],t+1<r&&0!==p[t]){for(let e=t+1;e<r;e++)w[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<i;r++)w[e]+=p[r]*o.get(e,r);for(let e=t+1;e<i;e++){let i=-p[e]/p[t+1];for(let n=t+1;n<r;n++)o.set(n,e,o.get(n,e)+i*w[n])}}if(h)for(let e=t+1;e<i;e++)g.set(e,t,p[e])}}let x=Math.min(i,r+1);if(y<i&&(d[y]=o.get(y,y)),r<x&&(d[x-1]=0),_+1<x&&(p[_]=o.get(_,x-1)),p[x-1]=0,l){for(let t=y;t<u;t++){for(let e=0;e<r;e++)m.set(e,t,0);m.set(t,t,1)}for(let t=y-1;t>=0;t--)if(0!==d[t]){for(let e=t+1;e<u;e++){let i=0;for(let n=t;n<r;n++)i+=m.get(n,t)*m.get(n,e);i=-i/m.get(t,t);for(let n=t;n<r;n++)m.set(n,e,m.get(n,e)+i*m.get(n,t))}for(let e=t;e<r;e++)m.set(e,t,-m.get(e,t));m.set(t,t,1+m.get(t,t));for(let e=0;e<t-1;e++)m.set(e,t,0)}else{for(let e=0;e<r;e++)m.set(e,t,0);m.set(t,t,1)}}if(h)for(let t=i-1;t>=0;t--){if(t<_&&0!==p[t])for(let e=t+1;e<i;e++){let r=0;for(let n=t+1;n<i;n++)r+=g.get(n,t)*g.get(n,e);r=-r/g.get(t+1,t);for(let n=t+1;n<i;n++)g.set(n,e,g.get(n,e)+r*g.get(n,t))}for(let e=0;e<i;e++)g.set(e,t,0);g.set(t,t,1)}let v=x-1,S=Number.EPSILON;for(;x>0;){let t,e;for(t=x-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+S*Math.abs(d[t]+Math.abs(d[t+1]));if(Math.abs(p[t])<=e||Number.isNaN(p[t])){p[t]=0;break}}if(t===x-2)e=4;else{let r;for(r=x-1;r>=t&&r!==t;r--){let e=(r!==x?Math.abs(p[r]):0)+(r!==t+1?Math.abs(p[r-1]):0);if(Math.abs(d[r])<=S*e){d[r]=0;break}}r===t?e=3:r===x-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=p[x-2];p[x-2]=0;for(let r=x-2;r>=t;r--){let n=hypotenuse(d[r],e),s=d[r]/n,a=e/n;if(d[r]=n,r!==t&&(e=-a*p[r-1],p[r-1]=s*p[r-1]),h)for(let t=0;t<i;t++)n=s*g.get(t,r)+a*g.get(t,x-1),g.set(t,x-1,-a*g.get(t,r)+s*g.get(t,x-1)),g.set(t,r,n)}break}case 2:{let e=p[t-1];p[t-1]=0;for(let i=t;i<x;i++){let n=hypotenuse(d[i],e),s=d[i]/n,a=e/n;if(d[i]=n,e=-a*p[i],p[i]=s*p[i],l)for(let e=0;e<r;e++)n=s*m.get(e,i)+a*m.get(e,t-1),m.set(e,t-1,-a*m.get(e,i)+s*m.get(e,t-1)),m.set(e,i,n)}break}case 3:{const e=Math.max(Math.abs(d[x-1]),Math.abs(d[x-2]),Math.abs(p[x-2]),Math.abs(d[t]),Math.abs(p[t])),n=d[x-1]/e,s=d[x-2]/e,a=p[x-2]/e,o=d[t]/e,c=p[t]/e,u=((s+n)*(s-n)+a*a)/2,f=n*a*(n*a);let w=0;0===u&&0===f||(w=u<0?0-Math.sqrt(u*u+f):Math.sqrt(u*u+f),w=f/(u+w));let b=(o+n)*(o-n)+w,y=o*c;for(let e=t;e<x-1;e++){let n=hypotenuse(b,y);0===n&&(n=Number.MIN_VALUE);let s=b/n,a=y/n;if(e!==t&&(p[e-1]=n),b=s*d[e]+a*p[e],p[e]=s*p[e]-a*d[e],y=a*d[e+1],d[e+1]=s*d[e+1],h)for(let t=0;t<i;t++)n=s*g.get(t,e)+a*g.get(t,e+1),g.set(t,e+1,-a*g.get(t,e)+s*g.get(t,e+1)),g.set(t,e,n);if(n=hypotenuse(b,y),0===n&&(n=Number.MIN_VALUE),s=b/n,a=y/n,d[e]=n,b=s*p[e]+a*d[e+1],d[e+1]=-a*p[e]+s*d[e+1],y=a*p[e+1],p[e+1]=s*p[e+1],l&&e<r-1)for(let t=0;t<r;t++)n=s*m.get(t,e)+a*m.get(t,e+1),m.set(t,e+1,-a*m.get(t,e)+s*m.get(t,e+1)),m.set(t,e,n)}p[x-2]=b;break}case 4:if(d[t]<=0&&(d[t]=d[t]<0?-d[t]:0,h))for(let e=0;e<=v;e++)g.set(e,t,-g.get(e,t));for(;t<v&&!(d[t]>=d[t+1]);){let e=d[t];if(d[t]=d[t+1],d[t+1]=e,h&&t<i-1)for(let r=0;r<i;r++)e=g.get(r,t+1),g.set(r,t+1,g.get(r,t)),g.set(r,t,e);if(l&&t<r-1)for(let i=0;i<r;i++)e=m.get(i,t+1),m.set(i,t+1,m.get(i,t)),m.set(i,t,e);t++}x--}}if(c){let t=g;g=m,m=t}this.m=r,this.n=i,this.s=d,this.U=m,this.V=g}solve(t){let e=t,r=this.threshold,i=this.s.length,n=Matrix.zeros(i,i);for(let t=0;t<i;t++)Math.abs(this.s[t])<=r?n.set(t,t,0):n.set(t,t,1/this.s[t]);let s=this.U,a=this.rightSingularVectors,o=a.mmul(n),l=a.rows,h=s.rows,c=Matrix.zeros(l,h);for(let t=0;t<l;t++)for(let e=0;e<h;e++){let r=0;for(let n=0;n<i;n++)r+=o.get(t,n)*s.get(e,n);c.set(t,e,r)}return c.mmul(e)}solveForDiagonal(t){return this.solve(Matrix.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,i=t.columns,n=new Matrix(r,this.s.length);for(let s=0;s<r;s++)for(let r=0;r<i;r++)Math.abs(this.s[r])>e&&n.set(s,r,t.get(s,r)/this.s[r]);let s=this.U,a=s.rows,o=s.columns,l=new Matrix(r,a);for(let t=0;t<r;t++)for(let e=0;e<a;e++){let r=0;for(let i=0;i<o;i++)r+=n.get(t,i)*s.get(e,i);l.set(t,e,r)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let i=0,n=r.length;i<n;i++)r[i]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Matrix.diag(this.s)}}function inverse(t,e=!1){return t=WrapperMatrix2D.checkMatrix(t),e?new SingularValueDecomposition(t).inverse():solve(t,Matrix.eye(t.rows))}function solve(t,e,r=!1){return t=WrapperMatrix2D.checkMatrix(t),e=WrapperMatrix2D.checkMatrix(e),r?new SingularValueDecomposition(t).solve(e):t.isSquare()?new LuDecomposition(t).solve(e):new QrDecomposition(t).solve(e)}function determinant(t){if((t=Matrix.checkMatrix(t)).isSquare()){let e,r,i,n;if(2===t.columns)return e=t.get(0,0),r=t.get(0,1),i=t.get(1,0),n=t.get(1,1),e*n-r*i;if(3===t.columns){let n,s,a;return n=new MatrixSelectionView(t,[1,2],[1,2]),s=new MatrixSelectionView(t,[1,2],[0,2]),a=new MatrixSelectionView(t,[1,2],[0,1]),e=t.get(0,0),r=t.get(0,1),i=t.get(0,2),e*determinant(n)-r*determinant(s)+i*determinant(a)}return new LuDecomposition(t).determinant}throw Error("determinant can only be calculated for a square matrix")}function xrange(t,e){let r=[];for(let i=0;i<t;i++)i!==e&&r.push(i);return r}function dependenciesOneRow(t,e,r,i=1e-9,n=1e-9){if(t>n)return new Array(e.rows+1).fill(0);{let t=e.addRow(r,[0]);for(let e=0;e<t.rows;e++)Math.abs(t.get(e,0))<i&&t.set(e,0,0);return t.to1DArray()}}function linearDependencies(t,e={}){const{thresholdValue:r=1e-9,thresholdError:i=1e-9}=e;let n=(t=Matrix.checkMatrix(t)).rows,s=new Matrix(n,n);for(let e=0;e<n;e++){let a=Matrix.columnVector(t.getRow(e)),o=t.subMatrixRow(xrange(n,e)).transpose(),l=new SingularValueDecomposition(o).solve(a),h=Matrix.sub(a,o.mmul(l)).abs().max();s.setRow(e,dependenciesOneRow(h,l,e,r,i))}return s}function pseudoInverse(t,e=Number.EPSILON){t=Matrix.checkMatrix(t);let r=new SingularValueDecomposition(t,{autoTranspose:!0}),i=r.leftSingularVectors,n=r.rightSingularVectors,s=r.diagonal;for(let t=0;t<s.length;t++)Math.abs(s[t])>e?s[t]=1/s[t]:s[t]=0;return n.mmul(Matrix.diag(s).mmul(i.transpose()))}function covariance(t,e=t,r={}){t=new Matrix(t);let i=!1;if("object"!=typeof e||Matrix.isMatrix(e)||Array.isArray(e)?e=new Matrix(e):(r=e,e=t,i=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0}=r;n&&(t=t.center("column"),i||(e=e.center("column")));const s=t.transpose().mmul(e);for(let e=0;e<s.rows;e++)for(let r=0;r<s.columns;r++)s.set(e,r,s.get(e,r)*(1/(t.rows-1)));return s}function correlation(t,e=t,r={}){t=new Matrix(t);let i=!1;if("object"!=typeof e||Matrix.isMatrix(e)||Array.isArray(e)?e=new Matrix(e):(r=e,e=t,i=!0),t.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:n=!0,scale:s=!0}=r;n&&(t.center("column"),i||e.center("column")),s&&(t.scale("column"),i||e.scale("column"));const a=t.standardDeviation("column",{unbiased:!0}),o=i?a:e.standardDeviation("column",{unbiased:!0}),l=t.transpose().mmul(e);for(let e=0;e<l.rows;e++)for(let r=0;r<l.columns;r++)l.set(e,r,l.get(e,r)*(1/(a[e]*o[r]))*(1/(t.rows-1)));return l}class EigenvalueDecomposition{constructor(t,e={}){const{assumeSymmetric:r=!1}=e;if(!(t=WrapperMatrix2D.checkMatrix(t)).isSquare())throw new Error("Matrix is not a square matrix");let i,n,s=t.columns,a=new Matrix(s,s),o=new Float64Array(s),l=new Float64Array(s),h=t,c=!1;if(c=!!r||t.isSymmetric(),c){for(i=0;i<s;i++)for(n=0;n<s;n++)a.set(i,n,h.get(i,n));tred2(s,l,o,a),tql2(s,l,o,a)}else{let t=new Matrix(s,s),e=new Float64Array(s);for(n=0;n<s;n++)for(i=0;i<s;i++)t.set(i,n,h.get(i,n));orthes(s,t,e,a),hqr2(s,l,o,a,t)}this.n=s,this.e=l,this.d=o,this.V=a}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,r=this.n,i=this.e,n=this.d,s=new Matrix(r,r);for(t=0;t<r;t++){for(e=0;e<r;e++)s.set(t,e,0);s.set(t,t,n[t]),i[t]>0?s.set(t,t+1,i[t]):i[t]<0&&s.set(t,t-1,i[t])}return s}}function tred2(t,e,r,i){let n,s,a,o,l,h,c,u;for(l=0;l<t;l++)r[l]=i.get(t-1,l);for(o=t-1;o>0;o--){for(u=0,a=0,h=0;h<o;h++)u+=Math.abs(r[h]);if(0===u)for(e[o]=r[o-1],l=0;l<o;l++)r[l]=i.get(o-1,l),i.set(o,l,0),i.set(l,o,0);else{for(h=0;h<o;h++)r[h]/=u,a+=r[h]*r[h];for(n=r[o-1],s=Math.sqrt(a),n>0&&(s=-s),e[o]=u*s,a-=n*s,r[o-1]=n-s,l=0;l<o;l++)e[l]=0;for(l=0;l<o;l++){for(n=r[l],i.set(l,o,n),s=e[l]+i.get(l,l)*n,h=l+1;h<=o-1;h++)s+=i.get(h,l)*r[h],e[h]+=i.get(h,l)*n;e[l]=s}for(n=0,l=0;l<o;l++)e[l]/=a,n+=e[l]*r[l];for(c=n/(a+a),l=0;l<o;l++)e[l]-=c*r[l];for(l=0;l<o;l++){for(n=r[l],s=e[l],h=l;h<=o-1;h++)i.set(h,l,i.get(h,l)-(n*e[h]+s*r[h]));r[l]=i.get(o-1,l),i.set(o,l,0)}}r[o]=a}for(o=0;o<t-1;o++){if(i.set(t-1,o,i.get(o,o)),i.set(o,o,1),a=r[o+1],0!==a){for(h=0;h<=o;h++)r[h]=i.get(h,o+1)/a;for(l=0;l<=o;l++){for(s=0,h=0;h<=o;h++)s+=i.get(h,o+1)*i.get(h,l);for(h=0;h<=o;h++)i.set(h,l,i.get(h,l)-s*r[h])}}for(h=0;h<=o;h++)i.set(h,o+1,0)}for(l=0;l<t;l++)r[l]=i.get(t-1,l),i.set(t-1,l,0);i.set(t-1,t-1,1),e[0]=0}function tql2(t,e,r,i){let n,s,a,o,l,h,c,u,f,d,m,g,p,w,b,y;for(a=1;a<t;a++)e[a-1]=e[a];e[t-1]=0;let _=0,M=0,x=Number.EPSILON;for(h=0;h<t;h++){for(M=Math.max(M,Math.abs(r[h])+Math.abs(e[h])),c=h;c<t&&!(Math.abs(e[c])<=x*M);)c++;if(c>h)do{for(n=r[h],u=(r[h+1]-n)/(2*e[h]),f=hypotenuse(u,1),u<0&&(f=-f),r[h]=e[h]/(u+f),r[h+1]=e[h]*(u+f),d=r[h+1],s=n-r[h],a=h+2;a<t;a++)r[a]-=s;for(_+=s,u=r[c],m=1,g=m,p=m,w=e[h+1],b=0,y=0,a=c-1;a>=h;a--)for(p=g,g=m,y=b,n=m*e[a],s=m*u,f=hypotenuse(u,e[a]),e[a+1]=b*f,b=e[a]/f,m=u/f,u=m*r[a]-b*n,r[a+1]=s+b*(m*n+b*r[a]),l=0;l<t;l++)s=i.get(l,a+1),i.set(l,a+1,b*i.get(l,a)+m*s),i.set(l,a,m*i.get(l,a)-b*s);u=-b*y*p*w*e[h]/d,e[h]=b*u,r[h]=m*u}while(Math.abs(e[h])>x*M);r[h]=r[h]+_,e[h]=0}for(a=0;a<t-1;a++){for(l=a,u=r[a],o=a+1;o<t;o++)r[o]<u&&(l=o,u=r[o]);if(l!==a)for(r[l]=r[a],r[a]=u,o=0;o<t;o++)u=i.get(o,a),i.set(o,a,i.get(o,l)),i.set(o,l,u)}}function orthes(t,e,r,i){let n,s,a,o,l,h,c,u=t-1;for(h=1;h<=u-1;h++){for(c=0,o=h;o<=u;o++)c+=Math.abs(e.get(o,h-1));if(0!==c){for(a=0,o=u;o>=h;o--)r[o]=e.get(o,h-1)/c,a+=r[o]*r[o];for(s=Math.sqrt(a),r[h]>0&&(s=-s),a-=r[h]*s,r[h]=r[h]-s,l=h;l<t;l++){for(n=0,o=u;o>=h;o--)n+=r[o]*e.get(o,l);for(n/=a,o=h;o<=u;o++)e.set(o,l,e.get(o,l)-n*r[o])}for(o=0;o<=u;o++){for(n=0,l=u;l>=h;l--)n+=r[l]*e.get(o,l);for(n/=a,l=h;l<=u;l++)e.set(o,l,e.get(o,l)-n*r[l])}r[h]=c*r[h],e.set(h,h-1,c*s)}}for(o=0;o<t;o++)for(l=0;l<t;l++)i.set(o,l,o===l?1:0);for(h=u-1;h>=1;h--)if(0!==e.get(h,h-1)){for(o=h+1;o<=u;o++)r[o]=e.get(o,h-1);for(l=h;l<=u;l++){for(s=0,o=h;o<=u;o++)s+=r[o]*i.get(o,l);for(s=s/r[h]/e.get(h,h-1),o=h;o<=u;o++)i.set(o,l,i.get(o,l)+s*r[o])}}}function hqr2(t,e,r,i,n){let s,a,o,l,h,c,u,f,d,m,g,p,w,b,y,_=t-1,M=t-1,x=Number.EPSILON,v=0,S=0,k=0,A=0,E=0,I=0,C=0,D=0;for(s=0;s<t;s++)for((s<0||s>M)&&(r[s]=n.get(s,s),e[s]=0),a=Math.max(s-1,0);a<t;a++)S+=Math.abs(n.get(s,a));for(;_>=0;){for(l=_;l>0&&(I=Math.abs(n.get(l-1,l-1))+Math.abs(n.get(l,l)),0===I&&(I=S),!(Math.abs(n.get(l,l-1))<x*I));)l--;if(l===_)n.set(_,_,n.get(_,_)+v),r[_]=n.get(_,_),e[_]=0,_--,D=0;else if(l===_-1){if(u=n.get(_,_-1)*n.get(_-1,_),k=(n.get(_-1,_-1)-n.get(_,_))/2,A=k*k+u,C=Math.sqrt(Math.abs(A)),n.set(_,_,n.get(_,_)+v),n.set(_-1,_-1,n.get(_-1,_-1)+v),f=n.get(_,_),A>=0){for(C=k>=0?k+C:k-C,r[_-1]=f+C,r[_]=r[_-1],0!==C&&(r[_]=f-u/C),e[_-1]=0,e[_]=0,f=n.get(_,_-1),I=Math.abs(f)+Math.abs(C),k=f/I,A=C/I,E=Math.sqrt(k*k+A*A),k/=E,A/=E,a=_-1;a<t;a++)C=n.get(_-1,a),n.set(_-1,a,A*C+k*n.get(_,a)),n.set(_,a,A*n.get(_,a)-k*C);for(s=0;s<=_;s++)C=n.get(s,_-1),n.set(s,_-1,A*C+k*n.get(s,_)),n.set(s,_,A*n.get(s,_)-k*C);for(s=0;s<=M;s++)C=i.get(s,_-1),i.set(s,_-1,A*C+k*i.get(s,_)),i.set(s,_,A*i.get(s,_)-k*C)}else r[_-1]=f+k,r[_]=f+k,e[_-1]=C,e[_]=-C;_-=2,D=0}else{if(f=n.get(_,_),d=0,u=0,l<_&&(d=n.get(_-1,_-1),u=n.get(_,_-1)*n.get(_-1,_)),10===D){for(v+=f,s=0;s<=_;s++)n.set(s,s,n.get(s,s)-f);I=Math.abs(n.get(_,_-1))+Math.abs(n.get(_-1,_-2)),f=d=.75*I,u=-.4375*I*I}if(30===D&&(I=(d-f)/2,I=I*I+u,I>0)){for(I=Math.sqrt(I),d<f&&(I=-I),I=f-u/((d-f)/2+I),s=0;s<=_;s++)n.set(s,s,n.get(s,s)-I);v+=I,f=d=u=.964}for(D+=1,h=_-2;h>=l&&(C=n.get(h,h),E=f-C,I=d-C,k=(E*I-u)/n.get(h+1,h)+n.get(h,h+1),A=n.get(h+1,h+1)-C-E-I,E=n.get(h+2,h+1),I=Math.abs(k)+Math.abs(A)+Math.abs(E),k/=I,A/=I,E/=I,h!==l)&&!(Math.abs(n.get(h,h-1))*(Math.abs(A)+Math.abs(E))<x*(Math.abs(k)*(Math.abs(n.get(h-1,h-1))+Math.abs(C)+Math.abs(n.get(h+1,h+1)))));)h--;for(s=h+2;s<=_;s++)n.set(s,s-2,0),s>h+2&&n.set(s,s-3,0);for(o=h;o<=_-1&&(b=o!==_-1,o!==h&&(k=n.get(o,o-1),A=n.get(o+1,o-1),E=b?n.get(o+2,o-1):0,f=Math.abs(k)+Math.abs(A)+Math.abs(E),0!==f&&(k/=f,A/=f,E/=f)),0!==f);o++)if(I=Math.sqrt(k*k+A*A+E*E),k<0&&(I=-I),0!==I){for(o!==h?n.set(o,o-1,-I*f):l!==h&&n.set(o,o-1,-n.get(o,o-1)),k+=I,f=k/I,d=A/I,C=E/I,A/=k,E/=k,a=o;a<t;a++)k=n.get(o,a)+A*n.get(o+1,a),b&&(k+=E*n.get(o+2,a),n.set(o+2,a,n.get(o+2,a)-k*C)),n.set(o,a,n.get(o,a)-k*f),n.set(o+1,a,n.get(o+1,a)-k*d);for(s=0;s<=Math.min(_,o+3);s++)k=f*n.get(s,o)+d*n.get(s,o+1),b&&(k+=C*n.get(s,o+2),n.set(s,o+2,n.get(s,o+2)-k*E)),n.set(s,o,n.get(s,o)-k),n.set(s,o+1,n.get(s,o+1)-k*A);for(s=0;s<=M;s++)k=f*i.get(s,o)+d*i.get(s,o+1),b&&(k+=C*i.get(s,o+2),i.set(s,o+2,i.get(s,o+2)-k*E)),i.set(s,o,i.get(s,o)-k),i.set(s,o+1,i.get(s,o+1)-k*A)}}}if(0!==S){for(_=t-1;_>=0;_--)if(k=r[_],A=e[_],0===A)for(l=_,n.set(_,_,1),s=_-1;s>=0;s--){for(u=n.get(s,s)-k,E=0,a=l;a<=_;a++)E+=n.get(s,a)*n.get(a,_);if(e[s]<0)C=u,I=E;else if(l=s,0===e[s]?n.set(s,_,0!==u?-E/u:-E/(x*S)):(f=n.get(s,s+1),d=n.get(s+1,s),A=(r[s]-k)*(r[s]-k)+e[s]*e[s],c=(f*I-C*E)/A,n.set(s,_,c),n.set(s+1,_,Math.abs(f)>Math.abs(C)?(-E-u*c)/f:(-I-d*c)/C)),c=Math.abs(n.get(s,_)),x*c*c>1)for(a=s;a<=_;a++)n.set(a,_,n.get(a,_)/c)}else if(A<0)for(l=_-1,Math.abs(n.get(_,_-1))>Math.abs(n.get(_-1,_))?(n.set(_-1,_-1,A/n.get(_,_-1)),n.set(_-1,_,-(n.get(_,_)-k)/n.get(_,_-1))):(y=cdiv(0,-n.get(_-1,_),n.get(_-1,_-1)-k,A),n.set(_-1,_-1,y[0]),n.set(_-1,_,y[1])),n.set(_,_-1,0),n.set(_,_,1),s=_-2;s>=0;s--){for(m=0,g=0,a=l;a<=_;a++)m+=n.get(s,a)*n.get(a,_-1),g+=n.get(s,a)*n.get(a,_);if(u=n.get(s,s)-k,e[s]<0)C=u,E=m,I=g;else if(l=s,0===e[s]?(y=cdiv(-m,-g,u,A),n.set(s,_-1,y[0]),n.set(s,_,y[1])):(f=n.get(s,s+1),d=n.get(s+1,s),p=(r[s]-k)*(r[s]-k)+e[s]*e[s]-A*A,w=2*(r[s]-k)*A,0===p&&0===w&&(p=x*S*(Math.abs(u)+Math.abs(A)+Math.abs(f)+Math.abs(d)+Math.abs(C))),y=cdiv(f*E-C*m+A*g,f*I-C*g-A*m,p,w),n.set(s,_-1,y[0]),n.set(s,_,y[1]),Math.abs(f)>Math.abs(C)+Math.abs(A)?(n.set(s+1,_-1,(-m-u*n.get(s,_-1)+A*n.get(s,_))/f),n.set(s+1,_,(-g-u*n.get(s,_)-A*n.get(s,_-1))/f)):(y=cdiv(-E-d*n.get(s,_-1),-I-d*n.get(s,_),C,A),n.set(s+1,_-1,y[0]),n.set(s+1,_,y[1]))),c=Math.max(Math.abs(n.get(s,_-1)),Math.abs(n.get(s,_))),x*c*c>1)for(a=s;a<=_;a++)n.set(a,_-1,n.get(a,_-1)/c),n.set(a,_,n.get(a,_)/c)}for(s=0;s<t;s++)if(s<0||s>M)for(a=s;a<t;a++)i.set(s,a,n.get(s,a));for(a=t-1;a>=0;a--)for(s=0;s<=M;s++){for(C=0,o=0;o<=Math.min(a,M);o++)C+=i.get(s,o)*n.get(o,a);i.set(s,a,C)}}}function cdiv(t,e,r,i){let n,s;return Math.abs(r)>Math.abs(i)?(n=i/r,s=r+n*i,[(t+n*e)/s,(e-n*t)/s]):(n=r/i,s=i+n*r,[(n*t+e)/s,(n*e-t)/s])}class CholeskyDecomposition{constructor(t){if(!(t=WrapperMatrix2D.checkMatrix(t)).isSymmetric())throw new Error("Matrix is not symmetric");let e,r,i,n=t,s=n.rows,a=new Matrix(s,s),o=!0;for(r=0;r<s;r++){let t=0;for(i=0;i<r;i++){let s=0;for(e=0;e<i;e++)s+=a.get(i,e)*a.get(r,e);s=(n.get(r,i)-s)/a.get(i,i),a.set(r,i,s),t+=s*s}for(t=n.get(r,r)-t,o&=t>0,a.set(r,r,Math.sqrt(Math.max(t,0))),i=r+1;i<s;i++)a.set(r,i,0)}this.L=a,this.positiveDefinite=Boolean(o)}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=WrapperMatrix2D.checkMatrix(t);let e=this.L,r=e.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(!1===this.isPositiveDefinite())throw new Error("Matrix is not positive definite");let i,n,s,a=t.columns,o=t.clone();for(s=0;s<r;s++)for(n=0;n<a;n++){for(i=0;i<s;i++)o.set(s,n,o.get(s,n)-o.get(i,n)*e.get(s,i));o.set(s,n,o.get(s,n)/e.get(s,s))}for(s=r-1;s>=0;s--)for(n=0;n<a;n++){for(i=s+1;i<r;i++)o.set(s,n,o.get(s,n)-o.get(i,n)*e.get(i,s));o.set(s,n,o.get(s,n)/e.get(s,s))}return o}get lowerTriangularMatrix(){return this.L}}class nipals{constructor(t,e={}){t=WrapperMatrix2D.checkMatrix(t);let{Y:r}=e;const{scaleScores:i=!1,maxIterations:n=1e3,terminationCriteria:s=1e-10}=e;let a;if(r){if(r=Array.isArray(r)&&"number"==typeof r[0]?Matrix.columnVector(r):WrapperMatrix2D.checkMatrix(r),!r.isColumnVector()||r.rows!==t.rows)throw new Error("Y must be a column vector of length X.rows");a=r}else a=t.getColumnVector(0);let o,l,h,c,u=1;for(let e=0;e<n&&u>s;e++)h=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),h=h.div(h.norm()),o=t.mmul(h).div(h.transpose().mmul(h).get(0,0)),e>0&&(u=o.clone().sub(c).pow(2).sum()),c=o.clone(),r?(l=r.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),l=l.div(l.norm()),a=r.mmul(l).div(l.transpose().mmul(l).get(0,0))):a=o;if(r){let e=t.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0));e=e.div(e.norm());let i=t.clone().sub(o.clone().mmul(e.transpose())),n=a.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),s=r.clone().sub(o.clone().mulS(n.get(0,0)).mmul(l.transpose()));this.t=o,this.p=e.transpose(),this.w=h.transpose(),this.q=l,this.u=a,this.s=o.transpose().mmul(o),this.xResidual=i,this.yResidual=s,this.betas=n}else this.w=h.transpose(),this.s=o.transpose().mmul(o).sqrt(),this.t=i?o.clone().div(this.s.get(0,0)):o,this.xResidual=t.sub(o.mmul(h.transpose()))}}var src$4=Object.freeze({__proto__:null,AbstractMatrix:AbstractMatrix,default:Matrix,Matrix:Matrix,wrap:wrap,WrapperMatrix1D:WrapperMatrix1D,WrapperMatrix2D:WrapperMatrix2D,solve:solve,inverse:inverse,determinant:determinant,linearDependencies:linearDependencies,pseudoInverse:pseudoInverse,covariance:covariance,correlation:correlation,SingularValueDecomposition:SingularValueDecomposition,SVD:SingularValueDecomposition,EigenvalueDecomposition:EigenvalueDecomposition,EVD:EigenvalueDecomposition,CholeskyDecomposition:CholeskyDecomposition,CHO:CholeskyDecomposition,LuDecomposition:LuDecomposition,LU:LuDecomposition,QrDecomposition:QrDecomposition,QR:QrDecomposition,Nipals:nipals,NIPALS:nipals,MatrixColumnView:MatrixColumnView,MatrixColumnSelectionView:MatrixColumnSelectionView,MatrixFlipColumnView:MatrixFlipColumnView,MatrixFlipRowView:MatrixFlipRowView,MatrixRowView:MatrixRowView,MatrixRowSelectionView:MatrixRowSelectionView,MatrixSelectionView:MatrixSelectionView,MatrixSubView:MatrixSubView,MatrixTransposeView:MatrixTransposeView});function getSeparatedKernel(t){const e=new SingularValueDecomposition(t,{autoTranspose:!0});if(1!==e.rank)return null;const r=Math.sqrt(e.s[0]);return[e.U.to2DArray().map(t=>t[0]*r),e.V.to2DArray().map(t=>t[0]*r)]}function convolution(t,e={}){let{channels:r,bitDepth:i,normalize:n=!1,divisor:s=1,border:a="copy",algorithm:o="auto"}=e,l={};i&&(l.bitDepth=i);let h,c,u=Image.createFrom(this,l);if(r=validateArrayOfChannels(this,r),"separable"!==o)({kernel:t}=validateKernel(t));else if(!Array.isArray(t)||2!==t.length)throw new RangeError("separable convolution requires two arrays of numbers to represent the kernel");if("auto"===o){let e=getSeparatedKernel(t);null!==e?(o="separable",t=e):o=(t.length>9||t[0].length>9)&&this.width<=4096&&this.height<=4096?"fft":"direct"}"separable"===o?(h=Math.floor(t[0].length/2),c=Math.floor(t[1].length/2)):(h=Math.floor(t.length/2),c=Math.floor(t[0].length/2));let f,d,m,g,p,w,b=u.isClamped,y=new Array(this.height*this.width);for(g=0;g<r.length;g++){for(p=r[g],m=0;m<this.height;m++)for(d=0;d<this.width;d++)f=m*this.width+d,y[f]=this.data[f*this.channels+p];if("direct"===o)w=src$2.direct(y,t,{rows:this.height,cols:this.width,normalize:n,divisor:s});else if("separable"===o){if(w=convolutionSeparable(y,t,this.width,this.height),n){s=0;for(let e=0;e<t[0].length;e++)for(let r=0;r<t[1].length;r++)s+=t[0][e]*t[1][r]}if(1!==s)for(let t=0;t<w.length;t++)w[t]/=s}else w=src$2.fft(y,t,{rows:this.height,cols:this.width,normalize:n,divisor:s});for(m=0;m<this.height;m++)for(d=0;d<this.width;d++)f=m*this.width+d,u.data[f*this.channels+p]=b?clamp(w[f],u):w[f]}if(this.alpha&&!r.includes(this.channels))for(d=this.components;d<this.data.length;d+=this.channels)u.data[d]=this.data[d];return"periodic"!==a&&u.setBorder({size:[c,h],algorithm:a}),u}function gradientFilter(t={}){let{direction:e="xy",border:r="copy",kernelX:i,kernelY:n,channels:s,bitDepth:a=this.bitDepth}=t;switch(this.checkProcessable("gradientFilter",{bitDepth:[8,16]}),e){case"x":if(!i)throw new Error("kernelX option is missing");return convolution.call(this,i,{channels:s,border:r,bitDepth:a});case"y":if(!n)throw new Error("kernelY option is missing");return convolution.call(this,n,{channels:s,border:r,bitDepth:a});case"xy":{if(!i)throw new Error("kernelX option is missing");if(!n)throw new Error("kernelY option is missing");const t=convolution.call(this,i,{channels:s,border:r,bitDepth:32}),e=convolution.call(this,n,{channels:s,border:r,bitDepth:32});return t.hypotenuse(e,{bitDepth:a,channels:s})}default:throw new Error("Unknown parameter direction: "+e)}}function sobelFilter(t){return gradientFilter.call(this,Object.assign({},t,{kernelX:SOBEL_X,kernelY:SOBEL_Y}))}function scharrFilter(t){return gradientFilter.call(this,Object.assign({},t,{kernelX:SCHARR_X,kernelY:SCHARR_Y}))}var newArray_1=newArray$1;function newArray$1(t,e){t=t||0;for(var r=new Array(t),i=0;i<t;i++)r[i]=e;return r}function level(t={}){let{algorithm:e="range",channels:r,min:i=this.min,max:n=this.max}=t;switch(this.checkProcessable("level",{bitDepth:[8,16,32]}),r=validateArrayOfChannels(this,{channels:r}),r.length!==this.channel&&(Array.isArray(i)&&i.length===this.channels&&(i=i.filter((t,e)=>r.includes(e))),Array.isArray(n)&&n.length===this.channels&&(n=n.filter((t,e)=>r.includes(e)))),e){case"range":i<0&&(i=0),n>this.maxValue&&(n=this.maxValue),Array.isArray(i)||(i=newArray_1(r.length,i)),Array.isArray(n)||(n=newArray_1(r.length,n)),processImage(this,i,n,r);break;default:throw new Error("level: algorithm not implement: "+e)}return this}function processImage(t,e,r,i){let n=new Array(i.length);for(let s=0;s<i.length;s++)0===e[s]&&r[s]===t.maxValue||r[s]===e[s]?n[s]=0:n[s]=(t.maxValue+1-1e-5)/(r[s]-e[s]),e[s]+=.499995/n[s];for(let r=0;r<i.length;r++){let s=i[r];if(0!==n[r])for(let i=0;i<t.data.length;i+=t.channels)t.data[i+s]=Math.min(Math.max(0,(t.data[i+s]-e[r])*n[r]+.5|0),t.maxValue)}}var toString$3=Object.prototype.toString,isArrayType=function(t){return"Array"===toString$3.call(t).substr(-6,5)};function checkNumberArray(t){if(isNaN(t)){if(t instanceof Image)return t.data;if(!isArrayType(t))throw new Error("checkNumberArray: the value should be either a number, array or Image");return t}if(t<=0)throw new Error("checkNumberArray: the value must be greater than 0");return t}function add(t,e={}){let{channels:r}=e;if(this.checkProcessable("add",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("add: the data size is different");for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+i]=Math.max(0,Math.min(this.maxValue,this.data[e+i]+t[e+i]>>0))}}else for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+i]=Math.min(this.maxValue,this.data[e+i]+t>>0)}return this}function subtract(t,e={}){let{channels:r}=e;if(this.checkProcessable("subtract",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("subtract: the data size is different");for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+i]=Math.max(0,Math.min(this.maxValue,this.data[e+i]-t[e+i]>>0))}}else for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+i]=Math.max(0,this.data[e+i]-t>>0)}return this}function subtractImage(t,e={}){let{bitDepth:r=this.bitDepth,channels:i,absolute:n=!1}=e;if(this.checkProcessable("subtractImage",{bitDepth:[8,16]}),this.width!==t.width||this.height!==t.height)throw new Error("subtractImage: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("subtractImage: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("subtractImage: both images must have the same number of channels");let s=Image.createFrom(this,{bitDepth:r});i=validateArrayOfChannels(this,{channels:i});for(let e=0;e<i.length;e++)for(let r=i[e];r<this.data.length;r+=this.channels){let e=this.data[r]-t.data[r];s.data[r]=n?Math.abs(e):Math.max(e,0)}return s}function hypotenuse$1(t,e={}){let{bitDepth:r=this.bitDepth,channels:i}=e;if(this.checkProcessable("hypotenuse",{bitDepth:[8,16,32]}),this.width!==t.width||this.height!==t.height)throw new Error("hypotenuse: both images must have the same size");if(this.alpha!==t.alpha||this.bitDepth!==t.bitDepth)throw new Error("hypotenuse: both images must have the same alpha and bitDepth");if(this.channels!==t.channels)throw new Error("hypotenuse: both images must have the same number of channels");let n=Image.createFrom(this,{bitDepth:r});i=validateArrayOfChannels(this,{channels:i});let s=n.isClamped;for(let e=0;e<i.length;e++)for(let r=i[e];r<this.data.length;r+=this.channels){let e=Math.hypot(this.data[r],t.data[r]);n.data[r]=s?Math.min(Math.max(Math.round(e),0),n.maxValue):e}return n}function multiply(t,e={}){let{channels:r}=e;if(this.checkProcessable("multiply",{bitDepth:[8,16]}),t<=0)throw new Error("multiply: the value must be greater than 0");if(r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("multiply: the data size is different");for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+i]=Math.max(0,Math.min(this.maxValue,this.data[e+i]*t[e+i]>>0))}}else for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+i]=Math.min(this.maxValue,this.data[e+i]*t>>0)}return this}function divide(t,e={}){let{channels:r}=e;if(this.checkProcessable("divide",{bitDepth:[8,16]}),r=validateArrayOfChannels(this,{channels:r}),t=checkNumberArray(t),isNaN(t)){if(this.data.length!==t.length)throw new Error("divide: the: the data size is different");for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+i]=Math.max(0,Math.min(this.maxValue,this.data[e+i]/t[e+i]>>0))}}else for(let e=0;e<r.length;e++){let i=r[e];for(let e=0;e<this.data.length;e+=this.channels)this.data[e+i]=Math.min(this.maxValue,this.data[e+i]/t>>0)}return this}class BaseRegression{constructor(){if(new.target===BaseRegression)throw new Error("BaseRegression must be subclassed")}predict(t){if("number"==typeof t)return this._predict(t);if(src$3(t)){const e=[];for(let r=0;r<t.length;r++)e.push(this._predict(t[r]));return e}throw new TypeError("x must be a number or array")}_predict(){throw new Error("_predict must be implemented")}train(){}toString(){return""}toLaTeX(){return""}score(t,e){if(!src$3(t)||!src$3(e)||t.length!==e.length)throw new Error("x and y must be arrays of the same length");const r=t.length,i=new Array(r);for(let e=0;e<r;e++)i[e]=this._predict(t[e]);let n=0,s=0,a=0,o=0,l=0,h=0,c=0;for(let t=0;t<r;t++)n+=i[t],s+=e[t],l+=i[t]*i[t],h+=e[t]*e[t],c+=i[t]*e[t],0!==e[t]&&(a+=(e[t]-i[t])*(e[t]-i[t])/e[t]),o+=(e[t]-i[t])*(e[t]-i[t]);const u=(r*c-n*s)/Math.sqrt((r*l-n*n)*(r*h-s*s));return{r:u,r2:u*u,chi2:a,rmsd:Math.sqrt(o/r)}}}function squaredEuclidean(t,e){let r=0;for(let i=0;i<t.length;i++)r+=(t[i]-e[i])*(t[i]-e[i]);return r}function euclidean(t,e){return Math.sqrt(squaredEuclidean(t,e))}var euclidean$1=Object.freeze({__proto__:null,squaredEuclidean:squaredEuclidean,euclidean:euclidean});const{squaredEuclidean:squaredEuclidean$1}=euclidean$1,defaultOptions$2={sigma:1};class GaussianKernel{constructor(t){t=Object.assign({},defaultOptions$2,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const r=squaredEuclidean$1(t,e);return Math.exp(-r/this.divisor)}}var gaussianKernel=GaussianKernel;const defaultOptions$3={degree:1,constant:1,scale:1};class PolynomialKernel{constructor(t){t=Object.assign({},defaultOptions$3,t),this.degree=t.degree,this.constant=t.constant,this.scale=t.scale}compute(t,e){for(var r=0,i=0;i<t.length;i++)r+=t[i]*e[i];return Math.pow(this.scale*r+this.constant,this.degree)}}var polynomialKernel=PolynomialKernel;const defaultOptions$4={alpha:.01,constant:-Math.E};class SigmoidKernel{constructor(t){t=Object.assign({},defaultOptions$4,t),this.alpha=t.alpha,this.constant=t.constant}compute(t,e){for(var r=0,i=0;i<t.length;i++)r+=t[i]*e[i];return Math.tanh(this.alpha*r+this.constant)}}var sigmoidKernel=SigmoidKernel;const defaultOptions$5={sigma:1,degree:1};class ANOVAKernel{constructor(t){t=Object.assign({},defaultOptions$5,t),this.sigma=t.sigma,this.degree=t.degree}compute(t,e){for(var r=0,i=Math.min(t.length,e.length),n=1;n<=i;++n)r+=Math.pow(Math.exp(-this.sigma*Math.pow(Math.pow(t[n-1],n)-Math.pow(e[n-1],n),2)),this.degree);return r}}var anovaKernel=ANOVAKernel;const{squaredEuclidean:squaredEuclidean$2}=euclidean$1,defaultOptions$6={sigma:1};class CauchyKernel{constructor(t){t=Object.assign({},defaultOptions$6,t),this.sigma=t.sigma}compute(t,e){return 1/(1+squaredEuclidean$2(t,e)/(this.sigma*this.sigma))}}var cauchyKernel=CauchyKernel;const{euclidean:euclidean$2}=euclidean$1,defaultOptions$7={sigma:1};class ExponentialKernel{constructor(t){t=Object.assign({},defaultOptions$7,t),this.sigma=t.sigma,this.divisor=2*t.sigma*t.sigma}compute(t,e){const r=euclidean$2(t,e);return Math.exp(-r/this.divisor)}}var exponentialKernel=ExponentialKernel;class HistogramIntersectionKernel{compute(t,e){for(var r=Math.min(t.length,e.length),i=0,n=0;n<r;++n)i+=Math.min(t[n],e[n]);return i}}var histogramIntersectionKernel=HistogramIntersectionKernel;const{euclidean:euclidean$3}=euclidean$1,defaultOptions$8={sigma:1};class LaplacianKernel{constructor(t){t=Object.assign({},defaultOptions$8,t),this.sigma=t.sigma}compute(t,e){const r=euclidean$3(t,e);return Math.exp(-r/this.sigma)}}var laplacianKernel=LaplacianKernel;const{squaredEuclidean:squaredEuclidean$3}=euclidean$1,defaultOptions$9={constant:1};class MultiquadraticKernel{constructor(t){t=Object.assign({},defaultOptions$9,t),this.constant=t.constant}compute(t,e){return Math.sqrt(squaredEuclidean$3(t,e)+this.constant*this.constant)}}var multiquadraticKernel=MultiquadraticKernel;const{squaredEuclidean:squaredEuclidean$4}=euclidean$1,defaultOptions$a={constant:1};class RationalQuadraticKernel{constructor(t){t=Object.assign({},defaultOptions$a,t),this.constant=t.constant}compute(t,e){const r=squaredEuclidean$4(t,e);return 1-r/(r+this.constant)}}var rationalQuadraticKernel=RationalQuadraticKernel;const{Matrix:Matrix$1,MatrixTransposeView:MatrixTransposeView$1}=src$4,kernelType={gaussian:gaussianKernel,rbf:gaussianKernel,polynomial:polynomialKernel,poly:polynomialKernel,anova:anovaKernel,cauchy:cauchyKernel,exponential:exponentialKernel,histogram:histogramIntersectionKernel,min:histogramIntersectionKernel,laplacian:laplacianKernel,multiquadratic:multiquadraticKernel,rational:rationalQuadraticKernel,sigmoid:sigmoidKernel,mlp:sigmoidKernel};class Kernel{constructor(t,e){if(this.kernelType=t,"linear"!==t)if("string"==typeof t){t=t.toLowerCase();var r=kernelType[t];if(!r)throw new Error("unsupported kernel type: "+t);this.kernelFunction=new r(e)}else{if("object"!=typeof t||"function"!=typeof t.compute)throw new TypeError("first argument must be a valid kernel type or instance");this.kernelFunction=t}}compute(t,e){if(t=Matrix$1.checkMatrix(t),e=void 0===e?t:Matrix$1.checkMatrix(e),"linear"===this.kernelType)return t.mmul(new MatrixTransposeView$1(e));const r=new Matrix$1(t.rows,e.rows);if(t===e)for(let e=0;e<t.rows;e++)for(let i=e;i<t.rows;i++){const n=this.kernelFunction.compute(t.getRow(e),t.getRow(i));r.set(e,i,n),r.set(i,e,n)}else for(let i=0;i<t.rows;i++)for(let n=0;n<e.rows;n++)r.set(i,n,this.kernelFunction.compute(t.getRow(i),e.getRow(n)));return r}}var kernel=Kernel;const defaultOptions$b={lambda:.1,kernelType:"gaussian",kernelOptions:{},computeCoefficient:!1};class KernelRidgeRegression extends BaseRegression{constructor(t,e,r){if(super(),!0===t)this.alpha=e.alpha,this.inputs=e.inputs,this.kernelType=e.kernelType,this.kernelOptions=e.kernelOptions,this.kernel=new kernel(e.kernelType,e.kernelOptions);else{t=Matrix.checkMatrix(t),r=Object.assign({},defaultOptions$b,r);const i=new kernel(r.kernelType,r.kernelOptions),n=i.compute(t),s=t.rows;n.add(Matrix.eye(s,s).mul(r.lambda)),this.alpha=solve(n,e),this.inputs=t,this.kernelType=r.kernelType,this.kernelOptions=r.kernelOptions,this.kernel=i}}_predict(t){return this.kernel.compute([t],this.inputs).mmul(this.alpha).getRow(0)}toJSON(){return{name:"kernelRidgeRegression",alpha:this.alpha,inputs:this.inputs,kernelType:this.kernelType,kernelOptions:this.kernelOptions}}static load(t){if("kernelRidgeRegression"!==t.name)throw new TypeError("not a KRR model");return new KernelRidgeRegression(!0,t)}}var medianQuickselect_min=createCommonjsModule((function(t){!function(){function e(t){for(var e=0,n=t.length-1,s=void 0,a=void 0,o=void 0,l=i(e,n);;){if(n<=e)return t[l];if(n==e+1)return t[e]>t[n]&&r(t,e,n),t[l];for(t[s=i(e,n)]>t[n]&&r(t,s,n),t[e]>t[n]&&r(t,e,n),t[s]>t[e]&&r(t,s,e),r(t,s,e+1),a=e+1,o=n;;){do{a++}while(t[e]>t[a]);do{o--}while(t[o]>t[e]);if(o<a)break;r(t,a,o)}r(t,e,o),o<=l&&(e=a),o>=l&&(n=o-1)}}var r=function(t,e,r){var i;return i=[t[r],t[e]],t[e]=i[0],t[r]=i[1],i},i=function(t,e){return~~((t+e)/2)};t.exports?t.exports=e:window.median=e}()}));function background(t,e,r){const i=new KernelRidgeRegression(t,e,r),n=new Array(this.size);for(let t=0;t<this.width;t++)for(let e=0;e<this.height;e++)n[e*this.width+t]=[t,e];const s=i.predict(n),a=Image.createFrom(this);for(let t=0;t<this.size;t++)a.data[t]=Math.min(this.maxValue,Math.max(0,s[t][0]));return a}function dilate(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("dilate",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("dilate: The number of rows and columns of the kernel must be odd");let i=!0;t:for(const t of e)for(const e of t)if(1!==e){i=!1;break t}let n=this;for(let t=0;t<r;t++)if(1===this.bitDepth)if(i){const t=n.clone();n=dilateOnceBinaryOnlyOnes(n,t,e.length,e[0].length)}else n=dilateOnceBinary(n,Image.createFrom(n),e);else n=i?dilateOnceGreyOnlyOnes(n,Image.createFrom(n),e.length,e[0].length):dilateOnceGrey(n,Image.createFrom(n),e);return n}function dilateOnceGrey(t,e,r){const i=r.length,n=r[0].length;let s=(i-1)/2,a=(n-1)/2;for(let o=0;o<t.height;o++)for(let l=0;l<t.width;l++){let h=0;for(let e=0;e<n;e++)for(let n=0;n<i;n++){if(1!==r[n][e])continue;let i=n-s+l,c=e-a+o;if(i<0||c<0||i>=t.width||c>=t.height)continue;const u=t.getValueXY(i,c,0);u>h&&(h=u)}e.setValueXY(l,o,0,h)}return e}function dilateOnceGreyOnlyOnes(t,e,r,i){const n=(r-1)/2,s=(i-1)/2,a=[];for(let e=0;e<t.width;e++)a.push(0);for(let r=0;r<t.height;r++){for(let e=0;e<t.width;e++){let i=0;for(let n=Math.max(0,r-s);n<Math.min(t.height,r+s+1);n++){const r=t.getValueXY(e,n,0);r>i&&(i=r)}a[e]=i}for(let i=0;i<t.width;i++){let s=0;for(let e=Math.max(0,i-n);e<Math.min(t.width,i+n+1);e++)a[e]>s&&(s=a[e]);e.setValueXY(i,r,0,s)}}return e}function dilateOnceBinary(t,e,r){const i=r.length,n=r[0].length;let s=(i-1)/2,a=(n-1)/2;for(let o=0;o<t.height;o++)for(let l=0;l<t.width;l++){let h=0;t:for(let e=0;e<n;e++)for(let n=0;n<i;n++){if(1!==r[n][e])continue;let i=n-s+l,c=e-a+o;if(!(c<0||i<0||i>=t.width||c>=t.height)&&1===t.getBitXY(i,c)){h=1;break t}}1===h&&e.setBitXY(l,o)}return e}function dilateOnceBinaryOnlyOnes(t,e,r,i){const n=(r-1)/2,s=(i-1)/2,a=[];for(let e=0;e<t.width;e++)a.push(1);for(let r=0;r<t.height;r++){for(let e=0;e<t.width;e++){a[e]=0;for(let i=Math.max(0,r-s);i<Math.min(t.height,r+s+1);i++)if(1===t.getBitXY(e,i)){a[e]=1;break}}for(let i=0;i<t.width;i++)if(1!==e.getBitXY(i,r))for(let s=Math.max(0,i-n);s<Math.min(t.width,i+n+1);s++)if(1===a[s]){e.setBitXY(i,r);break}}return e}function erode(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("erode",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("erode: The number of rows and columns of the kernel must be odd");let i=!0;t:for(const t of e)for(const e of t)if(1!==e){i=!1;break t}let n=this;for(let t=0;t<r;t++)if(1===this.bitDepth)if(i){const t=n.clone();n=erodeOnceBinaryOnlyOnes(n,t,e.length,e[0].length)}else n=erodeOnceBinary(n,Image.createFrom(n),e);else n=i?erodeOnceGreyOnlyOnes(n,Image.createFrom(n),e.length,e[0].length):erodeOnceGrey(n,Image.createFrom(n),e);return n}function erodeOnceGrey(t,e,r){const i=r.length,n=r[0].length;let s=(i-1)/2,a=(n-1)/2;for(let o=0;o<t.height;o++)for(let l=0;l<t.width;l++){let h=t.maxValue;for(let e=0;e<n;e++)for(let n=0;n<i;n++){if(1!==r[n][e])continue;let i=n-s+l,c=e-a+o;if(i<0||c<0||i>=t.width||c>=t.height)continue;const u=t.getValueXY(i,c,0);u<h&&(h=u)}e.setValueXY(l,o,0,h)}return e}function erodeOnceGreyOnlyOnes(t,e,r,i){const n=(r-1)/2,s=(i-1)/2,a=[];for(let e=0;e<t.width;e++)a.push(0);for(let r=0;r<t.height;r++){for(let e=0;e<t.width;e++){let i=t.maxValue;for(let n=Math.max(0,r-s);n<Math.min(t.height,r+s+1);n++){const r=t.getValueXY(e,n,0);r<i&&(i=r)}a[e]=i}for(let i=0;i<t.width;i++){let s=t.maxValue;for(let e=Math.max(0,i-n);e<Math.min(t.width,i+n+1);e++)a[e]<s&&(s=a[e]);e.setValueXY(i,r,0,s)}}return e}function erodeOnceBinary(t,e,r){const i=r.length,n=r[0].length;let s=(i-1)/2,a=(n-1)/2;for(let o=0;o<t.height;o++)for(let l=0;l<t.width;l++){let h=1;t:for(let e=0;e<n;e++)for(let n=0;n<i;n++){if(1!==r[n][e])continue;let i=n-s+l,c=e-a+o;if(!(c<0||i<0||i>=t.width||c>=t.height)&&0===t.getBitXY(i,c)){h=0;break t}}1===h&&e.setBitXY(l,o)}return e}function erodeOnceBinaryOnlyOnes(t,e,r,i){const n=(r-1)/2,s=(i-1)/2,a=[];for(let e=0;e<t.width;e++)a.push(0);for(let r=0;r<t.height;r++){for(let e=0;e<t.width;e++){a[e]=1;for(let i=Math.max(0,r-s);i<Math.min(t.height,r+s+1);i++)if(0===t.getBitXY(e,i)){a[e]=0;break}}for(let i=0;i<t.width;i++)if(0!==e.getBitXY(i,r))for(let s=Math.max(0,i-n);s<Math.min(t.width,i+n+1);s++)if(0===a[s]){e.clearBitXY(i,r);break}}return e}function open(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("open",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("open: The number of rows and columns of the kernel must be odd");let i=this;for(let t=0;t<r;t++)i=i.erode({kernel:e}),i=i.dilate({kernel:e});return i}function close(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("close",{bitDepth:[1,8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("close: The number of rows and columns of the kernel must be odd");let i=this;for(let t=0;t<r;t++)i=i.dilate({kernel:e}).erode({kernel:e});return i}function topHat(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("topHat",{bitDepth:[8,16],components:1,alpha:0}),e.length%2==0||e[0].length%2==0)throw new TypeError("topHat: The number of rows and columns of the kernel must be odd");let i=this;for(let t=0;t<r;t++){let t=i.open({kernel:e});i=t.subtractImage(i,{absolute:!0})}return i}function blackHat(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("blackHat",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("blackHat: The number of rows and columns of the kernel must be odd");let i=this;for(let t=0;t<r;t++){const t=i.close({kernel:e});i=t.subtractImage(i,{absolute:!0})}return i}function morphologicalGradient(t={}){let{kernel:e=[[1,1,1],[1,1,1],[1,1,1]],iterations:r=1}=t;if(this.checkProcessable("morphologicalGradient",{bitDepth:[8,16],components:1,alpha:0}),e.columns%2==0||e.rows%2==0)throw new TypeError("morphologicalGradient: The number of rows and columns of the kernel must be odd");let i=this;for(let t=0;t<r;t++){let t=i.dilate({kernel:e}),r=i.erode({kernel:e});i=t.subtractImage(r,{absolute:!0})}return i}function order4Points(t){let e=0,r=0,i=0,n=0,s=t[0][0],a=0;for(let e=1;e<t.length;e++)t[e][0]<s&&(s=t[e][0],a=e);let o=t[(a+1)%t.length][0],l=(a+1)%t.length;for(let e=1;e<t.length;e++)t[e][0]<o&&e!==a&&(o=t[e][0],l=e);return t[l][1]<t[a][1]?(e=t[l],n=t[a],a!==(l+1)%4?(r=t[(l+1)%4],i=t[(l+2)%4]):(r=t[(l+2)%4],i=t[(l+3)%4])):(n=t[l],e=t[a],l!==(a+1)%4?(r=t[(a+1)%4],i=t[(a+2)%4]):(r=t[(a+2)%4],i=t[(a+3)%4])),[e,r,i,n]}function distance2Points(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function crossVect(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function dotVect(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function computeWidthAndHeigth(t,e,r,i,n,s){let a=Math.max(distance2Points(t,e),distance2Points(i,r)),o=Math.max(distance2Points(t,i),distance2Points(e,r)),l=0,h=0,c=Math.ceil(n/2),u=Math.ceil(s/2),f=a/o,d=[t[0],t[1],1],m=[e[0],e[1],1],g=[i[0],i[1],1],p=[r[0],r[1],1],w=dotVect(crossVect(d,p),g)/dotVect(crossVect(m,p),g),b=dotVect(crossVect(d,p),m)/dotVect(crossVect(g,p),m),y=[w*m[0]-d[0],w*m[1]-d[1],w*m[2]-d[2]],_=[b*g[0]-d[0],b*g[1]-d[1],b*g[2]-d[2]],M=y[0],x=y[1],v=y[2],S=_[0],k=_[1],A=_[2],E=1/(v*A)*(M*S-(M*A+v*S)*c+v*A*c*c+(x*k-(x*A+v*k)*u+v*A*u*u));E=E>=0?Math.sqrt(E):Math.sqrt(-E);let I=new Matrix([[E,0,c],[0,E,u],[0,0,1]]),C=inverse(I.transpose()),D=inverse(I),T=Matrix.rowVector(y),R=Matrix.rowVector(_),P=Math.sqrt(dotVect(T.mmul(C).mmul(D).to1DArray(),y)/dotVect(R.mmul(C).mmul(D).to1DArray(),_));return 0===P||0===f?(l=Math.ceil(a),h=Math.ceil(o)):P<f?(l=Math.ceil(a),h=Math.ceil(l/P)):(h=Math.ceil(o),l=Math.ceil(P*h)),[l,h]}function projectionPoint(t,e,r,i,n,s,a,o,l,h,c,u){let[f,d]=[(r*t+i*e+n)/(l*t+h*e+1),(s*t+a*e+o)/(l*t+h*e+1)];return c.getValueXY(Math.floor(f),Math.floor(d),u)}function warpingFourPoints(t,e={}){let{calculateRatio:r=!0}=e;if(4!==t.length)throw new Error(`The array pts must have four elements, which are the four corners. Currently, pts have ${t.length} elements`);let i,n,[s,a,o,l]=t,h=[s,a,o,l],[c,u,f,d]=order4Points(h);r?[i,n]=computeWidthAndHeigth(c,u,f,d,this.width,this.height):(i=Math.ceil(Math.max(distance2Points(c,u),distance2Points(d,f))),n=Math.ceil(Math.max(distance2Points(c,d),distance2Points(u,f))));let m=Image.createFrom(this,{width:i,height:n}),[g,p]=c,[w,b]=u,[y,_]=f,[M,x]=d,[v,S]=[0,0],[k,A]=[0,i-1],[E,I]=[n-1,i-1],[C,D]=[n-1,0],T=new Matrix([[v,S,1,0,0,0,-v*g,-S*g],[k,A,1,0,0,0,-k*w,-A*w],[E,I,1,0,0,0,-E*y,-S*y],[C,D,1,0,0,0,-C*M,-D*M],[0,0,0,v,S,1,-v*p,-S*p],[0,0,0,k,A,1,-k*b,-A*b],[0,0,0,E,I,1,-E*_,-I*_],[0,0,0,C,D,1,-C*x,-D*x]]),R=Matrix.columnVector([g,w,y,M,p,b,_,x]),P=new SingularValueDecomposition(T).solve(R),[B,O,L,N,F,U,$,V]=P.to1DArray(),z=new Matrix(n,i);for(let t=0;t<this.channels;t++){for(let e=0;e<n;e++)for(let r=0;r<i;r++)z.set(e,r,projectionPoint(e,r,B,O,L,N,F,U,$,V,this,t));m.setMatrix(z,{channel:t})}return m}function crop(t={}){let{x:e=0,y:r=0,width:i=this.width-e,height:n=this.height-r}=t;if(this.checkProcessable("max",{bitDepth:[8,16]}),e=Math.round(e),r=Math.round(r),i=Math.round(i),n=Math.round(n),e>this.width-1||r>this.height-1)throw new RangeError(`crop: origin (x:${e}, y:${r}) out of range (${this.width-1}; ${this.height-1})`);if(i<=0||n<=0)throw new RangeError(`crop: width and height (width:${i}; height:${n}) must be positive numbers`);if(e<0||r<0)throw new RangeError(`crop: x and y (x:${e}, y:${r}) must be positive numbers`);if(i>this.width-e||n>this.height-r)throw new RangeError(`crop: (x: ${e}, y:${r}, width:${i}, height:${n}) size is out of range`);let s=Image.createFrom(this,{width:i,height:n,position:[e,r]}),a=i*this.channels,o=r+n,l=0,h=e*this.channels;for(let t=r;t<o;t++){let e=t*this.width*this.channels+h,r=e+a;for(;e<r;e++)s.data[l++]=this.data[e]}return s}function cropAlpha(t={}){this.checkProcessable("cropAlpha",{alpha:1});const{threshold:e=this.maxValue}=t;let r=findLeft(this,e,this.components);if(-1===r)throw new Error("Could not find new dimensions. Threshold may be too high.");let i=findTop(this,e,this.components,r),n=findBottom(this,e,this.components,r),s=findRight(this,e,this.components,r,i,n);return this.crop({x:r,y:i,width:s-r+1,height:n-i+1})}function findLeft(t,e,r){for(let i=0;i<t.width;i++)for(let n=0;n<t.height;n++)if(t.getValueXY(i,n,r)>=e)return i;return-1}function findTop(t,e,r,i){for(let n=0;n<t.height;n++)for(let s=i;s<t.width;s++)if(t.getValueXY(s,n,r)>=e)return n;return-1}function findBottom(t,e,r,i){for(let n=t.height-1;n>=0;n--)for(let s=i;s<t.width;s++)if(t.getValueXY(s,n,r)>=e)return n;return-1}function findRight(t,e,r,i,n,s){for(let a=t.width-1;a>=i;a--)for(let i=n;i<=s;i++)if(t.getValueXY(a,i,r)>=e)return a;return-1}function getFactor(t){if("string"==typeof t){const e=t[t.length-1];t=parseFloat(t),"%"===e&&(t/=100)}return t}function getThreshold(t,e){if(!e)throw Error("getThreshold : the maxValue should be specified");if("string"==typeof t){if("%"!==t[t.length-1])throw Error("getThreshold : if the value is a string it must finish by %");return parseFloat(t)/100*e}if("number"==typeof t)return t<1?t*e:t;throw Error("getThreshold : the value is not valid")}function factorDimensions(t,e,r){t=getFactor(t);let i=Math.round(t*e),n=Math.round(t*r);return i<=0&&(i=1),n<=0&&(n=1),{width:i,height:n}}function checkRow(t,e){if(e<0||e>=t.height)throw new RangeError(`row must be included between 0 and ${t.height-1}. Current value: ${e}`)}function checkColumn(t,e){if(e<0||e>=t.width)throw new RangeError(`column must be included between 0 and ${t.width-1}. Current value: ${e}`)}function checkChannel(t,e){if(e<0||e>=t.channels)throw new RangeError(`channel must be included between 0 and ${t.channels-1}. Current value: ${e}`)}const validInterpolations={nearestneighbor:"nearestNeighbor",nearestneighbour:"nearestNeighbor",bilinear:"bilinear"};function checkInterpolation(t){if("string"!=typeof t)throw new TypeError("interpolation must be a string");if(t=t.toLowerCase(),!validInterpolations[t])throw new RangeError("invalid interpolation algorithm: "+t);return validInterpolations[t]}function nearestNeighbor(t,e,r){const i=this.width/e,n=this.height/r;if(this.bitDepth>1)for(let s=0;s<e;s++){const e=Math.floor((s+.5)*i);for(let i=0;i<r;i++){const r=Math.floor((i+.5)*n);for(let n=0;n<this.channels;n++)t.setValueXY(s,i,n,this.getValueXY(e,r,n))}}else for(let s=0;s<e;s++){const e=Math.floor((s+.5)*i);for(let i=0;i<r;i++){const r=Math.floor((i+.5)*n);this.getBitXY(e,r)&&t.setBitXY(s,i)}}}function resize(t={}){const{factor:e=1,interpolation:r=validInterpolations.nearestneighbor,preserveAspectRatio:i=!0}=t,n=checkInterpolation(r);let s=t.width,a=t.height;if(s||(s=a&&i?Math.round(a*(this.width/this.height)):this.width),a||(a=i?Math.round(s*(this.height/this.width)):this.height),({width:s,height:a}=factorDimensions(e,s,a)),s===this.width&&a===this.height){const t=this.clone();return t.position=[0,0],t}let o=Math.round((this.width-s)/2),l=Math.round((this.height-a)/2);const h=Image.createFrom(this,{width:s,height:a,position:[o,l]});switch(n){case validInterpolations.nearestneighbor:nearestNeighbor.call(this,h,s,a);break;default:throw new Error("unsupported resize interpolation: "+n)}return h}function hsv(){this.checkProcessable("hsv",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB]});let t=Image.createFrom(this,{colorModel:HSV}),e=0,r=this.data;for(let i=0;i<r.length;i+=this.channels){let n=r[i],s=r[i+1],a=r[i+2],o=Math.min(n,s,a),l=Math.max(n,s,a),h=l-o,c=0,u=0===l?0:h/l,f=l;if(l!==o){switch(l){case n:c=(s-a)/h+(s<a?6:0);break;case s:c=(a-n)/h+2;break;case a:c=(n-s)/h+4;break;default:throw new Error("unreachable")}c/=6}t.data[e++]=c*this.maxValue,t.data[e++]=u*this.maxValue,t.data[e++]=f,this.alpha&&(t.data[e++]=r[i+3])}return t}function hsl(){this.checkProcessable("hsl",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB]});let t=Image.createFrom(this,{colorModel:HSL}),e=Math.floor(this.maxValue/2),r=0,i=this.data;for(let n=0;n<i.length;n+=this.channels){let s=i[n],a=i[n+1],o=i[n+2],l=Math.max(s,a,o),h=Math.min(s,a,o),c=0,u=0,f=(l+h)/2;if(l!==h){let t=l-h;switch(u=f>e?t/(2-l-h):t/(l+h),l){case s:c=(a-o)/t+(a<o?6:0);break;case a:c=(o-s)/t+2;break;case o:c=(s-a)/t+4;break;default:throw new Error("unreachable")}c/=6}t.data[r++]=c*this.maxValue,t.data[r++]=u*this.maxValue,t.data[r++]=f,this.alpha&&(t.data[r++]=i[n+3])}return t}function cmyk(){this.checkProcessable("cmyk",{bitDepth:[8,16],alpha:[0,1],colorModel:[RGB]});let t=Image.createFrom(this,{components:4,colorModel:CMYK}),e=0,r=this.data;for(let i=0;i<r.length;i+=this.channels){let n=r[i],s=r[i+1],a=r[i+2],o=Math.min(this.maxValue-n,this.maxValue-s,this.maxValue-a),l=(this.maxValue-n-o)/(1-o/this.maxValue),h=(this.maxValue-s-o)/(1-o/this.maxValue),c=(this.maxValue-a-o)/(1-o/this.maxValue);t.data[e++]=Math.round(l),t.data[e++]=Math.round(h),t.data[e++]=Math.round(c),t.data[e++]=Math.round(o),this.alpha&&(t.data[e++]=r[i+3])}return t}function rgba8(){return new Image(this.width,this.height,this.getRGBAData(),{kind:"RGBA",parent:this})}const methods={luma709:(t,e,r)=>6966*t+23436*e+2366*r>>15,luma601:(t,e,r)=>9798*t+19235*e+3735*r>>15,maximum:(t,e,r)=>Math.max(t,e,r),minimum:(t,e,r)=>Math.min(t,e,r),average:(t,e,r)=>(t+e+r)/3>>0,minmax:(t,e,r)=>(Math.max(t,e,r)+Math.min(t,e,r))/2,red:t=>t,green:(t,e)=>e,blue:(t,e,r)=>r,cyan(t,e,r,i){let n=methods.black(t,e,r,i);return(i.maxValue-t-n)/(1-n/i.maxValue)>>0},magenta(t,e,r,i){let n=methods.black(t,e,r,i);return(i.maxValue-e-n)/(1-n/i.maxValue)>>0},yellow(t,e,r,i){let n=methods.black(t,e,r,i);return(i.maxValue-r-n)/(1-n/i.maxValue)>>0},black:(t,e,r,i)=>Math.min(i.maxValue-t,i.maxValue-e,i.maxValue-r),hue(t,e,r,i){let n=methods.min(t,e,r),s=methods.max(t,e,r);if(s===n)return 0;let a=0,o=s-n;switch(s){case t:a=(e-r)/o+(e<r?6:0);break;case e:a=(r-t)/o+2;break;case r:a=(t-e)/o+4;break;default:throw new Error("unreachable")}return a/6*i.maxValue>>0},saturation(t,e,r,i){let n=methods.min(t,e,r),s=methods.max(t,e,r);return 0===s?0:(s-n)/s*i.maxValue},lightness(t,e,r){let i=methods.min(t,e,r);return(methods.max(t,e,r)+i)/2}};Object.defineProperty(methods,"luminosity",{enumerable:!1,value:methods.lightness}),Object.defineProperty(methods,"luminance",{enumerable:!1,value:methods.lightness}),Object.defineProperty(methods,"min",{enumerable:!1,value:methods.minimum}),Object.defineProperty(methods,"max",{enumerable:!1,value:methods.maximum}),Object.defineProperty(methods,"brightness",{enumerable:!1,value:methods.maximum});const names={};function grey(t={}){let{algorithm:e="luma709",keepAlpha:r=!1,mergeAlpha:i=!0}=t;if("string"!=typeof e&&"function"!=typeof e)throw new TypeError("algorithm must be a string or a function");this.checkProcessable("grey",{bitDepth:[8,16],alpha:[0,1]}),1===this.components&&(e="red"),r&=this.alpha,i&=this.alpha,r&&(i=!1);let n,s=getOutputImage(this,t,{components:1,alpha:r,colorModel:GREY});if("function"==typeof e)n=e;else if(n=methods[e.toLowerCase()],!n)throw new Error("unsupported grey algorithm: "+e);let a=0;for(let t=0;t<this.data.length;t+=this.channels)i?s.data[a++]=clamp(n(this.data[t],this.data[t+1],this.data[t+2],this)*this.data[t+this.components]/this.maxValue,this):(s.data[a++]=clamp(n(this.data[t],this.data[t+1],this.data[t+2],this),this),s.alpha&&(s.data[a++]=this.data[t+this.components]));return s}function huang(t){let e=0;for(let r=0;r<t.length;r++)if(0!==t[r]){e=r;break}let r=t.length-1;for(let i=t.length-1;i>=e;i--)if(0!==t[i]){r=i;break}let i=1/(r-e),n=new Array(t.length),s=0,a=0;for(let r=e;r<t.length;r++)s+=r*t[r],a+=t[r],n[r]=s/a;let o=new Array(t.length);s=a=0;for(let e=r;e>0;e--)s+=e*t[e],a+=t[e],o[e-1]=s/a;let l=-1,h=Number.MAX_VALUE;for(let e=0;e<t.length;e++){let r,s=0;for(let a=0;a<=e;a++)r=1/(1+i*Math.abs(a-n[e])),r<1e-6||r>.999999||(s+=t[a]*(-r*Math.log(r)-(1-r)*Math.log(1-r)));for(let n=e+1;n<t.length;n++)r=1/(1+i*Math.abs(n-o[e])),r<1e-6||r>.999999||(s+=t[n]*(-r*Math.log(r)-(1-r)*Math.log(1-r)));s<h&&(h=s,l=e)}return l}function intermodes(t){let e=t.slice(),r=0;for(;!bimodalTest(e);){let i=0,n=0,s=e[0];for(let r=0;r<t.length-1;r++)i=n,n=s,s=e[r+1],e[r]=(i+n+s)/3;if(e[t.length-1]=(n+s)/3,r++,r>1e4)throw new Error("Intermodes Threshold not found after 10000 iterations")}let i=0;for(let r=1;r<t.length-1;r++)e[r-1]<e[r]&&e[r+1]<e[r]&&(i+=r);return Math.floor(i/2)}function bimodalTest(t){let e=!1,r=0;for(let e=1;e<t.length-1;e++)if(t[e-1]<t[e]&&t[e+1]<t[e]&&(r++,r>2))return!1;return 2===r&&(e=!0),e}function isodata(t){let e,r,i,n,s=0;for(let e=1;e<t.length;e++)if(t[e]>0){s=e+1;break}for(;;){e=0,i=0;for(let r=0;r<s;r++)i+=t[r],e+=t[r]*r;n=0,r=0;for(let e=s+1;e<t.length;e++)r+=t[e],n+=t[e]*e;if(i>0&&r>0&&(e/=i,n/=r,s===Math.round((e+n)/2)))break;if(s++,s>t.length-2)throw new Error("Threshold not found")}return s}function li(t,e){let r,i,n,s,a,o,l,h,c,u,f,d;f=.5,u=0;for(let e=0;e<t.length;e++)u+=e*t[e];u/=e,l=u;do{o=l,r=o+.5|0,i=0,s=0;for(let e=0;e<=r;e++)i+=e*t[e],s+=t[e];h=0===s?0:i/s,n=0,a=0;for(let e=r+1;e<t.length;e++)n+=e*t[e],a+=t[e];c=0===a?0:n/a,d=(h-c)/(Math.log(h)-Math.log(c)),l=d<-Number.EPSILON?d-.5|0:d+.5|0}while(Math.abs(l-o)>.5);return r}function maxEntropy(t,e){let r=new Array(t.length);for(let i=0;i<t.length;i++)r[i]=t[i]/e;let i=new Array(t.length),n=new Array(t.length);i[0]=r[0],n[0]=1-i[0];for(let e=1;e<t.length;e++)i[e]=i[e-1]+r[e],n[e]=1-i[e];let s=0;for(let e=0;e<t.length;e++)if(Math.abs(i[e])>=Number.EPSILON){s=e;break}let a=t.length-1;for(let e=t.length-1;e>=s;e--)if(Math.abs(n[e])>=Number.EPSILON){a=e;break}let o,l,h,c=-1,u=Number.MIN_VALUE;for(let e=s;e<=a;e++){l=0;for(let n=0;n<=e;n++)0!==t[n]&&(l-=r[n]/i[e]*Math.log(r[n]/i[e]));h=0;for(let i=e+1;i<t.length;i++)0!==t[i]&&(h-=r[i]/n[e]*Math.log(r[i]/n[e]));o=l+h,u<o&&(u=o,c=e)}return c}function mean$1(t,e){let r=0;for(let e=0;e<t.length;e++)r+=e*t[e];return Math.floor(r/e)}function minError(t,e){let r,i,n,s,a,o,l,h,c,u,f,d,m=-2,g=0;for(let e=0;e<t.length;e++)g+=e*t[e];for(g/=e,r=g;r!==m;){let e=sumA(t,r),g=sumA(t,t.length-1),p=sumB(t,r),w=sumB(t,t.length-1),b=sumC(t,r);if(i=p/e,n=(w-p)/(g-e),s=e/g,a=(g-e)/g,o=b/e-i*i,l=(sumC(t,t.length-1)-b)/(g-e)-n*n,h=1/o-1/l,c=i/o-n/l,u=i*i/o-n*n/l+Math.log10(o*(a*a)/(l*(s*s))),f=c*c-h*u,f<0)return r;m=r,d=(c+Math.sqrt(f))/h,r=isNaN(d)?m:Math.floor(d)}return r}function sumA(t,e){let r=0;for(let i=0;i<=e;i++)r+=t[i];return r}function sumB(t,e){let r=0;for(let i=0;i<=e;i++)r+=i*t[i];return r}function sumC(t,e){let r=0;for(let i=0;i<=e;i++)r+=i*i*t[i];return r}function minimum(t){if(t.length<2)return 0;let e=0,r=-1,i=-1,n=new Array(t.length);for(let e=0;e<t.length;e++)n[e]=t[e],t[e]>0&&(i=e);for(;!bimodalTest$1(n);)if(n=smoothed(n),e++,e>1e4)return r;return r=minimumBetweenPeeks(n,i),r}function smoothed(t){let e=new Array(t.length);for(let r=1;r<t.length-1;r++)e[r]=(t[r-1]+t[r]+t[r+1])/3;return e[0]=(t[0]+t[1])/3,e[t.length-1]=(t[t.length-2]+t[t.length-1])/3,e}function minimumBetweenPeeks(t,e){let r;for(let i=1;i<e;i++)if(t[i-1]>t[i]&&t[i+1]>=t[i]){r=i;break}return r}function bimodalTest$1(t){let e=t.length,r=!1,i=0;for(let r=1;r<e-1;r++)if(t[r-1]<t[r]&&t[r+1]<t[r]&&(i++,i>2))return!1;return 2===i&&(r=!0),r}function moments(t,e){let r,i,n,s,a,o,l=0,h=0,c=0,u=0,f=-1,d=t.length,m=new Array(d);for(let r=0;r<d;r++)m[r]=t[r]/e;for(let t=0;t<d;t++)l+=t*m[t],h+=t*t*m[t],c+=t*t*t*m[t];i=1*h-l*l,n=(-h*h+l*c)/i,s=(1*-c+h*l)/i,a=.5*(-s-Math.sqrt(s*s-4*n)),o=.5*(-s+Math.sqrt(s*s-4*n)),r=(o-l)/(o-a);for(let t=0;t<d;t++)if(u+=m[t],u>r){f=t;break}return f}function otsu(t,e){let r=0,i=0,n=0,s=0,a=0;for(let e=0;e<t.length;e++)a+=e*t[e];for(let o=0;o<t.length;o++){i+=t[o];const l=e-i;if(0===i||0===l)continue;r+=o*t[o];const h=(a-r)/l,c=i*l*(r/i-h)*(r/i-h);c>=n&&(s=o,n=c)}return s}function percentile(t){let e=-1,r=new Array(t.length),i=partialSum(t,t.length-1),n=1;for(let s=0;s<t.length;s++)r[s]=Math.abs(partialSum(t,s)/i-.5),r[s]<n&&(n=r[s],e=s);return e}function partialSum(t,e){let r=0;for(let i=0;i<=e;i++)r+=t[i];return r}function renyiEntropy(t,e){let r,i,n,s=new Array(t.length),a=new Array(t.length),o=new Array(t.length),l=0,h=0,c=0,u=0,f=0,d=0;for(let r=0;r<t.length;r++)s[r]=t[r]/e;a[0]=s[0],o[0]=1-a[0];for(let e=1;e<t.length;e++)a[e]=a[e-1]+s[e],o[e]=1-a[e];i=0;for(let e=0;e<t.length;e++)if(Math.abs(a[e])>=Number.EPSILON){i=e;break}n=t.length-1;for(let e=t.length-1;e>=i;e--)if(Math.abs(o[e])>=Number.EPSILON){n=e;break}for(let e=i;e<=n;e++){let r=0,i=0,n=0;for(let o=0;o<=e;o++)0!==t[o]&&(r-=s[o]/a[e]*Math.log(s[o]/a[e])),i+=Math.sqrt(s[o]/a[e]),n+=s[o]*s[o]/(a[e]*a[e]);let m=0,g=0,p=0;for(let r=e+1;r<t.length;r++)0!==t[r]&&(m-=s[r]/o[e]*Math.log(s[r]/o[e])),g+=Math.sqrt(s[r]/o[e]),p+=s[r]*s[r]/(o[e]*o[e]);let w=r+m,b=2*(i*g>0?Math.log(i*g):0),y=-1*(n*p>0?Math.log(n*p):0);w>u&&(u=w,l=e),b>f&&(f=b,h=e),y>d&&(d=y,c=e)}let m,g=[l,h,c];g.sort(ascending),m=Math.abs(g[0]-g[1])<=5?Math.abs(g[1]-g[2])<=5?[1,2,1]:[0,1,3]:Math.abs(g[1]-g[2])<=5?[3,1,0]:[1,2,1];let p=a[g[2]]-a[g[0]];return r=Math.round(g[0]*(a[g[0]]+.25*p*m[0])+.25*g[1]*p*m[1]+g[2]*(o[g[2]]+.25*p*m[2])),r}function shanbhag(t,e){let r=new Array(t.length);for(let i=0;i<t.length;i++)r[i]=t[i]/e;let i=new Array(t.length),n=new Array(t.length);i[0]=r[0],n[0]=1-i[0];for(let e=1;e<t.length;e++)i[e]=i[e-1]+r[e],n[e]=1-i[e];let s=0;for(let e=0;e<t.length;e++)if(Math.abs(i[e])>=Number.EPSILON){s=e;break}let a=t.length-1;for(let e=t.length-1;e>=s;e--)if(Math.abs(n[e])>=Number.EPSILON){a=e;break}let o,l,h,c,u=-1,f=Number.MAX_VALUE;for(let e=s;e<=a;e++){h=0,o=.5/i[e];for(let t=1;t<=e;t++)h-=r[t]*Math.log(1-o*i[t-1]);h*=o,c=0,o=.5/n[e];for(let i=e+1;i<t.length;i++)c-=r[i]*Math.log(1-o*n[i]);c*=o,l=Math.abs(h-c),l<f&&(f=l,u=e)}return u}function triangle(t){let e=0,r=0,i=0,n=0;for(let r=0;r<t.length;r++)if(t[r]>0){e=r;break}e>0&&e--;for(let e=t.length-1;e>0;e--)if(t[e]>0){n=e;break}n<t.length-1&&n++;for(let e=0;e<t.length;e++)t[e]>r&&(i=e,r=t[e]);let s,a,o,l=!1;if(i-e<n-i){l=!0;let r=0,s=t.length-1;for(;r<s;){let e=t[r];t[r]=t[s],t[s]=e,r++,s--}e=t.length-1-n,i=t.length-1-i}if(e===i)return e;s=t[i],a=e-i,o=Math.sqrt(s*s+a*a),s/=o,a/=o,o=s*e+a*t[e];let h=e,c=0;for(let r=e+1;r<=i;r++){let e=s*r+a*t[r]-o;e>c&&(h=r,c=e)}if(h--,l){let e=0,r=t.length-1;for(;e<r;){let i=t[e];t[e]=t[r],t[r]=i,e++,r--}return t.length-1-h}return h}function yen(t,e){let r=new Array(t.length);for(let i=0;i<t.length;i++)r[i]=t[i]/e;let i=new Array(t.length);i[0]=r[0];for(let e=1;e<t.length;e++)i[e]=i[e-1]+r[e];let n=new Array(t.length);n[0]=r[0]*r[0];for(let e=1;e<t.length;e++)n[e]=n[e-1]+r[e]*r[e];let s=new Array(t.length);s[t.length-1]=0;for(let e=t.length-2;e>=0;e--)s[e]=s[e+1]+r[e+1]*r[e+1];let a,o=-1,l=Number.MIN_VALUE;for(let e=0;e<t.length;e++)a=-1*(n[e]*s[e]>0?Math.log(n[e]*s[e]):0)+2*(i[e]*(1-i[e])>0?Math.log(i[e]*(1-i[e])):0),a>l&&(l=a,o=e);return o}Object.keys(methods).forEach(t=>{names[t]=t});const methods$1={huang:huang,intermodes:intermodes,isodata:isodata,li:li,maxentropy:maxEntropy,mean:mean$1,minerror:minError,minimum:minimum,moments:moments,otsu:otsu,percentile:percentile,renyientropy:renyiEntropy,shanbhag:shanbhag,triangle:triangle,yen:yen},names$1={};function getThreshold$1(t={}){let{algorithm:e=names$1.otsu}=t;this.checkProcessable("getThreshold",{components:1,bitDepth:[8,16]});let r=methods$1[e.toLowerCase()];if(r)return r(this.getHistogram(),this.size);throw new Error("unknown thresholding algorithm: "+e)}Object.keys(methods$1).forEach(t=>{names$1[t]=t});const THRESHOLD="threshold";function mask(t={}){let{algorithm:e=THRESHOLD,threshold:r=.5,useAlpha:i=!0,invert:n=!1}=t;this.checkProcessable("mask",{components:1,bitDepth:[8,16]}),r=e===THRESHOLD?getThreshold(r,this.maxValue):getThreshold$1.call(this,t);let s=new Image(this.width,this.height,{kind:"BINARY",parent:this}),a=0;if(this.alpha&&i)for(let t=0;t<this.data.length;t+=this.channels){let e=this.data[t]+(this.maxValue-this.data[t])*(this.maxValue-this.data[t+1])/this.maxValue;(n&&e<=r||!n&&e>=r)&&s.setBit(a),a++}else for(let t=0;t<this.data.length;t+=this.channels)(n&&this.data[t]<=r||!n&&this.data[t]>=r)&&s.setBit(a),a++;return s}function copyImage(t,e,r,i){let n=t.width,s=t.height,a=e.width,o=t.channels;for(let l=0;l<n;l++)for(let h=0;h<s;h++)for(let s=0;s<o;s++){let c=(h*n+l)*o+s,u=((i+h)*a+r+l)*o+s;e.data[u]=t.data[c]}}function pad(t={}){let{size:e=0,algorithm:r="copy",color:i}=t;if(this.checkProcessable("pad",{bitDepth:[8,16]}),"set"===r){if(i.length!==this.channels)throw new Error("pad: the color array must have the same length as the number of channels. Here: "+this.channels);for(let t=0;t<i.length;t++)0===i[t]&&(i[t]=.001)}else i=newArray_1(this.channels,null);Array.isArray(e)||(e=[e,e]);let n=this.width+2*e[0],s=this.height+2*e[1],a=this.channels,o=Image.createFrom(this,{width:n,height:s});copyImage(this,o,e[0],e[1]);for(let t=e[0];t<n-e[0];t++)for(let r=0;r<a;r++){let l=i[r]||o.data[(e[1]*n+t)*a+r];for(let i=0;i<e[1];i++)o.data[(i*n+t)*a+r]=l;l=i[r]||o.data[((s-e[1]-1)*n+t)*a+r];for(let i=s-e[1];i<s;i++)o.data[(i*n+t)*a+r]=l}for(let t=0;t<s;t++)for(let r=0;r<a;r++){let s=i[r]||o.data[(t*n+e[0])*a+r];for(let i=0;i<e[0];i++)o.data[(t*n+i)*a+r]=s;s=i[r]||o.data[(t*n+n-e[0]-1)*a+r];for(let i=n-e[0];i<n;i++)o.data[(t*n+i)*a+r]=s}return o}function colorDepth(t=8){if(this.checkProcessable("colorDepth",{bitDepth:[1,8,16]}),![8,16].includes(t))throw Error("You need to specify the new colorDepth as 8 or 16");if(this.bitDepth===t)return this.clone();let e=Image.createFrom(this,{bitDepth:t});switch(t){case 8:if(1===this.bitDepth)for(let t=0;t<this.size;t++)this.getBit(t)&&(e.data[t]=255);else for(let t=0;t<this.data.length;t++)e.data[t]=this.data[t]>>8;break;case 16:if(1===this.bitDepth)for(let t=0;t<this.size;t++)this.getBit(t)&&(e.data[t]=65535);else for(let t=0;t<this.data.length;t++)e.data[t]=this.data[t]<<8|this.data[t];break;default:throw new Error("colorDepth conversion unexpected case")}return e}function rotateFree(t,e={}){const{interpolation:r=validInterpolations.nearestneighbor,width:i=this.width,height:n=this.height}=e;if("number"!=typeof t)throw new TypeError("degrees must be a number");const s=checkInterpolation(r),a=t*Math.PI/180,o=Math.floor(Math.abs(i*Math.cos(a))+Math.abs(n*Math.sin(a))),l=Math.floor(Math.abs(n*Math.cos(a))+Math.abs(i*Math.sin(a))),h=Image.createFrom(this,{width:o,height:l}),c=Math.cos(-a),u=Math.sin(-a);let f=o/2,d=l/2;o%2==0?(f-=.5,l%2==0?d-=.5:d=Math.floor(d)):(f=Math.floor(f),l%2==0?d-=.5:d=Math.floor(d));const m=Math.floor(i/2-f),g=Math.floor(n/2-d);switch(s){case validInterpolations.nearestneighbor:return rotateNearestNeighbor(this,h,m,g,f,d,c,u);case validInterpolations.bilinear:return rotateBilinear(this,h,m,g,f,d,c,u);default:throw new Error("unsupported rotate interpolation: "+s)}}function rotateNearestNeighbor(t,e,r,i,n,s,a,o){for(let l=0;l<e.width;l+=1)for(let h=0;h<e.height;h+=1)for(let c=0;c<t.channels;c++){let u=Math.round((l-n)*a-(h-s)*o+n)+r,f=Math.round((h-s)*a+(l-n)*o+s)+i;u<0||u>=t.width||f<0||f>=t.height?1===t.alpha&&c===t.channels-1?e.setValueXY(l,h,c,0):e.setValueXY(l,h,c,t.maxValue):e.setValueXY(l,h,c,t.getValueXY(u,f,c))}return e}function rotateBilinear(t,e,r,i,n,s,a,o){let l=t.width*t.channels;for(let h=0;h<e.height;h++)for(let c=0;c<e.width;c++){let u=(c-n)*a-(h-s)*o+n+r,f=(h-s)*a+(c-n)*o+s+i,d=0|u,m=0|f,g=u-d,p=f-m;for(let r=0;r<t.channels;r++)if(u<0||u>=t.width||f<0||f>=t.height)1===t.alpha&&r===t.channels-1?e.setValueXY(c,h,r,0):e.setValueXY(c,h,r,t.maxValue);else{let i=(m*t.width+d)*t.channels+r,n=t.data[i],s=t.data[i+t.channels],a=t.data[i+l],o=n+g*(s-n)+p*(a-n)+g*p*(n-s-a+t.data[i+l+t.channels])|0;e.setValueXY(c,h,r,o)}}return e}function rotate(t,e){if("number"!=typeof t)throw new TypeError("angle must be a number");switch(t<0&&(t=360*Math.ceil(-t/360)+t),t%360){case 0:return this.clone();case 90:return rotateRight.call(this);case 180:return rotate180.call(this);case 270:return rotateLeft.call(this);default:return rotateFree.call(this,t,e)}}function rotateLeft(){const t=Image.createFrom(this,{width:this.height,height:this.width}),e=t.height-1;for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)for(let n=0;n<this.channels;n++)t.setValueXY(r,e-i,n,this.getValueXY(i,r,n));return t}function rotateRight(){const t=Image.createFrom(this,{width:this.height,height:this.width}),e=t.width-1;for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++)for(let n=0;n<this.channels;n++)t.setValueXY(e-r,i,n,this.getValueXY(i,r,n));return t}function rotate180(){const t=Image.createFrom(this),e=t.width-1,r=t.height-1;for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)for(let s=0;s<this.channels;s++)t.setValueXY(e-n,r-i,s,this.getValueXY(n,i,s));return t}function insert(t,e={}){const r=getImageParameters(t);this.checkProcessable("insert",r);let{x:i=0,y:n=0}=e;const s=getOutputImageOrInPlace(this,e,{copy:!0}),a=Math.min(s.height,n+t.height),o=Math.min(s.width,i+t.width);if(1===s.bitDepth)for(let e=n;e<a;e++)for(let r=i;r<o;r++)t.getBitXY(r-i,e-n)?s.setBitXY(r,e):s.clearBitXY(r,e);else for(let e=n;e<a;e++)for(let r=i;r<o;r++)s.setPixelXY(r,e,t.getPixelXY(r-i,e-n));return s}function setBorder(t={}){let{size:e=0,algorithm:r="copy",color:i}=t;if(this.checkProcessable("setBorder",{bitDepth:[8,16,32,64]}),"set"===r){if(i.length!==this.channels)throw new Error("setBorder: the color array must have the same length as the number of channels. Here: "+this.channels);for(let t=0;t<i.length;t++)0===i[t]&&(i[t]=.001)}else i=newArray_1(this.channels,null);Array.isArray(e)||(e=[e,e]);let n=e[0],s=e[1],a=this.channels;for(let t=n;t<this.width-n;t++)for(let e=0;e<a;e++){let r=i[e]||this.data[(t+this.width*s)*a+e];for(let i=0;i<s;i++)this.data[(i*this.width+t)*a+e]=r;r=i[e]||this.data[(t+this.width*(this.height-s-1))*a+e];for(let i=this.height-s;i<this.height;i++)this.data[(i*this.width+t)*a+e]=r}for(let t=0;t<this.height;t++)for(let e=0;e<a;e++){let r=i[e]||this.data[(t*this.width+n)*a+e];for(let i=0;i<n;i++)this.data[(t*this.width+i)*a+e]=r;r=i[e]||this.data[(t*this.width+this.width-n-1)*a+e];for(let i=this.width-n;i<this.width;i++)this.data[(t*this.width+i)*a+e]=r}return this}function split(t={}){let{preserveAlpha:e=!0}=t;if(this.checkProcessable("split",{bitDepth:[8,16]}),1===this.components)return new Stack([this.clone()]);let r=new Stack,i=this.data;if(this.alpha&&e)for(let t=0;t<this.components;t++){let e=Image.createFrom(this,{components:1,alpha:!0,colorModel:GREY}),n=0;for(let r=0;r<i.length;r+=this.channels)e.data[n++]=i[r+t],e.data[n++]=i[r+this.components];r.push(e)}else for(let t=0;t<this.channels;t++){let e=Image.createFrom(this,{components:1,alpha:!1,colorModel:GREY}),n=0;for(let r=0;r<i.length;r+=this.channels)e.data[n++]=i[r+t];r.push(e)}return r}function getChannel(t,e={}){let{keepAlpha:r=!1,mergeAlpha:i=!1}=e;r&=this.alpha,i&=this.alpha,this.checkProcessable("getChannel",{bitDepth:[8,16]}),t=validateChannel(this,t);let n=Image.createFrom(this,{components:1,alpha:r,colorModel:GREY}),s=0;for(let e=0;e<this.data.length;e+=this.channels)i?n.data[s++]=this.data[e+t]*this.data[e+this.components]/this.maxValue:(n.data[s++]=this.data[e+t],r&&(n.data[s++]=this.data[e+this.components]));return n}function combineChannels(t=defaultCombineMethod,e={}){let{mergeAlpha:r=!1,keepAlpha:i=!1}=e;r&=this.alpha,i&=this.alpha,this.checkProcessable("combineChannels",{bitDepth:[8,16]});let n=Image.createFrom(this,{components:1,alpha:i,colorModel:GREY}),s=0;for(let e=0;e<this.size;e++){let a=t(this.getPixel(e));r?n.data[s++]=a*this.data[e*this.channels+this.components]/this.maxValue:(n.data[s++]=a,i&&(n.data[s++]=this.data[e*this.channels+this.components]))}return n}function defaultCombineMethod(t){return(t[0]+t[1]+t[2])/3}function setChannel(t,e){if(this.checkProcessable("setChannel",{bitDepth:[8,16]}),e.checkProcessable("setChannel (image parameter check)",{bitDepth:[this.bitDepth],alpha:[0],components:[1]}),e.width!==this.width||e.height!==this.height)throw new Error("Images must have exactly the same width and height");let r=t=validateChannel(this,t);for(let t=0;t<e.data.length;t++)this.data[r]=e.data[t],r+=this.channels;return this}function getSimilarity(t,e={}){let{shift:r=[0,0],average:i,channels:n,defaultAlpha:s,normalize:a,border:o=[0,0]}=e;if(this.checkProcessable("getSimilarity",{bitDepth:[8,16]}),Array.isArray(o)||(o=[o,o]),n=validateArrayOfChannels(this,{channels:n,defaultAlpha:s}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");void 0===i&&(i=!0);let l=Math.max(o[0],-r[0]),h=Math.min(this.width-o[0],this.width-r[0]),c=Math.max(o[1],-r[1]),u=Math.min(this.height-o[1],this.height-r[1]),f=newArray_1(n.length,0);for(let e=0;e<n.length;e++){let i=n[e],s=a?this.sum[i]:Math.max(this.sum[i],t.sum[i]),o=a?t.sum[i]:Math.max(this.sum[i],t.sum[i]);if(0!==s&&0!==o)for(let n=l;n<h;n++)for(let a=c;a<u;a++){let l=n*this.multiplierX+a*this.multiplierY+i,h=l+r[0]*this.multiplierX+r[1]*this.multiplierY;f[e]+=Math.min(this.data[l]/s,t.data[h]/o)}}return i?f.reduce((t,e)=>t+e)/f.length:f}function getPixelsGrid(t={}){let{sampling:e=[10,10],painted:r=!1,mask:i}=t;this.checkProcessable("getPixelsGrid",{bitDepth:[8,16],channels:1}),Array.isArray(e)||(e=[e,e]);const n=e[0],s=e[1],a=[],o=[],l=this.width/n,h=this.height/s;let c=Math.floor(l/2);for(let t=0;t<n;t++){let t=Math.floor(h/2);for(let e=0;e<s;e++){let e=Math.round(c),r=Math.round(t);i&&!i.getBitXY(e,r)||(a.push([e,r]),o.push(this.getPixelXY(e,r))),t+=h}c+=l}const u={xyS:a,zS:o};return r&&(u.painted=this.rgba8().paintPoints(a)),u}function Matrix$2(t,e,r){const i=new Array(t);for(let r=0;r<t;r++)i[r]=new Array(e);if(r)for(let n=0;n<t;n++)for(let t=0;t<e;t++)i[n][t]=r;return i.width=t,i.height=e,Object.setPrototypeOf(i,Matrix$2.prototype),i}function getBestMatch(t,e={}){let{border:r}=e;if(this.checkProcessable("getChannel",{bitDepth:[8,16]}),this.bitDepth!==t.bitDepth)throw new Error("Both images must have the same bitDepth");if(this.channels!==t.channels)throw new Error("Both images must have the same number of channels");if(this.colorModel!==t.colorModel)throw new Error("Both images must have the same colorModel");let i=new Matrix$2(t.width,t.height,-1/0),n=Math.floor(t.width/2),s=Math.floor(t.height/2),a=n,o=s,l=!1;for(;!l;){let e=i.localSearch(n,s,-1/0);for(let n=0;n<e.length;n++){let s=e[n],l=this.getSimilarity(t,{border:r,shift:[a-s[0],o-s[1]]});i[s[0]][s[1]]=l}let h=i.localMax(n,s);h.position[0]!==n||h.position[1]!==s?(n=h.position[0],s=h.position[1]):l=!0}return[n-a,s-o]}function getRow(t,e=0){this.checkProcessable("getRow",{bitDepth:[8,16]}),checkRow(this,t),checkChannel(this,e);let r=new Array(this.width),i=0,n=t*this.width*this.channels+e,s=n+this.width*this.channels;for(let t=n;t<s;t+=this.channels)r[i++]=this.data[t];return r}function getColumn(t,e=0){this.checkProcessable("getColumn",{bitDepth:[8,16]}),checkColumn(this,t),checkChannel(this,e);let r=new Array(this.height),i=0,n=this.width*this.channels;for(let s=e+t*this.channels;s<this.data.length;s+=n)r[i++]=this.data[s];return r}function getMatrix(t={}){let{channel:e}=t;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),void 0===e){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");e=0}let r=new Matrix(this.height,this.width);for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)r.set(t,i,this.getValueXY(i,t,e));return r}function setMatrix(t,e={}){t=new Matrix(t);let{channel:r}=e;if(this.checkProcessable("getMatrix",{bitDepth:[8,16]}),void 0===r){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}if(this.width!==t.columns||this.height!==t.rows)throw new RangeError("The size of the matrix must be equal to the size of the image");for(let e=0;e<this.height;e++)for(let i=0;i<this.width;i++)this.setValueXY(i,e,r,t.get(e,i))}function getPixelsArray(){this.checkProcessable("getPixelsArray",{bitDepth:[8,16,32]});let t=new Array(this.size),e=0;for(let r=0;r<this.data.length;r+=this.channels){let i=new Array(this.components);for(let t=0;t<this.components;t++)i[t]=this.data[r+t];t[e++]=i}return t}function getIntersection(t){let e=this,r=e.getClosestCommonParent(t),i=e.getRelativePosition(r,{defaultFurther:!0}),n=getRelativePositionForAllPixels(e,i),s=t.getRelativePosition(r,{defaultFurther:!0}),a=getRelativePositionForAllPixels(t,s),o=getCommonSurface(n,a),l={whitePixelsMask1:[],whitePixelsMask2:[],commonWhitePixels:[]};for(let r=0;r<o.length;r++){let n=o[r],a=[n[0]-i[0],n[1]-i[1]],h=[n[0]-s[0],n[1]-s[1]],c=e.getBitXY(a[0],a[1]),u=t.getBitXY(h[0],h[1]);1===c&&1===u&&l.commonWhitePixels.push(n)}for(let t=0;t<n.length;t++){let r,i;0!==t&&(r=Math.floor(t/e.width),i=t%e.width),1===e.getBitXY(r,i)&&l.whitePixelsMask1.push(n[t])}for(let e=0;e<a.length;e++){let r=0,i=0;0!==e&&(r=Math.floor(e/t.width),i=e%t.width),1===t.getBitXY(r,i)&&l.whitePixelsMask2.push(a[e])}return l}function getRelativePositionForAllPixels(t,e){let r=[];for(let i=0;i<t.height;i++)for(let n=0;n<t.width;n++){let t=[i,n];r.push([t[0]+e[0],t[1]+e[1]])}return r}function getCommonSurface(t,e){let r=0,i=0,n=[];for(;r<t.length&&i<e.length;)t[r][0]===e[i][0]&&t[r][1]===e[i][1]?(n.push(t[r]),r++,i++):t[r][0]<e[i][0]||t[r][0]===e[i][0]&&t[r][1]<e[i][1]?r++:i++;return n}function getClosestCommonParent(t){let e,r=getDepth(this),i=getDepth(t);if(e=r>=i?getFurthestParent(this,r):getFurthestParent(t,i),0===r||0===i)return e;let n=this,s=t;for(;r!==i;)if(r>i){if(n=n.parent,null===n)return e;r-=1}else{if(s=s.parent,null===s)return e;i-=1}for(;n!==s&&null!==n&&null!==s;)if(n=n.parent,s=s.parent,null===n||null===s)return e;return n!==s?e:n}function getDepth(t){let e=0,r=t;for(;null!=r.parent;)r=r.parent,e++;return e}function getFurthestParent(t,e){let r=t;for(;e>0;)r=r.parent,e-=1;return r}Matrix$2.prototype.localMin=function(t,e){let r=this[t][e],i=[t,e];for(let n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(let t=Math.max(0,e-1);t<Math.min(this[0].length,e+2);t++)this[n][t]<r&&(r=this[n][t],i=[n,t]);return{position:i,value:r}},Matrix$2.prototype.localMax=function(t,e){let r=this[t][e],i=[t,e];for(let n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(let t=Math.max(0,e-1);t<Math.min(this[0].length,e+2);t++)this[n][t]>r&&(r=this[n][t],i=[n,t]);return{position:i,value:r}},Matrix$2.prototype.localSearch=function(t,e,r){let i=[];for(let n=Math.max(0,t-1);n<Math.min(this.length,t+2);n++)for(let t=Math.max(0,e-1);t<Math.min(this[0].length,e+2);t++)this[n][t]===r&&i.push([n,t]);return i};const defaultOptions$c={lowThreshold:10,highThreshold:30,gaussianBlur:1.1},Gx=[[-1,0,1],[-2,0,2],[-1,0,1]],Gy=[[-1,-2,-1],[0,0,0],[1,2,1]],convOptions={bitDepth:32,mode:"periodic"};function cannyEdgeDetector(t,e){t.checkProcessable("Canny edge detector",{bitDepth:8,channels:1,components:1}),e=Object.assign({},defaultOptions$c,e);const r=t.width,i=t.height,n=t.maxValue,s={sigma:e.gaussianBlur,radius:3},a=t.gaussianFilter(s),o=a.convolution(Gy,convOptions),l=a.convolution(Gx,convOptions),h=l.hypotenuse(o),c=t.constructor,u=new c(r,i,{kind:"GREY",bitDepth:32}),f=new c(r,i,{kind:"GREY",bitDepth:32}),d=new c(r,i,{kind:"GREY"});for(var m=1;m<r-1;m++)for(var g=1;g<i-1;g++){var p=(Math.round(Math.atan2(l.getValueXY(m,g,0),o.getValueXY(m,g,0))*(5/Math.PI))+5)%5;0===p&&(h.getValueXY(m,g,0)<=h.getValueXY(m,g-1,0)||h.getValueXY(m,g,0)<=h.getValueXY(m,g+1,0))||1===p&&(h.getValueXY(m,g,0)<=h.getValueXY(m-1,g+1,0)||h.getValueXY(m,g,0)<=h.getValueXY(m+1,g-1,0))||2===p&&(h.getValueXY(m,g,0)<=h.getValueXY(m-1,g,0)||h.getValueXY(m,g,0)<=h.getValueXY(m+1,g,0))||3===p&&(h.getValueXY(m,g,0)<=h.getValueXY(m-1,g-1,0)||h.getValueXY(m,g,0)<=h.getValueXY(m+1,g+1,0))||u.setValueXY(m,g,0,h.getValueXY(m,g,0))}for(m=0;m<r*i;++m){var w=u.data[m],b=0;w>e.highThreshold&&(b++,d.data[m]=n),w>e.lowThreshold&&b++,f.data[m]=b}var y=[];for(m=1;m<r-1;++m)for(g=1;g<i-1;++g)if(1===f.getValueXY(m,g,0))t:for(var _=m-1;_<m+2;++_)for(var M=g-1;M<g+2;++M)if(2===f.getValueXY(_,M,0)){y.push([m,g]),d.setValueXY(m,g,0,n);break t}for(;y.length>0;){var x=[];for(m=0;m<y.length;++m)for(g=-1;g<2;++g)for(_=-1;_<2;++_)if(0!==g||0!==_){var v=y[m][0]+g,S=y[m][1]+_;1===f.getValueXY(v,S,0)&&0===d.getValueXY(v,S,0)&&(x.push([v,S]),d.setValueXY(v,S,0,n))}y=x}return d}function cannyEdge(t){return cannyEdgeDetector(this,t)}function extract(t,e={}){let{position:r}=e;if(this.checkProcessable("extract",{bitDepth:[1,8,16]}),!r&&(r=t.getRelativePosition(this),!r))throw new Error("extract : can not extract an image because the relative position can not be determined, try to specify manually the position as an array of 2 elements [x,y].");if(this.bitDepth>1){let e=Image.createFrom(this,{width:t.width,height:t.height,alpha:1,position:r,parent:this});for(let i=0;i<t.width;i++)for(let n=0;n<t.height;n++){for(let t=0;t<this.channels;t++){let s=this.getValueXY(i+r[0],n+r[1],t);e.setValueXY(i,n,t,s)}t.getBitXY(i,n)||e.setValueXY(i,n,this.components,0)}return e}{let e=Image.createFrom(this,{width:t.width,height:t.height,position:r,parent:this});for(let i=0;i<t.height;i++)for(let n=0;n<t.width;n++)t.getBitXY(n,i)&&this.getBitXY(n+r[0],i+r[1])&&e.setBitXY(n,i);return e}}var fastList=createCommonjsModule((function(t,e){!function(){function e(t,e,r){this.next=r,r&&(r.prev=this),this.prev=e,e&&(e.next=this),this.data=t}function r(){if(!(this instanceof r))return new r;this._head=null,this._tail=null,this.length=0}r.prototype={push:function(t){this._tail=new e(t,this._tail,null),this._head||(this._head=this._tail),this.length++},pop:function(){if(0!==this.length){var t=this._tail;return this._tail=t.prev,t.prev&&(t.prev=this._tail.next=null),this.length--,1===this.length?this._head=this._tail:0===this.length&&(this._head=this._tail=null),t.data}},unshift:function(t){this._head=new e(t,null,this._head),this._tail||(this._tail=this._head),this.length++},shift:function(){if(0!==this.length){var t=this._head;return this._head=t.next,t.next&&(t.next=this._head.prev=null),this.length--,1===this.length?this._tail=this._head:0===this.length&&(this._head=this._tail=null),t.data}},item:function(t){t<0&&(t=this.length+t);for(var e=this._head;t-- >0&&e;)e=e.next;return e?e.data:void 0},slice:function(t,e){if(t||(t=0),e||(e=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e===t)return[];if(e<t)throw new Error("invalid offset: "+t+","+e+" (length="+this.length+")");for(var r=e-t,i=new Array(r),n=0,s=this._head;t-- >0&&s;)s=s.next;for(;n<r&&s;)i[n++]=s.data,s=s.next;return i},drop:function(){r.call(this)},forEach:function(t,e){for(var r=this._head,i=0,n=this.length;i<n&&r;)t.call(e||this,r.data,i,this),r=r.next,i++},map:function(t,e){var i=new r;return this.forEach((function(r,n,s){i.push(t.call(e||s,r,n,s))})),i},filter:function(t,e){var i=new r;return this.forEach((function(r,n,s){t.call(e||s,r,n,s)&&i.push(r)})),i},reduce:function(t,e,r){var i=0,n=this._head,s=this.length;for(e||(i=1,e=n&&n.data,n=n&&n.next);i<s&&n;)e=t.call(r||this,e,n.data,this),i++,n=n.next;return e}},t.exports=r}()}));function floodFill(t={}){const{x:e=0,y:r=0,inPlace:i=!0}=t,n=i?this:Image.createFrom(this);if(this.checkProcessable("floodFill",{bitDepth:1}),this.getBitXY(e,r))return n;const s=new fastList;for(s.push(new Node(e,r));s.length>0;){const t=s.shift();n.setBitXY(t.x,t.y);for(let e=t.x+1;e<this.width&&!n.getBitXY(e,t.y)&&!this.getBitXY(e,t.y);e++)n.setBitXY(e,t.y),t.y+1<this.height&&!this.getBitXY(e,t.y+1)&&s.push(new Node(e,t.y+1)),t.y-1>=0&&!this.getBitXY(e,t.y-1)&&s.push(new Node(e,t.y-1));for(let e=t.x-1;e>=0&&!n.getBitXY(e,t.y)&&!this.getBitXY(e,t.y);e++)n.setBitXY(e,t.y),t.y+1<this.height&&!this.getBitXY(e,t.y+1)&&s.push(new Node(e,t.y+1)),t.y-1>=0&&!this.getBitXY(e,t.y-1)&&s.push(new Node(e,t.y-1))}return n}function Node(t,e){this.x=t,this.y=e}function hsv2rgb(t,e,r){var i=[],n=(r/=100)*(e/=100),s=t/60,a=n*(1-Math.abs(s%2-1)),o=r-n;switch(parseInt(s,10)){case 0:i=[n,a,0];break;case 1:i=[a,n,0];break;case 2:i=[0,n,a];break;case 3:i=[0,a,n];break;case 4:i=[a,0,n];break;case 5:i=[n,0,a]}return{r:Math.round(255*(i[0]+o)),g:Math.round(255*(i[1]+o)),b:Math.round(255*(i[2]+o))}}function hsl2hsv(t,e,r){return{h:t,s:2*(e*=(r<50?r:100-r)/100)/(r+e)*100,v:r+e}}function hsl2rgb(t,e,r){var i=hsl2hsv(t,e,r);return hsv2rgb(i.h,i.s,i.v)}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable})))),i.forEach((function(e){_defineProperty(t,e,r[e])}))}return t}var colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]};function parse(t){return named(t)||hex3(t)||hex6(t)||rgb(t)||rgba$1(t)||hsl$1(t)||hsla(t)}function named(t){var e=colors[t.toLowerCase()];if(e)return{r:e[0],g:e[1],b:e[2],a:100}}function rgb(t){var e=t.match(/rgb\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100}}}function rgba$1(t){var e=t.match(/rgba\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */).map(Number);return{r:r[0],g:r[1],b:r[2],a:100*r[3]}}}function hex6(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:100}}function hex3(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:100}}function hsl$1(t){var e=t.match(/hsl\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */);return _objectSpread({},hsl2rgb(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)),{a:100})}}function hsla(t){var e=t.match(/hsla\(([^)]+)\)/);if(e){var r=e[1].split(/ *, */),i=parseInt(r[0],10),n=parseInt(r[1],10),s=parseInt(r[2],10),a=parseInt(100*parseFloat(r[3]),10);return _objectSpread({},hsl2rgb(i,n,s),{a:a})}}function css2array(t){let e=parse(t);return[e.r,e.g,e.b,Math.round(255*e.a/100)]}function hue2rgb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function hsl2rgb$1(t,e,r){let i,n,s,a,o,l;return r/=100,0==(e/=100)?a=o=l=255*r:(n=r<=.5?r*(e+1):r+e-r*e,i=2*r-n,s=t/360,a=hue2rgb(i,n,s+1/3),o=hue2rgb(i,n,s),l=hue2rgb(i,n,s-1/3)),{r:a,g:o,b:l}}function getDistinctColors(t){let e=new Array(t),r=0;for(let i=0;i<360;i+=360/t){r++;let t=hsl2rgb$1(i,100,30+r%4*15);e[r-1]=[Math.round(255*t.r),Math.round(255*t.g),Math.round(255*t.b)]}return e}function getRandomColor(){return[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())]}function getColors(t){let{color:e,colors:r,randomColors:i,numberColors:n=50}=t;if(e&&!Array.isArray(e)&&(e=css2array(e)),e)return[e];if(r)return r=r.map((function(t){return Array.isArray(t)?t:css2array(t)})),r;if(i){r=new Array(n);for(let t=0;t<n;t++)r[t]=getRandomColor()}return getDistinctColors(n)}function paintLabels(t,e,r={}){let{color:i="blue",colors:n,font:s="12px Helvetica",rotate:a=0}=r;if(this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB}),!Array.isArray(t))throw Error("paintLabels: labels must be an array");if(!Array.isArray(e))throw Error("paintLabels: positions must be an array");if(i&&!Array.isArray(i)&&(i=css2array(i)),n=n?n.map((function(t){return Array.isArray(t)?t:css2array(t)})):[i],t.length!==e.length)throw Error("paintLabels: positions and labels must be arrays from the same size");Array.isArray(s)||(s=[s]),Array.isArray(a)||(a=[a]);let o=this.getCanvas().getContext("2d");for(let r=0;r<t.length;r++){o.save();let i=n[r%n.length];o.fillStyle=`rgba(${i[0]},${i[1]},${i[2]},${i[3]/this.maxValue})`,o.font=s[r%s.length];let l=e[r];o.translate(l[0],l[1]),o.rotate(a[r%a.length]/180*Math.PI),o.fillText(t[r],0,0),o.restore()}return this.data=Uint8Array.from(o.getImageData(0,0,this.width,this.height).data),this}function paintMasks(t,e={}){let{alpha:r=255,labels:i=[],labelsPosition:n=[],labelColor:s="blue",labelFont:a="12px Helvetica"}=e;this.checkProcessable("paintMasks",{channels:[3,4],bitDepth:[8,16],colorModel:RGB});let o=getColors(Object.assign({},e,{numberColors:t.length}));Array.isArray(t)||(t=[t]);for(let e=0;e<t.length;e++){let i=t[e],n=o[e%o.length];for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++)if(i.getBitXY(t,e))for(let s=0;s<Math.min(this.components,n.length);s++)if(255===r)this.setValueXY(t+i.position[0],e+i.position[1],s,n[s]);else{let a=this.getValueXY(t+i.position[0],e+i.position[1],s);a=Math.round((a*(255-r)+n[s]*r)/255),this.setValueXY(t+i.position[0],e+i.position[1],s,a)}}if(Array.isArray(i)&&i.length>0){let e=this.getCanvas().getContext("2d");e.fillStyle=s,e.font=a;for(let r=0;r<Math.min(t.length,i.length);r++){let s=n[r]?n[r]:t[r].position;e.fillText(i[r],s[0],s[1])}this.data=Uint8Array.from(e.getImageData(0,0,this.width,this.height).data)}return this}function zerosMatrix(t,e){let r=new Array(t);for(let i=0;i<t;i++)r[i]=new Array(e).fill(0);return r}const cross=[[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0]],smallCross=[[0,1,0],[1,1,1],[0,1,0]];class Shape{constructor(t={}){let{kind:e="cross",shape:r,size:i,width:n,height:s,filled:a=!0}=t;if(i&&(n=i,s=i),r)switch(r.toLowerCase()){case"square":case"rectangle":this.matrix=rectangle(n,s,{filled:a});break;case"circle":case"ellipse":this.matrix=ellipse(n,s,{filled:a});break;case"triangle":this.matrix=triangle$1(n,s,{filled:a});break;default:throw new Error("Shape: unexpected shape: "+r)}else{if(!e)throw new Error("Shape: expected a kind or a shape option");switch(e.toLowerCase()){case"cross":this.matrix=cross;break;case"smallcross":this.matrix=smallCross;break;default:throw new Error("Shape: unexpected kind: "+e)}}this.height=this.matrix.length,this.width=this.matrix[0].length,this.halfHeight=this.height/2>>0,this.halfWidth=this.width/2>>0}getPoints(){let t=this.matrix,e=[];for(let r=0;r<t.length;r++)for(let i=0;i<t[0].length;i++)t[r][i]&&e.push([i-this.halfWidth,r-this.halfHeight]);return e}getMask(){let t=new Image(this.width,this.height,{kind:BINARY});for(let e=0;e<this.matrix.length;e++)for(let r=0;r<this.matrix[0].length;r++)this.matrix[e][r]&&t.setBitXY(r,e);return t}}function rectangle(t,e,r){const i=zerosMatrix(e,t);if(r.filled)for(let r=0;r<e;r++)for(let e=0;e<t;e++)i[r][e]=1;else{for(let r of[0,e-1])for(let e=0;e<t;e++)i[r][e]=1;for(let r=0;r<e;r++)for(let e of[0,t-1])i[r][e]=1}return i}function ellipse(t,e,r){const i=zerosMatrix(e,t);let n=1-e%2,s=1-t%2,a=Math.floor((t-1)/2),o=Math.floor((e-1)/2),l=a*a,h=o*o;if(r.filled)for(let e=0;e<=o;e++)for(let r=a-Math.floor(Math.sqrt(l-l*e*e/h));r<=a;r++)i[o-e][r]=1,i[o+e+n][r]=1,i[o-e][t-r-1]=1,i[o+e+n][t-r-1]=1;else{for(let e=0;e<=o;e++){let r=a-Math.floor(Math.sqrt(l-l*e*e/h));i[o-e][r]=1,i[o+e+n][r]=1,i[o-e][t-r-1]=1,i[o+e+n][t-r-1]=1}for(let t=0;t<=a;t++){let r=o-Math.floor(Math.sqrt(h-h*t*t/l));i[r][a-t]=1,i[r][a+t+s]=1,i[e-r-1][a-t]=1,i[e-r-1][a+t+s]=1}}return i}function triangle$1(t,e,r){if(!r.filled)throw new Error("Non filled triangle is not implemented");const i=zerosMatrix(e,t);for(let r=0;r<e;r++){let n=Math.floor((1-r/e)*t/2);for(let e=n;e<t-n;e++)i[r][e]=1}return i}function paintPoints(t,e={}){let{shape:r}=e;this.checkProcessable("paintPoints",{bitDepth:[8,16]});let i=getColors(Object.assign({},e,{numberColors:t.length})),n=new Shape(r).getPoints(),s=Math.min(this.channels,i[0].length);for(let e=0;e<t.length;e++){let r=i[e%i.length],a=t[e][0],o=t[e][1];for(let t=0;t<n.length;t++){let e=n[t][0],i=n[t][1];if(a+e>=0&&o+i>=0&&a+e<this.width&&o+i<this.height){let t=(a+e+(o+i)*this.width)*this.channels;for(let e=0;e<s;e++)this.data[t+e]=r[e]}}}return this}function paintPolyline(t,e={}){let{color:r=[this.maxValue,0,0],closed:i=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]});let n=Math.min(this.channels,r.length);for(let e=0;e<t.length-1+i;e++){let i=t[e],s=t[(e+1)%t.length],a=s[0]-i[0],o=s[1]-i[1],l=Math.max(Math.abs(a),Math.abs(o)),h=a/l,c=o/l,u=i[0],f=i[1];for(let t=0;t<=l;t++){let t=Math.round(u),e=Math.round(f);if(t>=0&&e>=0&&t<this.width&&e<this.height)if(1===this.bitDepth)this.setBitXY(t,e);else{let i=(t+e*this.width)*this.channels;for(let t=0;t<n;t++)this.data[i+t]=r[t]}u+=h,f+=c}}return this}function paintPolylines(t,e={}){let r=Object.assign({},e);this.checkProcessable("paintPolylines",{bitDepth:[8,16]});let i=getColors(Object.assign({},e,{numberColors:t.length}));for(let e=0;e<t.length;e++)r.color=i[e%i.length],this.paintPolyline(t[e],r);return this}function paintPolygon(t,e={}){let{color:r=[this.maxValue,0,0],filled:i=!1}=e;this.checkProcessable("paintPoints",{bitDepth:[1,8,16]}),e.closed=!0;let n=deleteDouble(t);if(!1===i)return this.paintPolyline(t,e);{let i=Array(this.height);for(let t=0;t<this.height;t++){i[t]=[];for(let e=0;e<this.width;e++)i[t].push(0)}for(let t=0;t<n.length;t++){const e=lineBetweenTwoPoints(n[t],n[(t+1)%n.length]);for(let t=0;t<this.height;t++)for(let r=0;r<this.width;r++)isAtTheRightOfTheLine(r,t,e,this.height)&&(i[t][r]=0===i[t][r]?1:0)}for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)if(1===i[t][e])if(1===this.bitDepth)this.setBitXY(e,t);else{let i=Math.min(this.channels,r.length),n=(e+t*this.width)*this.channels;for(let t=0;t<i;t++)this.data[n+t]=r[t]}return this.paintPolyline(t,e)}}function deleteDouble(t){let e=[];for(let r=0;r<t.length;r++)t[r][0]===t[(r+1)%t.length][0]&&t[r][1]===t[(r+1)%t.length][1]||t[r][0]===t[(r-1+t.length)%t.length][0]&&t[r][1]===t[(r-1+t.length)%t.length][1]||t[(r+1)%t.length][0]===t[(r-1+t.length)%t.length][0]&&t[(r-1+t.length)%t.length][1]===t[(r+1)%t.length][1]||e.push(t[r]);return e}function lineBetweenTwoPoints(t,e){if(t[0]===e[0])return{a:0,b:t[0],vertical:!0};{const r=(e[1]-t[1])/(e[0]-t[0]);return{a:r,b:t[1]-r*t[0],vertical:!1}}}function isAtTheRightOfTheLine(t,e,r,i){if(!0===r.vertical)return r.b<=t;if(0===r.a)return!1;{const n=(e-r.b)/r.a;return n<t&&n>=0&&n<=i}}function paintPolygons(t,e={}){let r=Object.assign({},e);this.checkProcessable("paintPolygons",{bitDepth:[8,16]});let i=getColors(Object.assign({},e,{numberColors:t.length}));for(let e=0;e<t.length;e++)r.color=i[e%i.length],this.paintPolygon(t[e],r);return this}function getHistogram(t={}){let{maxSlots:e=256,channel:r,useAlpha:i=!0}=t;if(this.checkProcessable("getHistogram",{bitDepth:[1,8,16]}),void 0===r){if(this.components>1)throw new RangeError("You need to define the channel for an image that contains more than one channel");r=0}return getChannelHistogram.call(this,r,{useAlpha:i,maxSlots:e})}function getHistograms(t={}){const{maxSlots:e=256,useAlpha:r=!0}=t;this.checkProcessable("getHistograms",{bitDepth:[8,16]});let i=new Array(r?this.components:this.channels);for(let t=0;t<i.length;t++)i[t]=getChannelHistogram.call(this,t,{useAlpha:r,maxSlots:e});return i}function getChannelHistogram(t,e){let{useAlpha:r,maxSlots:i}=e;if(1===this.bitDepth){let t=[0,0];for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++){let i=this.getBitXY(e,r);0===i?t[0]+=1:1===i&&(t[1]+=1)}return t}let n=Math.log2(i);if(!isInteger(n))throw new RangeError("maxSlots must be a power of 2, for example: 64, 256, 1024");let s=0;this.bitDepth>n&&(s=this.bitDepth-n);let a=this.data,o=newArray_1(Math.pow(2,Math.min(this.bitDepth,n)),0);if(r&&this.alpha){let e=this.channels-t-1;for(let r=t;r<a.length;r+=this.channels)o[a[r]>>s]+=a[r+e]/this.maxValue}else for(let e=t;e<a.length;e+=this.channels)o[a[e]>>s]++;return o}function getColorHistogram(t={}){let{useAlpha:e=!0,nbSlots:r=512}=t;this.checkProcessable("getColorHistogram",{bitDepth:[8,16],components:[3]});let i=Math.log(r)/Math.log(8);if(i!==Math.floor(i))throw new RangeError("nbSlots must be a power of 8. Usually 8, 64, 512 or 4096");let n=this.bitDepth-i,s=this.data,a=newArray_1(Math.pow(8,i),0),o=Math.pow(2,2*i),l=Math.pow(2,i);for(let t=0;t<s.length;t+=this.channels){let r=(s[t]>>n)*o+(s[t+1]>>n)*l+(s[t+2]>>n);e&&this.alpha?a[r]+=s[t+this.channels-1]/this.maxValue:a[r]++}return a}function min$2(){this.checkProcessable("min",{bitDepth:[8,16,32]});let t=newArray_1(this.channels,1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)this.data[e+r]<t[r]&&(t[r]=this.data[e+r]);return t}function max$2(){this.checkProcessable("max",{bitDepth:[8,16,32]});let t=newArray_1(this.channels,-1/0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)this.data[e+r]>t[r]&&(t[r]=this.data[e+r]);return t}function sum(){this.checkProcessable("sum",{bitDepth:[8,16]});let t=newArray_1(this.channels,0);for(let e=0;e<this.data.length;e+=this.channels)for(let r=0;r<this.channels;r++)t[r]+=this.data[e+r];return t}function getMoment(t=0,e=0){this.checkProcessable("getMoment",{bitDepth:[1]});let r=0;for(let i=0;i<this.width;i++)for(let n=0;n<this.height;n++)1===this.getBitXY(i,n)&&(r+=i**t*n**e);return r}function localMaxima(t={}){let{mask:e,region:r=3,removeClosePoints:i=0,invert:n=!1,maxEquals:s=2}=t,a=this;this.checkProcessable("localMaxima",{bitDepth:[8,16],components:1}),r*=4;let o=n?0:1,l=[1,0,-1,0,1,1,-1,-1,2,0,-2,0,2,2,-2,-2],h=[0,1,0,-1,1,-1,1,-1,0,2,0,-2,2,-2,2,-2],c=r<=8?1:2,u=[];for(let t=c;t<a.height-c;t++)for(let i=c;i<a.width-c;i++){if(e&&e.getBitXY(i,t)!==o)continue;let c=0,f=0,d=a.data[i+t*a.width];for(let e=0;e<r;e++)n?a.data[i+l[e]+(t+h[e])*a.width]>d&&c++:a.data[i+l[e]+(t+h[e])*a.width]<d&&c++,a.data[i+l[e]+(t+h[e])*a.width]===d&&f++;c+f===r&&f<=s&&u.push([i,t])}if(i>0)for(let t=0;t<u.length;t++)for(let e=t+1;e<u.length;e++)Math.sqrt(Math.pow(u[t][0]-u[e][0],2)+Math.pow(u[t][1]-u[e][1],2))<i&&(u[t][0]=u[t][0]+u[e][0]>>1,u[t][1]=u[t][1]+u[e][1]>>1,u.splice(e,1),e--);return u}function mean$2(){let t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let i=t[r];e[r]=mean(i)}return e}function median$2(){let t=this.getHistograms({maxSlots:this.maxValue+1}),e=new Array(t.length);for(let r=0;r<t.length;r++){let i=t[r];e[r]=median(i)}return e}function points(){this.checkProcessable("points",{bitDepth:[1]});const t=[];for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++)1===this.getBitXY(e,r)&&t.push([e,r]);return t}function extendedPoints(){this.checkProcessable("extendedPoints",{bitDepth:[1]});const t=[];for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)1===this.getBitXY(r,e)&&(t.push([r,e]),1!==this.getBitXY(r+1,e)?(t.push([r+1,e]),t.push([r+1,e+1]),1!==this.getBitXY(r,e+1)&&t.push([r,e+1])):1!==this.getBitXY(r,e+1)&&(t.push([r,e+1]),t.push([r+1,e+1])));return t}function getRelativePosition(t,e={}){if(this===t)return[0,0];let r=[0,0],i=this;for(;i;){if(i===t)return r;i.position&&(r[0]+=i.position[0],r[1]+=i.position[1]),i=i.parent}return!!e.defaultFurther&&r}function countAlphaPixels(t={}){let{alpha:e=1}=t;this.checkProcessable("countAlphaPixels",{bitDepth:[8,16],alpha:1});let r=0;if(void 0!==e){for(let t=this.components;t<this.data.length;t+=this.channels)this.data[t]===e&&r++;return r}return this.size}function monotoneChainConvexHull(t,e={}){e.sorted||t.sort(byXThenY);const r=t.length,i=new Array(2*r);for(var n=0,s=0;s<r;s++){const e=t[s];for(;n>=2&&cw(i[n-2],i[n-1],e)<=0;)n--;i[n++]=e}const a=n+1;for(s=r-2;s>=0;s--){const e=t[s];for(;n>=a&&cw(i[n-2],i[n-1],e)<=0;)n--;i[n++]=e}return i.slice(0,n-1)}function cw(t,e,r){return(e[1]-t[1])*(r[0]-t[0])-(e[0]-t[0])*(r[1]-t[1])}function byXThenY(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}function monotoneChainConvexHull$1(){return monotoneChainConvexHull(this.extendedPoints,{sorted:!1})}function round(t){for(let e=0;e<t.length;e++)t[e][0]=Math.round(t[e][0]),t[e][1]=Math.round(t[e][1]);return t}function difference(t,e){return[t[0]-e[0],t[1]-e[1]]}function normalize(t){let e=Math.sqrt(t[0]**2+t[1]**2);return[t[0]/e,t[1]/e]}function rotate$1(t,e,r){void 0===r&&(r=new Array(e.length));let i=Math.cos(t),n=Math.sin(t);for(let t=0;t<r.length;++t)r[t]=[i*e[t][0]-n*e[t][1],n*e[t][0]+i*e[t][1]];return r}function perimeter(t){let e=0;for(let r=0;r<t.length;r++){let i=t[r][0],n=t[r][1],s=t[r===t.length-1?0:r+1][0],a=t[r===t.length-1?0:r+1][1];e+=Math.sqrt((s-i)**2+(a-n)**2)}return e}function surface(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r][0]*t[r===t.length-1?0:r+1][1]*.5,e-=t[r===t.length-1?0:r+1][0]*t[r][1]*.5;return Math.abs(e)}function minMax(t){let e=1/0,r=1/0,i=-1/0,n=-1/0;for(let s=0;s<t.length;s++)t[s][0]<e&&(e=t[s][0]),t[s][0]>i&&(i=t[s][0]),t[s][1]<r&&(r=t[s][1]),t[s][1]>n&&(n=t[s][1]);return[[e,r],[i,n]]}function moveToZeroZero(t,e){void 0===e&&(e=new Array(t.length).fill(0).map(()=>[]));let r=minMax(t),i=r[0][0],n=r[0][1];for(let r=0;r<t.length;r++)e[r][0]=t[r][0]-i,e[r][1]=t[r][1]-n;return e}function minimalBoundingRectangle(t={}){const{originalPoints:e=monotoneChainConvexHull$1.call(this)}=t;if(0===e.length)return[];if(1===e.length)return[e[0],e[0],e[0],e[0]];const r=new Array(e.length);let i,n=1/0,s=0;for(let t=0;t<r.length;t++){let a=getAngle(e[t],e[(t+1)%r.length]);rotate$1(-a,e,r);let o=r[t][0],l=r[t][1],h=r[(t+1)%r.length][0],c=r[(t+1)%r.length][1],u=!0,f=0,d=0,m=0;for(let t=0;t<r.length;t++){let e=r[t][0],i=r[t][1],n=(e-o)/(h-o);!0===u?(u=!1,f=n,d=n):(n<f&&(f=n),n>d&&(d=n));let s=(-(h-o)*i+h*l-c*o)/(h-o);Math.abs(s)>Math.abs(m)&&(m=s)}let g=[o+f*(h-o),l],p=[o+d*(h-o),l],w=Math.abs(m*(f-d)*(h-o));w<n&&(s=a,n=w,i=[g,p,[p[0],p[1]-m],[g[0],g[1]-m]])}return rotate$1(s,i,i),i}function getAngle(t,e){let r=normalize(difference(e,t)),i=Math.acos(r[0]);return r[1]<0?-i:i}function extend$1(t){let e={inPlace:!0};t.extendMethod("invert",invert),t.extendMethod("abs",abs),t.extendMethod("level",level,e),t.extendMethod("add",add,e),t.extendMethod("subtract",subtract,e),t.extendMethod("subtractImage",subtractImage),t.extendMethod("multiply",multiply,e),t.extendMethod("divide",divide,e),t.extendMethod("hypotenuse",hypotenuse$1),t.extendMethod("background",background),t.extendMethod("flipX",flipX),t.extendMethod("flipY",flipY),t.extendMethod("blurFilter",blurFilter),t.extendMethod("medianFilter",medianFilter),t.extendMethod("gaussianFilter",gaussianFilter),t.extendMethod("sobelFilter",sobelFilter),t.extendMethod("gradientFilter",gradientFilter),t.extendMethod("scharrFilter",scharrFilter),t.extendMethod("dilate",dilate),t.extendMethod("erode",erode),t.extendMethod("open",open),t.extendMethod("close",close),t.extendMethod("topHat",topHat),t.extendMethod("blackHat",blackHat),t.extendMethod("morphologicalGradient",morphologicalGradient),t.extendMethod("warpingFourPoints",warpingFourPoints),t.extendMethod("crop",crop),t.extendMethod("cropAlpha",cropAlpha),t.extendMethod("resize",resize).extendMethod("scale",resize),t.extendMethod("hsv",hsv),t.extendMethod("hsl",hsl),t.extendMethod("cmyk",cmyk),t.extendMethod("rgba8",rgba8),t.extendMethod("grey",grey).extendMethod("gray",grey),t.extendMethod("mask",mask),t.extendMethod("pad",pad),t.extendMethod("colorDepth",colorDepth),t.extendMethod("setBorder",setBorder,e),t.extendMethod("rotate",rotate),t.extendMethod("rotateLeft",rotateLeft),t.extendMethod("rotateRight",rotateRight),t.extendMethod("insert",insert),t.extendMethod("getRow",getRow),t.extendMethod("getColumn",getColumn),t.extendMethod("getMatrix",getMatrix),t.extendMethod("setMatrix",setMatrix),t.extendMethod("getPixelsArray",getPixelsArray),t.extendMethod("getIntersection",getIntersection),t.extendMethod("getClosestCommonParent",getClosestCommonParent),t.extendMethod("getThreshold",getThreshold$1),t.extendMethod("split",split),t.extendMethod("getChannel",getChannel),t.extendMethod("combineChannels",combineChannels),t.extendMethod("setChannel",setChannel),t.extendMethod("getSimilarity",getSimilarity),t.extendMethod("getPixelsGrid",getPixelsGrid),t.extendMethod("getBestMatch",getBestMatch),t.extendMethod("cannyEdge",cannyEdge),t.extendMethod("convolution",convolution),t.extendMethod("extract",extract),t.extendMethod("floodFill",floodFill),t.extendMethod("paintLabels",paintLabels,e),t.extendMethod("paintMasks",paintMasks,e),t.extendMethod("paintPoints",paintPoints,e),t.extendMethod("paintPolyline",paintPolyline,e),t.extendMethod("paintPolylines",paintPolylines,e),t.extendMethod("paintPolygon",paintPolygon,e),t.extendMethod("paintPolygons",paintPolygons,e),t.extendMethod("countAlphaPixels",countAlphaPixels),t.extendMethod("monotoneChainConvexHull",monotoneChainConvexHull$1),t.extendMethod("minimalBoundingRectangle",minimalBoundingRectangle),t.extendMethod("getHistogram",getHistogram).extendProperty("histogram",getHistogram),t.extendMethod("getHistograms",getHistograms).extendProperty("histograms",getHistograms),t.extendMethod("getColorHistogram",getColorHistogram).extendProperty("colorHistogram",getColorHistogram),t.extendMethod("getMin",min$2).extendProperty("min",min$2),t.extendMethod("getMax",max$2).extendProperty("max",max$2),t.extendMethod("getSum",sum).extendProperty("sum",sum),t.extendMethod("getMoment",getMoment).extendProperty("moment",getMoment),t.extendMethod("getLocalMaxima",localMaxima),t.extendMethod("getMedian",median$2).extendProperty("median",median$2),t.extendMethod("getMean",mean$2).extendProperty("mean",mean$2),t.extendMethod("getPoints",points).extendProperty("points",points),t.extendMethod("getExtendedPoints",extendedPoints).extendProperty("extendedPoints",extendedPoints),t.extendMethod("getRelativePosition",getRelativePosition)}function deepValue(t,e=""){let r=e.split(".");for(let e of r){if(void 0===t[e])return;t=t[e]}return t}var quantities=createCommonjsModule((function(t,e){t.exports=function(){function t(t){return"string"==typeof t||t instanceof String}var e=Number.isFinite||window.isFinite;function r(t){return e(t)}function i(t){return t}function n(t,e){if(e.length!==t.length)return!1;for(var r=0;r<t.length;r++){if(e[r].compareArray&&!e[r].compareArray(t[r]))return!1;if(e[r]!==t[r])return!1}return!0}function s(t,e){Object.keys(e).forEach((function(r){t[r]=e[r]}))}function a(){for(var t=1,e=0,r=0;r<arguments.length;r++){var i=arguments[r];e+=h(i),t*=i}return 0!==e?l(t,e):t}function o(t,e){if(0===e)throw new Error("Divide by zero");var r=Math.pow(10,h(e));return a(t,r/(r*e))}function l(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function h(t){if(!isFinite(t))return 0;for(var e=0;t%1!=0;)t*=10,e++;return e}function c(){var t;if(!this)return t=Object.create(c.prototype),c.apply(t,arguments),t;t=Error.apply(this,arguments),this.name="QtyError",this.message=t.message,this.stack=t.stack}function u(t,e){throw new c("Incompatible units: "+t+" and "+e)}c.prototype=Object.create(Error.prototype,{constructor:{value:c}});var f={"<googol>":[["googol"],1e100,"prefix"],"<kibi>":[["Ki","Kibi","kibi"],Math.pow(2,10),"prefix"],"<mebi>":[["Mi","Mebi","mebi"],Math.pow(2,20),"prefix"],"<gibi>":[["Gi","Gibi","gibi"],Math.pow(2,30),"prefix"],"<tebi>":[["Ti","Tebi","tebi"],Math.pow(2,40),"prefix"],"<pebi>":[["Pi","Pebi","pebi"],Math.pow(2,50),"prefix"],"<exi>":[["Ei","Exi","exi"],Math.pow(2,60),"prefix"],"<zebi>":[["Zi","Zebi","zebi"],Math.pow(2,70),"prefix"],"<yebi>":[["Yi","Yebi","yebi"],Math.pow(2,80),"prefix"],"<yotta>":[["Y","Yotta","yotta"],1e24,"prefix"],"<zetta>":[["Z","Zetta","zetta"],1e21,"prefix"],"<exa>":[["E","Exa","exa"],1e18,"prefix"],"<peta>":[["P","Peta","peta"],1e15,"prefix"],"<tera>":[["T","Tera","tera"],1e12,"prefix"],"<giga>":[["G","Giga","giga"],1e9,"prefix"],"<mega>":[["M","Mega","mega"],1e6,"prefix"],"<kilo>":[["k","kilo"],1e3,"prefix"],"<hecto>":[["h","Hecto","hecto"],100,"prefix"],"<deca>":[["da","Deca","deca","deka"],10,"prefix"],"<deci>":[["d","Deci","deci"],.1,"prefix"],"<centi>":[["c","Centi","centi"],.01,"prefix"],"<milli>":[["m","Milli","milli"],.001,"prefix"],"<micro>":[["u","μ","µ","Micro","mc","micro"],1e-6,"prefix"],"<nano>":[["n","Nano","nano"],1e-9,"prefix"],"<pico>":[["p","Pico","pico"],1e-12,"prefix"],"<femto>":[["f","Femto","femto"],1e-15,"prefix"],"<atto>":[["a","Atto","atto"],1e-18,"prefix"],"<zepto>":[["z","Zepto","zepto"],1e-21,"prefix"],"<yocto>":[["y","Yocto","yocto"],1e-24,"prefix"],"<1>":[["1","<1>"],1,""],"<meter>":[["m","meter","meters","metre","metres"],1,"length",["<meter>"]],"<inch>":[["in","inch","inches",'"'],.0254,"length",["<meter>"]],"<foot>":[["ft","foot","feet","'"],.3048,"length",["<meter>"]],"<yard>":[["yd","yard","yards"],.9144,"length",["<meter>"]],"<mile>":[["mi","mile","miles"],1609.344,"length",["<meter>"]],"<naut-mile>":[["nmi","naut-mile"],1852,"length",["<meter>"]],"<league>":[["league","leagues"],4828,"length",["<meter>"]],"<furlong>":[["furlong","furlongs"],201.2,"length",["<meter>"]],"<rod>":[["rd","rod","rods"],5.029,"length",["<meter>"]],"<mil>":[["mil","mils"],254e-7,"length",["<meter>"]],"<angstrom>":[["ang","angstrom","angstroms"],1e-10,"length",["<meter>"]],"<fathom>":[["fathom","fathoms"],1.829,"length",["<meter>"]],"<pica>":[["pica","picas"],.00423333333,"length",["<meter>"]],"<point>":[["pt","point","points"],.000352777778,"length",["<meter>"]],"<redshift>":[["z","red-shift","redshift"],1302773e20,"length",["<meter>"]],"<AU>":[["AU","astronomical-unit"],1495979e5,"length",["<meter>"]],"<light-second>":[["ls","light-second"],299792500,"length",["<meter>"]],"<light-minute>":[["lmin","light-minute"],1798755e4,"length",["<meter>"]],"<light-year>":[["ly","light-year"],9460528e9,"length",["<meter>"]],"<parsec>":[["pc","parsec","parsecs"],3085678e10,"length",["<meter>"]],"<datamile>":[["DM","datamile"],1828.8,"length",["<meter>"]],"<kilogram>":[["kg","kilogram","kilograms"],1,"mass",["<kilogram>"]],"<AMU>":[["u","AMU","amu"],1660538921e-36,"mass",["<kilogram>"]],"<dalton>":[["Da","Dalton","Daltons","dalton","daltons"],1660538921e-36,"mass",["<kilogram>"]],"<slug>":[["slug","slugs"],14.5939029,"mass",["<kilogram>"]],"<short-ton>":[["tn","ton","short-ton"],907.18474,"mass",["<kilogram>"]],"<metric-ton>":[["tonne","metric-ton"],1e3,"mass",["<kilogram>"]],"<carat>":[["ct","carat","carats"],2e-4,"mass",["<kilogram>"]],"<pound>":[["lbs","lb","pound","pounds","#"],.45359237,"mass",["<kilogram>"]],"<ounce>":[["oz","ounce","ounces"],.0283495231,"mass",["<kilogram>"]],"<gram>":[["g","gram","grams","gramme","grammes"],.001,"mass",["<kilogram>"]],"<grain>":[["grain","grains","gr"],6479891e-11,"mass",["<kilogram>"]],"<dram>":[["dram","drams","dr"],.0017718452,"mass",["<kilogram>"]],"<stone>":[["stone","stones","st"],6.35029318,"mass",["<kilogram>"]],"<hectare>":[["hectare"],1e4,"area",["<meter>","<meter>"]],"<acre>":[["acre","acres"],4046.85642,"area",["<meter>","<meter>"]],"<sqft>":[["sqft"],1,"area",["<foot>","<foot>"]],"<liter>":[["l","L","liter","liters","litre","litres"],.001,"volume",["<meter>","<meter>","<meter>"]],"<gallon>":[["gal","gallon","gallons"],.0037854118,"volume",["<meter>","<meter>","<meter>"]],"<gallon-imp>":[["galimp","gallon-imp","gallons-imp"],.00454609,"volume",["<meter>","<meter>","<meter>"]],"<quart>":[["qt","quart","quarts"],.00094635295,"volume",["<meter>","<meter>","<meter>"]],"<pint>":[["pt","pint","pints"],.000473176475,"volume",["<meter>","<meter>","<meter>"]],"<pint-imp>":[["ptimp","pint-imp","pints-imp"],.00056826125,"volume",["<meter>","<meter>","<meter>"]],"<cup>":[["cu","cup","cups"],.000236588238,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce>":[["floz","fluid-ounce","fluid-ounces"],295735297e-13,"volume",["<meter>","<meter>","<meter>"]],"<fluid-ounce-imp>":[["flozimp","floz-imp","fluid-ounce-imp","fluid-ounces-imp"],284130625e-13,"volume",["<meter>","<meter>","<meter>"]],"<tablespoon>":[["tb","tbsp","tbs","tablespoon","tablespoons"],147867648e-13,"volume",["<meter>","<meter>","<meter>"]],"<teaspoon>":[["tsp","teaspoon","teaspoons"],492892161e-14,"volume",["<meter>","<meter>","<meter>"]],"<bushel>":[["bu","bsh","bushel","bushels"],.035239072,"volume",["<meter>","<meter>","<meter>"]],"<oilbarrel>":[["bbl","oil-barrel","oil-barrels"],.158987294928,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel>":[["bl","bl-us","beer-barrel","beer-barrels"],.1173477658,"volume",["<meter>","<meter>","<meter>"]],"<beerbarrel-imp>":[["blimp","bl-imp","beer-barrel-imp","beer-barrels-imp"],.16365924,"volume",["<meter>","<meter>","<meter>"]],"<kph>":[["kph"],.277777778,"speed",["<meter>"],["<second>"]],"<mph>":[["mph"],.44704,"speed",["<meter>"],["<second>"]],"<knot>":[["kt","kn","kts","knot","knots"],.514444444,"speed",["<meter>"],["<second>"]],"<fps>":[["fps"],.3048,"speed",["<meter>"],["<second>"]],"<gee>":[["gee"],9.80665,"acceleration",["<meter>"],["<second>","<second>"]],"<kelvin>":[["degK","kelvin"],1,"temperature",["<kelvin>"]],"<celsius>":[["degC","celsius","celsius","centigrade"],1,"temperature",["<kelvin>"]],"<fahrenheit>":[["degF","fahrenheit"],5/9,"temperature",["<kelvin>"]],"<rankine>":[["degR","rankine"],5/9,"temperature",["<kelvin>"]],"<temp-K>":[["tempK","temp-K"],1,"temperature",["<temp-K>"]],"<temp-C>":[["tempC","temp-C"],1,"temperature",["<temp-K>"]],"<temp-F>":[["tempF","temp-F"],5/9,"temperature",["<temp-K>"]],"<temp-R>":[["tempR","temp-R"],5/9,"temperature",["<temp-K>"]],"<second>":[["s","sec","secs","second","seconds"],1,"time",["<second>"]],"<minute>":[["min","mins","minute","minutes"],60,"time",["<second>"]],"<hour>":[["h","hr","hrs","hour","hours"],3600,"time",["<second>"]],"<day>":[["d","day","days"],86400,"time",["<second>"]],"<week>":[["wk","week","weeks"],604800,"time",["<second>"]],"<fortnight>":[["fortnight","fortnights"],1209600,"time",["<second>"]],"<year>":[["y","yr","year","years","annum"],31556926,"time",["<second>"]],"<decade>":[["decade","decades"],315569260,"time",["<second>"]],"<century>":[["century","centuries"],3155692600,"time",["<second>"]],"<pascal>":[["Pa","pascal","Pascal"],1,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<bar>":[["bar","bars"],1e5,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<mmHg>":[["mmHg"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inHg>":[["inHg"],3386.3881472,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<torr>":[["torr"],133.322368,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<atm>":[["atm","ATM","atmosphere","atmospheres"],101325,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<psi>":[["psi"],6894.76,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<cmh2o>":[["cmH2O","cmh2o"],98.0638,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<inh2o>":[["inH2O","inh2o"],249.082052,"pressure",["<kilogram>"],["<meter>","<second>","<second>"]],"<poise>":[["P","poise"],.1,"viscosity",["<kilogram>"],["<meter>","<second>"]],"<stokes>":[["St","stokes"],1e-4,"viscosity",["<meter>","<meter>"],["<second>"]],"<mole>":[["mol","mole"],1,"substance",["<mole>"]],"<molar>":[["M","molar"],1e3,"concentration",["<mole>"],["<meter>","<meter>","<meter>"]],"<wtpercent>":[["wt%","wtpercent"],10,"concentration",["<kilogram>"],["<meter>","<meter>","<meter>"]],"<katal>":[["kat","katal","Katal"],1,"activity",["<mole>"],["<second>"]],"<unit>":[["U","enzUnit","unit"],16667e-19,"activity",["<mole>"],["<second>"]],"<farad>":[["F","farad","Farad"],1,"capacitance",["<second>","<second>","<second>","<second>","<ampere>","<ampere>"],["<meter>","<meter>","<kilogram>"]],"<coulomb>":[["C","coulomb","Coulomb"],1,"charge",["<ampere>","<second>"]],"<Ah>":[["Ah"],3600,"charge",["<ampere>","<second>"]],"<ampere>":[["A","Ampere","ampere","amp","amps"],1,"current",["<ampere>"]],"<siemens>":[["S","Siemens","siemens"],1,"conductance",["<second>","<second>","<second>","<ampere>","<ampere>"],["<kilogram>","<meter>","<meter>"]],"<henry>":[["H","Henry","henry"],1,"inductance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>","<ampere>"]],"<volt>":[["V","Volt","volt","volts"],1,"potential",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>"]],"<ohm>":[["Ohm","ohm","Ω","Ω"],1,"resistance",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<second>","<ampere>","<ampere>"]],"<weber>":[["Wb","weber","webers"],1,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<tesla>":[["T","tesla","teslas"],1,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<gauss>":[["G","gauss"],1e-4,"magnetism",["<kilogram>"],["<second>","<second>","<ampere>"]],"<maxwell>":[["Mx","maxwell","maxwells"],1e-8,"magnetism",["<meter>","<meter>","<kilogram>"],["<second>","<second>","<ampere>"]],"<oersted>":[["Oe","oersted","oersteds"],250/Math.PI,"magnetism",["<ampere>"],["<meter>"]],"<joule>":[["J","joule","Joule","joules"],1,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<erg>":[["erg","ergs"],1e-7,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<btu>":[["BTU","btu","BTUs"],1055.056,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<calorie>":[["cal","calorie","calories"],4.184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Calorie>":[["Cal","Calorie","Calories"],4184,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<therm-US>":[["th","therm","therms","Therm","therm-US"],105480400,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<Wh>":[["Wh"],3600,"energy",["<meter>","<meter>","<kilogram>"],["<second>","<second>"]],"<newton>":[["N","Newton","newton"],1,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<dyne>":[["dyn","dyne"],1e-5,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<pound-force>":[["lbf","pound-force"],4.448222,"force",["<kilogram>","<meter>"],["<second>","<second>"]],"<hertz>":[["Hz","hertz","Hertz"],1,"frequency",["<1>"],["<second>"]],"<radian>":[["rad","radian","radians"],1,"angle",["<radian>"]],"<degree>":[["deg","degree","degrees"],Math.PI/180,"angle",["<radian>"]],"<gradian>":[["gon","grad","gradian","grads"],Math.PI/200,"angle",["<radian>"]],"<steradian>":[["sr","steradian","steradians"],1,"solid_angle",["<steradian>"]],"<rotation>":[["rotation"],2*Math.PI,"angle",["<radian>"]],"<rpm>":[["rpm"],2*Math.PI/60,"angular_velocity",["<radian>"],["<second>"]],"<byte>":[["B","byte","bytes"],1,"information",["<byte>"]],"<bit>":[["b","bit","bits"],.125,"information",["<byte>"]],"<Bps>":[["Bps"],1,"information_rate",["<byte>"],["<second>"]],"<bps>":[["bps"],.125,"information_rate",["<byte>"],["<second>"]],"<dollar>":[["USD","dollar"],1,"currency",["<dollar>"]],"<cents>":[["cents"],.01,"currency",["<dollar>"]],"<candela>":[["cd","candela"],1,"luminosity",["<candela>"]],"<lumen>":[["lm","lumen"],1,"luminous_power",["<candela>","<steradian>"]],"<lux>":[["lux"],1,"illuminance",["<candela>","<steradian>"],["<meter>","<meter>"]],"<watt>":[["W","watt","watts"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere>":[["VA","volt-ampere"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<volt-ampere-reactive>":[["var","Var","VAr","VAR","volt-ampere-reactive"],1,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<horsepower>":[["hp","horsepower"],745.699872,"power",["<kilogram>","<meter>","<meter>"],["<second>","<second>","<second>"]],"<gray>":[["Gy","gray","grays"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<roentgen>":[["R","roentgen"],.00933,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<sievert>":[["Sv","sievert","sieverts"],1,"radiation",["<meter>","<meter>"],["<second>","<second>"]],"<becquerel>":[["Bq","becquerel","becquerels"],1,"radiation",["<1>"],["<second>"]],"<curie>":[["Ci","curie","curies"],37e9,"radiation",["<1>"],["<second>"]],"<cpm>":[["cpm"],1/60,"rate",["<count>"],["<second>"]],"<dpm>":[["dpm"],1/60,"rate",["<count>"],["<second>"]],"<bpm>":[["bpm"],1/60,"rate",["<count>"],["<second>"]],"<dot>":[["dot","dots"],1,"resolution",["<each>"]],"<pixel>":[["pixel","px"],1,"resolution",["<each>"]],"<ppi>":[["ppi"],1,"resolution",["<pixel>"],["<inch>"]],"<dpi>":[["dpi"],1,"typography",["<dot>"],["<inch>"]],"<cell>":[["cells","cell"],1,"counting",["<each>"]],"<each>":[["each"],1,"counting",["<each>"]],"<count>":[["count"],1,"counting",["<each>"]],"<base-pair>":[["bp","base-pair"],1,"counting",["<each>"]],"<nucleotide>":[["nt","nucleotide"],1,"counting",["<each>"]],"<molecule>":[["molecule","molecules"],1,"counting",["<1>"]],"<dozen>":[["doz","dz","dozen"],12,"prefix_only",["<each>"]],"<percent>":[["%","percent"],.01,"prefix_only",["<1>"]],"<ppm>":[["ppm"],1e-6,"prefix_only",["<1>"]],"<ppt>":[["ppt"],1e-9,"prefix_only",["<1>"]],"<gross>":[["gr","gross"],144,"prefix_only",["<dozen>","<dozen>"]],"<decibel>":[["dB","decibel","decibels"],1,"logarithmic",["<decibel>"]]},d=["<meter>","<kilogram>","<second>","<mole>","<ampere>","<radian>","<kelvin>","<temp-K>","<byte>","<dollar>","<candela>","<each>","<steradian>","<decibel>"],m=["<1>"];function g(t,e){var i=e[1],n=e[3]||[],s=e[4]||[];if(!r(i))throw new c(t+": Invalid unit definition. 'scalar' must be a number");n.forEach((function(e){if(void 0===f[e])throw new c(t+": Invalid unit definition. Unit "+e+" in 'numerator' is not recognized")})),s.forEach((function(e){if(void 0===f[e])throw new c(t+": Invalid unit definition. Unit "+e+" in 'denominator' is not recognized")}))}var p={},w={},b={},y={},_={};for(var M in f)if(f.hasOwnProperty(M)){var x=f[M];if("prefix"===x[2]){p[M]=x[1];for(var v=0;v<x[0].length;v++)w[x[0][v]]=M}else{g(M,x),b[M]={scalar:x[1],numerator:x[3],denominator:x[4]};for(var S=0;S<x[0].length;S++)y[x[0][S]]=M}_[M]=x[0][0]}var k=["length","time","temperature","mass","current","substance","luminosity","currency","information","angle"];function A(){if(this.signature)return this.signature;for(var t=E.call(this),e=0;e<t.length;e++)t[e]*=Math.pow(20,e);return t.reduce((function(t,e){return t+e}),0)}function E(){if(!this.isBase())return E.call(this.toBase());for(var t,e,r=new Array(k.length),i=0;i<r.length;i++)r[i]=0;for(var n=0;n<this.numerator.length;n++)(t=f[this.numerator[n]])&&(e=k.indexOf(t[2]))>=0&&(r[e]=r[e]+1);for(var s=0;s<this.denominator.length;s++)(t=f[this.denominator[s]])&&(e=k.indexOf(t[2]))>=0&&(r[e]=r[e]-1);return r}var I=new RegExp("^([+-]?\\s*(?:(?:\\d+(?:\\.\\d+)?)|(?:\\.\\d+))(?:[Ee][+-]?\\d+)?)?\\s*([^/]*)(?:/(.+))?$"),C=new RegExp("([^ \\*\\d]+?)(?:\\^|\\*{2})?(-?[01234](?![a-zA-Z]))"),D=new RegExp("([^ \\*\\d]+?)(?:\\^|\\*{2})?([01234](?![a-zA-Z]))");function T(e){t(e)||(e=e.toString()),e=e.trim();var r=I.exec(e);if(!r)throw new c(e+": Quantity not recognized");var i=r[1];i?(i=i.replace(/\s/g,""),this.scalar=parseFloat(i)):this.scalar=1;for(var n,s,a,o=r[2],l=r[3];r=C.exec(o);){if(n=parseFloat(r[2]),isNaN(n))throw new c("Unit exponent is not a number");if(0===n&&!O.test(r[1]))throw new c("Unit not recognized");s=r[1]+" ",a="";for(var h=0;h<Math.abs(n);h++)a+=s;n>=0?o=o.replace(r[0],a):(l=l?l+a:a,o=o.replace(r[0],""))}for(;r=D.exec(l);){if(n=parseFloat(r[2]),isNaN(n))throw new c("Unit exponent is not a number");if(0===n&&!O.test(r[1]))throw new c("Unit not recognized");s=r[1]+" ",a="";for(var u=0;u<n;u++)a+=s;l=l.replace(r[0],a)}o&&(this.numerator=F(o.trim())),l&&(this.denominator=F(l.trim()))}var R=Object.keys(w).sort((function(t,e){return e.length-t.length})).join("|"),P=Object.keys(y).sort((function(t,e){return e.length-t.length})).join("|"),B="("+R+")??("+P+")(?:\\b|$)",O=new RegExp("^\\s*("+B+"[\\s\\*]*)+$"),L=new RegExp(B,"g"),N={};function F(t){var e=N[t];if(e)return e;var r,i=[];if(!O.test(t))throw new c("Unit not recognized");for(;r=L.exec(t);)i.push(r.slice(1));return i=(i=(i=i.map((function(t){return w[t[0]]?[w[t[0]],y[t[1]]]:[y[t[1]]]}))).reduce((function(t,e){return t.concat(e)}),[])).filter((function(t){return t})),N[t]=i,i}function U(t){return t instanceof $}function $(t,e){if(V.apply(null,arguments),!U(this))return new $(t,e);if(this.scalar=null,this.baseScalar=null,this.signature=null,this._conversionCache={},this.numerator=m,this.denominator=m,z(t)?(this.scalar=t.scalar,this.numerator=t.numerator&&0!==t.numerator.length?t.numerator:m,this.denominator=t.denominator&&0!==t.denominator.length?t.denominator:m):e?(T.call(this,e),this.scalar=t):T.call(this,t),this.denominator.join("*").indexOf("temp")>=0)throw new c("Cannot divide with temperatures");if(this.numerator.join("*").indexOf("temp")>=0){if(this.numerator.length>1)throw new c("Cannot multiply by temperatures");if(!n(this.denominator,m))throw new c("Cannot divide with temperatures")}if(this.initValue=t,H.call(this),this.isTemperature()&&this.baseScalar<0)throw new c("Temperatures must not be less than absolute zero")}function V(e,i){if(i){if(!r(e)||!t(i))throw new c("Only number accepted as initialization value when units are explicitly provided")}else if(!(t(e)||r(e)||U(e)||z(e)))throw new c("Only string, number or quantity accepted as single initialization value")}function z(t){return t&&"object"==typeof t&&t.hasOwnProperty("scalar")}function H(){if(this.baseScalar)return this.baseScalar;if(this.isBase())this.baseScalar=this.scalar,this.signature=A.call(this);else{var t=this.toBase();this.baseScalar=t.scalar,this.signature=t.signature}}$.prototype={constructor:$};var G={"-312078":"elastance","-312058":"resistance","-312038":"inductance","-152058":"potential","-152040":"magnetism","-152038":"magnetism","-7997":"specific_volume","-79":"snap","-59":"jolt","-39":"acceleration","-38":"radiation","-20":"frequency","-19":"speed","-18":"viscosity","-17":"volumetric_flow","-1":"wavenumber",0:"unitless",1:"length",2:"area",3:"volume",20:"time",400:"temperature",7941:"yank",7942:"power",7959:"pressure",7961:"force",7962:"energy",7979:"viscosity",7981:"momentum",7982:"angular_momentum",7997:"density",7998:"area_density",8e3:"mass",152020:"radiation_exposure",159999:"magnetism",16e4:"current",160020:"charge",312058:"conductance",312078:"capacitance",3199980:"activity",3199997:"molar_concentration",32e5:"substance",63999998:"illuminance",64e6:"luminous_power",128e7:"currency",25599999980:"information_rate",256e8:"information",511999999980:"angular_velocity",512e9:"angle"};function Y(t,e){var r=e.to(X(t.units()));return $({scalar:t.scalar+r.scalar,numerator:t.numerator,denominator:t.denominator})}function X(t){if("tempK"===t)return"degK";if("tempC"===t)return"degC";if("tempF"===t)return"degF";if("tempR"===t)return"degR";throw new c("Unknown type for temp conversion from: "+t)}function j(t,e){var r,i=function(t){var e,r=t.units();if(r.match(/(deg)[CFRK]/))e=t.baseScalar;else if("tempK"===r)e=t.scalar;else if("tempC"===r)e=t.scalar;else if("tempF"===r)e=5*t.scalar/9;else{if("tempR"!==r)throw new c("Unknown type for temp conversion from: "+r);e=5*t.scalar/9}return $({scalar:e,numerator:["<kelvin>"],denominator:m})}(t),n=e.units();if("degK"===n)r=i.scalar;else if("degC"===n)r=i.scalar;else if("degF"===n)r=9*i.scalar/5;else{if("degR"!==n)throw new c("Unknown type for degree conversion to: "+n);r=9*i.scalar/5}return $({scalar:r,numerator:e.numerator,denominator:e.denominator})}$.prototype.kind=function(){return G[this.signature.toString()]},s($.prototype,{isDegrees:function(){return(null===this.signature||400===this.signature)&&1===this.numerator.length&&n(this.denominator,m)&&(this.numerator[0].match(/<temp-[CFRK]>/)||this.numerator[0].match(/<(kelvin|celsius|rankine|fahrenheit)>/))},isTemperature:function(){return this.isDegrees()&&this.numerator[0].match(/<temp-[CFRK]>/)}}),s($.prototype,{to:function(e){var r,i;return null==e?this:t(e)?(r=this._conversionCache[e])?r:(i=$(e)).units()===this.units()?this:(this.isCompatible(i)?i=i.isTemperature()?function(t,e){var r,i=e.units();if("tempK"===i)r=t.baseScalar;else if("tempC"===i)r=t.baseScalar-273.15;else if("tempF"===i)r=9*t.baseScalar/5-459.67;else{if("tempR"!==i)throw new c("Unknown type for temp conversion to: "+i);r=9*t.baseScalar/5}return $({scalar:r,numerator:e.numerator,denominator:e.denominator})}(this,i):i.isDegrees()?j(this,i):$({scalar:o(this.baseScalar,i.baseScalar),numerator:i.numerator,denominator:i.denominator}):this.isInverse(i)?i=this.inverse().to(e):u(this.units(),i.units()),this._conversionCache[e]=i,i):this.to(e.units())},toBase:function(){if(this.isBase())return this;if(this.isTemperature())return function(t){var e,r=t.units();if(r.match(/(deg)[CFRK]/))e=t.baseScalar;else if("tempK"===r)e=t.scalar;else if("tempC"===r)e=t.scalar+273.15;else if("tempF"===r)e=5*(t.scalar+459.67)/9;else{if("tempR"!==r)throw new c("Unknown type for temp conversion from: "+r);e=5*t.scalar/9}return $({scalar:e,numerator:["<temp-K>"],denominator:m})}(this);var t=K[this.units()];return t||(t=function(t,e){for(var r,i=[],n=[],s=1,o=0;o<t.length;o++)r=t[o],p[r]?s=a(s,p[r]):b[r]&&(s*=b[r].scalar,b[r].numerator&&i.push(b[r].numerator),b[r].denominator&&n.push(b[r].denominator));for(var l=0;l<e.length;l++)r=e[l],p[r]?s/=p[r]:b[r]&&(s/=b[r].scalar,b[r].numerator&&n.push(b[r].numerator),b[r].denominator&&i.push(b[r].denominator));return i=i.reduce((function(t,e){return t.concat(e)}),[]),n=n.reduce((function(t,e){return t.concat(e)}),[]),$({scalar:s,numerator:i,denominator:n})}(this.numerator,this.denominator),K[this.units()]=t),t.mul(this.scalar)},toFloat:function(){if(this.isUnitless())return this.scalar;throw new c("Can't convert to Float unless unitless.  Use Unit#scalar")},toPrec:function(e){if(t(e)&&(e=$(e)),r(e)&&(e=$(e+" "+this.units())),this.isUnitless()?e.isUnitless()||u(this.units(),e.units()):e=e.to(this.units()),0===e.scalar)throw new c("Divide by zero");return $(a(Math.round(this.scalar/e.scalar),e.scalar)+this.units())}});var K={};function Z(t,e,r,i){function n(t){return"<1>"!==t}t=t.filter(n),r=r.filter(n),e=e.filter(n),i=i.filter(n);var s={};function a(t,e){for(var r,i,n,a=0;a<t.length;a++)if(p[t[a]]?(r=t[a+1],i=t[a],n=p[i],a++):(r=t[a],i=null,n=1),r&&"<1>"!==r)if(s[r]){s[r][0]+=e;var l=s[r][2]?p[s[r][2]]:1;s[r][1===e?3:4]*=o(n,l)}else s[r]=[e,r,i,1,1]}a(t,1),a(e,-1),a(r,1),a(i,-1);var l=[],h=[],c=1;for(var u in s)if(s.hasOwnProperty(u)){var f,d=s[u];if(d[0]>0)for(f=0;f<d[0];f++)l.push(null===d[2]?d[1]:[d[2],d[1]]);else if(d[0]<0)for(f=0;f<-d[0];f++)h.push(null===d[2]?d[1]:[d[2],d[1]]);c*=o(d[3],d[4])}return 0===l.length&&(l=m),0===h.length&&(h=m),[l=l.reduce((function(t,e){return t.concat(e)}),[]),h=h.reduce((function(t,e){return t.concat(e)}),[]),c]}function W(){}$.parse=function(e){if(!t(e))throw new c("Argument should be a string");try{return this(e)}catch(t){return null}},$.getUnits=function(t){var e,r=[],i=Object.keys(f);if(void 0===t)for(e=0;e<i.length;e++)-1===["","prefix"].indexOf(f[i[e]][2])&&r.push(i[e].substr(1,i[e].length-2));else{if(-1===this.getKinds().indexOf(t))throw new c("Kind not recognized");for(e=0;e<i.length;e++)f[i[e]][2]===t&&r.push(i[e].substr(1,i[e].length-2))}return r.sort((function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0}))},$.getAliases=function(t){if(!y[t])throw new c("Unit not recognized");return f[y[t]][0]},$.mulSafe=a,$.divSafe=o,$.getKinds=function(){return function(t){var e={};return t.filter((function(t){return!e.hasOwnProperty(t)&&(e[t]=!0)}))}(Object.keys(G).map((function(t){return G[t]})))},$.swiftConverter=function(t,e){var r,n=$(t),s=$(e);return n.eq(s)?i:(r=n.isTemperature()?function(t){return n.mul(t).to(s).scalar}:function(t){return t*n.baseScalar/s.baseScalar},function(t){var e,i,n;if(Array.isArray(t)){for(i=t.length,n=[],e=0;e<i;e++)n.push(r(t[e]));return n}return r(t)})},$.Error=c,s($.prototype,{add:function(e){if(t(e)&&(e=$(e)),this.isCompatible(e)||u(this.units(),e.units()),this.isTemperature()&&e.isTemperature())throw new c("Cannot add two temperatures");return this.isTemperature()?Y(this,e):e.isTemperature()?Y(e,this):$({scalar:this.scalar+e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},sub:function(e){if(t(e)&&(e=$(e)),this.isCompatible(e)||u(this.units(),e.units()),this.isTemperature()&&e.isTemperature())return s=e,a=(n=this).units(),o=s.to(a),l=$(X(a)),$({scalar:n.scalar-o.scalar,numerator:l.numerator,denominator:l.denominator});if(this.isTemperature())return r=this,i=e.to(X(r.units())),$({scalar:r.scalar-i.scalar,numerator:r.numerator,denominator:r.denominator});if(e.isTemperature())throw new c("Cannot subtract a temperature from a differential degree unit");var r,i,n,s,a,o,l;return $({scalar:this.scalar-e.to(this).scalar,numerator:this.numerator,denominator:this.denominator})},mul:function(e){if(r(e))return $({scalar:a(this.scalar,e),numerator:this.numerator,denominator:this.denominator});if(t(e)&&(e=$(e)),(this.isTemperature()||e.isTemperature())&&!this.isUnitless()&&!e.isUnitless())throw new c("Cannot multiply by temperatures");var i=e;this.isCompatible(i)&&400!==this.signature&&(i=i.to(this));var n=Z(this.numerator,this.denominator,i.numerator,i.denominator);return $({scalar:a(this.scalar,i.scalar,n[2]),numerator:n[0],denominator:n[1]})},div:function(e){if(r(e)){if(0===e)throw new c("Divide by zero");return $({scalar:this.scalar/e,numerator:this.numerator,denominator:this.denominator})}if(t(e)&&(e=$(e)),0===e.scalar)throw new c("Divide by zero");if(e.isTemperature())throw new c("Cannot divide with temperatures");if(this.isTemperature()&&!e.isUnitless())throw new c("Cannot divide with temperatures");var i=e;this.isCompatible(i)&&400!==this.signature&&(i=i.to(this));var n=Z(this.numerator,this.denominator,i.denominator,i.numerator);return $({scalar:a(this.scalar,n[2])/i.scalar,numerator:n[0],denominator:n[1]})},inverse:function(){if(this.isTemperature())throw new c("Cannot divide with temperatures");if(0===this.scalar)throw new c("Divide by zero");return $({scalar:1/this.scalar,numerator:this.denominator,denominator:this.numerator})}}),s($.prototype,{eq:function(t){return 0===this.compareTo(t)},lt:function(t){return-1===this.compareTo(t)},lte:function(t){return this.eq(t)||this.lt(t)},gt:function(t){return 1===this.compareTo(t)},gte:function(t){return this.eq(t)||this.gt(t)},compareTo:function(e){return t(e)?this.compareTo($(e)):(this.isCompatible(e)||u(this.units(),e.units()),this.baseScalar<e.baseScalar?-1:this.baseScalar===e.baseScalar?0:this.baseScalar>e.baseScalar?1:void 0)},same:function(t){return this.scalar===t.scalar&&this.units()===t.units()}}),s($.prototype,{isUnitless:function(){return[this.numerator,this.denominator].every((function(t){return n(t,m)}))},isCompatible:function(e){return t(e)?this.isCompatible($(e)):!!U(e)&&void 0!==e.signature&&this.signature===e.signature},isInverse:function(t){return this.inverse().isCompatible(t)},isBase:function(){return void 0!==this._isBase?this._isBase:this.isDegrees()&&this.numerator[0].match(/<(kelvin|temp-K)>/)?(this._isBase=!0,this._isBase):(this.numerator.concat(this.denominator).forEach((function(t){"<1>"!==t&&-1===d.indexOf(t)&&(this._isBase=!1)}),this),!1===this._isBase||(this._isBase=!0),this._isBase)}}),W.prototype.get=function(t){return arguments.length>1&&(t=Array.apply(null,arguments)),t.reduce((function(e,r,i){if(e){var n=e[r];return i===t.length-1?n?n.data:void 0:n}}),this)},W.prototype.set=function(t,e){return arguments.length>2&&(t=Array.prototype.slice.call(arguments,0,-1),e=arguments[arguments.length-1]),t.reduce((function(r,i,n){var s=r[i];return void 0===s&&(s=r[i]={}),n===t.length-1?(s.data=e,e):s}),this)},$.formatter=function(t,e){return(t+" "+e).trim()},s($.prototype,{units:function(){if(void 0!==this._units)return this._units;var t=n(this.numerator,m),e=n(this.denominator,m);if(t&&e)return this._units="",this._units;var r=J(this.numerator),i=J(this.denominator);return this._units=r+(e?"":"/"+i),this._units},toString:function(e,i){var n;if(r(e))n=this.units(),i=e;else if(t(e))n=e;else if(U(e))return this.toPrec(e).toString(i);var s=this.to(n);return s=((void 0!==i?l(s.scalar,i):s.scalar)+" "+s.units()).trim()},format:function(t,e){1===arguments.length&&"function"==typeof t&&(e=t,t=void 0),e=e||$.formatter;var r=this.to(t);return e.call(this,r.scalar,r.units())}});var q=new W;function J(t){var e=q.get(t);return e||(e=n(t,m)?"1":function(t){return t.reduce((function(t,e){var r=t[e];return r||t.push(r=t[e]=[e,0]),r[1]++,t}),[]).map((function(t){return t[0]+(t[1]>1?t[1]:"")}))}(function(t){for(var e,r,i=[],n=0;n<t.length;n++)e=t[n],r=t[n+1],p[e]?(i.push(_[e]+_[r]),n++):i.push(_[e]);return i}(t)).join("*"),q.set(t,e),e)}return $.version="1.7.5",$}()}));function feretDiameters(t={}){const{originalPoints:e=monotoneChainConvexHull$1.call(this)}=t;if(0===e.length)return{min:0,max:0,minLine:[],maxLine:[],aspectRatio:1};if(1===e.length)return{min:1,max:1,minLine:[e[0],e[0]],maxLine:[e[0],e[0]],aspectRatio:1};const r=new Array(e.length);let i=1/0,n=0,s=[];for(let t=0;t<e.length;t++){let a=getAngle$1(e[t],e[(t+1)%e.length]);rotate$1(-a,e,r);let o=0,l=[];for(let i=0;i<e.length;i++){let e=Math.abs(r[t][1]-r[i][1]);e>o&&(o=e,l=[],l.push([r[i][0],r[t][1]],[r[i][0],r[i][1]]))}o<i&&(i=o,n=a,s=l)}rotate$1(n,s,s);let a=0,o=[],l=0;for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){let i=(e[t][0]-e[r][0])**2+(e[t][1]-e[r][1])**2;i>l&&(l=i,a=Math.sqrt(i),o=[e[t],e[r]])}return{min:i,minLine:s,max:a,maxLine:o,aspectRatio:i/a}}function getAngle$1(t,e){let r=normalize(difference(e,t)),i=Math.acos(r[0]);return r[1]<0?-i:i}class Roi{constructor(t,e){this.map=t,this.id=e,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.meanX=0,this.meanY=0,this.surface=0,this.computed={}}getMask(t={}){const{scale:e=1,kind:r=""}=t;let i;switch(r){case"contour":i=this.contourMask;break;case"box":i=this.boxMask;break;case"filled":i=this.filledMask;break;case"center":i=this.centerMask;break;case"hull":i=this.convexHullMask;break;case"mbr":i=this.mbrMask;break;case"feret":i=this.feretMask;break;default:i=this.mask}return e<1&&(i=i.resize({factor:e}),i.parent=this.mask.parent,i.position[0]+=this.minX,i.position[1]+=this.minY),i}get mean(){throw new Error("Roi mean not implemented yet")}get center(){return this.computed.center||(this.computed.center=[this.width/2>>0,this.height/2>>0]),this.computed.center}get ratio(){return this.width/this.height}get width(){return this.maxX-this.minX+1}get height(){return this.maxY-this.minY+1}_computExternalIDs(){let t=this.borderIDs,e=this.borderLengths;this.computed.externalIDs=[],this.computed.externalLengths=[];let r=this.internalIDs;for(let i=0;i<t.length;i++)r.includes(t[i])||(this.computed.externalIDs.push(t[i]),this.computed.externalLengths.push(e[i]))}get externalIDs(){return this.computed.externalIDs||this._computExternalIDs(),this.computed.externalIDs}get externalLengths(){return this.computed.externalLengths||this._computExternalIDs(),this.computed.externalLengths}_computeBorderIDs(){let t=getBorders(this);this.computed.borderIDs=t.ids,this.computed.borderLengths=t.lengths}get borderIDs(){return this.computed.borderIDs||this._computeBorderIDs(),this.computed.borderIDs}get borderLengths(){return this.computed.borderLengths||this._computeBorderIDs(),this.computed.borderLengths}get boxIDs(){return this.computed.boxIDs||(this.computed.boxIDs=getBoxIDs(this)),this.computed.boxIDs}get internalIDs(){return this.computed.internalIDs||(this.computed.internalIDs=getInternalIDs(this)),this.computed.internalIDs}get box(){return this.computed.box||(this.computed.box=getBox(this)),this.computed.box}get external(){return this.computed.external||(this.computed.external=getExternal(this)),this.computed.external}get border(){return this.computed.border||(this.computed.border=getBorder(this)),this.computed.border}get contourMask(){if(!this.computed.contourMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++)this.map.data[e+this.minX+(r+this.minY)*this.map.width]===this.id&&(e>0&&e<this.width-1&&r>0&&r<this.height-1&&this.map.data[e-1+this.minX+(r+this.minY)*this.map.width]===this.id&&this.map.data[e+1+this.minX+(r+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(r-1+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(r+1+this.minY)*this.map.width]===this.id||t.setBitXY(e,r));this.computed.contourMask=t}return this.computed.contourMask}get boxMask(){if(!this.computed.boxMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)t.setBitXY(e,0),t.setBitXY(e,this.height-1);for(let e=0;e<this.height;e++)t.setBitXY(0,e),t.setBitXY(this.width-1,e);this.computed.boxMask=t}return this.computed.boxMask}get mask(){if(!this.computed.mask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++)this.map.data[e+this.minX+(r+this.minY)*this.map.width]===this.id&&t.setBitXY(e,r);this.computed.mask=t}return this.computed.mask}get filledMask(){if(!this.computed.filledMask){let t=new Image(this.width,this.height,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++){let i=e+this.minX+(r+this.minY)*this.map.width;this.internalIDs.includes(this.map.data[i])&&t.setBitXY(e,r)}this.computed.filledMask=t}return this.computed.filledMask}get centerMask(){if(!this.computed.centerMask){let t=new Shape({kind:"smallCross"}).getMask();t.parent=this.map.parent,t.position=[this.minX+this.center[0]-1,this.minY+this.center[1]-1],this.computed.centerMask=t}return this.computed.centerMask}get convexHull(){if(!this.computed.convexHull){const t=[];for(let e=0;e<this.width;e++)for(let r=0;r<this.height;r++)this.map.data[e+this.minX+(r+this.minY)*this.map.width]===this.id&&(e>0&&e<this.width-1&&r>0&&r<this.height-1&&this.map.data[e-1+this.minX+(r+this.minY)*this.map.width]===this.id&&this.map.data[e+1+this.minX+(r+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(r-1+this.minY)*this.map.width]===this.id&&this.map.data[e+this.minX+(r+1+this.minY)*this.map.width]===this.id||(t.push([e,r]),t.push([e+1,r]),t.push([e,r+1]),t.push([e+1,r+1])));const e=monotoneChainConvexHull(t);this.computed.convexHull={polyline:e,surface:surface(e),perimeter:perimeter(e)}}return this.computed.convexHull}get convexHullMask(){if(!this.computed.convexHullMask){const t=this.convexHull,e=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});e.paintPolyline(t.polyline,{closed:!0}),this.computed.convexHullMask=e}return this.computed.convexHullMask}get mbr(){if(!this.computed.mbr){let t=minimalBoundingRectangle({originalPoints:this.convexHull.polyline});if(0===t.length)this.computed.mbr={width:0,height:0,surface:0,perimeter:0,rectangle:t};else{let e=t[0],r=t[1],i=t[2],n=Math.sqrt((e[0]-r[0])**2+(e[1]-r[1])**2),s=Math.sqrt((i[0]-r[0])**2+(i[1]-r[1])**2);this.computed.mbr={width:n,height:s,elongation:1-n/s,aspectRatio:n/s,surface:n*s,perimeter:2*(n+s),rectangle:t}}}return this.computed.mbr}get feretDiameters(){return this.computed.feretDiameters||(this.computed.feretDiameters=feretDiameters({originalPoints:this.convexHull.polyline})),this.computed.feretDiameters}get eqpc(){return this.computed.eqpc||(this.computed.eqpc=2*Math.sqrt(this.surface/Math.PI)),this.computed.eqpc}get perimeterInfo(){return this.computed.perimeterInfo||(this.computed.perimeterInfo=getPerimeterInfo(this)),this.computed.perimeterInfo}get perimeter(){let t=this.perimeterInfo,e=2-Math.sqrt(2);return t.one+2*t.two+3*t.three+4*t.four-e*(t.two+2*t.three+t.four)}get ped(){return this.computed.ped||(this.computed.ped=this.perimeter/Math.PI),this.computed.ped}get feretMask(){if(!this.computed.feretMask){const t=new Image(this.width+1,this.height+1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent});t.paintPolyline(this.feretDiameters.minLine),t.paintPolyline(this.feretDiameters.maxLine),this.computed.feretMask=t}return this.computed.feretMask}get mbrMask(){if(!this.computed.mbrMask){let t=round(this.mbr.rectangle);if(t.length>0){const e=minMax(t),r=new Image(e[1][0]-e[0][0]+1,e[1][1]-e[0][1]+1,{kind:BINARY,position:[this.minX+e[0][0],this.minY+e[0][1]],parent:this.map.parent});t=moveToZeroZero(t),r.paintPolyline(t,{closed:!0}),this.computed.mbrMask=r}else this.computed.mbrMask=new Image(1,1,{kind:BINARY,position:[this.minX,this.minY],parent:this.map.parent})}return this.computed.mbrMask}get points(){if(!this.computed.points){let t=[];for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++){let i=(e+this.minY)*this.map.width+r+this.minX;this.map.data[i]===this.id&&t.push([r,e])}this.computed.points=t}return this.computed.points}get maxLengthPoints(){if(!this.computed.maxLengthPoints){let t,e=0;const r=this.points;for(let i=0;i<r.length;i++)for(let n=i+1;n<r.length;n++){let s=Math.pow(r[i][0]-r[n][0],2)+Math.pow(r[i][1]-r[n][1],2);s>=e&&(e=s,t=[r[i],r[n]])}this.computed.maxLengthPoints=t}return this.computed.maxLengthPoints}get maxLength(){if(!this.computed.maxLength){let t=Math.sqrt(Math.pow(this.maxLengthPoints[0][0]-this.maxLengthPoints[1][0],2)+Math.pow(this.maxLengthPoints[0][1]-this.maxLengthPoints[1][1],2));this.computed.maxLength=t}return this.computed.maxLength}get roundness(){return 4*this.surface/(Math.PI*this.feretDiameters.max)**2}get sphericity(){return 2*Math.sqrt(this.surface*Math.PI)/this.perimeter}get convexity(){return this.surface/this.convexHull.surface}get angle(){if(!this.computed.angle){let t=this.maxLengthPoints,e=180*-Math.atan2(t[0][1]-t[1][1],t[0][0]-t[1][0])/Math.PI;this.computed.angle=e}return this.computed.angle}toJSON(){return{id:this.id,minX:this.minX,maxX:this.maxX,minY:this.minY,maxY:this.maxY,meanX:this.meanX,meanY:this.meanY,height:this.height,width:this.width,surface:this.surface,mbrWidth:this.mbr.width,mbrHeight:this.mbr.height,mbrSurface:this.mbr.surface,eqpc:this.eqpc,ped:this.ped,feretDiameterMin:this.feretDiameters.min,feretDiameterMax:this.feretDiameters.max,aspectRatio:this.feretDiameters.aspectRatio,sphericity:this.sphericity,roundness:this.roundness,convexity:this.convexity,perimeter:this.perimeter}}}function getBorders(t){let e=t.map,r=e.data,i=new Set,n=new Map,s=new Set,a=[1,0,-1,0],o=[0,1,0,-1];for(let l=t.minX;l<=t.maxX;l++)for(let h=t.minY;h<=t.maxY;h++)if(r[l+h*e.width]===t.id)for(let c=0;c<4;c++){let u=l+a[c],f=h+o[c];if(u>=0&&f>=0&&u<e.width&&f<e.height){let a=u+f*e.width;if(r[a]!==t.id&&!s.has(a)){s.add(a),i.add(r[a]);let t=n.get(r[a]);t?n.set(r[a],++t):n.set(r[a],1)}}}let l=Array.from(i),h=l.map((function(t){return n.get(t)}));return{ids:l,lengths:h}}function getBoxIDs(t){let e=new Set,r=t.map,i=r.data;for(let n of[0,t.height-1])for(let s=0;s<t.width;s++){let a=(n+t.minY)*r.width+s+t.minX;if(s-t.minX>0&&i[a]===t.id&&i[a-1]!==t.id){let t=i[a-1];e.add(t)}if(r.width-s-t.minX>1&&i[a]===t.id&&i[a+1]!==t.id){let t=i[a+1];e.add(t)}}for(let n of[0,t.width-1])for(let s=0;s<t.height;s++){let a=(s+t.minY)*r.width+n+t.minX;if(s-t.minY>0&&i[a]===t.id&&i[a-r.width]!==t.id){let t=i[a-r.width];e.add(t)}if(r.height-s-t.minY>1&&i[a]===t.id&&i[a+r.width]!==t.id){let t=i[a+r.width];e.add(t)}}return Array.from(e)}function getBox(t){let e=0,r=t.map,i=r.data,n=[0];t.height>1&&(n[1]=t.height-1);for(let s of n)for(let n=1;n<t.width-1;n++)i[(s+t.minY)*r.width+n+t.minX]===t.id&&e++;let s=[0];t.width>1&&(s[1]=t.width-1);for(let n of s)for(let s=0;s<t.height;s++)i[(s+t.minY)*r.width+n+t.minX]===t.id&&e++;return e}function getBorder(t){let e=0,r=t.map,i=r.data;for(let n=1;n<t.width-1;n++)for(let s=1;s<t.height-1;s++){let a=(s+t.minY)*r.width+n+t.minX;i[a]===t.id&&(i[a-1]===t.id&&i[a+1]===t.id&&i[a-r.width]===t.id&&i[a+r.width]===t.id||e++)}return e+t.box}function getPerimeterInfo(t){let e=t.map,r=e.data,i=0,n=0,s=0,a=0;for(let o=0;o<t.width;o++)for(let l=0;l<t.height;l++){let h=(l+t.minY)*e.width+o+t.minX;if(r[h]===t.id){let c=0;switch((0===o||t.externalIDs.includes(r[h-1]))&&c++,(o===t.width-1||t.externalIDs.includes(r[h+1]))&&c++,(0===l||t.externalIDs.includes(r[h-e.width]))&&c++,(l===t.height-1||t.externalIDs.includes(r[h+e.width]))&&c++,c){case 1:i++;break;case 2:n++;break;case 3:s++;break;case 4:a++}}}return{one:i,two:n,three:s,four:a}}function getExternal(t){let e=0,r=t.map,i=r.data;for(let n=1;n<t.width-1;n++)for(let s=1;s<t.height-1;s++){let a=(s+t.minY)*r.width+n+t.minX;i[a]===t.id&&(t.externalIDs.includes(i[a-1])||t.externalIDs.includes(i[a+1])||t.externalIDs.includes(i[a-r.width])||t.externalIDs.includes(i[a+r.width]))&&e++}return e+t.box}function getInternalIDs(t){let e=[t.id],r=t.map,i=r.data;if(t.height>2)for(let n=0;n<t.width;n++){let s=t.minY*r.width+n+t.minX;if(e.includes(i[s])){let n=i[s+r.width];e.includes(n)||t.boxIDs.includes(n)||e.push(n)}}let n=new Array(4);for(let s=1;s<t.width-1;s++)for(let a=1;a<t.height-1;a++){let o=(a+t.minY)*r.width+s+t.minX;if(e.includes(i[o])){n[0]=i[o-1],n[1]=i[o+1],n[2]=i[o-r.width],n[3]=i[o+r.width];for(let r=0;r<4;r++){let i=n[r];e.includes(i)||t.boxIDs.includes(i)||e.push(i)}}}return e}class RoiLayer{constructor(t,e){this.roiMap=t,this.options=e,this.roi=this.createRoi()}createRoi(){let t=this.roiMap.data,e={};this.roiMap.positive=0,this.roiMap.negative=0;for(let r=0;r<t.length;r++)t[r]&&!e[t[r]]&&(e[t[r]]=!0,t[r]>0?this.roiMap.positive++:this.roiMap.negative++);let r={};for(let t in e)r[t]=new Roi(this.roiMap,1*t);let i=this.roiMap.width,n=this.roiMap.height;for(let e=0;e<n;e++)for(let n=0;n<i;n++){let s=e*i+n;if(0!==t[s]){const i=r[t[s]];n<i.minX&&(i.minX=n),n>i.maxX&&(i.maxX=n),e<i.minY&&(i.minY=e),e>i.maxY&&(i.maxY=e),i.meanX+=n,i.meanY+=e,i.surface++}}let s=[];for(let t in e)r[t].meanX/=r[t].surface,r[t].meanY/=r[t].surface,s.push(r[t]);return s}}function commonBorderLength(t){let e=t.data,r=[1,0,-1,0],i=[0,1,0,-1],n=t.minMax,s=-n.min,a=n.max+s,o=[];for(let t=0;t<=a;t++)o.push(Object.create(null));for(let n=0;n<t.width;n++)for(let a=0;a<t.height;a++){let l=e[n+a*t.width];if(0!==l){let h=Object.create(null),c=!1;for(let u=0;u<4;u++){let f=n+r[u],d=a+i[u];if(f>=0&&d>=0&&f<t.width&&d<t.height){let r=e[f+d*t.width];l!==r&&(c=!0,0!==r&&void 0===h[r]&&(h[r]=!0,o[r+s][l]?o[r+s][l]++:o[r+s][l]=1))}else c=!0}c&&(o[l+s][l]?o[l+s][l]++:o[l+s][l]=1)}}let l={};for(let t=0;t<o.length;t++)Object.keys(o[t]).length>0&&(l[t-s]=o[t]);return l}function mergeRoi(t={}){const{algorithm:e="commonBorderLength",minCommonBorderLength:r=5,maxCommonBorderLength:i=100,minCommonBorderRatio:n=.3,maxCommonBorderRatio:s=1}=t;let a=function(t,e,n){return t[n]>=r&&t[n]<=i};"function"==typeof e&&(a=e),"commonborderratio"===e.toLowerCase()&&(a=function(t,e,r){let i=Math.min(t[r]/t[e],1);return i>=n&&i<=s});const o=this.commonBorderLength;let l={},h={};for(let t of Object.keys(o)){let e=o[t],r=Object.keys(e);for(let i of r)if(i!==t&&a(e,t,i)){let e=i;h[i]&&(e=h[i]);let r=t;if(h[t]&&(r=h[t]),Number(e)!==r){let t=Math.min(e,r),i=Math.max(e,r);if(l[t]||(l[t]={}),l[t][i]=!0,h[i]=t,l[i]){for(let e of Object.keys(l[i]))l[t][e]=!0,h[e]=t;delete l[i]}}}}let c=this.minMax,u=-c.min,f=c.max+u,d=new Array(f+1).fill(0);for(let t of Object.keys(h))d[Number(t)+u]=h[t];let m=this.data;for(let t=0;t<m.length;t++){let e=m[t];if(0!==e){let r=d[e+u];0!==r&&(m[t]=r)}}return this.computed={},this}class RoiMap{constructor(t,e){this.parent=t,this.width=t.width,this.height=t.height,this.data=e,this.negative=0,this.positive=0}get total(){return this.negative+this.positive}get minMax(){let t=Number.MAX_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER;for(let r=0;r<this.data.length;r++)this.data[r]<t&&(t=this.data[r]),this.data[r]>e&&(e=this.data[r]);return{min:t,max:e}}get commonBorderLength(){return commonBorderLength(this)}mergeRoi(t={}){return mergeRoi.call(this,t)}mergeRois(t){const e=t[0],r=t.slice(1);for(let t=0;t<this.data.length;t++)r.includes(this.data[t])&&(this.data[t]=e)}rowsInfo(){let t=new Array(this.height),e=0;for(let r=0;r<this.data.length;r+=this.width){let i={row:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=i;let n={},s={},a=[],o=this.data[r],l=0;for(let t=r;t<r+this.width;t++){let e=this.data[t];o!==e&&(o=e,a.push(l),l=0),l++,e>0?(i.positivePixel++,n[e]||(n[e]=!0)):e<0?(i.negativePixel++,s[e]||(s[e]=!0)):i.zeroPixel++}a.push(l),i.medianChange=a.sort((t,e)=>t-e)[Math.floor(a.length/2)],i.positiveRoiIDs=Object.keys(n),i.negativeRoiIDs=Object.keys(s),i.positiveRoi=i.positiveRoiIDs.length,i.negativeRoi=i.negativeRoiIDs.length}return t}colsInfo(){let t=new Array(this.width),e=0;for(let r=0;r<this.width;r++){let i={col:e,positivePixel:0,negativePixel:0,zeroPixel:0,positiveRoi:0,negativeRoi:0,medianChange:0};t[e++]=i;let n={},s={},a=[],o=this.data[r],l=0;for(let t=r;t<r+this.data.length;t+=this.width){let e=this.data[t];o!==e&&(o=e,a.push(l),l=0),l++,e>0?(i.positivePixel++,n[e]||(n[e]=!0)):e<0?(i.negativePixel++,s[e]||(s[e]=!0)):i.zeroPixel++}a.push(l),i.medianChange=a.sort((t,e)=>t-e)[Math.floor(a.length/2)],i.positiveRoiIDs=Object.keys(n),i.negativeRoiIDs=Object.keys(s),i.positiveRoi=i.positiveRoiIDs.length,i.negativeRoi=i.negativeRoiIDs.length}return t}}function fromMask(t,e={}){const{allowCorners:r=!1}=e;let i=new Int16Array(t.size),n=0,s=0,a=new Uint16Array(65536),o=new Uint16Array(65536);for(let e=0;e<t.width;e++)for(let r=0;r<t.height;r++)0===i[r*t.width+e]&&l(e,r);function l(e,l){let h=0,c=0,u=t.getBitXY(e,l),f=u?++n:--s;if(n>32767||s<-32768)throw new Error("Too many regions of interest");for(a[0]=e,o[0]=l;h<=c;){let e=a[65535&h],n=o[65535&h];if(i[n*t.width+e]=f,e>0&&0===i[n*t.width+e-1]&&t.getBitXY(e-1,n)===u&&(c++,a[65535&c]=e-1,o[65535&c]=n,i[n*t.width+e-1]=-32768),n>0&&0===i[(n-1)*t.width+e]&&t.getBitXY(e,n-1)===u&&(c++,a[65535&c]=e,o[65535&c]=n-1,i[(n-1)*t.width+e]=-32768),e<t.width-1&&0===i[n*t.width+e+1]&&t.getBitXY(e+1,n)===u&&(c++,a[65535&c]=e+1,o[65535&c]=n,i[n*t.width+e+1]=-32768),n<t.height-1&&0===i[(n+1)*t.width+e]&&t.getBitXY(e,n+1)===u&&(c++,a[65535&c]=e,o[65535&c]=n+1,i[(n+1)*t.width+e]=-32768),r&&(e>0&&n>0&&0===i[(n-1)*t.width+e-1]&&t.getBitXY(e-1,n-1)===u&&(c++,a[65535&c]=e-1,o[65535&c]=n-1,i[(n-1)*t.width+e-1]=-32768),e<t.width-1&&n>0&&0===i[(n-1)*t.width+e+1]&&t.getBitXY(e+1,n-1)===u&&(c++,a[65535&c]=e+1,o[65535&c]=n-1,i[(n-1)*t.width+e+1]=-32768),e>0&&n<t.height-1&&0===i[(n+1)*t.width+e-1]&&t.getBitXY(e-1,n+1)===u&&(c++,a[65535&c]=e-1,o[65535&c]=n+1,i[(n+1)*t.width+e-1]=-32768),e<t.width-1&&n<t.height-1&&0===i[(n+1)*t.width+e+1]&&t.getBitXY(e+1,n+1)===u&&(c++,a[65535&c]=e+1,o[65535&c]=n+1,i[(n+1)*t.width+e+1]=-32768)),h++,c-h>65535)throw new Error("analyseMask can not finish, the array to manage internal data is not big enough.You could improve mask by changing MAX_ARRAY")}}return new RoiMap(t,i)}class DisjointSet{constructor(){this.nodes=new Map}add(t){var e=this.nodes.get(t);return e||(e=new DisjointSetNode(t),this.nodes.set(t,e)),e}union(t,e){const r=this.find(t),i=this.find(e);r!==i&&(r.rank<i.rank?r.parent=i:r.rank>i.rank?i.parent=r:(i.parent=r,r.rank++))}find(t){for(var e=t;null!==e.parent;)e=e.parent;for(var r=t;null!==r.parent;){var i=r;r=r.parent,i.parent=e}return e}connected(t,e){return this.find(t)===this.find(e)}}var DisjointSet_1=DisjointSet;function DisjointSetNode(t){this.value=t,this.parent=null,this.rank=0}const direction4X=[-1,0],direction4Y=[0,-1],neighbours4=[null,null],direction8X=[-1,-1,0,1],direction8Y=[0,-1,-1,-1],neighbours8=[null,null,null,null];function fromMaskConnectedComponentLabelingAlgorithm(t,e={}){const{allowCorners:r=!1}=e;let i,n,s,a=4;if(r&&(a=8),8===a)i=direction8X,n=direction8Y,s=neighbours8;else{if(4!==a)throw new RangeError("unsupported neighbours count: "+a);i=direction4X,n=direction4Y,s=neighbours4}const o=t.size,l=t.width,h=t.height,c=new Array(o),u=new Uint32Array(o),f=new DisjointSet_1;let d=1;for(let e=0;e<h;e++)for(let r=0;r<l;r++){const a=r+e*l;if(t.getBit(a)){let t=null;for(let a=0;a<s.length;a++){const o=r+i[a],u=e+n[a];if(o>=0&&u>=0&&o<l&&u<h){let e=c[o+u*l];e?(s[a]=e,(!t||s[a].value<t.value)&&(t=s[a])):s[a]=null}}if(t){c[a]=t;for(let e=0;e<s.length;e++)s[e]&&s[e]!==t&&f.union(t,s[e])}else c[a]=f.add(d++)}}for(let e=0;e<h;e++)for(let r=0;r<l;r++){const i=r+e*l;t.getBit(i)&&(u[i]=f.find(c[i]).value)}return new RoiMap(t,u)}function fromMaxima(t={}){let{allowCorner:e=!0,onlyTop:r=!1,invert:i=!1}=t,n=this;n.checkProcessable("fromMaxima",{components:[1]});let s=0,a=0,o=new Int16Array(n.size),l=new Int8Array(n.size),h=new Float32Array(n.size),c=new Uint16Array(1048576),u=new Uint16Array(1048576),f=0,d=0,m=new Uint16Array(1048576),g=new Uint16Array(1048576),p=0,w=0;for(function({maxima:t=!0}){for(let r=1;r<n.height-1;r++)for(let i=1;i<n.width-1;i++){let h=i+r*n.width;if(0===l[h]){let l=t?n.data[h]:-n.data[i+r*n.width];if(n.data[r*n.width+i-1]>l)continue;if(n.data[r*n.width+i+1]>l)continue;if(n.data[(r-1)*n.width+i]>l)continue;if(n.data[(r+1)*n.width+i]>l)continue;if(e){if(n.data[(r-1)*n.width+i-1]>l)continue;if(n.data[(r-1)*n.width+i+1]>l)continue;if(n.data[(r+1)*n.width+i-1]>l)continue;if(n.data[(r+1)*n.width+i+1]>l)continue}o[h]=t?++s:--a,b(i,r)||(t?--s:++a)}}}(n);f<d;)y(c[1048575&f],u[1048575&f],2),f++;return new RoiMap(n,o);function b(t,e){let r=d;p=0,w=1,m[0]=t,g[0]=e;let i=!0;for(;p<w;)i&=y(m[1048575&p],g[1048575&p],1),p++;if(!i){for(let t=0;t<w;t++){let e=m[1048575&t],r=g[1048575&t]*n.width+e;o[r]=0}d=r}return i}function y(t,e,i){let s=o[e*n.width+t],a=n.data[e*n.width+t];for(let f=e-1;f<=e+1;f++)for(let e=t-1;e<=t+1;e++){let t=f*n.width+e;if(0===l[t])switch(l[t]=1,h[t]=n.data[t]-a,i){case 1:if(0===h[t]){if(0===e||0===f||e===n.width-1||f===n.height-1)return!1;o[t]=s,m[1048575&w]=e,g[1048575&w]=f,w++}else{if(h[t]>0)return!1;r||(o[t]=s,c[1048575&d]=e,u[1048575&d]=f,d++)}break;case 2:h[t]<=0&&(o[t]=s,c[1048575&d]=e,u[1048575&d]=f,d++);break;default:throw new Error("unreachable")}}return!0}}function fromPoints(t,e={}){let r=new Shape(e),i=new Int16Array(this.size),n=0,s=r.getPoints();for(let e=0;e<t.length;e++){n++;let r=t[e][0],a=t[e][1];for(let t=0;t<s.length;t++){let e=s[t][0],o=s[t][1];r+e>=0&&a+o>=0&&r+e<this.width&&a+o<this.height&&(i[r+e+(a+o)*this.width]=n)}}return new RoiMap(this,i)}var priorityQueue=createCommonjsModule((function(t,e){t.exports=function t(e,r,i){function n(a,o){if(!r[a]){if(!e[a]){var l="function"==typeof commonjsRequire&&commonjsRequire;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var c=r[a]={exports:{}};e[a][0].call(c.exports,(function(t){var r=e[a][1][t];return n(r||t)}),c,c.exports,t,e,r,i)}return r[a].exports}for(var s="function"==typeof commonjsRequire&&commonjsRequire,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(t,e,r){var i,n,s,a,o,l={}.hasOwnProperty;i=t("./PriorityQueue/AbstractPriorityQueue"),n=t("./PriorityQueue/ArrayStrategy"),a=t("./PriorityQueue/BinaryHeapStrategy"),s=t("./PriorityQueue/BHeapStrategy"),(o=function(t){function e(t){t||(t={}),t.strategy||(t.strategy=a),t.comparator||(t.comparator=function(t,e){return(t||0)-(e||0)}),e.__super__.constructor.call(this,t)}return function(t,e){for(var r in e)l.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,t),e}(i)).ArrayStrategy=n,o.BinaryHeapStrategy=a,o.BHeapStrategy=s,e.exports=o},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(t,e,r){e.exports=function(){function t(t){var e;if(null==(null!=t?t.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=t?t.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new t.strategy(t),this.length=(null!=t&&null!=(e=t.initialValues)?e.length:void 0)||0}return t.prototype.queue=function(t){this.length++,this.priv.queue(t)},t.prototype.dequeue=function(t){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},t.prototype.peek=function(t){if(!this.length)throw"Empty queue";return this.priv.peek()},t.prototype.clear=function(){return this.length=0,this.priv.clear()},t}()},{}],3:[function(t,e,r){var i;i=function(t,e,r){var i,n,s;for(n=0,i=t.length;n<i;)r(t[s=n+i>>>1],e)>=0?n=s+1:i=s;return n},e.exports=function(){function t(t){var e;this.options=t,this.comparator=this.options.comparator,this.data=(null!=(e=this.options.initialValues)?e.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return t.prototype.queue=function(t){var e;e=i(this.data,t,this.comparator),this.data.splice(e,0,t)},t.prototype.dequeue=function(){return this.data.pop()},t.prototype.peek=function(){return this.data[this.data.length-1]},t.prototype.clear=function(){this.data.length=0},t}()},{}],4:[function(t,e,r){e.exports=function(){function t(t){var e,r,i,n,s,a,o,l;for(this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.pageSize=(null!=t?t.pageSize:void 0)||512,this.length=0,o=0;1<<o<this.pageSize;)o+=1;if(1<<o!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=o,this._emptyMemoryPageTemplate=e=[],r=0,s=this.pageSize;0<=s?r<s:r>s;0<=s?++r:--r)e.push(null);if(this._memory=[],this._mask=this.pageSize-1,t.initialValues)for(i=0,n=(a=t.initialValues).length;i<n;i++)l=a[i],this.queue(l)}return t.prototype.queue=function(t){this.length+=1,this._write(this.length,t),this._bubbleUp(this.length,t)},t.prototype.dequeue=function(){var t,e;return t=this._read(1),e=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,e),this._bubbleDown(1,e)),t},t.prototype.peek=function(){return this._read(1)},t.prototype.clear=function(){this.length=0,this._memory.length=0},t.prototype._write=function(t,e){var r;for(r=t>>this._shift;r>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[r][t&this._mask]=e},t.prototype._read=function(t){return this._memory[t>>this._shift][t&this._mask]},t.prototype._bubbleUp=function(t,e){var r,i,n,s;for(r=this.comparator;t>1&&(i=t&this._mask,t<this.pageSize||i>3?n=t&~this._mask|i>>1:i<2?(n=t-this.pageSize>>this._shift,n+=n&~(this._mask>>1),n|=this.pageSize>>1):n=t-2,!(r(s=this._read(n),e)<0));)this._write(n,e),this._write(t,s),t=n},t.prototype._bubbleDown=function(t,e){var r,i,n,s,a;for(a=this.comparator;t<this.length;)if(t>this._mask&&!(t&this._mask-1)?r=i=t+2:t&this.pageSize>>1?(r=(t&~this._mask)>>1,i=1+(r=1+(r|=t&this._mask>>1)<<this._shift)):i=(r=t+(t&this._mask))+1,r!==i&&i<=this.length)if(n=this._read(r),s=this._read(i),a(n,e)<0&&a(n,s)<=0)this._write(r,e),this._write(t,n),t=r;else{if(!(a(s,e)<0))break;this._write(i,e),this._write(t,s),t=i}else{if(!(r<=this.length))break;if(!(a(n=this._read(r),e)<0))break;this._write(r,e),this._write(t,n),t=r}},t}()},{}],5:[function(t,e,r){e.exports=function(){function t(t){var e;this.comparator=(null!=t?t.comparator:void 0)||function(t,e){return t-e},this.length=0,this.data=(null!=(e=t.initialValues)?e.slice(0):void 0)||[],this._heapify()}return t.prototype._heapify=function(){var t,e,r;if(this.data.length>0)for(t=e=1,r=this.data.length;1<=r?e<r:e>r;t=1<=r?++e:--e)this._bubbleUp(t)},t.prototype.queue=function(t){this.data.push(t),this._bubbleUp(this.data.length-1)},t.prototype.dequeue=function(){var t,e;return e=this.data[0],t=this.data.pop(),this.data.length>0&&(this.data[0]=t,this._bubbleDown(0)),e},t.prototype.peek=function(){return this.data[0]},t.prototype.clear=function(){this.length=0,this.data.length=0},t.prototype._bubbleUp=function(t){for(var e,r;t>0&&(e=t-1>>>1,this.comparator(this.data[t],this.data[e])<0);)r=this.data[e],this.data[e]=this.data[t],this.data[t]=r,t=e},t.prototype._bubbleDown=function(t){var e,r,i,n,s;for(e=this.data.length-1;n=1+(r=1+(t<<1)),i=t,r<=e&&this.comparator(this.data[r],this.data[i])<0&&(i=r),n<=e&&this.comparator(this.data[n],this.data[i])<0&&(i=n),i!==t;)s=this.data[i],this.data[i]=this.data[t],this.data[t]=s,t=i},t}()},{}]},{},[1])(1)}));const dxs=[1,0,-1,0,1,1,-1,-1],dys=[0,1,0,-1,1,-1,1,-1];function fromWaterShed(t={}){let{points:e,mask:r,image:i,fillMaxValue:n=this.maxValue,invert:s=!1}=t,a=i||this;a.checkProcessable("fromWaterShed",{bitDepth:[8,16],components:1}),s=!s,e||(e=a.getLocalMaxima({invert:s,mask:r}));let o=s?0:1,l=new Int16Array(a.size),h=a.width,c=a.height,u=new priorityQueue({comparator:(t,e)=>t[2]-e[2],strategy:priorityQueue.BinaryHeapStrategy});for(let t=0;t<e.length;t++){let r=e[t][0]+e[t][1]*h;l[r]=t+1;let i=a.data[r];(s&&i<=n||!s&&i>=n)&&u.queue([e[t][0],e[t][1],i])}for(;u.length>0;){let t=u.dequeue(),e=t[0]+t[1]*h;for(let i=0;i<4;i++){let f=t[0]+dxs[i],d=t[1]+dys[i];if(f>=0&&d>=0&&f<h&&d<c){let c=f+d*h;if(!r||r.getBit(c)===o){let r=a.data[c];(s&&r<=n||!s&&r>=n)&&0===l[c]&&(l[c]=l[e],u.queue([t[0]+dxs[i],t[1]+dys[i],r]))}}}}return new RoiMap(a,l)}class RoiManager{constructor(t,e={}){this._image=t,this._options=e,this._options.label||(this._options.label="default"),this._layers={},this._painted=null}fromMaxima(t={}){let e=Object.assign({},this._options,t),r=fromMaxima.call(this._image,t);this._layers[e.label]=new RoiLayer(r,e)}fromPoints(t,e={}){let r=Object.assign({},this._options,e),i=fromPoints.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(i,r),this}putMap(t,e={}){let r=new RoiMap(this._image,t),i=Object.assign({},this._options,e);return this._layers[i.label]=new RoiLayer(r,i),this}fromWaterShed(t={}){let e=Object.assign({},this._options,t),r=fromWaterShed.call(this._image,t);this._layers[e.label]=new RoiLayer(r,e)}fromMask(t,e={}){let r=Object.assign({},this._options,e),i=fromMask.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(i,r),this}fromMaskConnectedComponentLabelingAlgorithm(t,e={}){let r=Object.assign({},this._options,e),i=fromMaskConnectedComponentLabelingAlgorithm.call(this._image,t,e);return this._layers[r.label]=new RoiLayer(i,r),this}getMap(t={}){let e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap}rowsInfo(t={}){return this.getMap(t).rowsInfo()}colsInfo(t={}){return this.getMap(t).rowsInfo()}getRoiIds(t={}){let e=this.getRois(t);if(e){let t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r].id;return t}throw new Error("ROIs not found")}getRois(t={}){let{label:e=this._options.label,positive:r=!0,negative:i=!0,minSurface:n=0,maxSurface:s=Number.POSITIVE_INFINITY,minWidth:a=0,maxWidth:o=Number.POSITIVE_INFINITY,minHeight:l=0,maxHeight:h=Number.POSITIVE_INFINITY,minRatio:c=0,maxRatio:u=Number.POSITIVE_INFINITY}=t;if(!this._layers[e])throw new Error(`this Roi layer (${e}) does not exist`);const f=this._layers[e].roi,d=[];for(const t of f)(t.id<0&&i||t.id>0&&r)&&t.surface>=n&&t.surface<=s&&t.width>=a&&t.width<=o&&t.height>=l&&t.height<=h&&t.ratio>=c&&t.ratio<=u&&d.push(t);return d}getRoi(t,e={}){const{label:r=this._options.label}=e;if(!this._layers[r])throw new Error(`this Roi layer (${r}) does not exist`);const i=this._layers[r].roi.find(e=>e.id===t);if(!i)throw new Error("found no Roi with id "+t);return i}getMasks(t={}){let e=this.getRois(t),r=new Array(e.length);for(let i=0;i<e.length;i++)r[i]=e[i].getMask(t);return r}getAnalysisMasks(t={}){const{analysisProperty:e}=t;let r=e+"Mask",i=this.getRois(t);return 0!==i.length&&i[0][r]?i.map(t=>t[r]):[]}getData(t={}){let e=Object.assign({},this._options,t);return this._assertLayerWithLabel(e.label),this._layers[e.label].roiMap.data}paint(t={}){let{labelProperty:e,analysisProperty:r}=t;this._painted||(this._painted=this._image.rgba8());let i=this.getMasks(t);if(e){const r=this.getRois(t);t.labels=r.map(t=>deepValue(t,e));const i=Math.max(...t.labels);let n=!1,s=!1;if(e.includes("surface")?n=!0:e.match(/(perimeter|min|max|external|width|height|length)/)&&(s=!0),isFinite(i)){let e="";if("pixel"!==t.unit&&t.pixelSize&&(s||n)){e=n?t.unit+"^2":t.unit;let r=n?"m^2":"m",i=n?t.pixelSize**2:t.pixelSize;const s=quantities.swiftConverter(r,e);t.labels=t.labels.map(t=>s(i*t))}t.labels=i>50?t.labels.map(t=>Math.round(t)+e):i>10?t.labels.map(t=>t.toFixed(1)+e):t.labels.map(t=>t.toFixed(2)+e)}t.labelsPosition=r.map(t=>[t.meanX,t.meanY])}if(this._painted.paintMasks(i,t),r){let e=this.getAnalysisMasks(t);this._painted.paintMasks(e,{color:t.analysisColor,alpha:t.analysisAlpha})}return this._painted}getMask(t={}){let e=new Image(this._image.width,this._image.height,{kind:"BINARY"}),r=this.getMasks(t);for(let t=0;t<r.length;t++){let i=r[t];for(let t=0;t<i.width;t++)for(let r=0;r<i.height;r++)i.getBitXY(t,r)&&e.setBitXY(t+i.position[0],r+i.position[1])}return e}resetPainted(t={}){const{image:e}=t;this._painted=e?this.image.rgba8():this._image.rgba8()}mergeRoi(t={}){const e=this.getMap(t);return e.mergeRoi(t),this.putMap(e.data,t),this}mergeRois(t,e={}){if(!Array.isArray(t)||t.some(t=>!Number.isInteger(t)))throw new Error("Roi ids must be an array of integers");if(t.length<2)throw new Error("Roi ids must have at least two elements");if(new Set(t).size!==t.length)throw new Error("Roi ids must be all different");t.forEach(t=>this.getRoi(t));const r=this.getMap(e);return r.mergeRois(t),this.putMap(r.data,e),this}findCorrespondingRoi(t,e={}){let r=this.getRois(e),i=[];for(let e=0;e<r.length;e++){let n=r[e],s=correspondingRoisInformation(n.minX,n.minY,n.points,t,Math.sign(n.id));i.push(s)}return i}_assertLayerWithLabel(t){if(!this._layers[t])throw new Error("no layer with label "+t)}}function correspondingRoisInformation(t,e,r,i,n){let s={id:[],surface:[],roiSurfaceCovered:[],same:0,opposite:0,total:0};for(let n=0;n<r.length;n++){let a=r[n],o=a[0]+t+(a[1]+e)*i.width,l=i.data[o];(l>0||l<0)&&(s.id.includes(l)?s.surface[s.id.indexOf(l)]+=1:(s.id.push(l),s.surface.push(1)))}for(let t=0;t<s.id.length;t++)Math.sign(s.id[t])===n?s.same+=s.surface[t]:s.opposite+=s.surface[t],s.roiSurfaceCovered[t]=s.surface[t]/r.length;return s.total=s.opposite+s.same,s}const objectToString=Object.prototype.toString;class Image{constructor(t,e,r,i){if(1===arguments.length?(i=t,({width:t,height:e,data:r}=i)):r&&!r.length&&(i=r,({data:r}=i)),void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i={}),"object"!=typeof i||null===i)throw new TypeError("options must be an object");if(!Number.isInteger(t)||t<=0)throw new RangeError("width must be a positive integer");if(!Number.isInteger(e)||e<=0)throw new RangeError("height must be a positive integer");const{kind:n=RGBA}=i;if("string"!=typeof n)throw new TypeError("kind must be a string");const s=getKind(n),a=Object.assign({},i);for(const t in s)void 0===a[t]&&(a[t]=s[t]);verifyKindDefinition(a);const{components:o,bitDepth:l,colorModel:h}=a,c=a.alpha+0,u=t*e,f=o+c,d=32===l?Number.MAX_VALUE:2**l-1;if(void 0===r)r=createPixelArray(u,o,c,f,l,d);else{const t=getTheoreticalPixelArraySize(u,f,l);if(r.length!==t)throw new RangeError(`incorrect data size: ${r.length}. Should be ${t}`)}this.width=t,this.height=e,this.data=r,this.size=u,this.components=o,this.alpha=c,this.bitDepth=l,this.maxValue=d,this.colorModel=h,this.channels=f,this.meta=i.meta||{},Object.defineProperty(this,"parent",{enumerable:!1,writable:!0,configurable:!0,value:i.parent||null}),this.position=i.position||[0,0],this.computed=null,this.sizes=[this.width,this.height],this.multiplierX=this.channels,this.multiplierY=this.channels*this.width,this.isClamped=this.bitDepth<32,this.borderSizes=[0,0]}get[Symbol.toStringTag](){return"IJSImage"}static isImage(t){return"[object IJSImage]"===objectToString.call(t)}static fromCanvas(t){const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new Image(e.width,e.height,e.data)}static createFrom(t,e){const r=getImageParameters(t);return Object.assign(r,{parent:t,position:[0,0]},e),new Image(r)}getRoiManager(t){return new RoiManager(this,t)}clone(){const t=this.data.slice();return new Image(this.width,this.height,t,this)}apply(t){for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++){let i=(e*this.width+r)*this.channels;t.call(this,i)}}}function laplacianOfGaussian(t,e,r){let i,n,s,a,o=new Array(e);r||(r=100),r*=-1;let l=(e-1)/2,h=2*t*t;for(i=0;i<e;i++)for(o[i]=new Array(e),a=(i-l)*(i-l),n=0;n<e;n++)s=(n-l)*(n-l),o[i][n]=Math.round(r*(1-(s+a)/h)*Math.exp(-(s+a)/h));return o}setValueMethods(Image),setBitMethods(Image),setExportMethods(Image),Image.prototype.checkProcessable=checkProcessable,Image.prototype.getRGBAData=getRGBAData,Image.load=load,Image.extendMethod=extendMethod,Image.extendProperty=extendProperty,extend$1(Image);var kernel$1=Object.freeze({__proto__:null,laplacianOfGaussian:laplacianOfGaussian,DISCRETE_LAPLACE_4:DISCRETE_LAPLACE_4,DISCRETE_LAPLACE_8:DISCRETE_LAPLACE_8,SOBEL_X:SOBEL_X,SOBEL_Y:SOBEL_Y,SCHARR_X:SCHARR_X,SCHARR_Y:SCHARR_Y,SECOND_DERIVATIVE:SECOND_DERIVATIVE,SECOND_DERIVATIVE_INV:SECOND_DERIVATIVE_INV}),worker$1=function(){function t(){this._listeners={}}self.window=self,t.prototype.on=function(t,e){if(this._listeners[t])throw new RangeError("there is already a listener for "+t);if("function"!=typeof e)throw new TypeError("callback argument must be a function");this._listeners[t]=e},t.prototype._send=function(t,e,r){void 0===r?r=[]:Array.isArray(r)||(r=[r]),self.postMessage({id:t,data:e},r)},t.prototype._trigger=function(t,e){if(!this._listeners[t])throw new Error("event "+t+" is not defined");this._listeners[t].apply(null,e)};var e=new t;self.onmessage=function(t){switch(t.data.action){case"exec":t.data.args.unshift((function(r,i){e._send(t.data.id,r,i)})),e._trigger(t.data.event,t.data.args);break;case"ping":e._send(t.data.id,"pong");break;default:throw new Error("unexpected action: "+t.data.action)}}},workerStr=worker$1.toString().split('"CODE";'),newWorkerURL=function(t,e){var r=new Blob(["(",workerStr[0],"importScripts.apply(self, "+JSON.stringify(e)+");\n","(",t,")();",workerStr[1],")();"],{type:"application/javascript"});return URL.createObjectURL(r)},workerTemplate={newWorkerURL:newWorkerURL},CORES=navigator.hardwareConcurrency||1;function WorkerManager(t,e){if("string"!=typeof t&&"function"!=typeof t)throw new TypeError("func argument must be a function");if(void 0===e&&(e={}),"object"!=typeof e||null===e)throw new TypeError("options argument must be an object");this._workerCode=t.toString(),void 0===e.maxWorkers||"auto"===e.maxWorkers?this._numWorkers=Math.min(CORES-1,1):e.maxWorkers>0?this._numWorkers=Math.min(e.maxWorkers,CORES):this._numWorkers=CORES,this._workers=new Map,this._timeout=e.timeout||0,this._terminateOnError=!!e.terminateOnError;var r=e.deps;"string"==typeof r&&(r=[r]),Array.isArray(r)||(r=void 0),this._id=0,this._terminated=!1,this._working=0,this._waiting=[],this._init(r)}WorkerManager.prototype._init=function(t){for(var e=workerTemplate.newWorkerURL(this._workerCode,t),r=0;r<this._numWorkers;r++){var i=new Worker(e);i.onmessage=this._onmessage.bind(this,i),i.onerror=this._onerror.bind(this,i),i.running=!1,i.id=r,this._workers.set(i,null)}URL.revokeObjectURL(e)},WorkerManager.prototype._onerror=function(t,e){if(!this._terminated){this._working--,t.running=!1;var r=this._workers.get(t);r&&r[1](e.message),this._workers.set(t,null),this._terminateOnError?this.terminate():this._exec()}},WorkerManager.prototype._onmessage=function(t,e){if(!this._terminated){this._working--,t.running=!1;var r=this._workers.get(t);r&&r[0](e.data.data),this._workers.set(t,null),this._exec()}},WorkerManager.prototype._exec=function(){for(var t of this._workers.keys()){if(this._working===this._numWorkers||0===this._waiting.length)return;if(!t.running)for(var e=0;e<this._waiting.length;e++){var r=this._waiting[e];if("number"!=typeof r[4]||r[4]===t.id){this._waiting.splice(e,1),t.postMessage({action:"exec",event:r[0],args:r[1]},r[2]),t.running=!0,t.time=Date.now(),this._workers.set(t,r[3]),this._working++;break}}}},WorkerManager.prototype.terminate=function(){if(!this._terminated){for(var t of this._workers)t[0].terminate(),t[1]&&t[1][1](new Error("Terminated"));this._workers.clear(),this._waiting=[],this._working=0,this._terminated=!0}},WorkerManager.prototype.postAll=function(t,e){if(this._terminated)throw new Error("Cannot post (terminated)");var r=[];for(var i of this._workers.keys())r.push(this.post(t,e,[],i.id));return Promise.all(r)},WorkerManager.prototype.post=function(t,e,r,i){void 0===e&&(e=[]),void 0===r&&(r=[]),Array.isArray(e)||(e=[e]),Array.isArray(r)||(r=[r]);var n=this;return new Promise((function(s,a){if(n._terminated)throw new Error("Cannot post (terminated)");n._waiting.push([t,e,r,[s,a],i]),n._exec()}))};var src$5=WorkerManager;const defaultOptions$d={regression:{kernelType:"polynomial",kernelOptions:{degree:2,constant:1}},threshold:.02,roi:{minSurface:100,positive:!1},sampling:20,include:[]};function run(t,e,r){e=Object.assign({},defaultOptions$d,e);const i=this.manager;return Array.isArray(t)?Promise.all(t.map((function(t){const n=runOnce(i,t,e);return"function"==typeof r&&n.then(r),n}))):runOnce(i,t,e)}function runOnce(t,e,r){return t.post("data",[e,r]).then((function(t){for(let e in t)t[e]=new Image(t[e]);return t}))}function work(){worker.on("data",(function(t,e,r){e=new IJS(e);const i={},n=[],s=e.grey(),a=s.sobelFilter();d("sobel",a);const o=a.level().mask({threshold:r.threshold});d("mask",o);const l=a.getRoiManager();l.fromMask(o);const h=l.getMask(r.roi);d("realMask",h);const c=s.getPixelsGrid({sampling:r.sampling,mask:h}),u=e.getBackground(c.xyS,c.zS,r.regression);d("background",u);const f=e.subtract(u);function d(t,e){r.include.includes(t)&&(i[t]=e,n.push(e.data.buffer))}i.result=f,n.push(f.data.buffer),t(i,n)}))}const background$1={run:run,work:work};function extend$2(t){t.extendMethod("background",background$1)}class Worker$1{constructor(){this._url=null,this._deps=[null]}checkUrl(){if(null===this._url)throw new Error("image worker must be initialized with an URL")}get url(){return this._url}set url(t){if("string"!=typeof t)throw new TypeError("worker URL must be a string");this._url=t,this._deps[0]=t}static extendMethod(t,e){let r,i,n={};function s(...t){return r||(this.checkUrl(),i=this.url,r=new src$5(e.work,{deps:i}),n.manager=r),e.run.call(n,...t)}s.reset=function(){r&&(r.terminate(),r=new src$5(e.work,{deps:i}),n.manager=r)},Worker$1.prototype[t]=s}}extend$2(Worker$1);var worker$2=new Worker$1;const Static={grey:names,threshold:names$1};exports.Image=Image,exports.Kernel=kernel$1,exports.Shape=Shape,exports.Stack=Stack,exports.Static=Static,exports.Worker=worker$2,exports.default=Image,Object.defineProperty(exports,"__esModule",{value:!0})},factory(exports)})),ijs=unwrapExports(imageJs);function e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}let t="undefined"!=typeof self?self:global;var i="undefined"!=typeof navigator,n=i&&"undefined"==typeof HTMLImageElement,s=!("undefined"==typeof global||"undefined"==typeof process||!process.versions||!process.versions.node);let r=t.Buffer,a=t.BigInt;var o=!!r;function l(t){return u(t)?void 0:t}const h=t=>void 0!==t;function u(t){return void 0===t||(t instanceof Map?0===t.size:0===Object.values(t).filter(h).length)}function c(t){let e=new Error(t);throw delete e.stack,e}function f(t){return""===(t=function(t){for(;t.endsWith("\0");)t=t.slice(0,-1);return t}(t).trim())?void 0:t}function d(t){let e=function(t){let e=0;return t.ifd0.enabled&&(e+=1024),t.exif.enabled&&(e+=2048),t.makerNote&&(e+=2048),t.userComment&&(e+=1024),t.gps.enabled&&(e+=512),t.interop.enabled&&(e+=100),t.ifd1.enabled&&(e+=1024),e+2048}(t);return t.jfif.enabled&&(e+=50),t.xmp.enabled&&(e+=2e4),t.iptc.enabled&&(e+=14e3),t.icc.enabled&&(e+=6e3),e}const p="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):void 0;function g(t){return p?p.decode(t):o?Buffer.from(t).toString("utf8"):decodeURIComponent(escape(String.fromCharCode.apply(null,t)))}class m{static from(t,e){return t instanceof this&&t.le===e?t:new m(t,void 0,void 0,e)}constructor(t,e=0,r,i){if("boolean"==typeof i&&(this.le=i),Array.isArray(t)&&(t=new Uint8Array(t)),0===t)this.byteOffset=0,this.byteLength=0;else if(t instanceof ArrayBuffer){void 0===r&&(r=t.byteLength-e);let i=new DataView(t,e,r);this._swapDataView(i)}else if(t instanceof Uint8Array||t instanceof DataView||t instanceof m){void 0===r&&(r=t.byteLength-e),(e+=t.byteOffset)+r>t.byteOffset+t.byteLength&&c("Creating view outside of available memory in ArrayBuffer");let i=new DataView(t.buffer,e,r);this._swapDataView(i)}else if("number"==typeof t){let e=new DataView(new ArrayBuffer(t));this._swapDataView(e)}else c("Invalid input argument for BufferView: "+t)}_swapArrayBuffer(t){this._swapDataView(new DataView(t))}_swapBuffer(t){this._swapDataView(new DataView(t.buffer,t.byteOffset,t.byteLength))}_swapDataView(t){this.dataView=t,this.buffer=t.buffer,this.byteOffset=t.byteOffset,this.byteLength=t.byteLength}_lengthToEnd(t){return this.byteLength-t}set(t,e,r=m){return t instanceof DataView||t instanceof m?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array||c("BufferView.set(): Invalid data argument."),this.toUint8().set(t,e),new r(this,e,t.byteLength)}subarray(t,e){return e=e||this._lengthToEnd(t),new m(this,t,e)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(t,e){return new Uint8Array(this.buffer,this.byteOffset+t,e)}getString(t=0,e=this.byteLength){return g(this.getUint8Array(t,e))}getUnicodeString(t=0,e=this.byteLength){const r=[];for(let i=0;i<e&&t+i<this.byteLength;i+=2)r.push(this.getUint16(t+i));return r.map(t=>String.fromCharCode(t)).join("")}getInt8(t){return this.dataView.getInt8(t)}getUint8(t){return this.dataView.getUint8(t)}getInt16(t,e=this.le){return this.dataView.getInt16(t,e)}getInt32(t,e=this.le){return this.dataView.getInt32(t,e)}getUint16(t,e=this.le){return this.dataView.getUint16(t,e)}getUint32(t,e=this.le){return this.dataView.getUint32(t,e)}getFloat32(t,e=this.le){return this.dataView.getFloat32(t,e)}getFloat64(t,e=this.le){return this.dataView.getFloat64(t,e)}getFloat(t,e=this.le){return this.dataView.getFloat32(t,e)}getDouble(t,e=this.le){return this.dataView.getFloat64(t,e)}getUintBytes(t,e,r){switch(e){case 1:return this.getUint8(t,r);case 2:return this.getUint16(t,r);case 4:return this.getUint32(t,r);case 8:return this.getUint64&&this.getUint64(t,r)}}getUint(t,e,r){switch(e){case 8:return this.getUint8(t,r);case 16:return this.getUint16(t,r);case 32:return this.getUint32(t,r);case 64:return this.getUint64&&this.getUint64(t,r)}}toString(t){return this.dataView.toString(t,this.constructor.name)}ensureChunk(){}}function S(t,e){c("".concat(t," '").concat(e,"' was not loaded, try using full build of exifr."))}class C extends Map{constructor(t){super(),this.kind=t}get(t,e){return this.has(t)||S(this.kind,t),e&&(t in e||function(t,e){c("Unknown ".concat(t," '").concat(e,"'."))}(this.kind,t),e[t].enabled||S(this.kind,t)),super.get(t)}keyList(){return Array.from(this.keys())}}var y=new C("file parser"),b=new C("segment parser"),P=new C("file reader");function I(t,e){return(r=t).startsWith("data:")||r.length>1e4?w(t,e,"base64"):i?k(t,e,"url",T):s?w(t,e,"fs"):void c("Invalid input argument");var r}async function k(t,e,r,i){return P.has(r)?w(t,e,r):i?async function(t,e){let r=await e(t);return new m(r)}(t,i):void c("Parser ".concat(r," is not loaded"))}async function w(t,e,r){let i=new(P.get(r))(t,e);return await i.read(),i}async function T(t){return fetch(t).then(t=>t.arrayBuffer())}async function D(t){return new Promise((e,r)=>{let i=new FileReader;i.onloadend=()=>e(i.result||new ArrayBuffer),i.onerror=r,i.readAsArrayBuffer(t)})}class A extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function O(t,e,r){let i=new A;for(let[t,e]of r)i.set(t,e);if(Array.isArray(e))for(let r of e)t.set(r,i);else t.set(e,i);return i}function x(t,e,r){let i,n=t.get(e);for(i of r)n.set(i[0],i[1])}const v=new Map,M=new Map,R=new Map,L=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],F=["jfif","xmp","icc","iptc"],U=["tiff",...F],B=["ifd0","ifd1","exif","gps","interop"],N=[...U,...B],E=["makerNote","userComment"],G=["translateKeys","translateValues","reviveValues","multiSegment"],V=[...G,"sanitize","mergeOutput"];class z{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class H extends z{get needed(){return this.enabled||this.deps.size>0}constructor(t,r,i,n){if(super(),e(this,"enabled",!1),e(this,"skip",new Set),e(this,"pick",new Set),e(this,"deps",new Set),e(this,"translateKeys",!1),e(this,"translateValues",!1),e(this,"reviveValues",!1),this.key=t,this.enabled=r,this.parse=this.enabled,this.applyInheritables(n),this.canBeFiltered=B.includes(t),this.canBeFiltered&&(this.dict=v.get(t)),void 0!==i)if(Array.isArray(i))this.parse=this.enabled=!0,this.canBeFiltered&&i.length>0&&this.translateTagSet(i,this.pick);else if("object"==typeof i){if(this.enabled=!0,this.parse=!1!==i.parse,this.canBeFiltered){let{pick:t,skip:e}=i;t&&t.length>0&&this.translateTagSet(t,this.pick),e&&e.length>0&&this.translateTagSet(e,this.skip)}this.applyInheritables(i)}else!0===i||!1===i?this.parse=this.enabled=i:c("Invalid options argument: ".concat(i))}applyInheritables(t){let e,r;for(e of G)r=t[e],void 0!==r&&(this[e]=r)}translateTagSet(t,e){if(this.dict){let r,i,{tagKeys:n,tagValues:s}=this.dict;for(r of t)"string"==typeof r?(i=s.indexOf(r),-1===i&&(i=n.indexOf(Number(r))),-1!==i&&e.add(Number(n[i]))):e.add(r)}else for(let r of t)e.add(r)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,Y(this.pick,this.deps)):this.enabled&&this.pick.size>0&&Y(this.pick,this.deps)}}var j={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},W=new Map;class K extends z{static useCached(t){let e=W.get(t);return void 0!==e||(e=new this(t),W.set(t,e)),e}constructor(t){super(),!0===t?this.setupFromTrue():void 0===t?this.setupFromUndefined():Array.isArray(t)?this.setupFromArray(t):"object"==typeof t?this.setupFromObject(t):c("Invalid options argument ".concat(t)),void 0===this.firstChunkSize&&(this.firstChunkSize=i?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let t;for(t of L)this[t]=j[t];for(t of V)this[t]=j[t];for(t of E)this[t]=j[t];for(t of N)this[t]=new H(t,j[t],void 0,this)}setupFromTrue(){let t;for(t of L)this[t]=j[t];for(t of V)this[t]=j[t];for(t of E)this[t]=!0;for(t of N)this[t]=new H(t,!0,void 0,this)}setupFromArray(t){let e;for(e of L)this[e]=j[e];for(e of V)this[e]=j[e];for(e of E)this[e]=j[e];for(e of N)this[e]=new H(e,!1,void 0,this);this.setupGlobalFilters(t,void 0,B)}setupFromObject(t){let e;for(e of(B.ifd0=B.ifd0||B.image,B.ifd1=B.ifd1||B.thumbnail,Object.assign(this,t),L))this[e]=_(t[e],j[e]);for(e of V)this[e]=_(t[e],j[e]);for(e of E)this[e]=_(t[e],j[e]);for(e of U)this[e]=new H(e,j[e],t[e],this);for(e of B)this[e]=new H(e,j[e],t[e],this.tiff);this.setupGlobalFilters(t.pick,t.skip,B,N),!0===t.tiff?this.batchEnableWithBool(B,!0):!1===t.tiff?this.batchEnableWithUserValue(B,t):Array.isArray(t.tiff)?this.setupGlobalFilters(t.tiff,void 0,B):"object"==typeof t.tiff&&this.setupGlobalFilters(t.tiff.pick,t.tiff.skip,B)}batchEnableWithBool(t,e){for(let r of t)this[r].enabled=e}batchEnableWithUserValue(t,e){for(let r of t){let t=e[r];this[r].enabled=!1!==t&&void 0!==t}}setupGlobalFilters(t,e,r,i=r){if(t&&t.length){for(let t of i)this[t].enabled=!1;let e=X(t,r);for(let[t,r]of e)Y(this[t].pick,r),this[t].enabled=!0}else if(e&&e.length){let t=X(e,r);for(let[e,r]of t)Y(this[e].skip,r)}}filterNestedSegmentTags(){let{ifd0:t,exif:e,xmp:r,iptc:i,icc:n}=this;this.makerNote?e.deps.add(37500):e.skip.add(37500),this.userComment?e.deps.add(37510):e.skip.add(37510),r.enabled||t.skip.add(700),i.enabled||t.skip.add(33723),n.enabled||t.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:t,exif:e,gps:r,interop:i}=this;i.needed&&(e.deps.add(40965),t.deps.add(40965)),e.needed&&t.deps.add(34665),r.needed&&t.deps.add(34853),this.tiff.enabled=B.some(t=>!0===this[t].enabled)||this.makerNote||this.userComment;for(let t of B)this[t].finalizeFilters()}get onlyTiff(){return!F.map(t=>this[t].enabled).some(t=>!0===t)&&this.tiff.enabled}checkLoadedPlugins(){for(let t of U)this[t].enabled&&!b.has(t)&&S("segment parser",t)}}function X(t,e){let r,i,n,s,a=[];for(n of e){for(s of(r=v.get(n),i=[],r))(t.includes(s[0])||t.includes(s[1]))&&i.push(s[0]);i.length&&a.push([n,i])}return a}function _(t,e){return void 0!==t?t:void 0!==e?e:void 0}function Y(t,e){for(let r of e)t.add(r)}e(K,"default",j);class J{constructor(t){e(this,"parsers",{}),this.options=K.useCached(t)}setup(){if(this.fileParser)return;let{file:t}=this,e=t.getUint16(0);for(let[r,i]of y)if(i.canHandle(t,e))return this.fileParser=new i(this.options,this.file,this.parsers),t[r]=!0;c("Unknown file format")}async read(t){this.file=await function(t,e){return"string"==typeof t?I(t,e):i&&!n&&t instanceof HTMLImageElement?I(t.src,e):t instanceof Uint8Array||t instanceof ArrayBuffer||t instanceof DataView?new m(t):i&&t instanceof Blob?k(t,e,"blob",D):void c("Invalid input argument")}(t,this.options)}async parse(){this.setup(),await this.fileParser.parse();let t={},e=[],r=Object.values(this.parsers).map(async r=>{let i;if(this.options.silentErrors){try{i=await r.parse()}catch(t){e.push(t)}e.push(...r.errors)}else i=await r.parse();r.assignToOutput(t,i)});return await Promise.all(r),this.options.silentErrors&&e.length>0&&(t.errors=e),this.file.close&&this.file.close(),l(t)}async extractThumbnail(){this.setup();let{options:t,file:e}=this,r=b.get("tiff",t);var i;if(e.tiff?i={start:0,type:"tiff"}:e.jpeg&&(i=await this.fileParser.getOrFindSegment("tiff")),void 0===i)return;let n=await this.fileParser.ensureSegmentChunk(i),s=this.parsers.tiff=new r(n,t,e),a=await s.extractThumbnail();return e.close&&e.close(),a}}async function q(t,e){let r=new J(e);return await r.read(t),r.parse()}var Q=Object.freeze({__proto__:null,parse:q,Exifr:J,fileParsers:y,segmentParsers:b,fileReaders:P,tagKeys:v,tagValues:M,tagRevivers:R,createDictionary:O,extendDictionary:x,fetchUrlAsArrayBuffer:T,readBlobAsArrayBuffer:D,chunkedProps:L,otherSegments:F,segments:U,tiffBlocks:B,segmentsAndBlocks:N,tiffExtractables:E,inheritables:G,allFormatters:V,Options:K});class Z{constructor(t,r,i){e(this,"ensureSegmentChunk",async t=>{let e=t.start,r=t.size||65536;if(this.file.chunked)if(this.file.available(e,r))t.chunk=this.file.subarray(e,r);else try{t.chunk=await this.file.readChunk(e,r)}catch(e){c("Couldn't read segment: ".concat(JSON.stringify(t),". ").concat(e.message))}else this.file.byteLength>e+r?t.chunk=this.file.subarray(e,r):void 0===t.size?t.chunk=this.file.subarray(e):c("Segment unreachable: "+JSON.stringify(t));return t.chunk}),this.extendOptions&&this.extendOptions(t),this.options=t,this.file=r,this.parsers=i}createParser(t,e){let r=new(b.get(t))(e,this.options,this.file);return this.parsers[t]=r}}class ${static findPosition(t,e){let r=t.getUint16(e+2)+2,i="function"==typeof this.headerLength?this.headerLength(t,e,r):this.headerLength,n=e+i,s=r-i;return{offset:e,length:r,headerLength:i,start:n,size:s,end:n+s}}static parse(t,e={}){return new this(t,new K({[this.type]:e})).parse()}normalizeInput(t){return t instanceof m?t:new m(t)}constructor(t,r={},i){e(this,"errors",[]),e(this,"raw",new Map),e(this,"handleError",t=>{if(!this.options.silentErrors)throw t;this.errors.push(t.message)}),this.chunk=this.normalizeInput(t),this.file=i,this.type=this.constructor.type,this.globalOptions=this.options=r,this.localOptions=r[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(t,e){let r=R.get(e),i=M.get(e),n=v.get(e),s=this.options[e],a=s.reviveValues&&!!r,o=s.translateValues&&!!i,l=s.translateKeys&&!!n,h={};for(let[e,s]of t)a&&r.has(e)?s=r.get(e)(s):o&&i.has(e)&&(s=this.translateValue(s,i.get(e))),l&&n.has(e)&&(e=n.get(e)||e),h[e]=s;return h}translateValue(t,e){return e[t]||t}assignToOutput(t,e){this.assignObjectToOutput(t,this.constructor.type,e)}assignObjectToOutput(t,e,r){if(this.globalOptions.mergeOutput)return Object.assign(t,r);t[e]?Object.assign(t[e],r):t[e]=r}}function ee(t){return 192===t||194===t||196===t||219===t||221===t||218===t||254===t}function te(t){return t>=224&&t<=239}function ie(t,e){for(let[r,i]of b)if(i.canHandle(t,e))return r}e($,"headerLength",4),e($,"type",void 0),e($,"multiSegment",!1),e($,"canHandle",()=>!1);class ne extends Z{constructor(...t){super(...t),e(this,"appSegments",[]),e(this,"jpegSegments",[]),e(this,"unknownSegments",[])}static canHandle(t,e){return 65496===e}async parse(){await this.findAppSegments(),await this.readSegments(),this.mergeMultiSegments(),this.createParsers()}async readSegments(){let t=this.appSegments.map(this.ensureSegmentChunk);await Promise.all(t)}setupSegmentFinderArgs(t){!0===t?(this.findAll=!0,this.wanted=new Set(b.keyList())):(t=void 0===t?b.keyList().filter(t=>this.options[t].enabled):t.filter(t=>this.options[t].enabled&&b.has(t)),this.findAll=!1,this.remaining=new Set(t),this.wanted=new Set(t)),this.unfinishedMultiSegment=!1}async findAppSegments(t=0,e){this.setupSegmentFinderArgs(e);let{file:r,findAll:i,wanted:n,remaining:s}=this;if(!i&&this.file.chunked&&(i=Array.from(n).some(t=>{let e=b.get(t),r=this.options[t];return e.multiSegment&&r.multiSegment}),i&&await this.file.readWhole()),t=this._findAppSegments(t,r.byteLength,i,n,s),!this.options.onlyTiff&&r.chunked){let e=!1;for(;s.size>0&&!e&&(r.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:i}=r,n=this.appSegments.some(t=>!this.file.available(t.offset||t.start,t.length||t.size));if(e=t>i&&!n?!await r.readNextChunk(t):!await r.readNextChunk(i),void 0===(t=this._findAppSegments(t,r.byteLength)))return}}}_findAppSegments(t,e){e-=2;let r,i,n,s,a,o,{file:l,findAll:h,wanted:c,remaining:u,options:f}=this;for(;t<e;t++)if(255===l.getUint8(t))if(r=l.getUint8(t+1),te(r)){if(i=l.getUint16(t+2),n=ie(l,t),n&&c.has(n)&&(s=b.get(n),a=s.findPosition(l,t),o=f[n],a.type=n,this.appSegments.push(a),!h&&(s.multiSegment&&o.multiSegment?(this.unfinishedMultiSegment=a.chunkNumber<a.chunkCount,this.unfinishedMultiSegment||u.delete(n)):u.delete(n),0===u.size)))break;f.recordUnknownSegments&&(a=$.findPosition(l,t),a.marker=r,this.unknownSegments.push(a)),t+=i+1}else if(ee(r)){if(i=l.getUint16(t+2),218===r&&!1!==f.stopAfterSos)return;f.recordJpegSegments&&this.jpegSegments.push({offset:t,length:i,marker:r}),t+=i+1}return t}mergeMultiSegments(){if(!this.appSegments.some(t=>t.multiSegment))return;let t=function(t,e){let r,i,n,s=new Map;for(let e=0;e<t.length;e++)r=t[e],i=r.type,s.has(i)?n=s.get(i):s.set(i,n=[]),n.push(r);return Array.from(s)}(this.appSegments);this.mergedAppSegments=t.map(([t,e])=>{let r=b.get(t,this.options);return r.handleMultiSegments?{type:t,chunk:r.handleMultiSegments(e)}:e[0]})}async createParsers(){let t=this.mergedAppSegments||this.appSegments;for(let e of t){let{type:t,chunk:r}=e;if(!this.options[t].enabled)continue;let i=this.parsers[t];if(i&&i.append);else if(!i){let e=new(b.get(t,this.options))(r,this.options,this.file);this.parsers[t]=e}}}getSegment(t){return this.appSegments.find(e=>e.type===t)}async getOrFindSegment(t){let e=this.getSegment(t);return void 0===e&&(await this.findAppSegments(0,[t]),e=this.getSegment(t)),e}}e(ne,"type","jpeg"),y.set("jpeg",ne);const se=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class re extends ${parseHeader(){var t=this.chunk.getUint16();18761===t?this.le=!0:19789===t&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(t,e,r=new Map){let{pick:i,skip:n}=this.options[e];i=new Set(i);let s=i.size>0,a=0===n.size,o=this.chunk.getUint16(t);t+=2;for(let l=0;l<o;l++){let o=this.chunk.getUint16(t);if(s){if(i.has(o)&&(r.set(o,this.parseTag(t,o,e)),i.delete(o),0===i.size))break}else!a&&n.has(o)||r.set(o,this.parseTag(t,o,e));t+=12}return r}parseTag(t,e,r){let{chunk:i}=this,n=i.getUint16(t+2),s=i.getUint32(t+4),a=se[n];if(a*s<=4?t+=8:t=i.getUint32(t+8),(n<1||n>13)&&c("Invalid TIFF value type. block: ".concat(r.toUpperCase(),", tag: ").concat(e.toString(16),", type: ").concat(n,", offset ").concat(t)),t>i.byteLength&&c("Invalid TIFF value offset. block: ".concat(r.toUpperCase(),", tag: ").concat(e.toString(16),", type: ").concat(n,", offset ").concat(t," is outside of chunk size ").concat(i.byteLength)),1===n)return i.getUint8Array(t,s);if(2===n)return f(i.getString(t,s));if(7===n)return i.getUint8Array(t,s);if(1===s)return this.parseTagValue(n,t);{let e=new(function(t){switch(t){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(n))(s),r=a;for(let i=0;i<s;i++)e[i]=this.parseTagValue(n,t),t+=r;return e}}parseTagValue(t,e){let{chunk:r}=this;switch(t){case 1:return r.getUint8(e);case 3:return r.getUint16(e);case 4:return r.getUint32(e);case 5:return r.getUint32(e)/r.getUint32(e+4);case 6:return r.getInt8(e);case 8:return r.getInt16(e);case 9:return r.getInt32(e);case 10:return r.getInt32(e)/r.getInt32(e+4);case 11:return r.getFloat(e);case 12:return r.getDouble(e);case 13:return r.getUint32(e);default:c("Invalid tiff type ".concat(t))}}}class ae extends re{static canHandle(t,e){return 225===t.getUint8(e+1)&&1165519206===t.getUint32(e+4)&&0===t.getUint16(e+8)}async parse(){this.parseHeader();let{options:t}=this;return t.ifd0.enabled&&await this.parseIfd0Block(),t.exif.enabled&&await this.safeParse("parseExifBlock"),t.gps.enabled&&await this.safeParse("parseGpsBlock"),t.interop.enabled&&await this.safeParse("parseInteropBlock"),t.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(t){let e=this[t]();return void 0!==e.catch&&(e=e.catch(this.handleError)),e}findIfd0Offset(){void 0===this.ifd0Offset&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(void 0===this.ifd1Offset){this.findIfd0Offset();let t=this.chunk.getUint16(this.ifd0Offset),e=this.ifd0Offset+2+12*t;this.ifd1Offset=this.chunk.getUint32(e)}}parseBlock(t,e){let r=new Map;return this[e]=r,this.parseTags(t,e,r),r}async parseIfd0Block(){if(this.ifd0)return;let{file:t}=this;this.findIfd0Offset(),this.ifd0Offset<8&&c("Malformed EXIF data"),!t.chunked&&this.ifd0Offset>t.byteLength&&c("IFD0 offset points to outside of file.\nthis.ifd0Offset: ".concat(this.ifd0Offset,", file.byteLength: ").concat(t.byteLength)),t.tiff&&await t.ensureChunk(this.ifd0Offset,d(this.options));let e=this.parseBlock(this.ifd0Offset,"ifd0");return 0!==e.size?(this.exifOffset=e.get(34665),this.interopOffset=e.get(40965),this.gpsOffset=e.get(34853),this.xmp=e.get(700),this.iptc=e.get(33723),this.icc=e.get(34675),this.options.sanitize&&(e.delete(34665),e.delete(40965),e.delete(34853),e.delete(700),e.delete(33723),e.delete(34675)),e):void 0}async parseExifBlock(){if(this.exif)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.exifOffset)return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,d(this.options));let t=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=t.get(40965)),this.makerNote=t.get(37500),this.userComment=t.get(37510),this.options.sanitize&&(t.delete(40965),t.delete(37500),t.delete(37510)),this.unpack(t,41728),this.unpack(t,41729),t}unpack(t,e){let r=t.get(e);r&&1===r.length&&t.set(e,r[0])}async parseGpsBlock(){if(this.gps)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.gpsOffset)return;let t=this.parseBlock(this.gpsOffset,"gps");return t&&t.has(2)&&t.has(4)&&(t.set("latitude",oe(...t.get(2),t.get(1))),t.set("longitude",oe(...t.get(4),t.get(3)))),t}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),void 0!==this.interopOffset||this.exif||await this.parseExifBlock(),void 0!==this.interopOffset))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(t=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||t))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),void 0===this.ifd1)return;let t=this.ifd1.get(513),e=this.ifd1.get(514);return this.chunk.getUint8Array(t,e)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let t,e,r,i={};for(e of B)if(t=this[e],!u(t))if(r=this.canTranslate?this.translateBlock(t,e):Object.fromEntries(t),this.options.mergeOutput){if("ifd1"===e)continue;Object.assign(i,r)}else i[e]=r;return this.makerNote&&(i.makerNote=this.makerNote),this.userComment&&(i.userComment=this.userComment),i}assignToOutput(t,e){if(this.globalOptions.mergeOutput)Object.assign(t,e);else for(let[r,i]of Object.entries(e))this.assignObjectToOutput(t,r,i)}}function oe(t,e,r,i){var n=t+e/60+r/3600;return"S"!==i&&"W"!==i||(n*=-1),n}e(ae,"type","tiff"),e(ae,"headerLength",10),b.set("tiff",ae);var le=Object.freeze({__proto__:null,default:Q,parse:q,Exifr:J,fileParsers:y,segmentParsers:b,fileReaders:P,tagKeys:v,tagValues:M,tagRevivers:R,createDictionary:O,extendDictionary:x,fetchUrlAsArrayBuffer:T,readBlobAsArrayBuffer:D,chunkedProps:L,otherSegments:F,segments:U,tiffBlocks:B,segmentsAndBlocks:N,tiffExtractables:E,inheritables:G,allFormatters:V,Options:K});const he={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},ue=Object.assign({},he,{firstChunkSize:4e4,gps:[1,2,3,4]}),ce=Object.assign({},he,{firstChunkSize:4e4,ifd0:[274]}),fe=Object.assign({},he,{tiff:!1,ifd1:!0,mergeOutput:!1});async function de(t){let e=new J(fe);await e.read(t);let i=await e.extractThumbnail();return i&&o?r.from(i):i}async function pe(t){let e=await this.thumbnail(t);if(void 0!==e){let t=new Blob([e]);return URL.createObjectURL(t)}}async function ge(t){let e=new J(ue);await e.read(t);let r=await e.parse();if(r&&r.gps){let{latitude:t,longitude:e}=r.gps;return{latitude:t,longitude:e}}}async function me(t){let e=new J(ce);await e.read(t);let r=await e.parse();if(r&&r.ifd0)return r.ifd0[274]}const Se={1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}};var Ce=!0,ye=!0;if("object"==typeof navigator){let t=navigator.userAgent;if(t.includes("iPad")||t.includes("iPhone")){let[e,r,i]=t.match(/OS (\d+)_(\d+)/),n=Number(r)+.1*Number(i);Ce=n<13.4,ye=!1}if(t.includes("Chrome/")){let[e,r]=t.match(/Chrome\/(\d+)/);Number(r)>=81&&(Ce=ye=!1)}else if(t.includes("Firefox/")){let[e,r]=t.match(/Firefox\/(\d+)/);Number(r)>=77&&(Ce=ye=!1)}}async function be(t){let e=await me(t);return Object.assign({canvas:Ce,css:ye},Se[e])}class Pe extends m{constructor(...t){super(...t),e(this,"ranges",new Ie),0!==this.byteLength&&this.ranges.add(0,this.byteLength)}_tryExtend(t,e,r){if(0===t&&0===this.byteLength&&r){let t=new DataView(r.buffer||r,r.byteOffset,r.byteLength);this._swapDataView(t)}else{let r=t+e;if(r>this.byteLength){let{dataView:t}=this._extend(r);this._swapDataView(t)}}}_extend(t){let e;e=o?r.allocUnsafe(t):new Uint8Array(t);let i=new DataView(e.buffer,e.byteOffset,e.byteLength);return e.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:e,dataView:i}}subarray(t,e,r=!1){return e=e||this._lengthToEnd(t),r&&this._tryExtend(t,e),this.ranges.add(t,e),super.subarray(t,e)}set(t,e,r=!1){r&&this._tryExtend(e,t.byteLength,t);let i=super.set(t,e);return this.ranges.add(e,i.byteLength),i}async ensureChunk(t,e){this.chunked&&(this.ranges.available(t,e)||await this.readChunk(t,e))}available(t,e){return this.ranges.available(t,e)}}class Ie{constructor(){e(this,"list",[])}get length(){return this.list.length}add(t,e,r=0){let i=t+e,n=this.list.filter(e=>ke(t,e.offset,i)||ke(t,e.end,i));if(n.length>0){t=Math.min(t,...n.map(t=>t.offset)),i=Math.max(i,...n.map(t=>t.end)),e=i-t;let r=n.shift();r.offset=t,r.length=e,r.end=i,this.list=this.list.filter(t=>!n.includes(t))}else this.list.push({offset:t,length:e,end:i})}available(t,e){let r=t+e;return this.list.some(e=>e.offset<=t&&r<=e.end)}}function ke(t,e,r){return t<=e&&e<=r}class we extends Pe{constructor(t,r){super(0),e(this,"chunksRead",0),this.input=t,this.options=r}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(t=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let e=this.options.chunkSize,r=await this.readChunk(t,e);return!!r&&r.byteLength===e}async readChunk(t,e){if(this.chunksRead++,0!==(e=this.safeWrapAddress(t,e)))return this._readChunk(t,e)}safeWrapAddress(t,e){return void 0!==this.size&&t+e>this.size?Math.max(0,this.size-t):e}get nextChunkOffset(){if(0!==this.ranges.list.length)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return void 0!==this.size&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}P.set("blob",class extends we{async readWhole(){this.chunked=!1;let t=await D(this.input);this._swapArrayBuffer(t)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(t,e){let r=e?t+e:void 0,i=this.input.slice(t,r),n=await D(i);return this.set(n,t,!0)}});var Te=Object.freeze({__proto__:null,default:le,parse:q,Exifr:J,fileParsers:y,segmentParsers:b,fileReaders:P,tagKeys:v,tagValues:M,tagRevivers:R,createDictionary:O,extendDictionary:x,fetchUrlAsArrayBuffer:T,readBlobAsArrayBuffer:D,chunkedProps:L,otherSegments:F,segments:U,tiffBlocks:B,segmentsAndBlocks:N,tiffExtractables:E,inheritables:G,allFormatters:V,Options:K,disableAllOptions:he,gpsOnlyOptions:ue,orientationOnlyOptions:ce,thumbnailOnlyOptions:fe,thumbnail:de,thumbnailUrl:pe,gps:ge,orientation:me,rotations:Se,get rotateCanvas(){return Ce},get rotateCss(){return ye},rotation:be});P.set("url",class extends we{async readWhole(){this.chunked=!1;let t=await T(this.input);this._swapArrayBuffer(t)}async _readChunk(t,e){let r=e?t+e-1:void 0,i={};(t||r)&&(i.range="bytes=".concat([t,r].join("-")));let n=await fetch(this.input,{headers:i}),s=await n.arrayBuffer(),a=s.byteLength;if(416!==n.status)return a!==e&&(this.size=t+a),this.set(s,t,!0)}}),m.prototype.getUint64=function(t){let e=this.getUint32(t),r=this.getUint32(t+4);return e<1048575?e<<32|r:void 0!==typeof a?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),a(e)<<a(32)|a(r)):void c("Trying to read 64b value but JS can only handle 53b numbers.")};class De extends Z{parseBoxes(t=0){let e=[];for(;t<this.file.byteLength-4;){let r=this.parseBoxHead(t);if(e.push(r),0===r.length)break;t+=r.length}return e}parseSubBoxes(t){t.boxes=this.parseBoxes(t.start)}findBox(t,e){return void 0===t.boxes&&this.parseSubBoxes(t),t.boxes.find(t=>t.kind===e)}parseBoxHead(t){let e=this.file.getUint32(t),r=this.file.getString(t+4,4),i=t+8;return 1===e&&(e=this.file.getUint64(t+8),i+=8),{offset:t,length:e,kind:r,start:i}}parseBoxFullHead(t){let e=this.file.getUint32(t.start);t.version=e>>24,t.start+=4}}class Ae extends De{static canHandle(t){if(0!==t.getUint16(0))return!1;let e=t.getUint16(2);if(e>50)return!1;let r=16,i=[];for(;r<e;)i.push(t.getString(r,4)),r+=4;return i.includes("heic")}async parse(){let t=this.file.getUint32(0),e=this.parseBoxHead(t);for(;"meta"!==e.kind;)t+=e.length,e=this.parseBoxHead(t);await this.file.ensureChunk(e.offset,e.length),this.parseBoxFullHead(e),this.parseSubBoxes(e),this.options.icc.enabled&&await this.findIcc(e),this.options.tiff.enabled&&await this.findExif(e)}async registerSegment(t,e,r){await this.file.ensureChunk(e,r);let i=this.file.subarray(e,r);this.createParser(t,i)}async findIcc(t){let e=this.findBox(t,"iprp");if(void 0===e)return;let r=this.findBox(e,"ipco");if(void 0===r)return;let i=this.findBox(r,"colr");void 0!==i&&await this.registerSegment("icc",i.offset+12,i.length)}async findExif(t){let e=this.findBox(t,"iinf");if(void 0===e)return;let r=this.findBox(t,"iloc");if(void 0===r)return;let i=this.findExifLocIdInIinf(e),n=this.findExtentInIloc(r,i);if(void 0===n)return;let[s,a]=n;await this.file.ensureChunk(s,a);let o=4+this.file.getUint32(s);s+=o,a-=o,await this.registerSegment("tiff",s,a)}findExifLocIdInIinf(t){this.parseBoxFullHead(t);let e,r,i,n,s=t.start,a=this.file.getUint16(s);for(s+=2;a--;){if(e=this.parseBoxHead(s),this.parseBoxFullHead(e),r=e.start,e.version>=2&&(i=3===e.version?4:2,n=this.file.getString(r+i+2,4),"Exif"===n))return this.file.getUintBytes(r,i);s+=e.length}}get8bits(t){let e=this.file.getUint8(t);return[e>>4,15&e]}findExtentInIloc(t,e){this.parseBoxFullHead(t);let r=t.start,[i,n]=this.get8bits(r++),[s,a]=this.get8bits(r++),o=2===t.version?4:2,l=1===t.version||2===t.version?2:0,h=a+i+n,c=2===t.version?4:2,u=this.file.getUintBytes(r,c);for(r+=c;u--;){let t=this.file.getUintBytes(r,o);r+=o+l+2+s;let c=this.file.getUint16(r);if(r+=2,t===e)return c>1&&console.warn("ILOC box has more than one extent but we're only processing one\nPlease create an issue at https://github.com/MikeKovarik/exifr with this file"),[this.file.getUintBytes(r+a,i),this.file.getUintBytes(r+a+i,n)];r+=c*h}}}e(Ae,"type","heic"),y.set("heic",Ae),O(v,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),O(v,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),O(v,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),O(M,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let Oe=O(M,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const xe={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Oe.set(37392,xe),Oe.set(41488,xe);const ve={0:"Normal",1:"Low",2:"High"};function Me(t){let e=Array.from(t).slice(1);return e[1]>15&&(e=e.map(t=>String.fromCharCode(t))),"0"!==e[2]&&0!==e[2]||e.pop(),e.join(".")}function Re(t){if("string"==typeof t){var[e,r,i,n,s,a]=t.trim().split(/[-: ]/g).map(Number),o=new Date(e,r-1,i);return Number.isNaN(n)||Number.isNaN(s)||Number.isNaN(a)||(o.setHours(n),o.setMinutes(s),o.setSeconds(a)),Number.isNaN(+o)?t:o}}function Le(t){if("string"==typeof t)return t;let e=[];if(0===t[1]&&0===t[t.length-1])for(let r=0;r<t.length;r+=2)e.push(Fe(t[r+1],t[r]));else for(let r=0;r<t.length;r+=2)e.push(Fe(t[r],t[r+1]));return f(String.fromCodePoint(...e))}function Fe(t,e){return t<<8|e}Oe.set(41992,ve),Oe.set(41993,ve),Oe.set(41994,ve),O(R,["ifd0","ifd1"],[[50827,function(t){return"string"!=typeof t?g(t):t}],[306,Re],[40091,Le],[40092,Le],[40093,Le],[40094,Le],[40095,Le]]),O(R,"exif",[[40960,Me],[36864,Me],[36867,Re],[36868,Re]]),O(R,"gps",[[0,t=>Array.from(t).join(".")],[7,t=>Array.from(t).join(":")]]);class Ue extends ${static canHandle(t,e){return 225===t.getUint8(e+1)&&1752462448===t.getUint32(e+4)&&"http://ns.adobe.com/"===t.getString(e+4,"http://ns.adobe.com/".length)}static headerLength(t,e){return"http://ns.adobe.com/xmp/extension/"===t.getString(e+4,"http://ns.adobe.com/xmp/extension/".length)?79:4+"http://ns.adobe.com/xap/1.0/".length+1}static findPosition(t,e){let r=super.findPosition(t,e);return r.multiSegment=r.extended=79===r.headerLength,r.multiSegment?(r.chunkCount=t.getUint8(e+72),r.chunkNumber=t.getUint8(e+76),0!==t.getUint8(e+77)&&r.chunkNumber++):(r.chunkCount=1/0,r.chunkNumber=-1),r}static handleMultiSegments(t){return t.map(t=>t.chunk.getString()).join("")}normalizeInput(t){return"string"==typeof t?t:t.getString&&t.getString()}parse(t=this.chunk){if(!this.localOptions.parse)return t;t=function(t){let e={"rdf:li":1,"rdf:Seq":1,"rdf:Bag":1,"rdf:Alt":1};return t.replace(We,(t,r,i)=>"<"===r?"".concat(t,"#").concat(e[i]++):"".concat(t,"#").concat(--e[i]))}(t);let e=Ne.findAll(t,"rdf","Description");0===e.length&&e.push(new Ne("rdf","Description",void 0,t));let r,i={};for(let t of e)for(let e of t.properties)r=ze(e.ns,i),Ee(e,r);return function(t){let e;for(let r in t)e=t[r]=l(t[r]),void 0===e&&delete t[r];return l(t)}(i)}assignToOutput(t,e){if(this.localOptions.parse)for(let[r,i]of Object.entries(e))switch(r){case"tiff":this.assignObjectToOutput(t,"ifd0",i);break;case"exif":this.assignObjectToOutput(t,"exif",i);break;case"xmlns":break;default:this.assignObjectToOutput(t,r,i)}else t.xmp=e}}e(Ue,"type","xmp"),e(Ue,"multiSegment",!0),b.set("xmp",Ue);class Be{static findAll(t){return He(t,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Be.unpackMatch)}static unpackMatch(t){let e=t[1],r=t[2],i=t[3].slice(1,-1);return i=je(i),new Be(e,r,i)}constructor(t,e,r){this.ns=t,this.name=e,this.value=r}serialize(){return this.value}}class Ne{static findAll(t,e,r){if(void 0!==e||void 0!==r){e=e||"[\\w\\d-]+",r=r||"[\\w\\d-]+";var i=new RegExp("<(".concat(e,"):(").concat(r,")(#\\d+)?((\\s+?[\\w\\d-:]+=(\"[^\"]*\"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)"),"gm")}else i=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return He(t,i).map(Ne.unpackMatch)}static unpackMatch(t){let e=t[1],r=t[2],i=t[4],n=t[8];return new Ne(e,r,i,n)}constructor(t,e,r,i){this.ns=t,this.name=e,this.attrString=r,this.innerXml=i,this.attrs=Be.findAll(r),this.children=Ne.findAll(i),this.value=0===this.children.length?je(i):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return void 0!==this.value&&0===this.attrs.length&&0===this.children.length}get isListContainer(){return 1===this.children.length&&this.children[0].isList}get isList(){let{ns:t,name:e}=this;return"rdf"===t&&("Seq"===e||"Bag"===e||"Alt"===e)}get isListItem(){return"rdf"===this.ns&&"li"===this.name}serialize(){if(0===this.properties.length&&void 0===this.value)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return Ve(this.children.map(Ge));if(this.isListItem&&1===this.children.length&&0===this.attrs.length)return this.children[0].serialize();let t={};for(let e of this.properties)Ee(e,t);return void 0!==this.value&&(t.value=this.value),l(t)}}function Ee(t,e){let r=t.serialize();void 0!==r&&(e[t.name]=r)}var Ge=t=>t.serialize(),Ve=t=>1===t.length?t[0]:t,ze=(t,e)=>e[t]?e[t]:e[t]={};function He(t,e){let r,i=[];if(!t)return i;for(;null!==(r=e.exec(t));)i.push(r);return i}function je(t){if(function(t){return null==t||"null"===t||"undefined"===t||""===t||""===t.trim()}(t))return;let e=Number(t);if(!Number.isNaN(e))return e;let r=t.toLowerCase();return"true"===r||"false"!==r&&t.trim()}const We=/(<|\/)(rdf:li|rdf:Seq|rdf:Bag|rdf:Alt)/g;var Ke=Object.freeze({__proto__:null,default:Te,parse:q,Exifr:J,fileParsers:y,segmentParsers:b,fileReaders:P,tagKeys:v,tagValues:M,tagRevivers:R,createDictionary:O,extendDictionary:x,fetchUrlAsArrayBuffer:T,readBlobAsArrayBuffer:D,chunkedProps:L,otherSegments:F,segments:U,tiffBlocks:B,segmentsAndBlocks:N,tiffExtractables:E,inheritables:G,allFormatters:V,Options:K,disableAllOptions:he,gpsOnlyOptions:ue,orientationOnlyOptions:ce,thumbnailOnlyOptions:fe,thumbnail:de,thumbnailUrl:pe,gps:ge,orientation:me,rotations:Se,get rotateCanvas(){return Ce},get rotateCss(){return ye},rotation:be});if(s)try{var Xe="function"==typeof require?Promise.resolve(require("fs").promises):import("fs").then(t=>t.promises)}catch(e){console.warn("Couldn't load 'fs'")}P.set("fs",class extends we{async readWhole(){this.chunked=!1,this.fs=await Xe;let t=await this.fs.readFile(this.input);this._swapBuffer(t)}async readChunked(){this.chunked=!0,this.fs=await Xe,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){void 0===this.fh&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(t,e){void 0===this.fh&&await this.open(),t+e>this.size&&(e=this.size-t);var r=this.subarray(t,e,!0);return await this.fh.read(r.dataView,0,e,t),r}async close(){if(this.fh){let t=this.fh;this.fh=void 0,await t.close()}}}),P.set("base64",class extends we{constructor(...t){super(...t),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(t,e){let i,n,s=this.input;void 0===t?(t=0,i=0,n=0):(i=4*Math.floor(t/3),n=t-i/4*3),void 0===e&&(e=this.size);let a=t+e,l=i+4*Math.ceil(a/3);s=s.slice(i,l);let h=Math.min(e,this.size-t);if(o){let e=r.from(s,"base64").slice(n,n+h);return this.set(e,t,!0)}{let e=this.subarray(t,h,!0),r=atob(s),i=e.toUint8();for(let t=0;t<h;t++)i[t]=r.charCodeAt(n+t);return e}}});class _e extends Z{static canHandle(t,e){return 18761===e||19789===e}extendOptions(t){let{ifd0:e,xmp:r,iptc:i,icc:n}=t;r.enabled&&e.deps.add(700),i.enabled&&e.deps.add(33723),n.enabled&&e.deps.add(34675),e.finalizeFilters()}async parse(){let{tiff:t,xmp:e,iptc:r,icc:i}=this.options;if(t.enabled||e.enabled||r.enabled||i.enabled){let t=Math.max(d(this.options),this.options.chunkSize);await this.file.ensureChunk(0,t),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(t){if(this.parsers.tiff[t]){let e=this.parsers.tiff[t],r=m.from(e);this.options[t].enabled&&this.createParser(t,r)}}}e(_e,"type","tiff"),y.set("tiff",_e),O(v,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),x(v,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let Ye=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];x(v,"ifd0",Ye),x(v,"exif",Ye),O(M,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class Je extends ${static canHandle(t,e){return 224===t.getUint8(e+1)&&1246120262===t.getUint32(e+4)&&0===t.getUint8(e+8)}parse(){return{JFIFVersion:this.chunk.getUint16(0),ResolutionUnit:this.chunk.getUint8(2),XResolution:this.chunk.getUint16(3),YResolution:this.chunk.getUint16(5),ThumbnailWidth:this.chunk.getUint8(7),ThumbnailHeight:this.chunk.getUint8(8)}}}e(Je,"type","jfif"),e(Je,"headerLength",9),b.set("jfif",Je);class qe extends ${static canHandle(t,e){return 226===t.getUint8(e+1)&&1229144927===t.getUint32(e+4)}static findPosition(t,e){let r=super.findPosition(t,e);return r.chunkNumber=t.getUint8(e+16),r.chunkCount=t.getUint8(e+17),r.multiSegment=r.chunkCount>1,r}static handleMultiSegments(t){return function(t){let e=function(t){let e=t[0].constructor,r=0;for(let e of t)r+=e.length;let i=new e(r),n=0;for(let e of t)i.set(e,n),n+=e.length;return i}(t.map(t=>t.chunk.toUint8()));return new m(e)}(t)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:t}=this;this.chunk.byteLength<84&&c("ICC header is too short");for(let[e,r]of Object.entries(Qe)){e=parseInt(e,10);let i=r(this.chunk,e);"\0\0\0\0"!==i&&t.set(e,i)}}parseTags(){let t,e,r,i,n,{raw:s}=this,a=this.chunk.getUint32(128),o=132,l=this.chunk.byteLength;for(;a--;){if(t=this.chunk.getString(o,4),e=this.chunk.getUint32(o+4),r=this.chunk.getUint32(o+8),i=this.chunk.getString(e,4),e+r>l)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");n=this.parseTag(i,e,r),void 0!==n&&"\0\0\0\0"!==n&&s.set(t,n),o+=12}}parseTag(t,e,r){switch(t){case"desc":return this.parseDesc(e);case"mluc":return this.parseMluc(e);case"text":return this.parseText(e,r);case"sig ":return this.parseSig(e)}if(!(e+r>this.chunk.byteLength))return this.chunk.getUint8Array(e,r)}parseDesc(t){let e=this.chunk.getUint32(t+8)-1;return f(this.chunk.getString(t+12,e))}parseText(t,e){return f(this.chunk.getString(t+8,e-8))}parseSig(t){return f(this.chunk.getString(t+8,4))}parseMluc(t){let{chunk:e}=this,r=e.getUint32(t+8),i=e.getUint32(t+12),n=t+16,s=[];for(let a=0;a<r;a++){let r=e.getString(n+0,2),a=e.getString(n+2,2),o=e.getUint32(n+4),l=e.getUint32(n+8)+t,h=f(e.getUnicodeString(l,o));s.push({lang:r,country:a,text:h}),n+=i}return 1===r?s[0].text:s}translateValue(t,e){return"string"==typeof t?e[t]||e[t.toLowerCase()]||t:e[t]||t}}e(qe,"type","icc"),e(qe,"multiSegment",!0),e(qe,"headerLength",18);const Qe={4:Ze,8:function(t,e){return[t.getUint8(e),t.getUint8(e+1)>>4,t.getUint8(e+1)%16].map(t=>t.toString(10)).join(".")},12:Ze,16:Ze,20:Ze,24:function(t,e){const r=t.getUint16(e),i=t.getUint16(e+2)-1,n=t.getUint16(e+4),s=t.getUint16(e+6),a=t.getUint16(e+8),o=t.getUint16(e+10);return new Date(Date.UTC(r,i,n,s,a,o))},36:Ze,40:Ze,48:Ze,52:Ze,64:(t,e)=>t.getUint32(e),80:Ze};function Ze(t,e){return f(t.getString(e,4))}b.set("icc",qe),O(v,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const $e={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},et={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};O(M,"icc",[[4,$e],[12,et],[40,Object.assign({},$e,et)],[48,$e],[80,$e],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class tt extends ${static canHandle(t,e){return 237===t.getUint8(e+1)&&"Photoshop"===t.getString(e+4,9)}static headerLength(t,e,r){for(let n=0;n<r;n++)if(this.isIptcSegmentHead(t,e+n)){var i=t.getUint8(e+n+7);return i%2!=0&&(i+=1),0===i&&(i=4),n+8+i}}static isIptcSegmentHead(t,e){return 56===t.getUint8(e)&&66===t.getUint8(e+1)&&73===t.getUint8(e+2)&&77===t.getUint8(e+3)&&4===t.getUint8(e+4)&&4===t.getUint8(e+5)}parse(){let{raw:t}=this,e=this.chunk.byteLength-1;for(let r=0;r<e;r++)if(28===this.chunk.getUint8(r)&&2===this.chunk.getUint8(r+1)){let e=this.chunk.getUint16(r+3),i=this.chunk.getUint8(r+2),n=this.chunk.getString(r+5,e);t.set(i,this.pluralizeValue(t.get(i),n)),r+=4+e}return this.translate(),this.output}pluralizeValue(t,e){return void 0!==t?t instanceof Array?(t.push(e),t):[t,e]:e}}e(tt,"type","iptc"),e(tt,"translateValues",!1),e(tt,"reviveValues",!1),b.set("iptc",tt),O(v,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),O(M,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);const metaTypes={jfif:!1,tiff:!1,xmp:!1,icc:!1,iptc:!1,ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1},metaProcessing={sanitize:!0,reviveValues:!0,translateKeys:!0,translateValues:!0},xmpColorModes=["Bitmap","GRAY","IndexedColor","RGB","CMYK",,,"MultiChannel","Duotone","LabColor"],metaData=function(){let t;return{getMetaData:async function(e){if(t.loading)return;const r=Object.assign({},metaTypes,metaProcessing,e);return await Ke.parse(t.currentUrl,r).then(t=>{let r={};const i=Array.from(Object.values(e)[0]);return i.length?i.forEach(e=>r[e]=t[e]):r=t||{},r.ColorMode&&(r.ColorMode=xmpColorModes[t.ColorMode]),r})},getColorMode:async function(){if(t.loading)return;return await Ke.parse(t.currentUrl,{icc:{pick:["ColorSpaceData"]}}).then(t=>{if(t&&t.ColorSpaceData)return t.ColorSpaceData})},getColorProfile:async function(){if(t.loading)return;const e=Object.assign({},metaTypes,{icc:{pick:["ProfileDescription"]},xmp:{pick:["ICCProfileName"]}},{multiSegment:!1});let r="";const i=async function(e){await Ke.parse(t.currentUrl,e).then(t=>{t&&(t.ProfileDescription&&(r=t.ProfileDescription),t.ICCProfileName&&(r=t.ICCProfileName))})};return await i(e),r||(e.multiSegment=!0,await i(e),r||void 0)},update:e=>t=e}}(),u$1=function(t,e){return t<"1e-"+e&&t>"-1e-"+e?0:Number(Math.round(t+"e"+e)+"e-"+e)},w$1=t=>t.reduce((t,e)=>t+e,0),S$1=t=>w$1(t)/t.length||0,anchorElement=document.createElement("a"),cache=new Object;let cacheOrder=new Array;const MAX_CACHE_SIZE=32;let currentUrl,currentImage,loading;const getPixelColor=function(t,e){if(loading)return;let r=Math.round(t),i=Math.round(e);return currentImage.getPixelXY(r,i)},getDropColor=function(t,e,r){if(loading)return;let i,n=Math.round(t),s=Math.round(e),a=Math.floor(r/2),o=Array(currentImage.channels);for(let t=0;t<currentImage.channels;t++)o[t]=[];for(let t=n-a;t<=n+a;t++)for(let e=s-a;e<=s+a;e++)if(i=currentImage.getPixelXY(t,e),"number"==typeof i[0])for(let t=0;t<currentImage.channels;t++)o[t].push(i[t]);for(let t=0;t<currentImage.channels;t++){let e=S$1(o[t]);i[t]=Math.round(e)}return i},imageMemoryUsage=function(){let t=currentImage.data.byteLength;return u$1(t/1024/1024,3)+" MB"},memoryUsage=function(){let t=0;for(let[,e]of Object.entries(cache))t+=e.data.byteLength;return u$1(t/1024/1024,3)+" MB"},purgeCache=function(){cacheOrder.forEach(t=>{t!==currentUrl&&delete cache[t]}),cacheOrder=[currentUrl]},maintainCacheOrder=function(t){const e=cacheOrder.indexOf(t);cacheOrder.splice(e,1),cacheOrder.push(t)},maintainCache=function(t){const e=cacheOrder.splice(0,1)[0];delete cache[e],cacheOrder.push(t)},api={get image(){if(!loading)return currentImage},getColorMode:metaData.getColorMode,getColorProfile:metaData.getColorProfile,getMetaData:metaData.getMetaData,getPixelColor:getPixelColor,getDropColor:getDropColor,imageMemoryUsage:imageMemoryUsage,memoryUsage:memoryUsage,purgeCache:purgeCache},loader=async function(t){if(loading)return api;if(anchorElement.href=t,(t=anchorElement.href)===currentUrl)return api;if(loading=!0,metaData.update({loading:loading}),cache[t])maintainCacheOrder(),currentImage=cache[t];else{cacheOrder.length>=MAX_CACHE_SIZE&&maintainCache();try{currentImage=await ijs.load(t),cache[t]=currentImage}catch(e){const r="data:"===t.substr(0,5)?t.substr(0,48):t.split("/").reverse()[0];return console.log("Could not load "+r),loading=!1,metaData.update({loading:loading}),api}}return loading=!1,currentUrl=t,metaData.update({loading:loading,currentUrl:currentUrl}),api};var index=async function(t){return await loader(t)};export default index;
//# sourceMappingURL=imageEyes.js.map
